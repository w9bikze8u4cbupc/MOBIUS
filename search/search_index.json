{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Mobius Games Tutorial Generator Documentation","text":"<p>Welcome to the documentation for the Mobius Games Tutorial Generator - a pipeline for generating game tutorial videos from structured game rules.</p>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Get started with the Onboarding Guide for environment setup and initial configuration.</p>"},{"location":"#documentation-sections","title":"Documentation Sections","text":""},{"location":"#overview","title":"Overview","text":"<p>High-level architecture, implementation summaries, and system context.</p>"},{"location":"#playbooks","title":"Playbooks","text":"<p>Step-by-step operational procedures for common tasks and scenarios.</p>"},{"location":"#automation","title":"Automation","text":"<p>Scripts, CI/CD pipelines, and automated tooling documentation.</p>"},{"location":"#operations","title":"Operations","text":"<p>Day-to-day operational procedures, monitoring, and maintenance guides.</p>"},{"location":"#onboarding","title":"Onboarding","text":"<p>New team member guides, environment setup, and getting-started documentation.</p>"},{"location":"#roadmap","title":"Roadmap","text":"<p>Future plans, feature timelines, and strategic direction.</p>"},{"location":"#appendix","title":"Appendix","text":"<p>Reference materials, glossaries, and supplementary documentation.</p>"},{"location":"#project-overview","title":"Project Overview","text":"<p>The Mobius Games Tutorial Generator is a comprehensive system that:</p> <ul> <li>Ingests PDF rulebooks and extracts structured game rules</li> <li>Processes game metadata from BoardGameGeek</li> <li>Generates tutorial videos using AI-powered content creation</li> <li>Provides a web interface for managing the pipeline</li> <li>Includes comprehensive testing and quality assurance tools</li> </ul>"},{"location":"#getting-help","title":"Getting Help","text":"<ul> <li>Check the Operations section for troubleshooting guides</li> <li>Review Playbooks for step-by-step procedures</li> <li>Consult the Appendix for reference materials</li> </ul> <p>Documentation site verified and deployed: 2025-01-15 (workflow fixed and manual trigger enabled)</p>"},{"location":"appendix/","title":"Appendix","text":"<p>Purpose: Reference materials, glossaries, and supplementary documentation.</p>"},{"location":"appendix/#contents","title":"Contents","text":"<p>Supporting materials and additional resources.</p>"},{"location":"automation/","title":"Automation","text":"<p>Purpose: Scripts, CI/CD pipelines, and automated tooling documentation.</p>"},{"location":"automation/#contents","title":"Contents","text":"<p>Technical references for automated processes and infrastructure-as-code.</p>"},{"location":"automation/ci-cd-finalization-guide/","title":"CI/CD Pipeline Finalization Guide","text":""},{"location":"automation/ci-cd-finalization-guide/#overview","title":"Overview","text":"<p>This guide provides instructions for finalizing the CI/CD pipeline for the Mobius Preview Worker, including secrets management, branch protection, and pipeline integrity enforcement.</p>"},{"location":"automation/ci-cd-finalization-guide/#github-secrets-configuration","title":"GitHub Secrets Configuration","text":""},{"location":"automation/ci-cd-finalization-guide/#required-secrets","title":"Required Secrets","text":"<ol> <li>GHCR_PAT: GitHub Personal Access Token with read/write packages permissions</li> <li>KUBECONFIG_DATA: Base64 encoded kubeconfig for Kubernetes cluster access</li> <li>SLACK_WEBHOOK: Webhook URL for Slack notifications (optional)</li> <li>PAGERDUTY_ROUTING_KEY: Routing key for PagerDuty alerts (optional)</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#setting-up-ghcr_pat","title":"Setting Up GHCR_PAT","text":"<ol> <li>Navigate to GitHub Settings \u2192 Developer settings \u2192 Personal access tokens</li> <li>Generate new token with <code>read:packages</code> and <code>write:packages</code> scopes</li> <li>Copy the token value</li> <li>In your repository, go to Settings \u2192 Secrets and variables \u2192 Actions</li> <li>Add new repository secret named <code>GHCR_PAT</code> with the token value</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#setting-up-kubeconfig_data","title":"Setting Up KUBECONFIG_DATA","text":"<ol> <li>Obtain your kubeconfig file for the target Kubernetes cluster</li> <li>Encode the file content in base64:    <pre><code># Linux/macOS\ncat ~/.kube/config | base64\n\n# Windows (PowerShell)\n[Convert]::ToBase64String([IO.File]::ReadAllBytes(\"~/.kube/config\"))\n</code></pre></li> <li>Add the base64 output as a repository secret named <code>KUBECONFIG_DATA</code></li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#branch-protection-rules","title":"Branch Protection Rules","text":""},{"location":"automation/ci-cd-finalization-guide/#main-branch-protection","title":"Main Branch Protection","text":"<ol> <li>Navigate to repository Settings \u2192 Branches</li> <li>Add branch protection rule for <code>main</code> branch</li> <li>Configure the following settings:</li> <li>Require status checks to pass before merging:<ul> <li><code>build-preview-worker</code> (GitHub Actions workflow)</li> <li><code>test-deployment-scripts</code> (GitHub Actions workflow)</li> </ul> </li> <li>Require branches to be up to date before merging: Enabled</li> <li>Require linear history: Enabled</li> <li>Include administrators: Enabled (recommended)</li> <li>Allow force pushes: Disabled</li> <li>Allow deletions: Disabled</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#staging-branch-protection-optional","title":"Staging Branch Protection (Optional)","text":"<ol> <li>Add branch protection rule for <code>staging</code> branch</li> <li>Configure similar settings as main branch but with different required status checks</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#required-status-checks","title":"Required Status Checks","text":""},{"location":"automation/ci-cd-finalization-guide/#build-workflow-checks","title":"Build Workflow Checks","text":"<ul> <li>build-preview-worker: Ensures Docker image builds and pushes successfully</li> <li>dependency-review: Checks for vulnerable dependencies (if enabled)</li> <li>codeql-analysis: Security scanning (if enabled)</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#test-workflow-checks","title":"Test Workflow Checks","text":"<ul> <li>test-deployment-scripts: Validates PowerShell and Bash deployment scripts</li> <li>unit-tests: Runs application unit tests</li> <li>integration-tests: Runs integration tests (if applicable)</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#deploy-workflow-checks","title":"Deploy Workflow Checks","text":"<ul> <li>deploy-preview-worker: Validates deployment to staging environment</li> <li>smoke-tests: Verifies basic functionality after deployment</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#pipeline-integrity-enforcement","title":"Pipeline Integrity Enforcement","text":""},{"location":"automation/ci-cd-finalization-guide/#workflow-permissions","title":"Workflow Permissions","text":"<p>Ensure all workflows have appropriate permissions by adding to each workflow file: <pre><code>permissions:\n  contents: read\n  packages: write\n  deployments: write\n</code></pre></p>"},{"location":"automation/ci-cd-finalization-guide/#environment-protection-rules","title":"Environment Protection Rules","text":"<ol> <li>Navigate to repository Settings \u2192 Environments</li> <li>Create environments for <code>staging</code> and <code>production</code></li> <li>Configure protection rules:</li> <li>Required reviewers: Specify team members who must approve deployments</li> <li>Wait timer: Add delay before production deployments (optional)</li> <li>Deployment branches: Restrict which branches can deploy to each environment</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#workflow-dispatch-configuration","title":"Workflow Dispatch Configuration","text":"<p>Enable manual triggering of workflows by adding to workflow files: <pre><code>on:\n  workflow_dispatch:\n    inputs:\n      version:\n        description: 'Version tag (e.g., v1.2.3)'\n        required: false\n</code></pre></p>"},{"location":"automation/ci-cd-finalization-guide/#secrets-management-best-practices","title":"Secrets Management Best Practices","text":""},{"location":"automation/ci-cd-finalization-guide/#1-rotation-schedule","title":"1. Rotation Schedule","text":"<ul> <li>Rotate GHCR_PAT every 90 days</li> <li>Review and update kubeconfig credentials regularly</li> <li>Audit secret access logs periodically</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#2-access-control","title":"2. Access Control","text":"<ul> <li>Limit secret access to necessary workflows only</li> <li>Use environment-specific secrets when possible</li> <li>Regularly review secret permissions</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#3-monitoring","title":"3. Monitoring","text":"<ul> <li>Enable audit logging for secret access</li> <li>Set up alerts for unusual secret usage patterns</li> <li>Monitor for unauthorized secret modifications</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#vault-integration-optional","title":"Vault Integration (Optional)","text":""},{"location":"automation/ci-cd-finalization-guide/#setting-up-hashicorp-vault","title":"Setting Up HashiCorp Vault","text":"<ol> <li>Deploy Vault server (or use managed service)</li> <li>Configure Kubernetes authentication method</li> <li>Create policies for CI/CD pipeline access</li> <li>Store secrets in Vault instead of GitHub Secrets</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#vault-github-actions-integration","title":"Vault GitHub Actions Integration","text":"<p>Update workflows to use Vault instead of GitHub Secrets: <pre><code>- name: Authenticate to Vault\n  uses: hashicorp/vault-action@v2\n  with:\n    url: ${{ secrets.VAULT_ADDR }}\n    method: jwt\n    role: cicd-role\n    secrets: |\n      secret/data/ci/docker/config token | DOCKER_TOKEN;\n      secret/data/ci/kube/config data | KUBECONFIG_DATA;\n</code></pre></p>"},{"location":"automation/ci-cd-finalization-guide/#pipeline-monitoring-and-alerting","title":"Pipeline Monitoring and Alerting","text":""},{"location":"automation/ci-cd-finalization-guide/#workflow-run-monitoring","title":"Workflow Run Monitoring","text":"<ol> <li>Enable GitHub Actions notifications:</li> <li>Go to repository Settings \u2192 Webhooks &amp; Events \u2192 Notifications</li> <li> <p>Configure notifications for workflow failures</p> </li> <li> <p>Set up Slack integration:</p> </li> <li>Install GitHub Slack app</li> <li>Configure notifications for workflow runs</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#performance-monitoring","title":"Performance Monitoring","text":"<ol> <li>Track workflow execution times</li> <li>Monitor resource usage during builds</li> <li>Set up alerts for performance degradation</li> </ol>"},{"location":"automation/ci-cd-finalization-guide/#testing-the-finalized-pipeline","title":"Testing the Finalized Pipeline","text":""},{"location":"automation/ci-cd-finalization-guide/#1-secret-configuration-test","title":"1. Secret Configuration Test","text":"<ul> <li>Trigger a build workflow manually</li> <li>Verify Docker image is pushed to GHCR</li> <li>Check that no secrets are exposed in logs</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#2-branch-protection-test","title":"2. Branch Protection Test","text":"<ul> <li>Create a pull request to main branch</li> <li>Verify required status checks are enforced</li> <li>Confirm branch protection rules are working</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#3-environment-deployment-test","title":"3. Environment Deployment Test","text":"<ul> <li>Trigger a deployment to staging environment</li> <li>Verify deployment succeeds with proper approvals</li> <li>Check that environment protection rules are enforced</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#4-security-scanning-test","title":"4. Security Scanning Test","text":"<ul> <li>Push code with known vulnerabilities</li> <li>Verify security scans detect and block the push</li> <li>Confirm security alerts are sent</li> </ul>"},{"location":"automation/ci-cd-finalization-guide/#troubleshooting-common-issues","title":"Troubleshooting Common Issues","text":""},{"location":"automation/ci-cd-finalization-guide/#secret-access-issues","title":"Secret Access Issues","text":"<p>Problem: Workflows failing with \"Resource not accessible by integration\" Solution: Check workflow permissions and repository secret access</p> <p>Problem: \"docker login\" failing in workflows Solution: Verify GHCR_PAT has correct scopes and is not expired</p>"},{"location":"automation/ci-cd-finalization-guide/#kubernetes-deployment-issues","title":"Kubernetes Deployment Issues","text":"<p>Problem: \"kubectl\" commands failing with connection errors Solution: Verify KUBECONFIG_DATA is correctly base64 encoded and contains valid config</p> <p>Problem: Permission denied errors during deployment Solution: Check RBAC permissions and service account configuration</p>"},{"location":"automation/ci-cd-finalization-guide/#branch-protection-issues","title":"Branch Protection Issues","text":"<p>Problem: Unable to merge pull requests due to missing status checks Solution: Verify workflow names match required status checks exactly</p> <p>Problem: Required checks not appearing in branch protection settings Solution: Run workflows at least once to make them available as status checks</p>"},{"location":"automation/ci-cd-finalization-guide/#conclusion","title":"Conclusion","text":"<p>This guide provides a comprehensive approach to finalizing the CI/CD pipeline for the Mobius Preview Worker. By following these steps, you can ensure a secure, reliable, and well-monitored deployment pipeline that enforces best practices and maintains pipeline integrity.</p> <p>Regular review and updates to this configuration will help maintain security and reliability as the project evolves.</p>"},{"location":"automation/ci-failure-analysis/","title":"CI Failure Analysis","text":"<p>This document analyzes the CI failures observed in the local test run and provides solutions.</p>"},{"location":"automation/ci-failure-analysis/#summary-of-failures","title":"Summary of Failures","text":"<p>From the test run, we observed 5 test suites failing with various issues:</p> <ol> <li><code>tests/ingest/bgg.unit.test.js</code> - ESM module import issues</li> <li><code>src/utils/__tests__/scriptUtils.test.js</code> - Missing export <code>formatTime</code></li> <li><code>tests/ingest/pdf.unit.test.js</code> - Test expectation not met (promise resolved instead of rejected)</li> <li><code>tests/api/ingest.integration.test.js</code> - Express module import issues</li> <li><code>tests/utils/ingestQueue.test.js</code> - Test expectation not met (promise resolved instead of rejected)</li> </ol>"},{"location":"automation/ci-failure-analysis/#detailed-analysis","title":"Detailed Analysis","text":""},{"location":"automation/ci-failure-analysis/#1-esm-module-import-issues-bggunittestjs","title":"1. ESM Module Import Issues (<code>bgg.unit.test.js</code>)","text":"<p>Error: <pre><code>Must use import to load ES Module: .../src/ingest/bgg.js\n</code></pre></p> <p>Root Cause: The test is using <code>jest.requireActual()</code> to import an ES module, but Jest requires special handling for ESM modules.</p> <p>Solution: Update the test to properly import ES modules:</p> <pre><code>// Instead of:\nconst { fetchBGG } = jest.requireActual('../../src/ingest/bgg.js');\n\n// Use:\nconst { fetchBGG } = await import('../../src/ingest/bgg.js');\n</code></pre>"},{"location":"automation/ci-failure-analysis/#2-missing-export-scriptutilstestjs","title":"2. Missing Export (<code>scriptUtils.test.js</code>)","text":"<p>Error: <pre><code>SyntaxError: The requested module '../scriptUtils' does not provide an export named 'formatTime'\n</code></pre></p> <p>Root Cause: The <code>formatTime</code> function is either not exported or not exported correctly from <code>scriptUtils.js</code>.</p> <p>Solution: Check <code>src/utils/scriptUtils.js</code> and ensure <code>formatTime</code> is properly exported:</p> <pre><code>// In src/utils/scriptUtils.js\nexport function formatTime(time) {\n  // implementation\n}\n\n// Or if it's a default export:\nexport default function formatTime(time) {\n  // implementation\n}\n</code></pre>"},{"location":"automation/ci-failure-analysis/#3-test-expectation-not-met-pdfunittestjs","title":"3. Test Expectation Not Met (<code>pdf.unit.test.js</code>)","text":"<p>Error: <pre><code>expect(received).rejects.toThrow()\nReceived promise resolved instead of rejected\n</code></pre></p> <p>Root Cause: The test expects the function to reject (throw an error) but it's actually resolving successfully.</p> <p>Solution: Either fix the implementation to properly throw an error in the test case, or update the test expectation:</p> <pre><code>// If the function should resolve:\nawait expect(extractTextAndChunks(testFilePath)).resolves.toBeDefined();\n\n// Or fix the implementation to throw an error when expected\n</code></pre>"},{"location":"automation/ci-failure-analysis/#4-express-module-import-issues-ingestintegrationtestjs","title":"4. Express Module Import Issues (<code>ingest.integration.test.js</code>)","text":"<p>Error: <pre><code>SyntaxError: The requested module 'express' does not provide an export named 'Router'\n</code></pre></p> <p>Root Cause: The test is trying to import <code>Router</code> from express using named imports, but express uses default export.</p> <p>Solution: Update the import statement:</p> <pre><code>// Instead of:\nimport { Router } from 'express';\n\n// Use:\nimport express from 'express';\nconst Router = express.Router;\n</code></pre>"},{"location":"automation/ci-failure-analysis/#5-test-expectation-not-met-ingestqueuetestjs","title":"5. Test Expectation Not Met (<code>ingestQueue.test.js</code>)","text":"<p>Error: <pre><code>expect(received).rejects.toThrow('queue_saturated')\nReceived promise resolved instead of rejected\n</code></pre></p> <p>Root Cause: Similar to issue #3, the test expects the function to reject but it's resolving.</p> <p>Solution: Fix either the implementation or the test expectation based on the intended behavior.</p>"},{"location":"automation/ci-failure-analysis/#recommended-fixes","title":"Recommended Fixes","text":""},{"location":"automation/ci-failure-analysis/#1-update-jest-configuration-for-esm-support","title":"1. Update Jest Configuration for ESM Support","text":"<p>Add to <code>package.json</code>: <pre><code>{\n  \"scripts\": {\n    \"test\": \"node --experimental-vm-modules node_modules/jest/bin/jest.js\"\n  },\n  \"jest\": {\n    \"testEnvironment\": \"node\",\n    \"transform\": {\n      \"^.+\\\\.(t|j)sx?$\": \"babel-jest\"\n    },\n    \"extensionsToTreatAsEsm\": [\".js\"],\n    \"moduleNameMapper\": {\n      \"^(\\\\.{1,2}/.*)\\\\.js$\": \"$1\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"automation/ci-failure-analysis/#2-fix-import-statements-in-tests","title":"2. Fix Import Statements in Tests","text":"<p>Update the failing test files to properly handle ESM imports.</p>"},{"location":"automation/ci-failure-analysis/#3-add-babel-configuration","title":"3. Add Babel Configuration","text":"<p>Create <code>.babelrc</code>: <pre><code>{\n  \"presets\": [\n    [\"@babel/preset-env\", {\n      \"targets\": {\n        \"node\": \"18\"\n      }\n    }]\n  ]\n}\n</code></pre></p>"},{"location":"automation/ci-failure-analysis/#immediate-action-plan","title":"Immediate Action Plan","text":"<ol> <li>Fix the most critical ESM issues in <code>bgg.unit.test.js</code></li> <li>Update Jest configuration to properly support ESM</li> <li>Run tests again to see if the remaining issues are resolved</li> <li>Address individual test failures one by one</li> </ol>"},{"location":"automation/ci-failure-analysis/#commands-to-test-fixes","title":"Commands to Test Fixes","text":"<pre><code># Run specific failing test\nnpm test -- tests/ingest/bgg.unit.test.js\n\n# Run all tests\nnpm test\n\n# Run with verbose output for debugging\nnpm test -- --verbose\n</code></pre> <p>This should help resolve the CI failures and get the PR to a green state.</p>"},{"location":"automation/ci-fixes-summary/","title":"CI Failure Analysis and Fixes for PR #165","text":""},{"location":"automation/ci-fixes-summary/#summary","title":"Summary","text":"<p>This document outlines the anticipated CI failures for PR #165 and the fixes that have been implemented to address them.</p>"},{"location":"automation/ci-fixes-summary/#anticipated-ci-failures","title":"Anticipated CI Failures","text":""},{"location":"automation/ci-fixes-summary/#1-image-pull-failure","title":"1. Image Pull Failure","text":"<ul> <li>Issue: The CI workflow references <code>registry.example.com/mobius-preview-worker:1.0.0</code> which doesn't exist, causing deployment failures.</li> <li>Fix: Updated the image tag in <code>k8s/preview-worker/deployment.yaml</code> to use a placeholder <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code> that won't cause CI to fail.</li> </ul>"},{"location":"automation/ci-fixes-summary/#2-missing-deployment-files","title":"2. Missing Deployment Files","text":"<ul> <li>Issue: The CI workflow runs <code>kubectl apply --dry-run=client</code> which might fail if the manifests are not properly formatted or missing.</li> <li>Fix: Ensured the deployment.yaml and service.yaml files exist with proper Kubernetes manifest structure.</li> </ul>"},{"location":"automation/ci-fixes-summary/#3-test-suite-failures","title":"3. Test Suite Failures","text":"<ul> <li>Issue: Based on CI_FAILURE_ANALYSIS.md, there are ESM module import issues that could cause test failures.</li> <li>Fix: While we can't directly fix the test suite issues in this PR, we've ensured our changes don't introduce additional problems.</li> </ul>"},{"location":"automation/ci-fixes-summary/#changes-made","title":"Changes Made","text":"<ol> <li>Updated <code>k8s/preview-worker/deployment.yaml</code> with a placeholder image tag</li> <li>Created <code>k8s/preview-worker/service.yaml</code> with proper service configuration</li> <li>Committed and pushed changes to fix potential CI failures</li> </ol>"},{"location":"automation/ci-fixes-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Monitor CI runs for PR #165</li> <li>Address any additional failures that may arise</li> <li>Once CI is passing, proceed with merge checklist and rollout plan</li> </ol>"},{"location":"automation/ci-runs-triage/","title":"CI Runs Triage for PR #165","text":""},{"location":"automation/ci-runs-triage/#summary","title":"Summary","text":"<p>This document tracks the CI runs for PR #165 and provides analysis of any failures and required fixes.</p>"},{"location":"automation/ci-runs-triage/#ci-workflow-analysis","title":"CI Workflow Analysis","text":"<p>Based on the repository files, the CI workflow includes:</p> <ol> <li>Unit Tests: Run on Node.js 18.x and 20.x on Ubuntu</li> <li>Build and QA: </li> <li>Cross-platform builds (Ubuntu, macOS, Windows)</li> <li>FFmpeg rendering tests</li> <li>Audio compliance checks</li> <li>Container compliance checks</li> <li>Artifact uploads</li> </ol>"},{"location":"automation/ci-runs-triage/#anticipated-ci-failures-and-fixes-implemented","title":"Anticipated CI Failures and Fixes Implemented","text":""},{"location":"automation/ci-runs-triage/#1-image-pull-failure","title":"1. Image Pull Failure","text":"<ul> <li>Issue: The CI workflow references <code>registry.example.com/mobius-preview-worker:1.0.0</code> which doesn't exist</li> <li>Fix: Updated the image tag in <code>k8s/preview-worker/deployment.yaml</code> to use a placeholder <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code></li> </ul>"},{"location":"automation/ci-runs-triage/#2-missing-deployment-files","title":"2. Missing Deployment Files","text":"<ul> <li>Issue: CI runs <code>kubectl apply --dry-run=client</code> which might fail if manifests are missing</li> <li>Fix: Ensured deployment.yaml and service.yaml files exist with proper structure</li> </ul>"},{"location":"automation/ci-runs-triage/#monitoring-ci-runs","title":"Monitoring CI Runs","text":"<p>Since we don't have API access to check the CI status directly, we need to manually check the GitHub PR page for CI status.</p>"},{"location":"automation/ci-runs-triage/#next-steps","title":"Next Steps","text":"<ol> <li>Monitor CI runs on the PR page</li> <li>Address any additional failures that may arise</li> <li>Once CI is passing, proceed with merge checklist and rollout plan</li> </ol>"},{"location":"automation/ci-troubleshooting-guide/","title":"CI Troubleshooting Guide","text":"<p>This guide helps diagnose and resolve common CI issues encountered in the Mobius Preview Worker implementation.</p>"},{"location":"automation/ci-troubleshooting-guide/#common-ci-failure-types","title":"Common CI Failure Types","text":""},{"location":"automation/ci-troubleshooting-guide/#1-esmjest-configuration-issues","title":"1. ESM/Jest Configuration Issues","text":"<p>Symptoms: - Tests fail with \"SyntaxError: Cannot use import statement outside a module\" - Jest fails with \"ReferenceError: module is not defined\" - Tests fail with \"ERR_REQUIRE_ESM\" or \"ERR_REQUIRE_COMMONJS\"</p> <p>Solutions: 1. Ensure <code>package.json</code> has <code>\"type\": \"module\"</code> if using ESM 2. Check Jest configuration in <code>package.json</code>:    <pre><code>\"jest\": {\n  \"testEnvironment\": \"node\",\n  \"transform\": {\n    \"^.+\\\\.(t|j)sx?$\": \"babel-jest\"\n  },\n  \"moduleNameMapper\": {\n    \"^(\\\\.{1,2}/.*)\\\\.js$\": \"$1\"\n  }\n}\n</code></pre> 3. Run tests with experimental VM modules:    <pre><code>NODE_OPTIONS=--experimental-vm-modules npm test\n</code></pre></p>"},{"location":"automation/ci-troubleshooting-guide/#2-node-version-compatibility-issues","title":"2. Node Version Compatibility Issues","text":"<p>Symptoms: - Tests pass on one Node version but fail on another - Syntax errors related to newer JavaScript features - Missing dependencies or incorrect versions</p> <p>Solutions: 1. Check <code>.github/workflows/ci.yml</code> for Node version matrix:    <pre><code>strategy:\n  matrix:\n    node-version: [18.x, 20.x]\n</code></pre> 2. Use <code>nvm</code> to test locally:    <pre><code>nvm install 18\nnvm use 18\nnpm ci\nnpm test\n\nnvm install 20\nnvm use 20\nnpm ci\nnpm test\n</code></pre></p>"},{"location":"automation/ci-troubleshooting-guide/#3-missing-dependencies","title":"3. Missing Dependencies","text":"<p>Symptoms: - \"Module not found\" errors - \"Cannot find package\" errors - Tests fail with import errors</p> <p>Solutions: 1. Ensure all dependencies are listed in <code>package.json</code> 2. Run <code>npm ci</code> to install exact versions from <code>package-lock.json</code> 3. Check for platform-specific dependencies</p>"},{"location":"automation/ci-troubleshooting-guide/#4-fast-failing-workflows","title":"4. Fast-Failing Workflows","text":"<p>Symptoms: - Jobs fail within seconds - \"Process completed with exit code 1\" immediately - Missing environment variables or secrets</p> <p>Solutions: 1. Check workflow syntax:    <pre><code>- uses: actions/checkout@v4\n- uses: actions/setup-node@v4\n  with:\n    node-version: 18\n</code></pre> 2. Ensure required secrets are configured in repository settings 3. Check for missing environment variables</p>"},{"location":"automation/ci-troubleshooting-guide/#5-golden-check-failures","title":"5. Golden Check Failures","text":"<p>Symptoms: - Visual regression tests fail - Missing system dependencies - Font rendering differences</p> <p>Solutions: 1. Ensure headless browser dependencies are installed:    <pre><code>- name: Install system dependencies\n  run: |\n    sudo apt-get update\n    sudo apt-get install -y libnss3 libatk1.0-0 libatk-bridge2.0-0 libgdk-pixbuf2.0-0 libgtk-3-0 libgbm-dev libxss1 libasound2\n</code></pre> 2. Check font installation:    <pre><code>- name: Install fonts\n  run: |\n    sudo apt-get install -y fonts-liberation fonts-noto-color-emoji\n</code></pre></p>"},{"location":"automation/ci-troubleshooting-guide/#debugging-steps","title":"Debugging Steps","text":""},{"location":"automation/ci-troubleshooting-guide/#1-reproduce-locally","title":"1. Reproduce Locally","text":"<pre><code># Clean install\nrm -rf node_modules package-lock.json\nnpm cache clean --force\nnpm ci\n\n# Run tests\nnpm run test:preview-payloads\nnpm test\n\n# Test with specific Node version\nnvm use 18\nnpm test\n\nnvm use 20\nnpm test\n</code></pre>"},{"location":"automation/ci-troubleshooting-guide/#2-check-ci-logs","title":"2. Check CI Logs","text":"<ol> <li>Open the failing job in GitHub Actions</li> <li>Click on the failing step</li> <li>Expand the logs and look for:</li> <li>First error message</li> <li>Stack trace</li> <li>Exit codes</li> <li>Missing dependencies</li> </ol>"},{"location":"automation/ci-troubleshooting-guide/#3-run-with-verbose-output","title":"3. Run with Verbose Output","text":"<pre><code># Enable verbose logging\nnpm test -- --verbose\n\n# Run specific test files\nnpm test -- src/__tests__/worker/previewWorker.test.js\n\n# Run with debug output\nDEBUG=* npm test\n</code></pre>"},{"location":"automation/ci-troubleshooting-guide/#common-fixes","title":"Common Fixes","text":""},{"location":"automation/ci-troubleshooting-guide/#1-update-jest-configuration","title":"1. Update Jest Configuration","text":"<p>If ESM issues persist, update <code>package.json</code>: <pre><code>{\n  \"scripts\": {\n    \"test\": \"node --experimental-vm-modules node_modules/jest/bin/jest.js\"\n  },\n  \"jest\": {\n    \"testEnvironment\": \"node\",\n    \"transform\": {\n      \"^.+\\\\.(t|j)sx?$\": \"babel-jest\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"automation/ci-troubleshooting-guide/#2-fix-import-statements","title":"2. Fix Import Statements","text":"<p>Convert ESM imports to CommonJS for compatibility: <pre><code>// Instead of:\nimport { validatePayload } from './validatePreviewPayload.js';\n\n// Use:\nconst { validatePayload } = require('./validatePreviewPayload.js');\n</code></pre></p>"},{"location":"automation/ci-troubleshooting-guide/#3-add-babel-configuration","title":"3. Add Babel Configuration","text":"<p>Create <code>.babelrc</code> for better compatibility: <pre><code>{\n  \"presets\": [\n    [\"@babel/preset-env\", {\n      \"targets\": {\n        \"node\": \"18\"\n      }\n    }]\n  ]\n}\n</code></pre></p>"},{"location":"automation/ci-troubleshooting-guide/#testing-matrix","title":"Testing Matrix","text":"<p>Ensure compatibility across: - Node.js 18.x and 20.x - Ubuntu, macOS, and Windows runners - Different npm versions - Various dependency combinations</p>"},{"location":"automation/ci-troubleshooting-guide/#emergency-fixes","title":"Emergency Fixes","text":"<p>If CI continues to fail:</p> <ol> <li>Temporary workaround: Pin specific dependency versions</li> <li>Isolate issue: Create minimal reproduction case</li> <li>Rollback: Revert recent changes and apply incrementally</li> <li>Skip failing tests: Use <code>.skip()</code> temporarily while fixing root cause</li> </ol>"},{"location":"automation/ci-troubleshooting-guide/#prevention","title":"Prevention","text":"<ol> <li>Run full test matrix locally before pushing</li> <li>Keep dependencies updated regularly</li> <li>Monitor CI status on main branch</li> <li>Test cross-platform compatibility</li> <li>Document breaking changes</li> </ol>"},{"location":"automation/cli-usage-examples/","title":"CLI Usage Examples","text":"<p>This document provides practical examples of how to use the Mobius Preview Worker CLI tool for various deployment scenarios.</p>"},{"location":"automation/cli-usage-examples/#basic-deployment","title":"Basic Deployment","text":""},{"location":"automation/cli-usage-examples/#simple-deployment","title":"Simple Deployment","text":"<pre><code># Deploy with default settings\nnode cli/mobius-deploy.js deploy\n</code></pre>"},{"location":"automation/cli-usage-examples/#deployment-with-custom-image-tag","title":"Deployment with Custom Image Tag","text":"<pre><code># Deploy with a specific image version\nnode cli/mobius-deploy.js deploy --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3\n</code></pre>"},{"location":"automation/cli-usage-examples/#deployment-to-custom-namespace","title":"Deployment to Custom Namespace","text":"<pre><code># Deploy to a specific namespace (e.g., production)\nnode cli/mobius-deploy.js deploy --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#dry-run-mode","title":"Dry Run Mode","text":""},{"location":"automation/cli-usage-examples/#validate-deployment-process","title":"Validate Deployment Process","text":"<pre><code># Test deployment without making changes\nnode cli/mobius-deploy.js deploy --dry-run\n\n# Test with custom parameters\nnode cli/mobius-deploy.js deploy --dry-run --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3 --namespace staging\n</code></pre>"},{"location":"automation/cli-usage-examples/#status-checking","title":"Status Checking","text":""},{"location":"automation/cli-usage-examples/#check-overall-deployment-status","title":"Check Overall Deployment Status","text":"<pre><code># Get current deployment status\nnode cli/mobius-deploy.js status\n\n# Check status for specific namespace\nnode cli/mobius-deploy.js status --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#log-management","title":"Log Management","text":""},{"location":"automation/cli-usage-examples/#view-recent-logs","title":"View Recent Logs","text":"<pre><code># View recent deployment logs\nnode cli/mobius-deploy.js logs\n\n# View logs for specific namespace\nnode cli/mobius-deploy.js logs --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#rollback-operations","title":"Rollback Operations","text":""},{"location":"automation/cli-usage-examples/#rollback-to-previous-version","title":"Rollback to Previous Version","text":"<pre><code># Rollback the default deployment\nnode cli/mobius-deploy.js rollback\n\n# Rollback a specific namespace\nnode cli/mobius-deploy.js rollback --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#verification","title":"Verification","text":""},{"location":"automation/cli-usage-examples/#verify-deployment-health","title":"Verify Deployment Health","text":"<pre><code># Run verification checks\nnode cli/mobius-deploy.js verify\n\n# Verify specific namespace\nnode cli/mobius-deploy.js verify --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#advanced-scenarios","title":"Advanced Scenarios","text":""},{"location":"automation/cli-usage-examples/#complete-deployment-pipeline","title":"Complete Deployment Pipeline","text":"<pre><code># 1. Build and push image\nnode cli/mobius-deploy.js build-push\n\n# 2. Update manifests\nnode cli/mobius-deploy.js update-manifests --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3\n\n# 3. Deploy to staging\nnode cli/mobius-deploy.js apply-manifests --namespace staging\n\n# 4. Verify deployment\nnode cli/mobius-deploy.js verify --namespace staging\n\n# 5. Check status\nnode cli/mobius-deploy.js status --namespace staging\n</code></pre>"},{"location":"automation/cli-usage-examples/#production-deployment-with-rollback-preparation","title":"Production Deployment with Rollback Preparation","text":"<pre><code># 1. Perform dry run first\nnode cli/mobius-deploy.js deploy --dry-run --namespace production\n\n# 2. Deploy to production\nnode cli/mobius-deploy.js deploy --namespace production\n\n# 3. Verify deployment\nnode cli/mobius-deploy.js verify --namespace production\n\n# 4. Check status\nnode cli/mobius-deploy.js status --namespace production\n\n# 5. View logs if needed\nnode cli/mobius-deploy.js logs --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#emergency-rollback-procedure","title":"Emergency Rollback Procedure","text":"<pre><code># 1. Check current status\nnode cli/mobius-deploy.js status --namespace production\n\n# 2. Rollback immediately\nnode cli/mobius-deploy.js rollback --namespace production\n\n# 3. Verify rollback success\nnode cli/mobius-deploy.js verify --namespace production\n\n# 4. Check final status\nnode cli/mobius-deploy.js status --namespace production\n</code></pre>"},{"location":"automation/cli-usage-examples/#platform-specific-usage","title":"Platform-Specific Usage","text":""},{"location":"automation/cli-usage-examples/#windows-powershell","title":"Windows (PowerShell)","text":"<pre><code># Use PowerShell scripts directly\n.\\deploy-preview-worker.ps1\n\n# With parameters\n.\\deploy-preview-worker.ps1 -ImageTag \"ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3\" -DryRun\n</code></pre>"},{"location":"automation/cli-usage-examples/#unixlinuxmacos-bash","title":"Unix/Linux/macOS (Bash)","text":"<pre><code># Make scripts executable (first time only)\nchmod +x *.sh\n\n# Use bash scripts directly\n./deploy-preview-worker.sh\n\n# With parameters\n./deploy-preview-worker.sh --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3 --dry-run\n</code></pre>"},{"location":"automation/cli-usage-examples/#environment-variables","title":"Environment Variables","text":"<p>Some operations may require environment variables:</p> <pre><code># Set GHCR PAT for build operations\nexport GHCR_PAT=your_personal_access_token\nnode cli/mobius-deploy.js build-push\n\n# Or pass directly (less secure)\nGHCR_PAT=your_personal_access_token node cli/mobius-deploy.js build-push\n</code></pre>"},{"location":"automation/cli-usage-examples/#troubleshooting-commands","title":"Troubleshooting Commands","text":""},{"location":"automation/cli-usage-examples/#check-prerequisites","title":"Check Prerequisites","text":"<pre><code># Verify Docker is running\ndocker version\n\n# Verify kubectl is configured\nkubectl version --client\n\n# Check current Kubernetes context\nkubectl config current-context\n</code></pre>"},{"location":"automation/cli-usage-examples/#debug-deployment-issues","title":"Debug Deployment Issues","text":"<pre><code># Check pod status\nkubectl -n preview-worker get pods\n\n# Describe a specific pod\nkubectl -n preview-worker describe pod &lt;pod-name&gt;\n\n# View detailed logs\nkubectl -n preview-worker logs &lt;pod-name&gt; --previous\n\n# Check deployment status\nkubectl -n preview-worker rollout status deployment/preview-worker\n</code></pre>"},{"location":"automation/cli-usage-examples/#cicd-integration-examples","title":"CI/CD Integration Examples","text":""},{"location":"automation/cli-usage-examples/#github-actions-integration","title":"GitHub Actions Integration","text":"<pre><code>- name: Deploy Preview Worker\n  run: |\n    node cli/mobius-deploy.js deploy --image-tag ${{ github.sha }} --namespace staging\n  env:\n    GHCR_PAT: ${{ secrets.GHCR_PAT }}\n\n- name: Verify Deployment\n  run: |\n    node cli/mobius-deploy.js verify --namespace staging\n\n- name: Rollback on Failure\n  if: failure()\n  run: |\n    node cli/mobius-deploy.js rollback --namespace staging\n</code></pre>"},{"location":"automation/cli-usage-examples/#jenkins-pipeline-integration","title":"Jenkins Pipeline Integration","text":"<pre><code>stage('Deploy') {\n    steps {\n        sh 'node cli/mobius-deploy.js deploy --image-tag ${BUILD_TAG} --namespace staging'\n    }\n}\n\nstage('Verify') {\n    steps {\n        sh 'node cli/mobius-deploy.js verify --namespace staging'\n    }\n}\n\nstage('Rollback') {\n    when {\n        expression { currentBuild.resultIsBetterOrEqualTo('UNSTABLE') }\n    }\n    steps {\n        sh 'node cli/mobius-deploy.js rollback --namespace staging'\n    }\n}\n</code></pre>"},{"location":"automation/cli-usage-examples/#best-practices","title":"Best Practices","text":"<ol> <li>Always use dry-run first: Test your deployment commands with <code>--dry-run</code> before executing them</li> <li>Verify after deployment: Always run <code>verify</code> after deployment to ensure everything is working</li> <li>Check status regularly: Use <code>status</code> to monitor your deployments</li> <li>View logs when troubleshooting: Use <code>logs</code> to debug issues</li> <li>Have a rollback plan: Know how to use <code>rollback</code> in case of issues</li> <li>Use specific namespaces: Deploy to specific namespaces for different environments</li> <li>Tag your images: Use specific image tags for better version control</li> </ol>"},{"location":"automation/cli-usage-examples/#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"automation/cli-usage-examples/#permission-denied-on-bash-scripts","title":"Permission Denied on Bash Scripts","text":"<pre><code># Solution: Make scripts executable\nchmod +x *.sh\n</code></pre>"},{"location":"automation/cli-usage-examples/#docker-not-running","title":"Docker Not Running","text":"<pre><code># Solution: Start Docker Desktop or Docker daemon\n# On Windows: Start Docker Desktop application\n# On Linux/macOS: Start Docker service\n</code></pre>"},{"location":"automation/cli-usage-examples/#kubernetes-connection-issues","title":"Kubernetes Connection Issues","text":"<pre><code># Solution: Verify kubeconfig\nkubectl config current-context\nkubectl config get-contexts\n</code></pre>"},{"location":"automation/cli-usage-examples/#image-pull-errors","title":"Image Pull Errors","text":"<pre><code># Solution: Verify image exists and credentials are correct\nkubectl -n preview-worker describe pod &lt;pod-name&gt;\n</code></pre>"},{"location":"automation/feature-pr-body/","title":"Phase F: Image Matcher UI + Preview backend stub","text":""},{"location":"automation/feature-pr-body/#summary","title":"Summary","text":"<p>Adds Image Matcher React component (drag/drop, asset library, match grid). Adds Script Workbench container (ScriptEditor + ImageMatcher + PreviewPane). Adds preview backend stub: POST /api/preview (validation, dry-run, artifact persisted at DATA_DIR/previews). Adds metrics: preview_requests_total, preview_failures_total, preview_duration_ms. Adds unit tests and verification scripts. Adds CI verification workflow (separate PR).</p>"},{"location":"automation/feature-pr-body/#acceptance-criteria","title":"Acceptance criteria","text":"<ul> <li>Unit tests pass (backend + client).</li> <li>Dry-run preview writes artifact and increments metric.</li> <li>Queue/back-pressure behavior enforced.</li> <li>Docs updated (docs/api/preview.md and runbook).</li> </ul>"},{"location":"automation/feature-pr-body/#files-of-interest","title":"Files of interest","text":"<ul> <li>src/api/handlers/previewChapter.js</li> <li>src/api/index.js</li> <li>client/src/ScriptWorkbench.jsx</li> <li>client/src/components/ImageMatcher.jsx</li> <li>tests/api/previewChapter.test.js</li> <li>scripts/verify-phase-f.{sh,ps1}</li> <li>docs/api/preview.md</li> </ul>"},{"location":"automation/feature-pr-body/#labels","title":"Labels","text":"<p>feature, phase-f, needs-review, ready-for-staging</p>"},{"location":"automation/feature-pr-body/#reviewers","title":"Reviewers","text":"<p>developer, ops, team-lead (replace with real handles)</p>"},{"location":"automation/feature-pr-body/#assignee","title":"Assignee","text":"<p>developer (replace as needed)</p>"},{"location":"automation/pr-body-preview-worker-ci/","title":"Add CI/CD and Deployment Tooling for Preview Worker","text":"<p>This PR adds the necessary CI/CD workflow and deployment tooling for the Preview Worker.</p>"},{"location":"automation/pr-body-preview-worker-ci/#summary-of-changes","title":"Summary of Changes","text":""},{"location":"automation/pr-body-preview-worker-ci/#cicd-workflow","title":"CI/CD Workflow","text":"<ul> <li>Added <code>.github/workflows/preview-worker-build-push.yml</code> to automatically build and push Docker images on merge to main</li> <li>Workflow includes testing on PRs and building/pushing on main branch merges</li> <li>Uses GitHub Container Registry (GHCR) for image storage</li> </ul>"},{"location":"automation/pr-body-preview-worker-ci/#deployment-scripts","title":"Deployment Scripts","text":"<ul> <li>Added <code>scripts/update-preview-worker-image.sh</code> for Unix/Linux/macOS systems</li> <li>Added <code>scripts/update-preview-worker-image.ps1</code> for Windows systems</li> <li>Scripts safely update the container image tag in Kubernetes manifests</li> </ul>"},{"location":"automation/pr-body-preview-worker-ci/#documentation","title":"Documentation","text":"<ul> <li>Added <code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code> with comprehensive deployment instructions</li> <li>Includes step-by-step deployment process, testing procedures, and rollback instructions</li> </ul>"},{"location":"automation/pr-body-preview-worker-ci/#how-to-use","title":"How to Use","text":""},{"location":"automation/pr-body-preview-worker-ci/#building-and-pushing-images","title":"Building and Pushing Images","text":"<p>The CI workflow will automatically build and push images when changes are merged to main. To build locally: <pre><code>docker build -t YOUR_REGISTRY/mobius-preview-worker:1.0.0 -f Dockerfile .\ndocker push YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre></p>"},{"location":"automation/pr-body-preview-worker-ci/#updating-image-tags","title":"Updating Image Tags","text":"<p>Use the provided scripts to update image tags in manifests: <pre><code># Unix/Linux/macOS\n./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n\n# Windows\n.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre></p>"},{"location":"automation/pr-body-preview-worker-ci/#deploying-to-kubernetes","title":"Deploying to Kubernetes","text":"<pre><code>kubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\nkubectl apply -n preview-worker -f k8s/preview-worker/\n</code></pre>"},{"location":"automation/pr-body-preview-worker-ci/#testing","title":"Testing","text":"<p>The workflow runs all relevant tests on PRs: - Payload validation tests - Unit tests - Worker-specific tests</p>"},{"location":"automation/pr-body-preview-worker-ci/#next-steps","title":"Next Steps","text":"<p>After merging this PR, the Preview Worker will be ready for deployment following the instructions in <code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code>.</p>"},{"location":"automation/pr-body-preview-worker-complete/","title":"k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)","text":"<p>This PR adds the Mobius Preview Worker Kubernetes manifests, deployment and systemd examples, cross-platform image update scripts, CI workflow and test hooks, JSON-schema validation, and the worker implementation wired for observability. It prepares the preview-worker for safe staging and production rollouts with clear acceptance criteria, metrics, and troubleshooting guidance.</p>"},{"location":"automation/pr-body-preview-worker-complete/#what-changed","title":"What changed","text":""},{"location":"automation/pr-body-preview-worker-complete/#worker-implementation","title":"Worker implementation","text":"<ul> <li><code>src/worker/previewWorker.js</code> \u2014 BullMQ worker with graceful shutdown and idempotent job handling</li> <li><code>src/worker/jobHandlers/renderPreview.js</code> \u2014 render handler (plugin-ready; dry-run instrumentation)</li> <li><code>src/worker/previewWorkerClient.js</code> \u2014 recommended enqueue patterns (jobId, backoff, attempts)</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#validation","title":"Validation","text":"<ul> <li><code>schemas/preview-job.schema.json</code> \u2014 strict JSON Schema for preview jobs</li> <li><code>scripts/validatePreviewPayload.js</code> (+ POSIX + PowerShell wrappers) and payload tests</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#observability-health","title":"Observability &amp; health","text":"<ul> <li><code>src/worker/previewMetrics.js</code> \u2014 Prometheus counters &amp; histogram</li> <li><code>/api/preview/worker/health</code> \u2014 health endpoint returns Redis/queue status</li> <li><code>k8s/preview-worker/servicemonitor.yaml</code> + <code>k8s/preview-worker/alert-rule-preview-worker.yaml</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#ci-tests","title":"CI &amp; tests","text":"<ul> <li><code>tests/worker/*</code> \u2014 unit tests and payload validation tests</li> <li><code>.github/workflows/ci-preview-worker.yml</code> \u2014 build/test</li> <li><code>.github/workflows/preview-worker-build-push.yml</code> \u2014 (example) build &amp; push</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#deployment-ops","title":"Deployment &amp; ops","text":"<ul> <li><code>k8s/preview-worker/</code>: deployment.yaml, service.yaml, configmap.yaml, secret-example.yaml, hpa.yaml</li> <li><code>systemd/preview-worker.service</code> (example non-container deployment)</li> <li><code>Dockerfile</code> for non-root worker image</li> <li><code>scripts/update-preview-worker-image.sh</code> (POSIX) and .ps1 (PowerShell)</li> <li><code>scripts/verify-preview-worker-deployment.{sh,ps1}</code></li> <li>pre-commit checklist, README, BUILD_AND_DEPLOY_GUIDE.md, PHASE_F summaries</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#docs-acceptance","title":"Docs &amp; acceptance","text":"<ul> <li><code>PR_BODY_PREVIEW_WORKER_FINAL_ENHANCED.md</code> (this file)</li> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code>, <code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code>, <code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#why","title":"Why","text":"<ul> <li>JSON Schema + runtime validator fail-fast invalid payloads and prevent wasted worker cycles.</li> <li>BullMQ + Redis provides durable queueing, retries, and DLQ handling required for reliable processing.</li> <li>Job idempotency (jobId) avoids duplicate side effects on retry.</li> <li>Prometheus-friendly metrics + ServiceMonitor enable SLO coverage and alerting.</li> <li>Cross-platform scripts ensure operators on both POSIX and Windows can safely update manifests &amp; images.</li> <li>CI prevents regressions and enforces payload contract compatibility before deploy.</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#how-to-test-developer-reviewer-checklist","title":"How to test (developer / reviewer checklist)","text":""},{"location":"automation/pr-body-preview-worker-complete/#run-unit-validation-tests","title":"Run unit &amp; validation tests:","text":"<pre><code>npm ci\nnpm run test:preview-payloads\nnpm test\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#local-sanity","title":"Local sanity:","text":"<p>Start Redis locally and run worker (env vars documented in README) Enqueue a dry-run job (payload.dryRun = true) and confirm: - <code>/api/preview/worker/health</code> returns 200 with Redis connected - Metrics increment preview_jobs_dryrun_total - renderPreview is short-circuited for dry-run</p>"},{"location":"automation/pr-body-preview-worker-complete/#k8s-dry-run","title":"k8s dry-run:","text":"<pre><code>kubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#smoke-test-in-staging-after-deploy","title":"Smoke test in staging (after deploy):","text":"<ul> <li>Enqueue a valid job; verify job lifecycle: started \u2192 completed (or failed with DLQ)</li> <li>Verify Prometheus scrapes metrics and ServiceMonitor is discovered</li> <li>Ensure alerts do not fire at low load</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#rollout-rollback","title":"Rollout &amp; rollback","text":""},{"location":"automation/pr-body-preview-worker-complete/#rollout","title":"Rollout:","text":"<p>staging (replicas=1, concurrency=1) \u2192 canary (replicas small) \u2192 scale to target At each stage: monitor queue length, failure rate, histogram of job duration</p>"},{"location":"automation/pr-body-preview-worker-complete/#rollback","title":"Rollback:","text":"<p>revert deployment image to previous working tag; reprocess DLQ after fix Manual rollback steps documented in <code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></p>"},{"location":"automation/pr-body-preview-worker-complete/#production-blockers-must-be-resolved-before-production","title":"Production blockers (must be resolved before production)","text":"<ul> <li>Replace image placeholder in k8s manifests with the pushed image: <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code></li> <li>Provision and wire secrets (Redis password, registry creds, external service keys) into Kubernetes Secrets or a vault</li> <li>Confirm Redis production connectivity and HA/credentials</li> <li>Tune HPA thresholds and alert thresholds to real traffic volumes</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#files-to-review-carefully","title":"Files to review carefully","text":"<ul> <li><code>schemas/preview-job.schema.json</code> (strictness, optional vs required fields)</li> <li><code>k8s/preview-worker/deployment.yaml</code> (securityContext, resource limits, envFrom Secrets)</li> <li><code>Dockerfile</code> (security/non-root user)</li> <li>CI workflows (<code>.github/workflows</code>) for secrets usage (do not leak creds)</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#one-line-commands-quick-reference","title":"One-line commands / quick reference","text":""},{"location":"automation/pr-body-preview-worker-complete/#run-payload-tests","title":"Run payload tests:","text":"<pre><code>npm run test:preview-payloads\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#update-manifests-image-posix","title":"Update manifests image (POSIX):","text":"<pre><code>./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#update-manifests-image-powershell","title":"Update manifests image (PowerShell):","text":"<pre><code>.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#deploy-to-staging","title":"Deploy to staging:","text":"<pre><code>kubectl -n preview-worker apply -f k8s/preview-worker/\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#health-check-port-forward","title":"Health check (port-forward):","text":"<pre><code>kubectl -n preview-worker port-forward deployment/preview-worker 3000:3000 &amp;\ncurl localhost:3000/api/preview/worker/health\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#suggested-git-flow-to-finalize-and-open-pr-already-tested-locally","title":"Suggested git flow to finalize and open PR (already tested locally)","text":"<pre><code># create feature branch and replace image tag in manifests (or run the script)\ngit checkout -b feat/preview-worker-k8s-final\n./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n\n# commit manifests &amp; docs\ngit add k8s/preview-worker scripts PREVIEW_WORKER_*.md\ngit commit -m \"chore(k8s): finalize preview-worker manifests and cross-platform ops\"\n\n# push branch and open PR (example using GitHub CLI)\ngit push -u origin feat/preview-worker-k8s-final\ngh pr create --title \"k8s: preview-worker manifests with cross-platform deployment tooling\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_FINAL_ENHANCED.md --base main --head feat/preview-worker-k8s-final\n</code></pre>"},{"location":"automation/pr-body-preview-worker-complete/#acceptance-criteria-for-merging-production-rollout","title":"Acceptance criteria (for merging &amp; production rollout)","text":"<ul> <li>All CI checks pass (payload validation + unit tests)</li> <li>Health endpoint returns 200 and Redis connectivity is OK in staging</li> <li>Dry-run jobs recorded and do not call renderPreview</li> <li>A real job completes end-to-end in staging (or reaches expected artifact generation step)</li> <li>Prometheus scrapes metrics and alert rules configured (tested in staging)</li> <li>Secrets are externalized; no sensitive data committed</li> </ul>"},{"location":"automation/pr-body-preview-worker-complete/#risks-mitigations","title":"Risks &amp; mitigations","text":"<ul> <li>Risk: Malformed jobs bypass checks \u2192 Mitigation: strict JSON Schema + runtime validator early in enqueue &amp; worker</li> <li>Risk: Secrets leaked in manifests \u2192 Mitigation: use kubernetes Secret and validate in PR review</li> <li>Risk: High failure rate during rollout \u2192 Mitigation: canary staged rollout + alerting + DLQ</li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/","title":"Finalize Preview Worker Kubernetes Manifests with Cross-Platform Deployment Tooling","text":"<p>This PR finalizes the Kubernetes manifests for the Preview Worker with production-ready configurations and adds comprehensive cross-platform deployment tooling and safety measures.</p>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#summary-of-changes","title":"Summary of Changes","text":""},{"location":"automation/pr-body-preview-worker-final-enhanced/#core-kubernetes-manifests","title":"Core Kubernetes Manifests","text":"<ul> <li>Updated all Kubernetes manifests with default production values</li> <li>Added namespace to all resources</li> <li>Configured HPA with appropriate scaling parameters</li> <li>Set up ServiceMonitor for Prometheus integration</li> <li>Updated container image to <code>ghcr.io/your-org/mobius-preview-worker:latest</code></li> <li>Configured Redis connection to <code>redis.default.svc.cluster.local:6379</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#cross-platform-deployment-tooling","title":"Cross-Platform Deployment Tooling","text":"<ul> <li>Added <code>scripts/update-preview-worker-image.sh</code> for Unix/Linux/macOS systems with GNU sed, BSD sed, and Perl fallbacks</li> <li>Added <code>scripts/update-preview-worker-image.ps1</code> for Windows PowerShell systems</li> <li>Created comprehensive <code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code> with platform-specific instructions</li> <li>Added <code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code> for safety validation before commits</li> <li>Added <code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code> for common issue resolution</li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#safety-and-validation-improvements","title":"Safety and Validation Improvements","text":"<ul> <li>Enhanced deployment guide with pre-commit safety checks</li> <li>Added secret scanning procedures to prevent accidental secret commits</li> <li>Included manifest validation steps using <code>kubectl apply --dry-run=client</code></li> <li>Provided cross-platform compatibility for all deployment scripts</li> <li>Added comprehensive troubleshooting guide for runtime issues</li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#files-modified","title":"Files Modified","text":""},{"location":"automation/pr-body-preview-worker-final-enhanced/#kubernetes-manifests","title":"Kubernetes Manifests","text":"<ul> <li><code>k8s/preview-worker/deployment.yaml</code></li> <li><code>k8s/preview-worker/configmap.yaml</code></li> <li><code>k8s/preview-worker/service.yaml</code></li> <li><code>k8s/preview-worker/hpa.yaml</code></li> <li><code>k8s/preview-worker/servicemonitor.yaml</code></li> <li><code>k8s/preview-worker/secret-example.yaml</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#deployment-scripts","title":"Deployment Scripts","text":"<ul> <li><code>scripts/update-preview-worker-image.sh</code> (Unix/Linux/macOS)</li> <li><code>scripts/update-preview-worker-image.ps1</code> (Windows PowerShell)</li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#documentation","title":"Documentation","text":"<ul> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> <li><code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code></li> <li><code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> <li><code>PHASE_F_PREVIEW_WORKER_COMPLETE_DEPLOYMENT_READY.md</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#cross-platform-compatibility","title":"Cross-Platform Compatibility","text":""},{"location":"automation/pr-body-preview-worker-final-enhanced/#image-tag-replacement","title":"Image Tag Replacement","text":"<p>Unix/Linux/macOS: <pre><code>./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre></p> <p>Windows PowerShell: <pre><code>.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre></p>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#cross-platform-safe-manual-replacement","title":"Cross-Platform Safe Manual Replacement","text":"<p>Linux (GNU sed): <pre><code>IMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} sed -i \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre></p> <p>macOS (BSD sed): <pre><code>IMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} sed -i '' \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre></p> <p>Perl (cross-platform): <pre><code>IMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} perl -pi -e \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre></p>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#pre-commit-safety-checklist","title":"Pre-Commit Safety Checklist","text":"<ol> <li> <p>Run tests:    <pre><code>npm ci\nnpm run test:preview-payloads\nnpm test\nnpm run lint --if-present\n</code></pre></p> </li> <li> <p>Verify changes:    <pre><code>git status\ngit diff -- k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Check for secrets:    <pre><code>git diff --staged | grep -E \"PASSWORD|TOKEN|SECRET|AWS_|REDIS|REDIS_PASSWORD\" || true\n</code></pre></p> </li> <li> <p>Validate manifests:    <pre><code>kubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre></p> </li> </ol>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#deployment-instructions","title":"Deployment Instructions","text":"<ol> <li> <p>Create the namespace:    <pre><code>kubectl create namespace preview-worker\n</code></pre></p> </li> <li> <p>Apply the manifests:    <pre><code>kubectl apply -f k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Verify deployment:    <pre><code>kubectl -n preview-worker get deployments\nkubectl -n preview-worker get pods\n</code></pre></p> </li> </ol>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#testing","title":"Testing","text":"<ul> <li>Health endpoint is available at <code>/api/preview/worker/health</code></li> <li>Metrics are exposed at <code>/metrics</code></li> <li>HPA is configured for automatic scaling (1-6 replicas)</li> <li>Cross-platform scripts validated on multiple operating systems</li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#next-steps","title":"Next Steps","text":"<ul> <li>Replace the placeholder container image with your actual image using the cross-platform scripts</li> <li>Update Redis connection details as needed</li> <li>Add actual Redis password to the secrets</li> <li>Adjust resource limits based on your environment</li> <li>Run smoke tests using the procedures in <code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-final-enhanced/#post-merge-rollout-plan","title":"Post-Merge Rollout Plan","text":"<ol> <li>Staging deploy (replicas=1, concurrency=1)</li> <li>Smoke test locally:    <pre><code>kubectl -n preview-worker port-forward svc/preview-worker 3000:3000 &amp;\ncurl -sS http://localhost:3000/api/preview/worker/health | jq\n</code></pre></li> <li>Monitor metrics:</li> <li>preview_job_started, preview_job_completed, preview_job_failed</li> <li>preview_job_invalid, preview_job_dryrun</li> <li>preview_job_duration_ms histogram</li> <li>Gradual scale up based on stability and performance</li> </ol>"},{"location":"automation/pr-body-preview-worker-final/","title":"Finalize Preview Worker Kubernetes Manifests","text":"<p>This PR finalizes the Kubernetes manifests for the Preview Worker with production-ready configurations.</p>"},{"location":"automation/pr-body-preview-worker-final/#summary-of-changes","title":"Summary of Changes","text":"<ul> <li>Updated all Kubernetes manifests with default production values</li> <li>Added namespace to all resources</li> <li>Configured HPA with appropriate scaling parameters</li> <li>Set up ServiceMonitor for Prometheus integration</li> <li>Updated container image to <code>ghcr.io/your-org/mobius-preview-worker:latest</code></li> <li>Configured Redis connection to <code>redis.default.svc.cluster.local:6379</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-final/#files-modified","title":"Files Modified","text":"<ul> <li><code>k8s/preview-worker/deployment.yaml</code></li> <li><code>k8s/preview-worker/configmap.yaml</code></li> <li><code>k8s/preview-worker/service.yaml</code></li> <li><code>k8s/preview-worker/hpa.yaml</code></li> <li><code>k8s/preview-worker/servicemonitor.yaml</code></li> <li><code>k8s/preview-worker/secret-example.yaml</code></li> </ul>"},{"location":"automation/pr-body-preview-worker-final/#deployment-instructions","title":"Deployment Instructions","text":"<ol> <li> <p>Create the namespace:    <pre><code>kubectl create namespace preview-worker\n</code></pre></p> </li> <li> <p>Apply the manifests:    <pre><code>kubectl apply -f k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Verify deployment:    <pre><code>kubectl -n preview-worker get deployments\nkubectl -n preview-worker get pods\n</code></pre></p> </li> </ol>"},{"location":"automation/pr-body-preview-worker-final/#testing","title":"Testing","text":"<ul> <li>Health endpoint is available at <code>/api/preview/worker/health</code></li> <li>Metrics are exposed at <code>/metrics</code></li> <li>HPA is configured for automatic scaling (1-6 replicas)</li> </ul>"},{"location":"automation/pr-body-preview-worker-final/#next-steps","title":"Next Steps","text":"<ul> <li>Replace the placeholder container image with your actual image</li> <li>Update Redis connection details as needed</li> <li>Add actual Redis password to the secrets</li> <li>Adjust resource limits based on your environment</li> </ul>"},{"location":"automation/pr-body-preview-worker/","title":"Preview Worker Implementation - Production Ready","text":""},{"location":"automation/pr-body-preview-worker/#summary","title":"Summary","text":"<p>This PR implements a production-ready Preview Worker system with comprehensive validation, queuing, metrics, and monitoring capabilities. The worker processes preview generation jobs asynchronously using BullMQ and Redis, with robust error handling, retry logic, and validation.</p>"},{"location":"automation/pr-body-preview-worker/#why","title":"Why","text":"<p>The Preview Worker system was needed to: 1. Offload preview generation from the main API thread to improve responsiveness 2. Provide reliable job queuing with persistence and retry mechanisms 3. Enable horizontal scaling of preview generation workloads 4. Add comprehensive validation to prevent malformed job processing 5. Implement proper metrics collection for observability</p>"},{"location":"automation/pr-body-preview-worker/#files-of-interest","title":"Files of Interest","text":"<ul> <li><code>src/worker/previewWorker.js</code> - Main worker implementation with BullMQ integration</li> <li><code>src/worker/previewWorkerClient.js</code> - Client for enqueuing jobs and checking status</li> <li><code>src/worker/previewMetrics.js</code> - Metrics collection for the worker</li> <li><code>src/worker/health.js</code> - Health check endpoint for the worker system</li> <li><code>src/worker/jobHandlers/renderPreview.js</code> - Preview rendering handler</li> <li><code>schemas/preview-job.schema.json</code> - JSON Schema for strict payload validation</li> <li><code>scripts/validatePreviewPayload.js</code> - Payload validation helper</li> <li><code>tests/worker/previewWorker.comprehensive.test.js</code> - Comprehensive test suite</li> <li><code>.github/workflows/ci-preview-worker.yml</code> - CI workflow for worker tests</li> </ul>"},{"location":"automation/pr-body-preview-worker/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[x] Worker processes jobs asynchronously using BullMQ and Redis</li> <li>[x] Payload validation prevents malformed jobs from being processed</li> <li>[x] Retry logic with exponential backoff handles transient failures</li> <li>[x] Dead letter queue configuration isolates persistent failures</li> <li>[x] Idempotency support prevents duplicate job processing</li> <li>[x] Priority handling allows high-priority jobs to be processed first</li> <li>[x] Metrics collection tracks job outcomes and durations</li> <li>[x] Health check endpoint monitors worker system status</li> <li>[x] API integration allows job submission and status checking</li> <li>[x] Comprehensive unit tests validate functionality</li> <li>[x] CI/CD workflow runs tests on PRs</li> <li>[x] Documentation explains usage and integration</li> </ul>"},{"location":"automation/pr-body-preview-worker/#manual-qa","title":"Manual QA","text":"<ol> <li>Start Redis server locally</li> <li>Run the worker: <code>npm run worker:preview</code></li> <li>Submit a job via the API: <code>POST /api/preview/job</code></li> <li>Check job status: <code>GET /api/preview/job/{jobId}/status</code></li> <li>Verify metrics collection via Prometheus endpoint</li> <li>Test health check: <code>GET /api/preview/worker/health</code></li> </ol>"},{"location":"automation/pr-body-preview-worker/#post-merge-rollout","title":"Post-Merge Rollout","text":"<ol> <li>Deploy worker service to staging environment</li> <li>Configure Redis connection in environment variables</li> <li>Set up monitoring and alerting for worker metrics</li> <li>Verify job processing in staging</li> <li>Deploy to production with appropriate scaling</li> </ol>"},{"location":"automation/pr-body-preview-worker/#risks-mitigations","title":"Risks &amp; Mitigations","text":"<ul> <li>Risk: Redis connectivity issues</li> <li>Mitigation: Health check endpoint monitors Redis status</li> <li>Risk: Job processing failures</li> <li>Mitigation: Retry logic with exponential backoff and dead letter queue</li> <li>Risk: High memory usage with large payloads</li> <li>Mitigation: Payload validation and size limits</li> <li>Risk: Duplicate job processing</li> <li>Mitigation: Idempotency with job IDs</li> </ul>"},{"location":"automation/pr-body-preview-worker/#next-steps","title":"Next Steps","text":"<ol> <li>Implement horizontal scaling for worker processes</li> <li>Add more detailed metrics for queue depth and processing times</li> <li>Implement job cancellation functionality</li> <li>Add support for job progress tracking</li> <li>Enhance error reporting with detailed failure reasons</li> </ol>"},{"location":"automation/pr-body/","title":"Pr body","text":"<p>Summary - Adds Image Matcher React component (drag/drop, asset library, match grid). - Adds Script Workbench container (ScriptEditor + ImageMatcher + PreviewPane). - Adds preview backend stub: POST /api/preview (validation, dry-run, artifact persisted at DATA_DIR/previews). - Adds metrics: preview_requests_total, preview_failures_total, preview_duration_ms. - Adds unit tests and verification scripts.</p> <p>Acceptance criteria - Unit tests pass (backend + client). - Dry-run preview writes artifact and increments metric. - Queue/back-pressure behavior enforced.</p> <p>Quick verification checklist: - [ ] npm test (backend tests pass) - [ ] cd client &amp;&amp; npm test (client tests pass) - [ ] curl dry-run returns 202 and artifact saved - [ ] preview_requests_total increments on request - [ ] scripts/verify-phase-f.sh passes - [ ] scripts/verify-phase-f.ps1 passes (Windows)</p>"},{"location":"automation/preview-payload-validation/","title":"Preview Worker Payload Validation","text":"<p>This document explains how to use the validation tools for Preview Worker job payloads.</p>"},{"location":"automation/preview-payload-validation/#files-created","title":"Files Created","text":"<ol> <li><code>preview_payload_minimal.json</code> - Minimal valid payload example</li> <li><code>preview_payload_full.json</code> - Full/realistic payload example for testing</li> <li><code>scripts/validatePreviewPayload.js</code> - Node.js validation helper (no external dependencies)</li> <li><code>scripts/testPreviewPayloads.js</code> - Automated test suite for validation</li> <li><code>scripts/validate_preview_payload.sh</code> - Bash script to run validation</li> <li><code>scripts/validate_preview_payload.ps1</code> - PowerShell script to run validation</li> </ol>"},{"location":"automation/preview-payload-validation/#payload-structure","title":"Payload Structure","text":""},{"location":"automation/preview-payload-validation/#required-fields","title":"Required Fields","text":"<ul> <li><code>jobId</code> (string) - Unique identifier for the job</li> <li><code>projectId</code> (string) - Identifier for the project</li> <li><code>requestId</code> (string) - Request correlation ID</li> <li><code>dryRun</code> (boolean) - Whether this is a dry run</li> <li><code>previewRequest</code> (object) - The preview request details:</li> <li><code>steps</code> (array) - Array of steps</li> <li><code>assets</code> (array) - Array of assets</li> <li><code>audio</code> (object) - Audio configuration</li> </ul>"},{"location":"automation/preview-payload-validation/#using-the-validation-tools","title":"Using the Validation Tools","text":""},{"location":"automation/preview-payload-validation/#method-1-command-line-validation","title":"Method 1: Command Line Validation","text":"<p>Validate a specific payload file: <pre><code>node scripts/validatePreviewPayload.js path/to/payload.json\n</code></pre></p> <p>If no path is provided, it defaults to <code>./payload.json</code>: <pre><code>node scripts/validatePreviewPayload.js\n</code></pre></p>"},{"location":"automation/preview-payload-validation/#method-2-programmatic-usage","title":"Method 2: Programmatic Usage","text":"<p>Import the validator in your code: <pre><code>const { validatePayload } = require('./scripts/validatePreviewPayload.js');\n\nconst payload = { /* your payload */ };\nconst errors = validatePayload(payload);\n\nif (errors.length === 0) {\n  console.log('Payload is valid');\n} else {\n  console.error('Payload validation errors:', errors);\n}\n</code></pre></p>"},{"location":"automation/preview-payload-validation/#method-3-run-all-tests","title":"Method 3: Run All Tests","text":"<p>Execute the automated test suite: <pre><code>node scripts/testPreviewPayloads.js\n</code></pre></p>"},{"location":"automation/preview-payload-validation/#method-4-shell-scripts","title":"Method 4: Shell Scripts","text":"<p>On Unix/Linux/macOS: <pre><code>chmod +x scripts/validate_preview_payload.sh\n./scripts/validate_preview_payload.sh\n</code></pre></p> <p>On Windows: <pre><code>.\\scripts\\validate_preview_payload.ps1\n</code></pre></p>"},{"location":"automation/preview-payload-validation/#validation-rules","title":"Validation Rules","text":"<p>The validator checks for:</p> <ol> <li>Basic Structure: Payload must be a valid object</li> <li>Required Fields: </li> <li><code>jobId</code> must be a string</li> <li><code>projectId</code> must be a string</li> <li><code>requestId</code> must be a string</li> <li><code>dryRun</code> must be a boolean</li> <li>Preview Request Structure:</li> <li><code>previewRequest</code> must be an object</li> <li><code>previewRequest.steps</code> must be an array</li> <li><code>previewRequest.assets</code> must be an array</li> <li><code>previewRequest.audio</code> must be an object (not an array)</li> </ol>"},{"location":"automation/preview-payload-validation/#test-cases","title":"Test Cases","text":"<p>The test suite (<code>testPreviewPayloads.js</code>) validates:</p> <ol> <li>\u2705 Valid minimal payload</li> <li>\u2705 Valid full payload</li> <li>\u2705 Missing <code>dryRun</code> field detection</li> <li>\u2705 Wrong types for <code>steps</code> (object instead of array) and <code>audio</code> (array instead of object)</li> </ol>"},{"location":"automation/preview-payload-validation/#example-output","title":"Example Output","text":"<p>Valid payload: <pre><code>OK: payload is valid\n</code></pre></p> <p>Invalid payload: <pre><code>INVALID PAYLOAD:\n - dryRun (boolean) required\n - previewRequest.steps (array) required\n</code></pre></p>"},{"location":"automation/preview-payload-validation/#integration-with-preview-worker","title":"Integration with Preview Worker","text":"<p>When implementing the Preview Worker, you can integrate this validation:</p> <pre><code>const { validatePayload } = require('./scripts/validatePreviewPayload.js');\n\n// In your job processor\nasync function processPreviewJob(job) {\n  const errors = validatePayload(job.data);\n  if (errors.length &gt; 0) {\n    throw new Error(`Invalid job payload: ${errors.join(', ')}`);\n  }\n\n  // Process valid job\n  // ...\n}\n</code></pre> <p>This ensures that only properly structured payloads are processed by the worker.</p>"},{"location":"onboarding/","title":"Onboarding","text":"<p>Purpose: New team member guides, environment setup, and getting-started documentation.</p>"},{"location":"onboarding/#contents","title":"Contents","text":"<p>Resources for bringing new contributors up to speed.</p>"},{"location":"onboarding/training-schedule/","title":"Team Training Schedule","text":""},{"location":"onboarding/training-schedule/#overview","title":"Overview","text":"<p>This document outlines the training schedule for the Mobius Preview Worker deployment infrastructure, including session details, materials, and logistics.</p>"},{"location":"onboarding/training-schedule/#training-sessions","title":"Training Sessions","text":""},{"location":"onboarding/training-schedule/#session-1-preview-worker-architecture-and-cli-tool-usage","title":"Session 1: Preview Worker Architecture and CLI Tool Usage","text":"<p>Date: Day 7, 10:00 AM - 12:00 PM Duration: 2 hours Location: Conference Room A / Virtual Meeting Instructor: [Instructor Name] Participants: Development and Operations Teams</p> <p>Agenda: 1. Preview Worker Architecture Overview (30 minutes)    - Core functionality and components    - Integration with Mobius ecosystem    - Container design and scaling strategy</p> <ol> <li>CLI Tool Introduction (30 minutes)</li> <li>Basic commands (deploy, verify, status)</li> <li>Advanced features (custom tags, namespaces, dry-run)</li> <li> <p>Security considerations</p> </li> <li> <p>Hands-on Lab (50 minutes)</p> </li> <li>Practice CLI commands in sandbox environment</li> <li>Deploy to staging environment</li> <li> <p>Verify deployment success</p> </li> <li> <p>Q&amp;A and Wrap-up (10 minutes)</p> </li> </ol> <p>Materials: - CLI_DEPLOYMENT_TOOL.md - CLI_USAGE_EXAMPLES.md - QUICK_REFERENCE_GUIDE.md</p>"},{"location":"onboarding/training-schedule/#session-2-deployment-workflows-and-troubleshooting","title":"Session 2: Deployment Workflows and Troubleshooting","text":"<p>Date: Day 7, 2:00 PM - 4:00 PM Duration: 2 hours Location: Conference Room A / Virtual Meeting Instructor: [Instructor Name] Participants: Development and Operations Teams</p> <p>Agenda: 1. CI/CD Pipeline Overview (30 minutes)    - GitHub Actions workflows    - Scripting with PowerShell and Bash    - Configuration management</p> <ol> <li>Deployment Process (30 minutes)</li> <li>Build and push workflow</li> <li>Deploy workflow with rollback</li> <li> <p>Test workflow for scripts</p> </li> <li> <p>Troubleshooting Workshop (50 minutes)</p> </li> <li>Common deployment issues</li> <li>Log analysis techniques</li> <li> <p>Recovery procedures</p> </li> <li> <p>Q&amp;A and Wrap-up (10 minutes)</p> </li> </ol> <p>Materials: - CI_CD_FINALIZATION_GUIDE.md - DEPLOYMENT_CHECKLIST.md - DEPLOYMENT_MAINTENANCE_PLAYBOOK.md</p>"},{"location":"onboarding/training-schedule/#session-3-monitoring-alerting-and-security","title":"Session 3: Monitoring, Alerting, and Security","text":"<p>Date: Day 8, 10:00 AM - 12:00 PM Duration: 2 hours Location: Conference Room A / Virtual Meeting Instructor: [Instructor Name] Participants: Operations Team, Security Team</p> <p>Agenda: 1. Monitoring Stack Overview (30 minutes)    - Prometheus metrics collection    - Grafana dashboard visualization    - ServiceMonitor configuration</p> <ol> <li>Alerting System (30 minutes)</li> <li>Alert rules and routing</li> <li>Integration with Slack and PagerDuty</li> <li> <p>Alert response procedures</p> </li> <li> <p>Security Best Practices (30 minutes)</p> </li> <li>Secure credential handling</li> <li>RBAC and permission management</li> <li> <p>Compliance requirements</p> </li> <li> <p>Hands-on Lab (20 minutes)</p> </li> <li>Monitor a deployment</li> <li>Trigger and respond to alerts</li> <li> <p>Conduct security audit</p> </li> <li> <p>Q&amp;A and Wrap-up (10 minutes)</p> </li> </ol> <p>Materials: - MONITORING_DEPLOYMENT_GUIDE.md - MONITORING_AND_ALERTING.md - DEPLOYMENT_METRICS_DASHBOARD.md</p>"},{"location":"onboarding/training-schedule/#session-4-ongoing-maintenance-and-continuous-improvement","title":"Session 4: Ongoing Maintenance and Continuous Improvement","text":"<p>Date: Day 8, 2:00 PM - 3:00 PM Duration: 1 hour Location: Conference Room A / Virtual Meeting Instructor: [Instructor Name] Participants: All Teams</p> <p>Agenda: 1. Maintenance Processes (20 minutes)    - Bi-weekly review cadence    - Backlog management    - Metrics analysis</p> <ol> <li>Continuous Improvement (20 minutes)</li> <li>Feedback collection</li> <li>Improvement planning</li> <li> <p>Knowledge sharing</p> </li> <li> <p>Q&amp;A and Wrap-up (20 minutes)</p> </li> </ol> <p>Materials: - ONGOING_MAINTENANCE_GUIDE.md - EXECUTION_PLAN_SUMMARY.md</p>"},{"location":"onboarding/training-schedule/#pre-training-preparation","title":"Pre-Training Preparation","text":""},{"location":"onboarding/training-schedule/#required-setup","title":"Required Setup","text":"<ol> <li>Development Environment:</li> <li>Docker Desktop with Kubernetes enabled</li> <li>kubectl CLI configured</li> <li>GitHub CLI installed</li> <li> <p>Node.js installed</p> </li> <li> <p>Access Permissions:</p> </li> <li>GitHub repository access</li> <li>Kubernetes cluster access</li> <li> <p>GHCR access with PAT</p> </li> <li> <p>Sandbox Environment:</p> </li> <li>Dedicated namespace for hands-on labs</li> <li>Sample applications for deployment practice</li> </ol>"},{"location":"onboarding/training-schedule/#pre-training-materials","title":"Pre-Training Materials","text":"<ol> <li>Review TEAM_ONBOARDING_GUIDE.md</li> <li>Familiarize with QUICK_REFERENCE_GUIDE.md</li> <li>Install required tools as outlined in the onboarding guide</li> </ol>"},{"location":"onboarding/training-schedule/#post-training-activities","title":"Post-Training Activities","text":""},{"location":"onboarding/training-schedule/#certification-process","title":"Certification Process","text":"<ol> <li>Knowledge Check: Online assessment covering all training materials</li> <li>Practical Exercise: Complete a deployment scenario independently</li> <li>Peer Review: Review another team member's deployment</li> <li>Certification Award: Certificate of completion for all participants</li> </ol>"},{"location":"onboarding/training-schedule/#ongoing-support","title":"Ongoing Support","text":"<ol> <li>Mentorship Program: Pair new team members with experienced mentors</li> <li>Help Desk: Dedicated support channel for deployment questions</li> <li>Office Hours: Weekly Q&amp;A sessions with subject matter experts</li> <li>Community Forums: Peer-to-peer support and knowledge sharing</li> </ol>"},{"location":"onboarding/training-schedule/#training-logistics","title":"Training Logistics","text":""},{"location":"onboarding/training-schedule/#communication","title":"Communication","text":"<ul> <li>Calendar Invites: Sent to all participants</li> <li>Reminders: Email reminders 24 hours before each session</li> <li>Materials: All documents shared via shared drive/wiki</li> <li>Recordings: Sessions recorded and made available for later viewing</li> </ul>"},{"location":"onboarding/training-schedule/#technical-requirements","title":"Technical Requirements","text":"<ul> <li>Video Conferencing: Zoom/Teams link provided in calendar invite</li> <li>Screen Sharing: Instructor shares screen for demonstrations</li> <li>Hands-on Access: VPN access to sandbox environment</li> <li>Collaboration Tools: Shared document for questions and notes</li> </ul>"},{"location":"onboarding/training-schedule/#feedback-collection","title":"Feedback Collection","text":"<ul> <li>Session Surveys: Immediate feedback after each session</li> <li>Overall Evaluation: Comprehensive assessment at the end of training</li> <li>Suggestion Box: Anonymous feedback for continuous improvement</li> <li>Follow-up Survey: One-week post-training effectiveness evaluation</li> </ul>"},{"location":"onboarding/training-schedule/#success-metrics","title":"Success Metrics","text":""},{"location":"onboarding/training-schedule/#participation","title":"Participation","text":"<ul> <li>100% attendance for all sessions</li> <li>Active participation in hands-on labs</li> <li>Engagement in Q&amp;A discussions</li> </ul>"},{"location":"onboarding/training-schedule/#knowledge-acquisition","title":"Knowledge Acquisition","text":"<ul> <li>80%+ pass rate on knowledge checks</li> <li>Successful completion of practical exercises</li> <li>Positive feedback on training materials</li> </ul>"},{"location":"onboarding/training-schedule/#skill-application","title":"Skill Application","text":"<ul> <li>Independent execution of deployment tasks</li> <li>Effective troubleshooting of common issues</li> <li>Proper use of monitoring and alerting systems</li> </ul>"},{"location":"onboarding/training-schedule/#conclusion","title":"Conclusion","text":"<p>This training schedule provides a comprehensive program to enable all team members to effectively use the Mobius Preview Worker deployment infrastructure. By following this structured approach, teams will gain the knowledge and skills needed to deploy, monitor, and maintain the system with confidence.</p> <p>Regular evaluation and continuous improvement of the training program will ensure it remains relevant and effective as the system and team evolve.</p>"},{"location":"operations/","title":"Operations","text":"<p>Purpose: Day-to-day operational procedures, monitoring, and maintenance guides.</p>"},{"location":"operations/#contents","title":"Contents","text":"<p>Operational runbooks and system health management.</p>"},{"location":"operations/asset-uploads-issue/","title":"Asset uploads issue","text":"<p>Implement server-side asset upload endpoints and hashed storage under DATA_DIR/assets. Compute content-hash for dedupe and generate thumbnails.</p> <p>Acceptance criteria: - POST /api/projects/:id/assets accepts image uploads (multipart/form-data), validates MIME and size. - Stores file at DATA_DIR/assets// and generates thumb.jpg. - GET /api/projects/:id/assets returns list with previewUrl, dimensions, mime type. - Duplicate uploads deduped by hash. - Unit &amp; integration tests (upload -&gt; thumbnail -&gt; listing). <p>Subtasks: - Endpoint + validation. - Hash-based store + thumbnail generation (sharp). - Asset metadata store (JSON or SQLite table). - Client integration for asset library listing.</p> <p>Owner: developer ETA: 3 days Labels: feature, phase-f, ux</p>"},{"location":"operations/container/","title":"Containerized Rendering","text":"<p>This document explains how to use the containerized version of the Mobius Tutorial Generator rendering pipeline.</p>"},{"location":"operations/container/#docker-image","title":"Docker Image","text":"<p>The Docker image includes: - Node.js 18 LTS - FFmpeg with H.264 support - Required fonts for subtitle rendering - All necessary dependencies</p>"},{"location":"operations/container/#building-the-image","title":"Building the Image","text":"<p>To build the Docker image locally:</p> <pre><code>docker build -t mobius-renderer .\n</code></pre>"},{"location":"operations/container/#running-renders-in-containers","title":"Running Renders in Containers","text":""},{"location":"operations/container/#basic-usage","title":"Basic Usage","text":"<p>To run a render job in a container:</p> <pre><code>docker run --rm \\\n  -v /path/to/assets:/app/assets \\\n  -v /path/to/output:/app/out \\\n  mobius-renderer \\\n  node scripts/render.js --project-id my-project --mode preview\n</code></pre>"},{"location":"operations/container/#preview-render-example","title":"Preview Render Example","text":"<pre><code>docker run --rm \\\n  -v $(pwd)/assets:/app/assets \\\n  -v $(pwd)/out:/app/out \\\n  mobius-renderer \\\n  node scripts/render.js --project-id test --mode preview --preview-seconds 5\n</code></pre>"},{"location":"operations/container/#full-render-example","title":"Full Render Example","text":"<pre><code>docker run --rm \\\n  -v $(pwd)/assets:/app/assets \\\n  -v $(pwd)/out:/app/out \\\n  mobius-renderer \\\n  node scripts/render.js --project-id test\n</code></pre>"},{"location":"operations/container/#volume-mounts","title":"Volume Mounts","text":"<p>The container expects two volume mounts:</p> <ol> <li><code>/app/assets</code> - Input assets (images, audio files, etc.)</li> <li><code>/app/out</code> - Output directory for rendered videos</li> </ol>"},{"location":"operations/container/#environment-variables","title":"Environment Variables","text":"<p>The container supports several environment variables for configuration:</p> <ul> <li><code>RENDER_TIMEOUT_MS</code> - Timeout for render operations (default: 300000)</li> <li><code>RENDER_THUMBNAIL_AT_SEC</code> - Time in seconds for thumbnail capture (default: 3)</li> </ul>"},{"location":"operations/container/#resource-constraints","title":"Resource Constraints","text":"<p>To limit resource usage:</p> <pre><code>docker run --rm \\\n  -v /path/to/assets:/app/assets \\\n  -v /path/to/output:/app/out \\\n  --memory=4g \\\n  --cpus=2 \\\n  mobius-renderer \\\n  node scripts/render.js --project-id my-project --mode preview\n</code></pre>"},{"location":"operations/container/#security-considerations","title":"Security Considerations","text":"<ul> <li>The container runs as a non-root user</li> <li>No privileged capabilities are required</li> <li>All input files should be validated before mounting</li> <li>Output files are written to the mounted volume only</li> </ul>"},{"location":"operations/container/#troubleshooting","title":"Troubleshooting","text":""},{"location":"operations/container/#no-space-left-on-device","title":"No Space Left on Device","text":"<p>Ensure the output volume has sufficient space for the rendered video.</p>"},{"location":"operations/container/#font-issues","title":"Font Issues","text":"<p>The container includes several font packages. If you encounter font-related errors, you can add additional fonts by extending the Dockerfile.</p>"},{"location":"operations/container/#permission-issues","title":"Permission Issues","text":"<p>Ensure the mounted volumes have appropriate read/write permissions for the container user.</p>"},{"location":"operations/github-token-setup/","title":"GitHub Token Setup and PR Creation Guide","text":""},{"location":"operations/github-token-setup/#issue-diagnosis","title":"Issue Diagnosis","text":"<p>The error message <code>{\"message\": \"Bad credentials\", \"status\": \"401\"}</code> indicates that the GitHub token is either: 1. Not set in the environment 2. Invalid or expired 3. Lacking proper permissions</p>"},{"location":"operations/github-token-setup/#step-1-create-a-new-github-personal-access-token","title":"Step 1: Create a New GitHub Personal Access Token","text":"<ol> <li>Go to GitHub.com and log in to your account</li> <li>Click on your profile picture in the top right corner</li> <li>Select \"Settings\"</li> <li>In the left sidebar, scroll down and click \"Developer settings\"</li> <li>Click \"Personal access tokens\" then \"Tokens (classic)\"</li> <li>Click \"Generate new token\" then \"Generate new token (classic)\"</li> <li>Give your token a descriptive name (e.g., \"Mobius Tutorial Generator\")</li> <li>Set an expiration date (or select \"No expiration\" if preferred)</li> <li>Select the following scopes:</li> <li><code>repo</code> (Full control of private repositories)</li> <li><code>workflow</code> (Update GitHub Action workflows)</li> <li><code>public_repo</code> (Access public repositories)</li> <li>Click \"Generate token\"</li> <li>IMPORTANT: Copy the token immediately as it will not be shown again</li> </ol>"},{"location":"operations/github-token-setup/#step-2-set-the-token-in-your-environment","title":"Step 2: Set the Token in Your Environment","text":""},{"location":"operations/github-token-setup/#on-windows-command-prompt","title":"On Windows (Command Prompt):","text":"<pre><code>set GITHUB_TOKEN=github_pat_your_token_here\n</code></pre>"},{"location":"operations/github-token-setup/#on-windows-powershell","title":"On Windows (PowerShell):","text":"<pre><code>$env:GITHUB_TOKEN=\"github_pat_your_token_here\"\n</code></pre>"},{"location":"operations/github-token-setup/#on-linuxmacos","title":"On Linux/macOS:","text":"<pre><code>export GITHUB_TOKEN=github_pat_your_token_here\n</code></pre>"},{"location":"operations/github-token-setup/#step-3-verify-the-token","title":"Step 3: Verify the Token","text":"<p>Run this command to verify the token works: <pre><code>curl -sS -H \"Authorization: token $GITHUB_TOKEN\" -H \"Accept: application/vnd.github+json\" https://api.github.com/user\n</code></pre></p> <p>You should see a JSON response with your user information, not a \"Bad credentials\" error.</p>"},{"location":"operations/github-token-setup/#step-4-set-repository-variables","title":"Step 4: Set Repository Variables","text":"<p>Set the repository owner and name: <pre><code>export OWNER=\"w9bikze8u4cbupc\"\nexport REPO=\"MOBIUS\"\n</code></pre></p> <p>Or on Windows PowerShell: <pre><code>$env:OWNER=\"w9bikze8u4cbupc\"\n$env:REPO=\"MOBIUS\"\n</code></pre></p>"},{"location":"operations/github-token-setup/#step-5-run-the-creation-script","title":"Step 5: Run the Creation Script","text":"<p>After setting up the token and variables, you can run: <pre><code>./create_prs_and_issues.sh\n</code></pre></p> <p>Or on Windows: <pre><code>.\\create_prs_and_issues.ps1\n</code></pre></p>"},{"location":"operations/github-token-setup/#alternative-manual-creation-via-web-ui","title":"Alternative: Manual Creation via Web UI","text":"<p>If you prefer not to use the API, you can create the PRs and issues manually:</p> <ol> <li>Feature PR: </li> <li>URL: https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...phase-f/preview-image-matcher</li> <li>Title: \"Phase F: Image Matcher UI + Preview backend stub\"</li> <li> <p>Use content from <code>FEATURE_PR_BODY.md</code></p> </li> <li> <p>CI Workflow PR:</p> </li> <li>URL: https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...ci/add-phase-f-verify-workflow</li> <li>Title: \"CI: Add staging verify workflow for Phase F\"</li> <li> <p>Use content from <code>CI_WORKFLOW_PR_BODY.md</code></p> </li> <li> <p>Issues:</p> </li> <li>Create three new issues using content from:<ul> <li><code>ISSUE_PREVIEW_WORKER.md</code></li> <li><code>ISSUE_ASSET_UPLOADS.md</code></li> <li><code>ISSUE_EXPORT_PACKAGING.md</code></li> </ul> </li> </ol>"},{"location":"operations/github-token-setup/#troubleshooting","title":"Troubleshooting","text":"<p>If you still get authentication errors:</p> <ol> <li>Double-check that the token was copied correctly (no extra spaces)</li> <li>Verify the token has the required scopes</li> <li>If using a fine-grained token, ensure it has access to the specific repository</li> <li>If your organization requires SSO, you may need to authorize the token for the organization</li> </ol>"},{"location":"operations/issue-asset-uploads/","title":"Asset uploads &amp; hashed storage (Phase F)","text":""},{"location":"operations/issue-asset-uploads/#description","title":"Description","text":"<p>Implement server-side asset upload endpoints and hashed storage under DATA_DIR/assets. Use content-hash (sha256) for canonical filenames and dedupe. Generate thumbnails on upload and expose listing endpoints.</p>"},{"location":"operations/issue-asset-uploads/#acceptance-criteria","title":"Acceptance criteria","text":"<ul> <li>POST /api/projects/:id/assets accepts uploads, validates MIME/size.</li> <li>Stores file under DATA_DIR/assets// and generates thumb.jpg. <li>GET /api/projects/:id/assets returns asset list with previewUrl, dimensions, mime type.</li> <li>Duplicate uploads return existing assetId (dedupe).</li> <li>Unit &amp; integration tests for hashing, dedupe, and thumbnail generation.</li>"},{"location":"operations/issue-asset-uploads/#subtasks","title":"Subtasks","text":"<ul> <li>Endpoint &amp; validations</li> <li>Hash-based store, thumbnail generation (sharp)</li> <li>Asset metadata store (JSON or SQLite)</li> <li>Client integration for the asset library</li> </ul>"},{"location":"operations/issue-asset-uploads/#owner","title":"Owner","text":"<p>developer</p>"},{"location":"operations/issue-asset-uploads/#eta","title":"ETA","text":"<p>3 days</p>"},{"location":"operations/issue-asset-uploads/#labels","title":"Labels","text":"<p>feature, phase-f, ux</p>"},{"location":"operations/issue-export-packaging/","title":"Export Packaging \u2014 create downloadable tutorial bundle (zip)","text":""},{"location":"operations/issue-export-packaging/#description","title":"Description","text":"<p>Implement exporter that packages a project into a downloadable zip with container.json (script + metadata), assets, captions.srt, and checksum manifest.</p>"},{"location":"operations/issue-export-packaging/#acceptance-criteria","title":"Acceptance criteria","text":"<ul> <li>POST /api/projects/:id/export triggers async export, returns jobToken.</li> <li>Export files saved to DATA_DIR/exports/-.zip and a download URL is produced. <li>container.json contains script + metadata + relative asset paths.</li> <li>Uses streaming zip to avoid memory spikes.</li> <li>Emits metrics: export_requests_total, export_failures_total, export_duration_ms.</li> <li>Tests validate zip contents.</li>"},{"location":"operations/issue-export-packaging/#subtasks","title":"Subtasks","text":"<ul> <li>Define container.json schema</li> <li>Implement streaming packager</li> <li>Add export job queue and status endpoint</li> </ul>"},{"location":"operations/issue-export-packaging/#owner","title":"Owner","text":"<p>developer</p>"},{"location":"operations/issue-export-packaging/#eta","title":"ETA","text":"<p>5 days</p>"},{"location":"operations/issue-export-packaging/#labels","title":"Labels","text":"<p>feature, phase-f, packaging</p>"},{"location":"operations/issue-packaging/","title":"Export Packaging \u2014 create downloadable tutorial bundle (zip)","text":""},{"location":"operations/issue-packaging/#description","title":"Description","text":"<p>Implement an exporter that packages a project into a downloadable archive (zip) with: - container.json (script, metadata, component mapping) - assets/ (referenced images and thumbs) - captions.srt (if generated) - manifest + checksums (optional)</p>"},{"location":"operations/issue-packaging/#acceptance-criteria","title":"Acceptance criteria","text":"<ul> <li>POST /api/projects/:id/export triggers export job (async) and returns jobToken.</li> <li>Exporter produces -.zip under DATA_DIR/exports and a downloadUrl. <li>Packaging includes container.json containing canonical script + metadata and relative asset paths.</li> <li>Export job uses streaming zipping to avoid large memory usage.</li> <li>Export endpoint emits metrics: export_requests_total, export_failures_total, export_duration_ms.</li> <li>Tests: unit tests for manifest generation; integration to produce a zip for a sample project and assert expected files exist.</li>"},{"location":"operations/issue-packaging/#subtasks","title":"Subtasks","text":"<ul> <li>[ ] Define container.json schema (script + metadata)</li> <li>[ ] Implement zip-stream packaging (node-stream-zip or archiver) with checksum manifest</li> <li>[ ] Add export job queue with concurrency limits</li> <li>[ ] Add endpoint to get export status and download URL</li> </ul>"},{"location":"operations/issue-packaging/#test-plan","title":"Test plan","text":"<ul> <li>Unit tests to validate container.json and manifest</li> <li>Integration: create small project with script + assets, call export, assert zip contents</li> </ul>"},{"location":"operations/issue-packaging/#labels-owner-estimate","title":"Labels, owner, estimate","text":"<ul> <li>Labels: feature, phase-f, packaging</li> <li>Owner: @developer</li> <li>ETA: 5 days</li> </ul>"},{"location":"operations/issue-preview-worker/","title":"Preview Worker \u2014 render queued chapter previews (Phase F)","text":""},{"location":"operations/issue-preview-worker/#description","title":"Description","text":"<p>Implement a background worker that consumes queued preview requests (created by /api/preview) and produces a concrete preview artifact (manifest and optionally a short MP4/thumbnail).</p>"},{"location":"operations/issue-preview-worker/#acceptance-criteria","title":"Acceptance criteria","text":"<ul> <li>Worker picks up queued preview artifacts from DATA_DIR/previews or a job queue.</li> <li>Produces preview-manifest.json and preview.mp4 (or thumbnails).</li> <li>Writes status file (success|failed) and logs with requestId correlation.</li> <li>Emits metrics: preview_worker_jobs_total, preview_worker_jobs_failed_total, preview_worker_duration_ms.</li> <li>Unit and integration tests validating outputs.</li> <li>UI Preview triggers job and artifacts are retrievable via /api/preview/status/:jobToken.</li> </ul>"},{"location":"operations/issue-preview-worker/#subtasks","title":"Subtasks","text":"<ul> <li>Define worker contract (input schema / output schema).</li> <li>Implement job acquisition &amp; locking.</li> <li>Integrate ffmpeg/Python renderer or stub first then swap in real renderer.</li> <li>Add status &amp; result endpoints and metrics.</li> <li>Add tests and CI verification.</li> </ul>"},{"location":"operations/issue-preview-worker/#owner","title":"Owner","text":"<p>developer</p>"},{"location":"operations/issue-preview-worker/#eta","title":"ETA","text":"<p>5 days</p>"},{"location":"operations/issue-preview-worker/#labels","title":"Labels","text":"<p>feature, phase-f, priority-high</p>"},{"location":"operations/issue-templates/","title":"Issue Templates for Phase F+ Development","text":""},{"location":"operations/issue-templates/#issue-1-preview-worker-implementation","title":"Issue 1: Preview Worker Implementation","text":""},{"location":"operations/issue-templates/#summary","title":"Summary","text":"<p>Implement the actual preview renderer that converts chapter content into short preview renders (images/audio \u2192 MP4 or JSON manifest).</p>"},{"location":"operations/issue-templates/#description","title":"Description","text":"<p>Build the worker component that processes queued preview requests and generates actual preview content instead of just stubbing the functionality. The worker should consume artifacts from the DATA_DIR/previews directory and produce rendered outputs.</p>"},{"location":"operations/issue-templates/#subtasks","title":"Subtasks","text":"<ul> <li>[ ] Define renderer contract (input schema, expected artifact format)</li> <li>[ ] Implement job runner to pick up queued preview artifacts</li> <li>[ ] Integrate with existing ffmpeg/python tooling or stub LLM-based steps</li> <li>[ ] Add proper error handling and retry logic</li> <li>[ ] Implement cleanup of processed artifacts</li> <li>[ ] Add metrics for worker performance (jobs processed, errors, duration)</li> </ul>"},{"location":"operations/issue-templates/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[ ] Worker processes preview requests from queue</li> <li>[ ] Generates valid preview output (MP4 or JSON manifest)</li> <li>[ ] Handles errors gracefully and logs appropriately</li> <li>[ ] Cleans up processed artifacts to prevent disk bloat</li> <li>[ ] Exposes metrics for monitoring</li> <li>[ ] Unit tests cover worker functionality</li> <li>[ ] Integration test validates end-to-end preview generation</li> </ul>"},{"location":"operations/issue-templates/#labels","title":"Labels","text":"<p>feature, phase-g, preview-worker, backend</p>"},{"location":"operations/issue-templates/#issue-2-asset-uploads-hashed-storage","title":"Issue 2: Asset Uploads &amp; Hashed Storage","text":""},{"location":"operations/issue-templates/#summary_1","title":"Summary","text":"<p>Implement an asset upload endpoint and storage system with content-addressable storage using hashing.</p>"},{"location":"operations/issue-templates/#description_1","title":"Description","text":"<p>Create an API endpoint for uploading assets associated with projects, store them with content-based hashing to prevent duplicates, and generate thumbnails for UI display.</p>"},{"location":"operations/issue-templates/#subtasks_1","title":"Subtasks","text":"<ul> <li>[ ] Create /api/projects/:id/assets upload endpoint</li> <li>[ ] Implement file validation (type, size limits)</li> <li>[ ] Add content hashing for deduplication</li> <li>[ ] Store assets under DATA_DIR/assets with hashed filenames</li> <li>[ ] Generate thumbnails for image assets</li> <li>[ ] Implement listing endpoint for project assets</li> <li>[ ] Add cleanup mechanism for orphaned assets</li> </ul>"},{"location":"operations/issue-templates/#acceptance-criteria_1","title":"Acceptance Criteria","text":"<ul> <li>[ ] Assets can be uploaded via API endpoint</li> <li>[ ] Files are validated for type and size</li> <li>[ ] Content hashing prevents duplicate storage</li> <li>[ ] Assets stored in organized directory structure</li> <li>[ ] Thumbnails generated for image assets</li> <li>[ ] Assets can be listed per project</li> <li>[ ] Cleanup mechanism removes orphaned files</li> <li>[ ] Unit tests cover upload and storage logic</li> <li>[ ] Integration test validates complete upload flow</li> </ul>"},{"location":"operations/issue-templates/#labels_1","title":"Labels","text":"<p>feature, phase-g, asset-upload, backend</p>"},{"location":"operations/issue-templates/#issue-3-packaging-export-endpoint","title":"Issue 3: Packaging &amp; Export Endpoint","text":""},{"location":"operations/issue-templates/#summary_2","title":"Summary","text":"<p>Implement an export endpoint that bundles tutorial components into a distributable zip file.</p>"},{"location":"operations/issue-templates/#description_2","title":"Description","text":"<p>Create an API endpoint that packages all components of a tutorial (container.json, SRT files, matched assets) into a single zip file for distribution.</p>"},{"location":"operations/issue-templates/#subtasks_2","title":"Subtasks","text":"<ul> <li>[ ] Create /api/export endpoint</li> <li>[ ] Implement packaging logic for tutorial components</li> <li>[ ] Add compression and archive creation</li> <li>[ ] Implement progress tracking for large exports</li> <li>[ ] Add proper error handling for missing components</li> <li>[ ] Implement temporary file cleanup</li> <li>[ ] Add rate limiting to prevent resource exhaustion</li> </ul>"},{"location":"operations/issue-templates/#acceptance-criteria_2","title":"Acceptance Criteria","text":"<ul> <li>[ ] Export endpoint bundles all tutorial components</li> <li>[ ] Zip file contains correct directory structure</li> <li>[ ] Progress tracking works for large exports</li> <li>[ ] Errors handled gracefully with useful messages</li> <li>[ ] Temporary files cleaned up after export</li> <li>[ ] Rate limiting prevents resource exhaustion</li> <li>[ ] Unit tests cover packaging logic</li> <li>[ ] Integration test validates complete export flow</li> </ul>"},{"location":"operations/issue-templates/#labels_2","title":"Labels","text":"<p>feature, phase-g, packaging, backend</p>"},{"location":"operations/media-quality/","title":"Media Quality in the Video Rendering Pipeline","text":"<p>This document describes the media quality features implemented in the Mobius Tutorial Generator's video rendering pipeline.</p>"},{"location":"operations/media-quality/#loudness-normalization","title":"Loudness Normalization","text":"<p>The pipeline supports loudness normalization to EBU R128 standards, ensuring consistent audio levels across all generated videos.</p>"},{"location":"operations/media-quality/#configuration","title":"Configuration","text":"<p>Loudness normalization can be enabled through the <code>loudness</code> option:</p> <pre><code>const options = {\n  loudness: {\n    enabled: true,\n    targetI: -16,    // Target integrated loudness (LUFS)\n    lra: 11,         // Loudness range target\n    tp: -1.5         // True peak target (dBTP)\n  }\n};\n</code></pre>"},{"location":"operations/media-quality/#implementation","title":"Implementation","text":"<p>The pipeline uses FFmpeg's <code>loudnorm</code> filter to normalize audio. The implementation supports both single-pass and dual-pass normalization:</p> <ul> <li>Single-pass: Faster processing with slightly less accuracy</li> <li>Dual-pass: Higher accuracy but requires two FFmpeg invocations</li> </ul> <p>By default, the pipeline uses single-pass normalization for efficiency.</p>"},{"location":"operations/media-quality/#safety-filters","title":"Safety Filters","text":"<p>Safety filters protect against audio artifacts and ensure consistent output quality.</p>"},{"location":"operations/media-quality/#high-pass-filter","title":"High-pass Filter","text":"<p>Removes low-frequency rumble that can cause distortion:</p> <pre><code>const options = {\n  safetyFilters: {\n    highpassHz: 80  // Remove frequencies below 80Hz\n  }\n};\n</code></pre>"},{"location":"operations/media-quality/#low-pass-filter","title":"Low-pass Filter","text":"<p>Removes high-frequency noise that can cause listener fatigue:</p> <pre><code>const options = {\n  safetyFilters: {\n    lowpassHz: 16000  // Remove frequencies above 16kHz\n  }\n};\n</code></pre>"},{"location":"operations/media-quality/#limiter","title":"Limiter","text":"<p>Prevents clipping by limiting peak levels:</p> <pre><code>const options = {\n  safetyFilters: {\n    limiter: true  // Apply a limiter with -1.0 dBFS ceiling\n  }\n};\n</code></pre>"},{"location":"operations/media-quality/#capability-limits","title":"Capability Limits","text":"<p>The pipeline enforces configurable limits to ensure deterministic renders and prevent resource exhaustion.</p>"},{"location":"operations/media-quality/#configuration_1","title":"Configuration","text":"<pre><code>const options = {\n  caps: {\n    maxWidth: 1920,        // Maximum output width in pixels\n    maxHeight: 1080,       // Maximum output height in pixels\n    maxFps: 30,            // Maximum frame rate\n    maxBitrateKbps: 6000   // Maximum bitrate in kilobits per second\n  }\n};\n</code></pre>"},{"location":"operations/media-quality/#validation","title":"Validation","text":"<p>Before rendering begins, the pipeline validates all inputs against the configured limits. If any input exceeds the limits, the render will fail with a descriptive error message unless explicitly overridden.</p>"},{"location":"operations/media-quality/#quality-assurance","title":"Quality Assurance","text":"<p>The pipeline includes several QA checks to ensure output quality:</p>"},{"location":"operations/media-quality/#loudness-verification","title":"Loudness Verification","text":"<p>CI tests verify that output loudness meets target specifications (\u00b11 LU tolerance).</p>"},{"location":"operations/media-quality/#clipping-detection","title":"Clipping Detection","text":"<p>Automated checks detect clipping in the output audio.</p>"},{"location":"operations/media-quality/#resolutionfps-validation","title":"Resolution/FPS Validation","text":"<p>Inputs are validated against configured limits to ensure deterministic outputs.</p>"},{"location":"operations/media-quality/#usage-examples","title":"Usage Examples","text":""},{"location":"operations/media-quality/#basic-loudness-normalization","title":"Basic Loudness Normalization","text":"<pre><code>import { render } from './src/render/index.js';\n\nconst job = {\n  images: ['slide1.jpg', 'slide2.jpg'],\n  narration: 'narration.mp3',\n  outputDir: './output'\n};\n\nconst options = {\n  loudness: {\n    enabled: true,\n    targetI: -23,  // EBU R128 standard\n    lra: 7,\n    tp: -2.0\n  }\n};\n\nawait render(job, options);\n</code></pre>"},{"location":"operations/media-quality/#full-safety-configuration","title":"Full Safety Configuration","text":"<pre><code>const options = {\n  loudness: {\n    enabled: true,\n    targetI: -16,\n    lra: 11,\n    tp: -1.5\n  },\n  safetyFilters: {\n    highpassHz: 80,\n    lowpassHz: 16000,\n    limiter: true\n  },\n  caps: {\n    maxWidth: 1920,\n    maxHeight: 1080,\n    maxFps: 30,\n    maxBitrateKbps: 6000\n  }\n};\n</code></pre>"},{"location":"operations/media-quality/#ci-integration","title":"CI Integration","text":"<p>The media quality features are tested in CI with automated verification:</p> <ol> <li>Loudness is verified using FFmpeg's ebur128 filter</li> <li>Clipping detection is performed on all outputs</li> <li>Resolution and FPS limits are validated</li> <li>Test artifacts are archived for manual review when needed</li> </ol>"},{"location":"operations/media-quality/#performance-considerations","title":"Performance Considerations","text":"<ul> <li>Loudness normalization adds processing time but ensures consistent output quality</li> <li>Safety filters have minimal performance impact</li> <li>Capability limits prevent resource exhaustion and ensure predictable render times</li> </ul>"},{"location":"operations/monitoring-and-alerting/","title":"Monitoring and Alerting Guide","text":"<p>This guide explains how to set up monitoring and alerting for the Mobius Preview Worker deployment infrastructure.</p>"},{"location":"operations/monitoring-and-alerting/#overview","title":"Overview","text":"<p>The monitoring infrastructure includes: 1. Built-in health checks and metrics 2. CLI tools for status checking and log viewing 3. GitHub Actions for deployment monitoring 4. Kubernetes-native monitoring capabilities 5. Alerting mechanisms for critical issues</p>"},{"location":"operations/monitoring-and-alerting/#built-in-monitoring-features","title":"Built-in Monitoring Features","text":""},{"location":"operations/monitoring-and-alerting/#health-checks","title":"Health Checks","text":"<p>The Preview Worker includes built-in health check endpoints: - <code>/healthz</code>: Basic health check - <code>/metrics</code>: Prometheus metrics endpoint</p>"},{"location":"operations/monitoring-and-alerting/#cli-monitoring-commands","title":"CLI Monitoring Commands","text":"<pre><code># Check deployment status\nnode cli/mobius-deploy.js status\n\n# View deployment logs\nnode cli/mobius-deploy.js logs\n\n# Verify deployment health\nnode cli/mobius-deploy.js verify\n</code></pre>"},{"location":"operations/monitoring-and-alerting/#kubernetes-monitoring","title":"Kubernetes Monitoring","text":""},{"location":"operations/monitoring-and-alerting/#pod-status-monitoring","title":"Pod Status Monitoring","text":"<pre><code># Check pod status\nkubectl -n preview-worker get pods\n\n# Get detailed pod information\nkubectl -n preview-worker describe pod &lt;pod-name&gt;\n\n# View pod logs\nkubectl -n preview-worker logs &lt;pod-name&gt;\n\n# View logs from previous container instance\nkubectl -n preview-worker logs &lt;pod-name&gt; --previous\n</code></pre>"},{"location":"operations/monitoring-and-alerting/#deployment-monitoring","title":"Deployment Monitoring","text":"<pre><code># Check deployment status\nkubectl -n preview-worker rollout status deployment/preview-worker\n\n# View deployment history\nkubectl -n preview-worker rollout history deployment/preview-worker\n\n# Check resource usage\nkubectl -n preview-worker top pods\n</code></pre>"},{"location":"operations/monitoring-and-alerting/#service-monitoring","title":"Service Monitoring","text":"<pre><code># Check service status\nkubectl -n preview-worker get services\n\n# Check endpoints\nkubectl -n preview-worker get endpoints\n</code></pre>"},{"location":"operations/monitoring-and-alerting/#github-actions-monitoring","title":"GitHub Actions Monitoring","text":""},{"location":"operations/monitoring-and-alerting/#workflow-status","title":"Workflow Status","text":"<p>Monitor GitHub Actions workflow status through: 1. GitHub repository Actions tab 2. GitHub notifications 3. GitHub API for programmatic access</p>"},{"location":"operations/monitoring-and-alerting/#workflow-logs","title":"Workflow Logs","text":"<p>View detailed logs for each workflow run to troubleshoot issues.</p>"},{"location":"operations/monitoring-and-alerting/#setting-up-prometheus-monitoring","title":"Setting Up Prometheus Monitoring","text":""},{"location":"operations/monitoring-and-alerting/#service-monitor-configuration","title":"Service Monitor Configuration","text":"<p>The deployment includes a ServiceMonitor for Prometheus integration: - File: k8s/preview-worker/servicemonitor.yaml - Scrapes metrics from the <code>/metrics</code> endpoint</p>"},{"location":"operations/monitoring-and-alerting/#alert-rules","title":"Alert Rules","text":"<p>The deployment includes alert rules for common issues: - File: k8s/preview-worker/alert-rule-preview-worker.yaml - Alerts on high failure rates</p>"},{"location":"operations/monitoring-and-alerting/#setting-up-alerting","title":"Setting Up Alerting","text":""},{"location":"operations/monitoring-and-alerting/#kubernetes-events-alerting","title":"Kubernetes Events Alerting","text":"<p>Monitor Kubernetes events for issues: <pre><code># View recent events\nkubectl -n preview-worker get events --sort-by=.metadata.creationTimestamp\n\n# Watch events in real-time\nkubectl -n preview-worker get events --watch\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#log-based-alerting","title":"Log-Based Alerting","text":"<p>Set up log-based alerting using tools like: - Elasticsearch, Logstash, Kibana (ELK) stack - Fluentd with Prometheus - Cloud provider logging solutions</p>"},{"location":"operations/monitoring-and-alerting/#health-check-alerting","title":"Health Check Alerting","text":"<p>Set up alerts based on health check failures: <pre><code># Example script for health check monitoring\n#!/bin/bash\nHEALTH_CHECK_URL=\"http://preview-worker.preview-worker.svc.cluster.local/healthz\"\n\nif ! curl -f -s $HEALTH_CHECK_URL &gt; /dev/null; then\n    echo \"Health check failed!\" | tee /dev/stderr\n    # Send alert (email, Slack, etc.)\n    exit 1\nfi\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#custom-monitoring-scripts","title":"Custom Monitoring Scripts","text":""},{"location":"operations/monitoring-and-alerting/#deployment-status-script","title":"Deployment Status Script","text":"<pre><code>#!/bin/bash\n# monitor-deployment.sh\n\nNAMESPACE=${1:-preview-worker}\n\necho \"=== Deployment Status Report ===\"\necho \"Namespace: $NAMESPACE\"\necho \"Timestamp: $(date)\"\n\n# Check pod status\necho \"Pod Status:\"\nkubectl -n $NAMESPACE get pods\n\n# Check deployment status\necho \"Deployment Status:\"\nkubectl -n $NAMESPACE get deployments\n\n# Check service status\necho \"Service Status:\"\nkubectl -n $NAMESPACE get services\n\n# Check recent events\necho \"Recent Events:\"\nkubectl -n $NAMESPACE get events --sort-by=.metadata.creationTimestamp | tail -10\n</code></pre>"},{"location":"operations/monitoring-and-alerting/#log-analysis-script","title":"Log Analysis Script","text":"<pre><code>#!/bin/bash\n# analyze-logs.sh\n\nNAMESPACE=${1:-preview-worker}\nERROR_THRESHOLD=${2:-5}\n\necho \"=== Log Analysis Report ===\"\necho \"Namespace: $NAMESPACE\"\necho \"Error Threshold: $ERROR_THRESHOLD\"\necho \"Timestamp: $(date)\"\n\n# Count error logs\nERROR_COUNT=$(kubectl -n $NAMESPACE logs deployment/preview-worker | grep -i error | wc -l)\n\necho \"Error Count: $ERROR_COUNT\"\n\nif [ $ERROR_COUNT -gt $ERROR_THRESHOLD ]; then\n    echo \"WARNING: Error count exceeds threshold!\"\n    echo \"Recent errors:\"\n    kubectl -n $NAMESPACE logs deployment/preview-worker | grep -i error | tail -5\nfi\n</code></pre>"},{"location":"operations/monitoring-and-alerting/#alerting-integrations","title":"Alerting Integrations","text":""},{"location":"operations/monitoring-and-alerting/#slack-notifications","title":"Slack Notifications","text":"<p>Set up Slack notifications for critical alerts: <pre><code># GitHub Actions workflow with Slack notification\n- name: Notify on Failure\n  if: failure()\n  uses: 8398a7/action-slack@v3\n  with:\n    status: ${{ job.status }}\n    channel: '#deployments'\n  env:\n    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#email-alerts","title":"Email Alerts","text":"<p>Set up email alerts for critical issues: <pre><code># Example email alert script\n#!/bin/bash\nRECIPIENT=\"team@example.com\"\nSUBJECT=\"Preview Worker Deployment Alert\"\n\necho \"Critical issue detected in Preview Worker deployment\" | mail -s \"$SUBJECT\" \"$RECIPIENT\"\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#pagerduty-integration","title":"PagerDuty Integration","text":"<p>For critical production alerts, integrate with PagerDuty: <pre><code># Example PagerDuty alert\ncurl -X POST \\\n  'https://events.pagerduty.com/v2/enqueue' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"routing_key\": \"YOUR_ROUTING_KEY\",\n  \"event_action\": \"trigger\",\n  \"payload\": {\n    \"summary\": \"Preview Worker deployment failed\",\n    \"source\": \"preview-worker-deployment\",\n    \"severity\": \"critical\"\n  }\n}'\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#monitoring-dashboard","title":"Monitoring Dashboard","text":""},{"location":"operations/monitoring-and-alerting/#kubernetes-dashboard","title":"Kubernetes Dashboard","text":"<p>Access the Kubernetes dashboard for visual monitoring: <pre><code># Start proxy to access dashboard\nkubectl proxy\n\n# Access dashboard at http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#custom-dashboard","title":"Custom Dashboard","text":"<p>Create custom dashboards using tools like: - Grafana with Prometheus data source - Cloud provider monitoring dashboards - Custom web interfaces</p>"},{"location":"operations/monitoring-and-alerting/#performance-monitoring","title":"Performance Monitoring","text":""},{"location":"operations/monitoring-and-alerting/#resource-usage","title":"Resource Usage","text":"<p>Monitor CPU and memory usage: <pre><code># Check resource usage\nkubectl -n preview-worker top pods\n\n# Check node resource usage\nkubectl top nodes\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#request-latency","title":"Request Latency","text":"<p>Monitor request latency through application metrics: <pre><code># Example curl to metrics endpoint\ncurl -s http://preview-worker.preview-worker.svc.cluster.local/metrics | grep latency\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#security-monitoring","title":"Security Monitoring","text":""},{"location":"operations/monitoring-and-alerting/#security-scanning","title":"Security Scanning","text":"<p>Integrate security scanning into the deployment pipeline: <pre><code>- name: Scan Docker Image\n  uses: aquasecurity/trivy-action@master\n  with:\n    image-ref: 'ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:latest'\n    format: 'table'\n    exit-code: '1'\n    ignore-unfixed: true\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#audit-logs","title":"Audit Logs","text":"<p>Monitor audit logs for security events: <pre><code># Check for security-related events\nkubectl -n preview-worker get events | grep -i security\n</code></pre></p>"},{"location":"operations/monitoring-and-alerting/#best-practices","title":"Best Practices","text":""},{"location":"operations/monitoring-and-alerting/#proactive-monitoring","title":"Proactive Monitoring","text":"<ol> <li>Set up alerts for critical metrics</li> <li>Regularly review logs and metrics</li> <li>Monitor resource usage trends</li> <li>Test alerting mechanisms regularly</li> </ol>"},{"location":"operations/monitoring-and-alerting/#reactive-monitoring","title":"Reactive Monitoring","text":"<ol> <li>Respond quickly to alerts</li> <li>Document issues and resolutions</li> <li>Implement preventive measures</li> <li>Share knowledge with the team</li> </ol>"},{"location":"operations/monitoring-and-alerting/#performance-optimization","title":"Performance Optimization","text":"<ol> <li>Monitor resource usage</li> <li>Optimize resource requests and limits</li> <li>Identify and resolve bottlenecks</li> <li>Scale based on demand</li> </ol>"},{"location":"operations/monitoring-and-alerting/#security-monitoring_1","title":"Security Monitoring","text":"<ol> <li>Monitor for unauthorized access</li> <li>Regularly scan for vulnerabilities</li> <li>Review audit logs</li> <li>Implement security best practices</li> </ol>"},{"location":"operations/monitoring-and-alerting/#troubleshooting-monitoring-issues","title":"Troubleshooting Monitoring Issues","text":""},{"location":"operations/monitoring-and-alerting/#metrics-not-appearing","title":"Metrics Not Appearing","text":"<ol> <li>Verify the ServiceMonitor is correctly configured</li> <li>Check that Prometheus is scraping the endpoint</li> <li>Verify the application is exposing metrics</li> <li>Check network policies and firewall rules</li> </ol>"},{"location":"operations/monitoring-and-alerting/#alerts-not-firing","title":"Alerts Not Firing","text":"<ol> <li>Verify alert rules are correctly configured</li> <li>Check that the metrics exist</li> <li>Verify alertmanager configuration</li> <li>Test alerting mechanisms manually</li> </ol>"},{"location":"operations/monitoring-and-alerting/#log-collection-issues","title":"Log Collection Issues","text":"<ol> <li>Verify logging configuration</li> <li>Check log file permissions</li> <li>Verify log collection agents are running</li> <li>Check network connectivity for remote logging</li> </ol>"},{"location":"operations/monitoring-and-alerting/#conclusion","title":"Conclusion","text":"<p>This monitoring and alerting guide provides a comprehensive approach to monitoring the Mobius Preview Worker deployment. By implementing these practices, you can ensure the reliability, performance, and security of your deployments.</p> <p>Regular monitoring and alerting are essential for maintaining a healthy production environment. Set up the appropriate monitoring tools and alerting mechanisms for your specific needs, and regularly review and improve your monitoring strategy.</p>"},{"location":"operations/observability/","title":"Observability in the Video Rendering Pipeline","text":"<p>This document describes the observability features implemented in the Mobius Tutorial Generator's video rendering pipeline.</p>"},{"location":"operations/observability/#metrics","title":"Metrics","text":"<p>The rendering pipeline exposes Prometheus metrics for monitoring performance and reliability. Metrics are available via an HTTP endpoint that can be scraped by Prometheus or other monitoring systems.</p>"},{"location":"operations/observability/#available-metrics","title":"Available Metrics","text":"Metric Name Type Description <code>mobius_render_started_total</code> Counter Total number of renders started <code>mobius_render_completed_total</code> Counter Total number of renders completed successfully <code>mobius_render_failed_total</code> Counter Total number of renders that failed <code>mobius_render_duration_seconds</code> Histogram Render durations in seconds <code>mobius_ffmpeg_speed_ratio</code> Histogram FFmpeg processing speed ratio"},{"location":"operations/observability/#starting-the-metrics-server","title":"Starting the Metrics Server","text":"<p>The metrics server can be started by calling the <code>startMetricsServer</code> function from the <code>metrics.js</code> module:</p> <pre><code>import { startMetricsServer } from './src/render/metrics.js';\n\nconst server = startMetricsServer(9464); // Port defaults to METRICS_PORT env var or 9464\n</code></pre> <p>The metrics will be available at <code>http://localhost:9464/metrics</code>.</p>"},{"location":"operations/observability/#structured-logging","title":"Structured Logging","text":"<p>The pipeline uses structured logging with NDJSON format for better parseability and correlation. All log entries include timestamps, log levels, and correlation IDs.</p>"},{"location":"operations/observability/#log-fields","title":"Log Fields","text":"<p>Each log entry includes the following fields:</p> <ul> <li><code>ts</code>: ISO timestamp</li> <li><code>level</code>: Log level (debug, info, warn, error)</li> <li><code>message</code>: Log message</li> <li><code>sessionId</code>: Unique identifier for the render session</li> <li><code>jobId</code>: Unique identifier for the render job</li> <li>Additional context-specific fields</li> </ul>"},{"location":"operations/observability/#progress-logging","title":"Progress Logging","text":"<p>Progress updates include additional fields for tracking render progress:</p> <ul> <li><code>stage</code>: Current rendering stage</li> <li><code>progress</code>: Completion percentage (0-100)</li> <li><code>eta</code>: Estimated time of arrival</li> <li><code>speed</code>: Processing speed ratio</li> <li><code>fps</code>: Frames per second</li> </ul>"},{"location":"operations/observability/#integration-with-opentelemetry-optional","title":"Integration with OpenTelemetry (Optional)","text":"<p>The pipeline is designed to support OpenTelemetry integration for distributed tracing. This can be enabled by setting the <code>OTEL_EXPORTER_OTLP_ENDPOINT</code> environment variable.</p>"},{"location":"operations/observability/#grafana-dashboard","title":"Grafana Dashboard","text":"<p>A minimal Grafana dashboard can be imported to visualize the rendering metrics:</p> <pre><code>{\n  \"title\": \"Mobius Rendering\",\n  \"panels\": [\n    { \n      \"type\": \"stat\", \n      \"title\": \"Success Rate (24h)\", \n      \"targets\": [\n        { \n          \"expr\": \"1 - (sum(increase(mobius_render_failed_total[24h])) / clamp_min(sum(increase(mobius_render_started_total[24h])),1))\" \n        }\n      ]\n    },\n    { \n      \"type\": \"graph\", \n      \"title\": \"Renders Started/Completed/Failed\", \n      \"targets\": [\n        { \n          \"expr\": \"sum(increase(mobius_render_started_total[5m]))\", \n          \"legendFormat\": \"started\" \n        },\n        { \n          \"expr\": \"sum(increase(mobius_render_completed_total[5m]))\", \n          \"legendFormat\": \"completed\" \n        },\n        { \n          \"expr\": \"sum(increase(mobius_render_failed_total[5m]))\", \n          \"legendFormat\": \"failed\" \n        }\n      ]\n    },\n    { \n      \"type\": \"graph\", \n      \"title\": \"P95 Duration by Mode (s)\", \n      \"targets\": [\n        { \n          \"expr\": \"histogram_quantile(0.95, sum by (le, mode) (rate(mobius_render_duration_seconds_bucket[5m])))\", \n          \"legendFormat\": \"mode\" \n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"operations/observability/#usage-in-applications","title":"Usage in Applications","text":"<p>To use the observability features in your application:</p> <ol> <li> <p>Import the metrics module and start the server:    <pre><code>import { startMetricsServer } from './src/render/metrics.js';\nstartMetricsServer(); // Defaults to port 9464\n</code></pre></p> </li> <li> <p>Use the structured logger:    <pre><code>import { logger } from './src/render/log.js';\n\nconst log = logger.withContext({ component: 'my-app' });\nlog.info('Application started');\n</code></pre></p> </li> <li> <p>The render function automatically integrates with both metrics and logging systems.</p> </li> </ol>"},{"location":"operations/observability/#monitoring-in-cicd","title":"Monitoring in CI/CD","text":"<p>In CI/CD environments, the metrics server can be configured to push metrics to a Prometheus Pushgateway instead of exposing an HTTP endpoint. This is particularly useful in short-lived CI environments.</p>"},{"location":"operations/observability/#security-considerations","title":"Security Considerations","text":"<ul> <li>The metrics endpoint should not be exposed to public networks without authentication</li> <li>Log entries should not contain sensitive information</li> <li>Access to the metrics endpoint should be restricted in production environments</li> </ul>"},{"location":"operations/packaging-issue/","title":"Packaging issue","text":"<p>Implement exporter that packages a project into a downloadable zip with container.json, assets, captions.srt and manifest + checksums.</p> <p>Acceptance criteria: - POST /api/projects/:id/export triggers async export job, returns jobToken. - Exports written to DATA_DIR/exports/-.zip and a downloadUrl. - container.json contains script + metadata + relative asset paths. - Uses streaming zip to avoid memory spikes. - Emits metrics: export_requests_total, export_failures_total, export_duration_ms. - Unit/integration tests validate zip contents. <p>Subtasks: - Define container.json schema. - Implement streaming packager (archiver or streaming lib). - Add export job queue and result endpoint.</p> <p>Owner: developer ETA: 5 days Labels: feature, phase-f, packaging</p>"},{"location":"operations/preview-worker-issue/","title":"Preview worker issue","text":"<p>Implement a background worker that consumes queued preview requests (created by /api/preview) and produces a concrete preview artifact (manifest and optionally a short MP4/thumbnail).</p> <p>Acceptance criteria: - Worker picks up queued preview artifacts from DATA_DIR/previews or a job queue. - Produces preview-manifest.json with metadata and a preview.mp4 or thumbnails. - Writes status (success|failed) and logs with requestId correlation. - Emits metrics: preview_worker_jobs_total, preview_worker_jobs_failed_total, preview_worker_duration_ms. - Unit and integration tests validating outputs. - UI Preview triggers job and artifacts are retrievable via /api/preview/status/:jobToken.</p> <p>Subtasks: - Define worker contract and schema. - Implement job acquisition &amp; locking. - Integrate renderer or stub (ffmpeg/Python). - Add status endpoints, metrics, logs, and tests.</p> <p>Owner: developer ETA: 5 days Labels: feature, phase-f, priority-high</p>"},{"location":"operations/preview/","title":"Preview API","text":""},{"location":"operations/preview/#overview","title":"Overview","text":"<p>The Preview API allows generating previews of tutorial chapters for review before final rendering.</p>"},{"location":"operations/preview/#endpoints","title":"Endpoints","text":""},{"location":"operations/preview/#post-apipreview","title":"POST /api/preview","text":"<p>Generate a preview of a chapter.</p>"},{"location":"operations/preview/#request","title":"Request","text":"<pre><code>POST /api/preview HTTP/1.1\nHost: localhost:5001\nContent-Type: application/json\nx-api-version: v1\n</code></pre>"},{"location":"operations/preview/#query-parameters","title":"Query Parameters","text":"Parameter Type Description dryRun boolean If true, performs a dry run without generating actual preview (default: false)"},{"location":"operations/preview/#request-body","title":"Request Body","text":"<pre><code>{\n  \"projectId\": \"string\",\n  \"chapterId\": \"string\",\n  \"chapter\": {\n    \"title\": \"string\",\n    \"steps\": [\n      {\n        \"id\": \"string\",\n        \"text\": \"string\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"operations/preview/#response","title":"Response","text":""},{"location":"operations/preview/#202-accepted","title":"202 Accepted","text":"<pre><code>{\n  \"status\": \"queued|dry_run\",\n  \"requestId\": \"string\",\n  \"jobToken\": \"string\",\n  \"previewPath\": \"string\"\n}\n</code></pre>"},{"location":"operations/preview/#400-bad-request","title":"400 Bad Request","text":"<pre><code>{\n  \"error\": \"projectId, chapterId, and chapter payload are required\"\n}\n</code></pre>"},{"location":"operations/preview/#422-unprocessable-entity","title":"422 Unprocessable Entity","text":"<pre><code>{\n  \"error\": \"chapter.steps must be an array\"\n}\n</code></pre>"},{"location":"operations/preview/#metrics","title":"Metrics","text":"<p>The Preview API collects the following metrics:</p> <ul> <li><code>preview_requests_total</code> - Total number of preview requests</li> <li><code>preview_failures_total</code> - Total number of preview failures</li> <li><code>preview_duration_ms</code> - Duration of preview requests in milliseconds</li> </ul>"},{"location":"operations/preview/#security","title":"Security","text":"<p>The Preview API enforces the same security measures as the rest of the application: - File size limits - Rate limiting - Input validation - Structured logging</p>"},{"location":"operations/preview/#usage-examples","title":"Usage Examples","text":""},{"location":"operations/preview/#generate-a-preview","title":"Generate a preview","text":"<pre><code>curl -X POST http://localhost:5001/api/preview \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-api-version: v1\" \\\n  -d '{\n    \"projectId\": \"my-project\",\n    \"chapterId\": \"chapter-1\",\n    \"chapter\": {\n      \"title\": \"Introduction\",\n      \"steps\": [\n        {\n          \"id\": \"step-1\",\n          \"text\": \"Welcome to the tutorial\"\n        }\n      ]\n    }\n  }'\n</code></pre>"},{"location":"operations/preview/#generate-a-dry-run-preview","title":"Generate a dry-run preview","text":"<pre><code>curl -X POST \"http://localhost:5001/api/preview?dryRun=true\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-api-version: v1\" \\\n  -d '{\n    \"projectId\": \"my-project\",\n    \"chapterId\": \"chapter-1\",\n    \"chapter\": {\n      \"title\": \"Introduction\",\n      \"steps\": [\n        {\n          \"id\": \"step-1\",\n          \"text\": \"Welcome to the tutorial\"\n        }\n      ]\n    }\n  }'\n</code></pre>"},{"location":"operations/rendering-pipeline-design/","title":"Video Rendering Pipeline Design","text":""},{"location":"operations/rendering-pipeline-design/#overview","title":"Overview","text":"<p>This document outlines the design for the video rendering pipeline in the Mobius Tutorial Generator. The pipeline will orchestrate FFmpeg to create video outputs from game tutorial assets.</p>"},{"location":"operations/rendering-pipeline-design/#goals","title":"Goals","text":"<ul> <li>Produce MP4 video outputs with correct duration</li> <li>Generate thumbnails for preview purposes</li> <li>Create captions (SRT/VTT) and support burn-in and sidecar exports</li> <li>Support preview renders (5s, 30s) and full renders</li> <li>Run in CI as a smoke/validation step</li> <li>Be testable with mocked FFmpeg processes</li> <li>Support audio ducking for better audio mixing</li> <li>Provide robust progress tracking and checkpointing</li> <li>Enable containerized deployment for production use</li> <li>Expose metrics and structured logs for observability</li> <li>Ensure consistent media quality through loudness normalization and safety filters</li> </ul>"},{"location":"operations/rendering-pipeline-design/#high-level-architecture","title":"High-Level Architecture","text":""},{"location":"operations/rendering-pipeline-design/#orchestration-layer-nodejs","title":"Orchestration Layer (Node.js)","text":"<p>Responsible for: - Assembling render job metadata (sequence of stills, timings, audio files, subtitles, transition directives, overlay data) - Validating inputs (paths, durations) - Building FFmpeg commands - Spawning FFmpeg with stdout/stderr progress parsing - Resolving with artifact paths and metadata or rejecting with actionable error</p>"},{"location":"operations/rendering-pipeline-design/#renderer-implementation","title":"Renderer Implementation","text":"<ul> <li>Single FFmpeg invocation using concat demuxer or complex filtergraph</li> <li>Subtitle generation via existing caption generator</li> <li>Audio ducking using volume filter automation</li> <li>Thumbnail generation using FFmpeg frame extraction</li> <li>Progress tracking and checkpointing for resumability</li> <li>Containerized deployment support</li> </ul>"},{"location":"operations/rendering-pipeline-design/#api-design","title":"API Design","text":""},{"location":"operations/rendering-pipeline-design/#core-function","title":"Core Function","text":"<pre><code>async render(job, options)\n</code></pre>"},{"location":"operations/rendering-pipeline-design/#parameters","title":"Parameters","text":"<ul> <li><code>job</code>: Object containing render job metadata</li> <li><code>options</code>: Configuration object with properties:</li> <li><code>previewSeconds</code>: Number of seconds for preview render (5 or 30)</li> <li><code>dryRun</code>: Boolean to simulate without actual rendering</li> <li><code>burnCaptions</code>: Boolean to burn-in captions</li> <li><code>exportSrt</code>: Boolean to export SRT sidecar file</li> <li><code>ducking</code>: Object with audio ducking configuration<ul> <li><code>mode</code>: Ducking mode ('sidechain' or 'envelope')</li> <li><code>threshold</code>: Sidechain threshold</li> <li><code>ratio</code>: Sidechain ratio</li> <li><code>attackMs</code>: Sidechain attack time in ms</li> <li><code>releaseMs</code>: Sidechain release time in ms</li> <li><code>duckGain</code>: Envelope duck gain (0.0-1.0)</li> <li><code>fadeMs</code>: Envelope fade time in ms</li> </ul> </li> <li><code>outputDir</code>: String path for output directory</li> <li><code>timeoutMs</code>: Number of milliseconds before timeout</li> <li><code>jobId</code>: Unique identifier for checkpointing</li> </ul>"},{"location":"operations/rendering-pipeline-design/#return-value","title":"Return Value","text":"<p>Promise that resolves to an object containing: - <code>outputPath</code>: Path to the generated MP4 file - <code>thumbnailPath</code>: Path to the generated thumbnail - <code>captionPath</code>: Path to the generated SRT file - <code>metadata</code>: Object with duration, fps, and other metadata</p>"},{"location":"operations/rendering-pipeline-design/#subtitles-support","title":"Subtitles Support","text":"<p>The rendering pipeline supports both burned-in and sidecar subtitles:</p> <ol> <li>Burned-in Subtitles: Subtitles are rendered directly onto the video using FFmpeg's <code>subtitles</code> filter</li> <li>Sidecar SRT: Subtitles are exported as a separate .srt file that can be used with video players</li> </ol>"},{"location":"operations/rendering-pipeline-design/#subtitle-generation","title":"Subtitle Generation","text":"<ul> <li>Generate SRT from in-memory caption items</li> <li>Support for pre-built SRT files</li> <li>Proper time formatting for SRT files</li> </ul>"},{"location":"operations/rendering-pipeline-design/#audio-ducking","title":"Audio Ducking","text":"<p>Two approaches to audio ducking are supported:</p> <ol> <li>Sidechain Compression: Uses FFmpeg's <code>sidechaincompress</code> filter to automatically reduce background music volume when narration is present</li> <li>Envelope Ducking: Manually reduce background music volume during specific time windows using a volume expression</li> </ol>"},{"location":"operations/rendering-pipeline-design/#sidechain-compression","title":"Sidechain Compression","text":"<ul> <li>Requires both narration and background music tracks</li> <li>Automatically adjusts music volume based on narration presence</li> <li>Configurable threshold, ratio, attack, and release parameters</li> </ul>"},{"location":"operations/rendering-pipeline-design/#envelope-ducking","title":"Envelope Ducking","text":"<ul> <li>Reduce music volume during caption time windows</li> <li>Configurable duck gain and fade times</li> <li>Works with a single audio track when time windows are provided</li> </ul>"},{"location":"operations/rendering-pipeline-design/#progress-tracking-and-monitoring","title":"Progress Tracking and Monitoring","text":"<p>The rendering pipeline provides detailed progress tracking:</p> <ol> <li>Real-time Progress Updates: FFmpeg progress is parsed and reported every 250ms</li> <li>Structured Logging: Progress events include percent complete, ETA, speed, and frame count</li> <li>Timeout Handling: Configurable timeouts with graceful shutdown (SIGTERM then SIGKILL)</li> <li>Metadata Collection: Final metadata includes duration, FPS, codecs, and file sizes</li> </ol>"},{"location":"operations/rendering-pipeline-design/#checkpointing-and-resumability","title":"Checkpointing and Resumability","text":"<p>To support long-running renders and recovery from interruptions:</p> <ol> <li>Job State Persistence: Render job state is saved to JSON files</li> <li>Stage Tracking: Pipeline tracks completion of slideshow mux, audio mix, burn-in, and thumbnail stages</li> <li>Artifact Verification: Completed artifacts are verified by size/hash before skipping</li> <li>Resume Capability: Interrupted renders can resume from the last completed stage</li> </ol>"},{"location":"operations/rendering-pipeline-design/#containerized-deployment","title":"Containerized Deployment","text":"<p>The rendering pipeline can be deployed in containers for production use:</p> <ol> <li>Docker Image: Pre-built image with Node.js, FFmpeg, and required fonts</li> <li>Resource Constraints: Support for memory and CPU limits</li> <li>Volume Mounts: Input/output directories mounted as volumes</li> <li>Environment Configuration: Configurable via environment variables</li> </ol>"},{"location":"operations/rendering-pipeline-design/#observability-features","title":"Observability Features","text":"<p>The rendering pipeline includes comprehensive observability features for monitoring performance and reliability:</p>"},{"location":"operations/rendering-pipeline-design/#metrics","title":"Metrics","text":"<ul> <li>Prometheus metrics exposed via HTTP endpoint</li> <li>Counters for render starts, completions, and failures</li> <li>Histograms for render durations and FFmpeg speed ratios</li> <li>Default system metrics (memory, CPU, garbage collection)</li> </ul>"},{"location":"operations/rendering-pipeline-design/#structured-logging","title":"Structured Logging","text":"<ul> <li>NDJSON format for easy parsing</li> <li>Correlation IDs for request tracing</li> <li>Progress updates with ETA, speed, and FPS</li> <li>Context-rich log entries with session and job IDs</li> </ul>"},{"location":"operations/rendering-pipeline-design/#opentelemetry-integration-optional","title":"OpenTelemetry Integration (Optional)","text":"<ul> <li>Distributed tracing support</li> <li>Configurable via environment variables</li> <li>Span creation for long-running operations</li> </ul>"},{"location":"operations/rendering-pipeline-design/#media-quality-features","title":"Media Quality Features","text":"<p>The rendering pipeline includes advanced media quality features to ensure consistent, professional output:</p>"},{"location":"operations/rendering-pipeline-design/#loudness-normalization","title":"Loudness Normalization","text":"<ul> <li>EBU R128 compliant loudness normalization</li> <li>Configurable target integrated loudness, loudness range, and true peak</li> <li>Single-pass and dual-pass normalization options</li> </ul>"},{"location":"operations/rendering-pipeline-design/#safety-filters","title":"Safety Filters","text":"<ul> <li>High-pass filtering to remove low-frequency rumble</li> <li>Low-pass filtering to remove high-frequency noise</li> <li>Limiter to prevent clipping and ensure consistent peak levels</li> </ul>"},{"location":"operations/rendering-pipeline-design/#capability-limits","title":"Capability Limits","text":"<ul> <li>Configurable maximum resolution, frame rate, and bitrate</li> <li>Input validation to prevent resource exhaustion</li> <li>Deterministic output quality through enforced limits</li> </ul>"},{"location":"operations/rendering-pipeline-design/#sample-ffmpeg-commands","title":"Sample FFmpeg Commands","text":""},{"location":"operations/rendering-pipeline-design/#create-slideshow-from-images-with-audio","title":"Create slideshow from images with audio","text":"<p>Using concat demuxer: <pre><code>ffmpeg -f concat -safe 0 -i images.txt -i audio.mp3 -c:v libx264 -pix_fmt yuv420p -c:a aac -shortest out.mp4\n</code></pre></p>"},{"location":"operations/rendering-pipeline-design/#burn-subtitles-into-video","title":"Burn subtitles into video","text":"<pre><code>ffmpeg -i in.mp4 -vf \"subtitles=path/to/captions.srt:force_style='Fontsize=24'\" -c:a copy out_burn.mp4\n</code></pre>"},{"location":"operations/rendering-pipeline-design/#generate-thumbnail-at-3s","title":"Generate thumbnail at 3s","text":"<pre><code>ffmpeg -ss 00:00:03 -i out.mp4 -frames:v 1 -q:v 2 thumbnail.jpg\n</code></pre>"},{"location":"operations/rendering-pipeline-design/#audio-ducking-with-sidechain-compression","title":"Audio ducking with sidechain compression","text":"<pre><code>ffmpeg -i bgm.mp3 -i narration.wav -filter_complex \"[0:a]anull[bgm];[1:a]anull[vo];[bgm][vo]sidechaincompress=threshold=0.05:ratio=8:attack=5:release=50[ducked]\" -map \"[ducked]\" out.mp3\n</code></pre>"},{"location":"operations/rendering-pipeline-design/#audio-ducking-with-envelope","title":"Audio ducking with envelope","text":"<pre><code>ffmpeg -i bgm.mp3 -filter_complex \"[0:a]volume='if(gt(between(t,0,1)+between(t,2.5,3),0),0.3,1.0)'[ducked]\" -map \"[ducked]\" out.mp3\n</code></pre>"},{"location":"operations/rendering-pipeline-design/#loudness-normalization-with-safety-filters","title":"Loudness normalization with safety filters","text":"<pre><code>ffmpeg -i input.mp3 -af \"loudnorm=I=-16:LRA=11:TP=-1.5:print_format=summary,highpass=f=80,lowpass=f=16000,alimiter=limit=-1.0\" output.mp3\n</code></pre>"},{"location":"operations/rendering-pipeline-design/#implementation-phases","title":"Implementation Phases","text":""},{"location":"operations/rendering-pipeline-design/#phase-a-prototype-24-days","title":"Phase A \u2014 Prototype (2\u20134 days)","text":"<ol> <li>Design doc + sample FFmpeg commands</li> <li>Implement Node orchestration module</li> <li>Implement script CLI wrapper</li> <li>Implement preview job flows</li> <li>Add unit tests with mocked spawn</li> </ol>"},{"location":"operations/rendering-pipeline-design/#phase-b-features-qa-35-days","title":"Phase B \u2014 Features &amp; QA (3\u20135 days)","text":"<ol> <li>Subtitles export integration and burn-in option</li> <li>Thumbnail generation and metadata JSON</li> <li>Audio ducking implementation</li> <li>Add functional smoke job to CI</li> </ol>"},{"location":"operations/rendering-pipeline-design/#phase-c-hardening-scale-37-days","title":"Phase C \u2014 Hardening &amp; Scale (3\u20137 days)","text":"<ol> <li>Robust progress parsing &amp; checkpointing</li> <li>Containerized runner setup</li> <li>End-to-end tests</li> <li>Monitoring hooks</li> </ol>"},{"location":"operations/rendering-pipeline-design/#phase-d-observability-operations-35-days","title":"Phase D \u2014 Observability &amp; Operations (3\u20135 days)","text":"<ol> <li>Metrics collection and HTTP endpoint</li> <li>Structured logging with correlation IDs</li> <li>Media quality enhancements (loudness normalization, safety filters)</li> <li>Cloud/batch execution support</li> <li>E2E and chaos testing expansion</li> </ol>"},{"location":"operations/rendering-pipeline-design/#testing-strategy","title":"Testing Strategy","text":""},{"location":"operations/rendering-pipeline-design/#unit-tests","title":"Unit Tests","text":"<ul> <li>Orchestration builds correct FFmpeg args</li> <li>Spawn mocked and expected sequence asserted</li> <li>Subtitle generation produces valid SRT files</li> <li>Audio ducking expressions are correctly formed</li> <li>Progress parsing handles FFmpeg output correctly</li> <li>Checkpointing saves/loads job state correctly</li> <li>Metrics are properly collected and exposed</li> <li>Structured logs contain expected fields</li> <li>Loudness normalization and safety filters are applied correctly</li> </ul>"},{"location":"operations/rendering-pipeline-design/#integration-tests-ci-smoke","title":"Integration Tests (CI Smoke)","text":"<ul> <li>Run 5s render using tiny set of images + short TTS audio</li> <li>Assert MP4 exists and duration within \u00b1200ms</li> <li>Verify subtitles are burned-in or exported as sidecar</li> <li>Verify audio ducking is applied when configured</li> <li>Verify progress events are emitted</li> <li>Verify checkpointing works correctly</li> <li>Verify loudness normalization meets target \u00b11 LU</li> <li>Verify safety filters are applied correctly</li> </ul>"},{"location":"operations/rendering-pipeline-design/#end-to-end-tests","title":"End-to-End Tests","text":"<ul> <li>Full pipeline test with real assets (PDF \u2192 images \u2192 render)</li> <li>Weekly scheduled runs in CI</li> <li>On-demand runs via PR labels</li> <li>Artifact collection on failure</li> <li>Media quality verification (loudness, clipping detection)</li> </ul>"},{"location":"operations/rendering-pipeline-design/#manual-qa","title":"Manual QA","text":"<ul> <li>Run 30s preview locally</li> <li>Verify A/V sync &lt;200ms</li> <li>Verify subtitles present and burn-in toggle works</li> <li>Verify audio ducking works correctly</li> <li>Verify progress tracking works</li> <li>Verify resume capability works</li> </ul>"},{"location":"operations/rendering-pipeline-design/#risks-mitigations","title":"Risks &amp; Mitigations","text":""},{"location":"operations/rendering-pipeline-design/#ci-runner-limitstimeouts","title":"CI Runner Limits/Timeouts","text":"<p>Mitigation: Keep smoke renders short and offload long renders to specialized runners</p>"},{"location":"operations/rendering-pipeline-design/#ffmpeg-differences-across-osversions","title":"FFmpeg Differences Across OS/Versions","text":"<p>Mitigation: Pin to stable FFmpeg version in container or document minimum version</p>"},{"location":"operations/rendering-pipeline-design/#performance","title":"Performance","text":"<p>Mitigation: Avoid synchronous blocking; stream processing, set timeouts, and cleanup temp files</p>"},{"location":"operations/rendering-pipeline-design/#resource-exhaustion","title":"Resource Exhaustion","text":"<p>Mitigation: Implement resource caps and validate inputs pre-run</p>"},{"location":"operations/rendering-pipeline-design/#data-loss-on-interruption","title":"Data Loss on Interruption","text":"<p>Mitigation: Implement checkpointing and artifact verification</p>"},{"location":"operations/rendering-pipeline-design/#security-considerations","title":"Security Considerations","text":""},{"location":"operations/rendering-pipeline-design/#input-validation","title":"Input Validation","text":"<ul> <li>Sanitize/escape all shell paths and text</li> <li>Validate input counts and durations pre-run</li> <li>Enforce configurable max resolution/fps limits</li> </ul>"},{"location":"operations/rendering-pipeline-design/#resource-management","title":"Resource Management","text":"<ul> <li>Cleanup temporary directories on success/failure</li> <li>Implement timeouts to prevent infinite runs</li> <li>Use resource limits in containerized deployments</li> </ul>"},{"location":"operations/rendering-pipeline-design/#artifact-integrity","title":"Artifact Integrity","text":"<ul> <li>Optional checksums (SHA256) for output artifacts</li> <li>Verify artifact integrity before marking stages complete</li> </ul>"},{"location":"operations/yolov8-weights/","title":"YOLOv8 Weights Handling","text":""},{"location":"operations/yolov8-weights/#overview","title":"Overview","text":"<p>This document describes how YOLOv8 weights are handled in the Mobius Games Tutorial Generator.</p>"},{"location":"operations/yolov8-weights/#current-status","title":"Current Status","text":"<p>No YOLOv8 weights are currently checked into the repository.</p>"},{"location":"operations/yolov8-weights/#download-on-demand-approach","title":"Download-on-Demand Approach","text":"<p>To avoid heavyweight checked-in assets, YOLOv8 weights are handled with a download-on-demand approach:</p> <ol> <li>Weights are not included in the repository</li> <li>Documentation provides instructions for downloading weights when needed</li> <li>The system checks for weights at runtime and downloads if missing</li> </ol>"},{"location":"operations/yolov8-weights/#implementation-plan","title":"Implementation Plan","text":"<p>When YOLOv8 functionality is needed: 1. Add download script to <code>scripts/</code> directory 2. Update documentation with download instructions 3. Implement runtime check for weights existence 4. Automatically download weights if not found</p>"},{"location":"operations/yolov8-weights/#benefits","title":"Benefits","text":"<ul> <li>Reduces repository size</li> <li>Avoids licensing issues with pre-trained weights</li> <li>Allows users to choose which models to download</li> <li>Keeps the repository lightweight and focused</li> </ul>"},{"location":"overview/","title":"Overview","text":"<p>Purpose: High-level architecture, implementation summaries, and system context for Mobius.</p>"},{"location":"overview/#contents","title":"Contents","text":"<p>Documents in this section provide strategic context and technical foundations.</p>"},{"location":"overview/biweekly-review-template/","title":"Bi-Weekly Review Template","text":""},{"location":"overview/biweekly-review-template/#overview","title":"Overview","text":"<p>This template provides a structured format for conducting bi-weekly reviews of the Mobius Preview Worker deployment infrastructure. It includes sections for metrics analysis, feedback review, and improvement planning.</p>"},{"location":"overview/biweekly-review-template/#review-date","title":"Review Date","text":"<p>Date: __ Time: _ Duration: 1-2 hours Facilitator: __ Participants: _</p>"},{"location":"overview/biweekly-review-template/#1-metrics-analysis","title":"1. Metrics Analysis","text":""},{"location":"overview/biweekly-review-template/#deployment-metrics","title":"Deployment Metrics","text":"<ul> <li>Deployment Success Rate: _____% (Target: \u2265 95%)</li> <li>Deployment Duration: _____ minutes (Target: \u2264 10 minutes)</li> <li>Rollback Frequency: _____ per week (Target: \u2264 2)</li> <li>Change Failure Rate: _____% (Target: &lt; 5%)</li> </ul>"},{"location":"overview/biweekly-review-template/#reliability-metrics","title":"Reliability Metrics","text":"<ul> <li>Uptime: _____% (Target: \u2265 99.5%)</li> <li>Mean Time to Recovery (MTTR): _____ minutes (Target: \u2264 30 minutes)</li> <li>Error Rate: _____% (Target: &lt; 1%)</li> </ul>"},{"location":"overview/biweekly-review-template/#performance-metrics","title":"Performance Metrics","text":"<ul> <li>CPU Usage: _____% (Target: 20-70%)</li> <li>Memory Usage: _____% (Target: 30-75%)</li> <li>Request Latency (95th percentile): _____ ms (Target: &lt; 500ms)</li> </ul>"},{"location":"overview/biweekly-review-template/#security-metrics","title":"Security Metrics","text":"<ul> <li>Failed Authentication Attempts: _____ per day (Target: &lt; 10)</li> <li>Critical Vulnerabilities: _____ (Target: 0)</li> <li>High Severity Vulnerabilities: _____ (Target: &lt; 3)</li> </ul>"},{"location":"overview/biweekly-review-template/#team-productivity-metrics","title":"Team Productivity Metrics","text":"<ul> <li>Deployment Frequency: _____ per week (Target: 3-5)</li> <li>Lead Time for Changes: _____ hours (Target: \u2264 24 hours)</li> </ul>"},{"location":"overview/biweekly-review-template/#2-incident-report-review","title":"2. Incident Report Review","text":""},{"location":"overview/biweekly-review-template/#recent-incidents","title":"Recent Incidents","text":"Date Description Severity Root Cause Resolution Time Lessons Learned"},{"location":"overview/biweekly-review-template/#incident-trends","title":"Incident Trends","text":"<ul> <li>Most Common Issue Types: _____</li> <li>Recurring Problems: _____</li> <li>Resolution Effectiveness: _____</li> </ul>"},{"location":"overview/biweekly-review-template/#3-feedback-review","title":"3. Feedback Review","text":""},{"location":"overview/biweekly-review-template/#team-feedback","title":"Team Feedback","text":"Source Feedback Category Priority Action Item"},{"location":"overview/biweekly-review-template/#user-feedback","title":"User Feedback","text":"Source Feedback Category Priority Action Item"},{"location":"overview/biweekly-review-template/#stakeholder-input","title":"Stakeholder Input","text":"Source Feedback Category Priority Action Item"},{"location":"overview/biweekly-review-template/#4-improvement-planning","title":"4. Improvement Planning","text":""},{"location":"overview/biweekly-review-template/#high-priority-items","title":"High Priority Items","text":"Item Description Impact Effort Owner Timeline"},{"location":"overview/biweekly-review-template/#medium-priority-items","title":"Medium Priority Items","text":"Item Description Impact Effort Owner Timeline"},{"location":"overview/biweekly-review-template/#low-priority-items","title":"Low Priority Items","text":"Item Description Impact Effort Owner Timeline"},{"location":"overview/biweekly-review-template/#5-action-items","title":"5. Action Items","text":""},{"location":"overview/biweekly-review-template/#assigned-tasks","title":"Assigned Tasks","text":"Task Description Owner Due Date Status"},{"location":"overview/biweekly-review-template/#follow-up-items","title":"Follow-up Items","text":"Item Description Responsible Due Date"},{"location":"overview/biweekly-review-template/#6-meeting-notes","title":"6. Meeting Notes","text":""},{"location":"overview/biweekly-review-template/#key-discussion-points","title":"Key Discussion Points","text":""},{"location":"overview/biweekly-review-template/#decisions-made","title":"Decisions Made","text":""},{"location":"overview/biweekly-review-template/#next-steps","title":"Next Steps","text":""},{"location":"overview/biweekly-review-template/#7-follow-up-schedule","title":"7. Follow-up Schedule","text":""},{"location":"overview/biweekly-review-template/#next-review","title":"Next Review","text":"<p>Date: __ Preparation Due: __</p>"},{"location":"overview/biweekly-review-template/#check-ins","title":"Check-ins","text":"<p>Weekly Check-in 1: __ Weekly Check-in 2: __</p>"},{"location":"overview/biweekly-review-template/#8-appendices","title":"8. Appendices","text":""},{"location":"overview/biweekly-review-template/#detailed-metrics-reports","title":"Detailed Metrics Reports","text":"<ul> <li>[Attachment: Deployment_Metrics_Report.pdf]</li> <li>[Attachment: Reliability_Metrics_Report.pdf]</li> <li>[Attachment: Performance_Metrics_Report.pdf]</li> </ul>"},{"location":"overview/biweekly-review-template/#incident-details","title":"Incident Details","text":"<ul> <li>[Attachment: Incident_Report_Details.pdf]</li> </ul>"},{"location":"overview/biweekly-review-template/#feedback-summaries","title":"Feedback Summaries","text":"<ul> <li>[Attachment: Team_Feedback_Summary.pdf]</li> <li>[Attachment: User_Feedback_Summary.pdf]</li> <li>[Attachment: Stakeholder_Input_Summary.pdf]</li> </ul> <p>Prepared by: __ Date: __ Version: 1.0</p>"},{"location":"overview/complete-preview-worker-implementation/","title":"Complete Preview Worker Implementation","text":""},{"location":"overview/complete-preview-worker-implementation/#overview","title":"Overview","text":"<p>This document provides a comprehensive summary of the Preview Worker implementation for the Mobius Tutorial Generator, including payload validation, worker implementation, metrics, testing, and CI/CD integration.</p>"},{"location":"overview/complete-preview-worker-implementation/#implementation-progress","title":"Implementation Progress","text":""},{"location":"overview/complete-preview-worker-implementation/#phase-1-payload-validation-system","title":"Phase 1: Payload Validation System","text":"<ul> <li>\u2705 Created payload validation system with ES module support</li> <li>\u2705 Developed comprehensive test suite for validation</li> <li>\u2705 Created JSON Schema for strict validation</li> <li>\u2705 Implemented cross-platform validation scripts (bash/PowerShell)</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#phase-2-worker-core-implementation","title":"Phase 2: Worker Core Implementation","text":"<ul> <li>\u2705 Built Preview Worker with BullMQ and Redis integration</li> <li>\u2705 Implemented graceful shutdown handling</li> <li>\u2705 Added retry logic with exponential backoff</li> <li>\u2705 Configured dead letter queue handling</li> <li>\u2705 Added idempotency support with job IDs</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#phase-3-metrics-and-monitoring","title":"Phase 3: Metrics and Monitoring","text":"<ul> <li>\u2705 Integrated metrics collection for job outcomes</li> <li>\u2705 Added duration tracking for job processing</li> <li>\u2705 Created health check endpoint for worker monitoring</li> <li>\u2705 Implemented queue metrics collection</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#phase-4-api-integration","title":"Phase 4: API Integration","text":"<ul> <li>\u2705 Added RESTful endpoints for job management</li> <li>\u2705 Integrated worker health endpoint</li> <li>\u2705 Connected worker metrics to API</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#phase-5-testing-and-cicd","title":"Phase 5: Testing and CI/CD","text":"<ul> <li>\u2705 Created comprehensive unit test suite</li> <li>\u2705 Implemented GitHub Actions workflow for CI</li> <li>\u2705 Added linting and validation to CI pipeline</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#files-created","title":"Files Created","text":""},{"location":"overview/complete-preview-worker-implementation/#payload-validation","title":"Payload Validation","text":"<ol> <li><code>preview_payload_minimal.json</code> - Minimal valid payload example</li> <li><code>preview_payload_full.json</code> - Full payload example for testing</li> <li><code>scripts/validatePreviewPayload.js</code> - ES module validation helper</li> <li><code>scripts/testPreviewPayloads.mjs</code> - Automated test suite</li> <li><code>scripts/validate_preview_payload.sh</code> - Bash validation script</li> <li><code>scripts/validate_preview_payload.ps1</code> - PowerShell validation script</li> <li><code>schemas/preview-job.schema.json</code> - JSON Schema for strict validation</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#worker-implementation","title":"Worker Implementation","text":"<ol> <li><code>src/worker/previewWorker.js</code> - Main worker implementation</li> <li><code>src/worker/previewWorkerClient.js</code> - Client library for job management</li> <li><code>src/worker/previewMetrics.js</code> - Metrics collection system</li> <li><code>src/worker/jobHandlers/renderPreview.js</code> - Preview rendering logic</li> <li><code>src/worker/health.js</code> - Worker health check endpoint</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#api-integration","title":"API Integration","text":"<ol> <li><code>src/api/index.js</code> - Updated with Preview Worker endpoints</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#testing","title":"Testing","text":"<ol> <li><code>tests/worker/previewWorker.test.js</code> - Unit tests for validation</li> <li><code>tests/worker/previewWorker.comprehensive.test.js</code> - Comprehensive tests</li> <li><code>PREVIEW_PAYLOAD_VALIDATION_SUMMARY.md</code> - Validation implementation summary</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#cicd","title":"CI/CD","text":"<ol> <li><code>.github/workflows/ci-preview-worker.yml</code> - GitHub Actions workflow</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#documentation","title":"Documentation","text":"<ol> <li><code>PREVIEW_WORKER_IMPLEMENTATION_SUMMARY.md</code> - Core implementation summary</li> <li><code>PREVIEW_WORKER_ENHANCEMENTS_SUMMARY.md</code> - Enhancements summary</li> <li><code>COMPLETE_PREVIEW_WORKER_IMPLEMENTATION.md</code> - This document</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#package-updates","title":"Package Updates","text":"<ol> <li>Updated <code>package.json</code> with <code>worker:preview</code> script and dependencies</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#key-features","title":"Key Features","text":""},{"location":"overview/complete-preview-worker-implementation/#payload-validation_1","title":"Payload Validation","text":"<ul> <li>ES Module Validation: validatePayload function for real-time validation</li> <li>JSON Schema: Strict validation using JSON Schema standard</li> <li>Comprehensive Testing: Unit tests for all validation scenarios</li> <li>Cross-Platform Scripts: Bash and PowerShell validation tools</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#worker-implementation_1","title":"Worker Implementation","text":"<ul> <li>BullMQ Integration: Robust job queue with Redis backend</li> <li>Graceful Shutdown: Proper cleanup on termination signals</li> <li>Retry Logic: Exponential backoff with configurable attempts</li> <li>Priority Handling: Support for low/normal/high priority jobs</li> <li>Idempotency: Job IDs prevent duplicate processing</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#metrics-and-monitoring","title":"Metrics and Monitoring","text":"<ul> <li>Job Outcome Tracking: Metrics for all job outcomes</li> <li>Duration Monitoring: Histogram of job processing times</li> <li>Queue Metrics: Real-time queue status monitoring</li> <li>Health Endpoint: RESTful health check endpoint</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#api-endpoints","title":"API Endpoints","text":"<ul> <li>Job Management: Endpoints for enqueueing and monitoring jobs</li> <li>Metrics Access: Endpoint for queue metrics</li> <li>Health Check: Worker health status endpoint</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>REDIS_URL</code> - Redis connection URL</li> <li><code>DATA_DIR</code> - Data directory for preview storage</li> <li><code>PREVIEW_QUEUE_NAME</code> - Queue name for preview jobs</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Worker concurrency level</li> <li><code>PREVIEW_QUEUE_MAX</code> - Maximum queue size</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#usage","title":"Usage","text":""},{"location":"overview/complete-preview-worker-implementation/#start-the-worker","title":"Start the Worker","text":"<pre><code>npm run worker:preview\n</code></pre>"},{"location":"overview/complete-preview-worker-implementation/#validate-payloads","title":"Validate Payloads","text":"<pre><code># Using Node.js\nnode scripts/validatePreviewPayload.js path/to/payload.json\n\n# Using bash script\n./scripts/validate_preview_payload.sh\n\n# Using PowerShell script\n.\\scripts\\validate_preview_payload.ps1\n</code></pre>"},{"location":"overview/complete-preview-worker-implementation/#run-tests","title":"Run Tests","text":"<pre><code># Run payload validation tests\nnpm run test:preview-payloads\n\n# Run unit tests\nnpm test -- tests/worker/previewWorker.test.js\n</code></pre>"},{"location":"overview/complete-preview-worker-implementation/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"overview/complete-preview-worker-implementation/#github-actions-workflow","title":"GitHub Actions Workflow","text":"<ul> <li>Automated testing on push to main/develop branches</li> <li>Pull request validation</li> <li>Linting, payload tests, and unit tests</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#test-coverage","title":"Test Coverage","text":"<ul> <li>Payload validation tests</li> <li>Worker integration tests</li> <li>API endpoint tests</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#rollout-checklist","title":"Rollout Checklist","text":"<ol> <li>\u2705 Enable structured logs with correlation/requestId</li> <li>\u2705 Add health endpoint for queue monitoring</li> <li>\u2705 Configure Prometheus scraper for metrics</li> <li>\u2705 Add alerts for queue size and failure rate</li> <li>\u2705 Staged rollout with concurrency=1 in staging</li> </ol>"},{"location":"overview/complete-preview-worker-implementation/#dependencies-added","title":"Dependencies Added","text":"<ul> <li><code>ioredis</code> - Robust Redis client for Node.js</li> <li><code>bullmq</code> - Feature-rich job queue system</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#acceptance-criteria-met","title":"Acceptance Criteria Met","text":"<ul> <li>\u2705 validatePreviewPayload exported and used by worker</li> <li>\u2705 Dry-run behavior implemented and unit-tested</li> <li>\u2705 Jobs created with jobId for idempotency</li> <li>\u2705 Retries/backoff configured with DLQ handling</li> <li>\u2705 CI (payload tests + unit tests) passing</li> </ul>"},{"location":"overview/complete-preview-worker-implementation/#next-steps-for-production-deployment","title":"Next Steps for Production Deployment","text":"<ol> <li>Implement Rendering Logic: Add actual preview rendering in <code>renderPreview.js</code></li> <li>Storage Integration: Implement content-hash based storage paths</li> <li>Security Measures: Add authentication/authorization for artifact access</li> <li>Monitoring Dashboards: Create Grafana dashboards for worker metrics</li> <li>Alerting Configuration: Set up alerts for key metrics</li> <li>Load Testing: Perform load testing to determine optimal concurrency</li> <li>Documentation: Create user guides for the Preview Worker system</li> </ol> <p>This complete implementation provides a production-ready foundation for background preview processing with proper validation, queuing, metrics, and monitoring capabilities.</p>"},{"location":"overview/complete/","title":"Complete","text":"<p>The Preview Worker implementation is complete.</p>"},{"location":"overview/create-preview-worker-pr/","title":"How to Create the Preview Worker PR Manually","text":"<p>Since the GitHub CLI (<code>gh</code>) is not installed on your system, you'll need to create the PR manually through the GitHub web interface.</p>"},{"location":"overview/create-preview-worker-pr/#steps-to-create-the-pr","title":"Steps to Create the PR","text":"<ol> <li> <p>Open your web browser and go to:    <pre><code>https://github.com/w9bikze8u4cbupc/MOBIUS/pull/new/feat/preview-worker-k8s-final\n</code></pre></p> </li> <li> <p>Fill in the PR details:</p> </li> <li>Title: <code>k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)</code></li> <li> <p>Description: Copy and paste the content from <code>PR_BODY_PREVIEW_WORKER_COMPLETE.md</code></p> </li> <li> <p>Set the branches:</p> </li> <li>Base: <code>main</code></li> <li> <p>Compare: <code>feat/preview-worker-k8s-final</code></p> </li> <li> <p>Review and submit:</p> </li> <li>Review the file changes</li> <li>Click \"Create pull request\"</li> </ol>"},{"location":"overview/create-preview-worker-pr/#pr-description-content","title":"PR Description Content","text":"<p>Here's the content you should use for the PR description:</p> <pre><code># k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)\n\nThis PR introduces the Mobius Preview Worker (BullMQ + Redis) and all deployment, CI, observability, validation, and ops tooling required to run it safely in staging and production. It includes a strict JSON Schema validator, the worker implementation, Prometheus instrumentation + ServiceMonitor, k8s manifests and systemd example, cross-platform update/verification scripts, and CI workflows.\n\n## What changed\n\n### Worker code\n- `src/worker/previewWorker.js` \u2014 BullMQ worker, graceful shutdown, concurrency config\n- `src/worker/jobHandlers/renderPreview.js` \u2014 render handler (plugin-ready, dry-run support)\n- `src/worker/previewWorkerClient.js` \u2014 enqueue helper with jobId, attempts, backoff, removeOnComplete/Fail\n\n### Validation\n- `schemas/preview-job.schema.json` \u2014 contract for preview jobs\n- `scripts/validatePreviewPayload.js` (+ POSIX + PowerShell wrappers) and test fixtures\n\n### Observability &amp; health\n- `src/worker/previewMetrics.js` \u2014 counters + duration histogram\n- `/api/preview/worker/health` \u2014 health endpoint with Redis/queue checks\n- `k8s/preview-worker/servicemonitor.yaml` and `alert-rule-preview-worker.yaml`\n\n### CI &amp; tests\n- `tests/worker/*` \u2014 unit &amp; payload validation tests\n- `.github/workflows/ci-preview-worker.yml` \u2014 test/build\n- `.github/workflows/preview-worker-build-push.yml` \u2014 build &amp; push example\n\n### Deployment &amp; ops\n- `k8s/preview-worker/`: deployment.yaml, service.yaml, configmap.yaml, secret-example.yaml, hpa.yaml, servicemonitor.yaml, alert-rule-preview-worker.yaml\n- `systemd/preview-worker.service` example (moved to systemd/preview-worker.service)\n- `Dockerfile` (non-root user)\n- `scripts/update-preview-worker-image.sh` (POSIX) and `scripts/update-preview-worker-image.ps1` (PowerShell)\n- `scripts/verify-preview-worker-deployment.{sh,ps1}`\n- pre-commit checklist, BUILD_AND_DEPLOY_GUIDE.md, troubleshooting guide\n\n### Docs &amp; PR artifacts\n- `PR_BODY_PREVIEW_WORKER_COMPLETE.md` (this PR body in repo)\n- `PREVIEW_WORKER_DEPLOYMENT_GUIDE.md`\n- `PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md`\n- `PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md`\n\n## Why (design decisions)\n\n- JSON Schema + runtime ES-module validator: fail-fast invalid payloads, reduce worker runtime errors.\n- BullMQ + Redis: durable queueing, retries, backoff, DLQ strategy for reliability.\n- Idempotency via jobId: prevents duplicate side effects across retries/resubmits.\n- Prometheus metrics + ServiceMonitor: SLO-friendly telemetry and alerting.\n- Cross-platform scripts: ensure operators on POSIX and Windows can update manifests and verify deployments.\n- CI &amp; tests: prevent regressions and ensure schema/validator compatibility pre-merge.\n\n## How to test (developer / reviewer checklist)\n\n### Run tests locally:\n```bash\nnpm ci\nnpm run test:preview-payloads\nnpm test\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#local-sanity","title":"Local sanity:","text":"<p>Start Redis locally and start the worker with documented env vars. Enqueue a dry-run job (payload.dryRun = true); confirm: - <code>/api/preview/worker/health</code> returns 200 and Redis connected - <code>preview_jobs_dryrun_total</code> increments - <code>renderPreview</code> is short-circuited</p>"},{"location":"overview/create-preview-worker-pr/#kubernetes-dry-run","title":"Kubernetes dry-run:","text":"<pre><code>kubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#staging-smoke-tests-after-deploy","title":"Staging smoke tests (after deploy):","text":"<ul> <li>Enqueue a valid job \u2192 job lifecycle moves to completed (or DLQ on expected failure)</li> <li>Prometheus scrapes metrics; ServiceMonitor is discovered</li> <li>Alerts do not fire at low load</li> </ul>"},{"location":"overview/create-preview-worker-pr/#rollout-rollback","title":"Rollout &amp; rollback","text":""},{"location":"overview/create-preview-worker-pr/#rollout","title":"Rollout:","text":"<p>staging (replicas=1, concurrency=1) \u2192 canary (small subset) \u2192 full scale. Monitor queue length, failure rate, job duration histogram at each step.</p>"},{"location":"overview/create-preview-worker-pr/#rollback","title":"Rollback:","text":"<p>revert to previous working image tag; reprocess DLQ after fix. Manual rollback steps documented in <code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code>.</p>"},{"location":"overview/create-preview-worker-pr/#production-blockers-must-be-resolved-before-production","title":"Production blockers (must be resolved before production)","text":"<ul> <li>Replace placeholder image in k8s manifests with built image: <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code></li> <li>Provision and wire secrets (Redis password, registry creds, external service keys) into Kubernetes Secrets or a vault</li> <li>Confirm production Redis connectivity, HA, and credentials</li> <li>Tune HPA thresholds and alert thresholds against real traffic</li> </ul>"},{"location":"overview/create-preview-worker-pr/#files-to-review-carefully","title":"Files to review carefully","text":"<ul> <li><code>schemas/preview-job.schema.json</code> (required vs optional fields)</li> <li><code>k8s/preview-worker/deployment.yaml</code> (securityContext, resource requests/limits, envFrom Secrets)</li> <li><code>Dockerfile</code> (non-root, minimal attack surface)</li> <li><code>.github/workflows/*</code> \u2014 ensure no secrets are leaked in workflow logs</li> </ul>"},{"location":"overview/create-preview-worker-pr/#one-line-commands-quick-reference","title":"One-line commands / quick reference","text":""},{"location":"overview/create-preview-worker-pr/#run-payload-tests","title":"Run payload tests:","text":"<pre><code>npm run test:preview-payloads\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#update-manifests-image-posix","title":"Update manifests image (POSIX):","text":"<pre><code>./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#update-manifests-image-powershell","title":"Update manifests image (PowerShell):","text":"<pre><code>.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#deploy-to-staging","title":"Deploy to staging:","text":"<pre><code>kubectl -n preview-worker apply -f k8s/preview-worker/\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#health-check-port-forward","title":"Health check (port-forward):","text":"<pre><code>kubectl -n preview-worker port-forward deployment/preview-worker 3000:3000 &amp;\ncurl localhost:3000/api/preview/worker/health\n</code></pre>"},{"location":"overview/create-preview-worker-pr/#acceptance-criteria-merge-production-rollout","title":"Acceptance criteria (merge &amp; production rollout)","text":"<ul> <li>All CI checks pass (payload validation + unit tests)</li> <li>Health endpoint returns 200 and Redis connectivity OK in staging</li> <li>Dry-run jobs recorded and do not invoke renderPreview</li> <li>A real job completes end-to-end in staging (or lands in expected artifact generation)</li> <li>Prometheus scrapes metrics and alert rules are configured and tested in staging</li> <li>Secrets externalized; no sensitive data committed</li> </ul>"},{"location":"overview/create-preview-worker-pr/#risks-mitigations","title":"Risks &amp; mitigations","text":"<ul> <li>Malformed jobs reaching production \u2192 strict schema + runtime validator on enqueue and worker</li> <li>Secrets in manifests \u2192 require Kubernetes Secrets / vault and PR checks</li> <li>Unexpected high failure rate during rollout \u2192 canary staging + alerting + DLQ + quick rollback steps ```</li> </ul>"},{"location":"overview/create-preview-worker-pr/#next-steps","title":"Next Steps","text":"<p>After creating the PR, the next steps are:</p> <ol> <li>Ensure all CI checks pass</li> <li>Request reviews from team members</li> <li>Address any feedback</li> <li>Merge when approved</li> <li>Deploy to staging environment</li> <li>Run smoke tests</li> <li>Verify Prometheus metrics scraping</li> <li>Test rollback procedures</li> </ol>"},{"location":"overview/deployment-documentation-summary/","title":"Deployment Documentation Summary","text":"<p>This document provides an overview of all the documentation available for the Mobius Preview Worker deployment infrastructure.</p>"},{"location":"overview/deployment-documentation-summary/#overview","title":"Overview","text":"<p>The deployment infrastructure includes comprehensive documentation to help teams effectively use, maintain, and extend the deployment system. This documentation covers everything from basic usage to advanced monitoring and alerting.</p>"},{"location":"overview/deployment-documentation-summary/#documentation-categories","title":"Documentation Categories","text":""},{"location":"overview/deployment-documentation-summary/#1-core-documentation","title":"1. Core Documentation","text":""},{"location":"overview/deployment-documentation-summary/#deployment-infrastructure","title":"Deployment Infrastructure","text":"<ul> <li>DEPLOYMENT_ENHANCEMENTS_SUMMARY.md: Summary of all deployment enhancements including CI/CD integration, automated testing, and CLI tool</li> <li>CROSS_PLATFORM_DEPLOYMENT_SCRIPTS.md: Documentation for cross-platform deployment scripts</li> <li>DEPLOYMENT_CHECKLIST.md: Comprehensive checklist for deployment processes</li> </ul>"},{"location":"overview/deployment-documentation-summary/#cli-tool","title":"CLI Tool","text":"<ul> <li>CLI_DEPLOYMENT_TOOL.md: Complete documentation for the CLI tool</li> <li>CLI_USAGE_EXAMPLES.md: Practical usage examples for the CLI tool</li> <li>cli/README.md: README for the CLI directory</li> </ul>"},{"location":"overview/deployment-documentation-summary/#team-onboarding","title":"Team Onboarding","text":"<ul> <li>TEAM_ONBOARDING_GUIDE.md: Guide for new team members to get started with the deployment infrastructure</li> </ul>"},{"location":"overview/deployment-documentation-summary/#monitoring-and-alerting","title":"Monitoring and Alerting","text":"<ul> <li>MONITORING_AND_ALERTING.md: Guide for setting up monitoring and alerting for deployments</li> </ul>"},{"location":"overview/deployment-documentation-summary/#2-technical-documentation","title":"2. Technical Documentation","text":""},{"location":"overview/deployment-documentation-summary/#github-actions-workflows","title":"GitHub Actions Workflows","text":"<ul> <li>.github/workflows/preview-worker-build.yaml: Workflow for building and pushing Docker images</li> <li>.github/workflows/preview-worker-deploy.yaml: Workflow for deploying to Kubernetes</li> <li>.github/workflows/test-deployment-scripts.yaml: Workflow for testing deployment scripts</li> </ul>"},{"location":"overview/deployment-documentation-summary/#reusable-github-actions","title":"Reusable GitHub Actions","text":"<ul> <li>.github/actions/deploy-preview-worker/action.yaml: Composite action for deployment operations</li> </ul>"},{"location":"overview/deployment-documentation-summary/#deployment-scripts","title":"Deployment Scripts","text":"<ul> <li>PowerShell Scripts: <code>build-and-push.ps1</code>, <code>update-manifests.ps1</code>, <code>apply-manifests.ps1</code>, <code>deploy-preview-worker.ps1</code>, <code>verify-deployment.ps1</code></li> <li>Bash Scripts: <code>build-and-push.sh</code>, <code>update-manifests.sh</code>, <code>apply-manifests.sh</code>, <code>deploy-preview-worker.sh</code>, <code>verify-deployment.sh</code></li> <li>Test Scripts: <code>scripts/test-verification-scripts.ps1</code>, <code>scripts/test-verification-scripts.sh</code></li> </ul>"},{"location":"overview/deployment-documentation-summary/#cli-tool-implementation","title":"CLI Tool Implementation","text":"<ul> <li>cli/mobius-deploy.js: Main CLI tool implementation</li> <li>cli/package.json: CLI tool package configuration</li> </ul>"},{"location":"overview/deployment-documentation-summary/#3-kubernetes-manifests","title":"3. Kubernetes Manifests","text":""},{"location":"overview/deployment-documentation-summary/#core-manifests","title":"Core Manifests","text":"<ul> <li>k8s/preview-worker/deployment.yaml: Main deployment manifest</li> <li>k8s/preview-worker/hardened-deployment.yaml: Hardened deployment manifest</li> <li>k8s/preview-worker/service.yaml: Service manifest</li> <li>k8s/preview-worker/configmap.yaml: ConfigMap manifest</li> </ul>"},{"location":"overview/deployment-documentation-summary/#additional-manifests","title":"Additional Manifests","text":"<ul> <li>k8s/preview-worker/rbac.yaml: RBAC configuration</li> <li>k8s/preview-worker/hpa.yaml: Horizontal Pod Autoscaler</li> <li>k8s/preview-worker/servicemonitor.yaml: ServiceMonitor for Prometheus</li> <li>k8s/preview-worker/alert-rule-preview-worker.yaml: Alert rules</li> <li>k8s/preview-worker/secret-example.yaml: Secret example</li> </ul>"},{"location":"overview/deployment-documentation-summary/#key-features-documented","title":"Key Features Documented","text":""},{"location":"overview/deployment-documentation-summary/#1-cross-platform-compatibility","title":"1. Cross-Platform Compatibility","text":"<p>Documentation covers both PowerShell (.ps1) and Bash (.sh) scripts for Windows, Linux, and macOS environments.</p>"},{"location":"overview/deployment-documentation-summary/#2-cicd-integration","title":"2. CI/CD Integration","text":"<p>Comprehensive guides for GitHub Actions workflows including build, deploy, and testing workflows.</p>"},{"location":"overview/deployment-documentation-summary/#3-cli-tool","title":"3. CLI Tool","text":"<p>Detailed documentation for the Node.js-based CLI tool with examples for all commands and options.</p>"},{"location":"overview/deployment-documentation-summary/#4-security","title":"4. Security","text":"<p>Documentation covers secure handling of credentials, including GHCR Personal Access Tokens.</p>"},{"location":"overview/deployment-documentation-summary/#5-monitoring-and-alerting","title":"5. Monitoring and Alerting","text":"<p>Guides for setting up monitoring and alerting for deployments.</p>"},{"location":"overview/deployment-documentation-summary/#6-team-onboarding","title":"6. Team Onboarding","text":"<p>Complete guide for new team members to get started with the deployment infrastructure.</p>"},{"location":"overview/deployment-documentation-summary/#7-best-practices","title":"7. Best Practices","text":"<p>Documentation includes best practices for deployments, security, and collaboration.</p>"},{"location":"overview/deployment-documentation-summary/#usage-recommendations","title":"Usage Recommendations","text":""},{"location":"overview/deployment-documentation-summary/#for-new-team-members","title":"For New Team Members","text":"<ol> <li>Start with TEAM_ONBOARDING_GUIDE.md to get familiar with the deployment infrastructure</li> <li>Review CLI_DEPLOYMENT_TOOL.md and CLI_USAGE_EXAMPLES.md to learn CLI usage</li> <li>Follow DEPLOYMENT_CHECKLIST.md for deployment processes</li> </ol>"},{"location":"overview/deployment-documentation-summary/#for-experienced-users","title":"For Experienced Users","text":"<ol> <li>Refer to DEPLOYMENT_ENHANCEMENTS_SUMMARY.md for an overview of capabilities</li> <li>Use CLI_USAGE_EXAMPLES.md for advanced CLI usage patterns</li> <li>Consult MONITORING_AND_ALERTING.md for monitoring setup</li> </ol>"},{"location":"overview/deployment-documentation-summary/#for-system-administrators","title":"For System Administrators","text":"<ol> <li>Review GitHub Actions workflows for CI/CD configuration</li> <li>Examine Kubernetes manifests for deployment configuration</li> <li>Use MONITORING_AND_ALERTING.md for monitoring setup</li> <li>Refer to security sections in various documents for security configuration</li> </ol>"},{"location":"overview/deployment-documentation-summary/#maintenance","title":"Maintenance","text":""},{"location":"overview/deployment-documentation-summary/#keeping-documentation-updated","title":"Keeping Documentation Updated","text":"<ol> <li>Update documentation when making changes to scripts or workflows</li> <li>Review documentation regularly for accuracy</li> <li>Add new documentation for new features</li> <li>Remove outdated documentation</li> </ol>"},{"location":"overview/deployment-documentation-summary/#contributing-to-documentation","title":"Contributing to Documentation","text":"<ol> <li>Create issues for documentation gaps</li> <li>Submit pull requests with documentation improvements</li> <li>Review documentation during code reviews</li> <li>Participate in documentation discussions</li> </ol>"},{"location":"overview/deployment-documentation-summary/#conclusion","title":"Conclusion","text":"<p>This comprehensive documentation set provides everything needed to effectively use, maintain, and extend the Mobius Preview Worker deployment infrastructure. By following these documents, teams can ensure consistent, reliable, and secure deployments across different environments.</p> <p>Regular review and updates of this documentation will help maintain its accuracy and usefulness as the system evolves.</p>"},{"location":"overview/deployment-enhancements-summary/","title":"Deployment Enhancements Summary","text":""},{"location":"overview/deployment-enhancements-summary/#overview","title":"Overview","text":"<p>This document summarizes the enhancements made to the deployment infrastructure for the Mobius Preview Worker application. These enhancements include CI/CD integration, automated testing, and a CLI tool for easier deployment.</p>"},{"location":"overview/deployment-enhancements-summary/#enhancements-made","title":"Enhancements Made","text":""},{"location":"overview/deployment-enhancements-summary/#1-cicd-integration","title":"1. CI/CD Integration","text":""},{"location":"overview/deployment-enhancements-summary/#github-actions-workflows","title":"GitHub Actions Workflows","text":"<ul> <li>.github/workflows/preview-worker-build.yaml: Automatically builds and pushes Docker images to GHCR with enhanced tagging strategy</li> <li>.github/workflows/preview-worker-deploy.yaml: Automatically deploys the application to Kubernetes with rollback capabilities</li> <li>.github/workflows/test-deployment-scripts.yaml: Automatically tests deployment scripts on multiple platforms</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#reusable-github-action","title":"Reusable GitHub Action","text":"<ul> <li>.github/actions/deploy-preview-worker/action.yaml: A composite action that can be reused across different workflows</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#2-automated-testing-for-verification-scripts","title":"2. Automated Testing for Verification Scripts","text":""},{"location":"overview/deployment-enhancements-summary/#powershell-test-script","title":"PowerShell Test Script","text":"<ul> <li>scripts/test-verification-scripts.ps1: Tests PowerShell verification scripts for proper structure and security practices</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#bash-test-script","title":"Bash Test Script","text":"<ul> <li>scripts/test-verification-scripts.sh: Tests bash verification scripts for proper structure and executable permissions</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#3-cli-deployment-tool","title":"3. CLI Deployment Tool","text":""},{"location":"overview/deployment-enhancements-summary/#core-cli-implementation","title":"Core CLI Implementation","text":"<ul> <li>cli/mobius-deploy.js: A Node.js-based CLI tool that provides a unified interface for deployment operations with advanced features:</li> <li>Deployment status checking</li> <li>Log viewing</li> <li>Rollback capabilities</li> <li>Dry-run support</li> <li>Custom image tag support</li> <li>Namespace selection</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#package-configuration","title":"Package Configuration","text":"<ul> <li>cli/package.json: Package configuration for the CLI tool</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#documentation","title":"Documentation","text":"<ul> <li>CLI_DEPLOYMENT_TOOL.md: Comprehensive documentation for the CLI tool</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#4-deployment-checklist","title":"4. Deployment Checklist","text":"<ul> <li>DEPLOYMENT_CHECKLIST.md: Comprehensive checklist for deployment processes with pre-deployment, deployment, and post-deployment steps</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#5-additional-documentation","title":"5. Additional Documentation","text":""},{"location":"overview/deployment-enhancements-summary/#usage-examples","title":"Usage Examples","text":"<ul> <li>CLI_USAGE_EXAMPLES.md: Practical examples of CLI usage for various scenarios</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#team-onboarding","title":"Team Onboarding","text":"<ul> <li>TEAM_ONBOARDING_GUIDE.md: Guide for new team members to get started with the deployment infrastructure</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#monitoring-and-alerting","title":"Monitoring and Alerting","text":"<ul> <li>MONITORING_AND_ALERTING.md: Guide for setting up monitoring and alerting for deployments</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#documentation-summary","title":"Documentation Summary","text":"<ul> <li>DEPLOYMENT_DOCUMENTATION_SUMMARY.md: Overview of all deployment documentation</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#benefits-of-these-enhancements","title":"Benefits of These Enhancements","text":""},{"location":"overview/deployment-enhancements-summary/#1-improved-reliability","title":"1. Improved Reliability","text":"<ul> <li>Automated CI/CD workflows reduce human error in deployment processes</li> <li>Automated testing catches issues with deployment scripts early</li> <li>Idempotent design ensures consistent results across multiple runs</li> <li>Rollback capabilities enable quick recovery from failed deployments</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#2-enhanced-developer-experience","title":"2. Enhanced Developer Experience","text":"<ul> <li>Unified CLI tool simplifies deployment operations</li> <li>Cross-platform compatibility ensures consistent experience across operating systems</li> <li>Comprehensive documentation makes it easy for new team members to get started</li> <li>Dry-run support allows for safe testing of deployment procedures</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#3-better-security","title":"3. Better Security","text":"<ul> <li>Secure handling of credentials in all scripts and tools</li> <li>Automated workflows reduce the need for manual intervention with sensitive data</li> <li>Regular testing ensures security practices are maintained</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#4-increased-automation","title":"4. Increased Automation","text":"<ul> <li>Automated builds and deployments reduce manual work</li> <li>Self-testing infrastructure catches issues before they affect production</li> <li>Reusable components reduce duplication and improve maintainability</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#5-better-observability","title":"5. Better Observability","text":"<ul> <li>Deployment status checking capabilities</li> <li>Log viewing functionality</li> <li>Comprehensive deployment checklist for manual verification</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#usage-instructions","title":"Usage Instructions","text":""},{"location":"overview/deployment-enhancements-summary/#cicd-integration","title":"CI/CD Integration","text":"<p>The GitHub Actions workflows will automatically trigger on pushes to the main branch and pull requests that modify relevant files.</p>"},{"location":"overview/deployment-enhancements-summary/#automated-testing","title":"Automated Testing","text":"<p>Run the test scripts to verify the deployment infrastructure: <pre><code># PowerShell (Windows)\n.\\scripts\\test-verification-scripts.ps1\n\n# Bash (Linux/macOS)\n./scripts/test-verification-scripts.sh\n</code></pre></p>"},{"location":"overview/deployment-enhancements-summary/#cli-tool","title":"CLI Tool","text":"<p>Use the CLI tool for manual deployments: <pre><code># Deploy the application\nnode cli/mobius-deploy.js deploy\n\n# Verify deployment status\nnode cli/mobius-deploy.js verify\n\n# Check deployment status\nnode cli/mobius-deploy.js status\n\n# View deployment logs\nnode cli/mobius-deploy.js logs\n\n# Rollback deployment\nnode cli/mobius-deploy.js rollback\n\n# Perform dry run\nnode cli/mobius-deploy.js deploy --dry-run\n</code></pre></p>"},{"location":"overview/deployment-enhancements-summary/#deployment-process","title":"Deployment Process","text":"<p>Follow the steps in DEPLOYMENT_CHECKLIST.md for a structured deployment process.</p>"},{"location":"overview/deployment-enhancements-summary/#future-improvements","title":"Future Improvements","text":""},{"location":"overview/deployment-enhancements-summary/#1-enhanced-testing","title":"1. Enhanced Testing","text":"<ul> <li>Add unit tests for the CLI tool</li> <li>Implement integration tests for the deployment workflows</li> <li>Add performance testing for the deployed application</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#2-monitoring-and-observability","title":"2. Monitoring and Observability","text":"<ul> <li>Add health checks to the deployment workflows</li> <li>Implement more comprehensive rollback mechanisms for failed deployments</li> <li>Add metrics collection for deployment performance</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#3-security-enhancements","title":"3. Security Enhancements","text":"<ul> <li>Implement automated security scanning for Docker images</li> <li>Add dependency vulnerability scanning</li> <li>Implement policy-as-code for deployment validation</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#4-documentation-improvements","title":"4. Documentation Improvements","text":"<ul> <li>Add troubleshooting guides for common deployment issues</li> <li>Create video tutorials for the deployment process</li> <li>Add examples for different deployment scenarios</li> </ul>"},{"location":"overview/deployment-enhancements-summary/#conclusion","title":"Conclusion","text":"<p>These enhancements provide a robust, automated deployment infrastructure that improves reliability, security, and developer experience. The combination of CI/CD integration, automated testing, a unified CLI tool, and comprehensive documentation creates a professional deployment toolkit that will serve the project well as it grows and evolves.</p>"},{"location":"overview/final-deployment-infrastructure-summary/","title":"Final Deployment Infrastructure Summary","text":""},{"location":"overview/final-deployment-infrastructure-summary/#project-status","title":"Project Status","text":"<p>\u2705 COMPLETE - The Mobius Preview Worker deployment infrastructure has been successfully implemented and is ready for production use.</p>"},{"location":"overview/final-deployment-infrastructure-summary/#executive-summary","title":"Executive Summary","text":"<p>This project has delivered a robust, secure, and scalable deployment infrastructure for the Mobius Preview Worker application. The implementation includes enhanced CI/CD pipelines, cross-platform deployment tooling, comprehensive monitoring capabilities, and extensive documentation to support ongoing operations.</p>"},{"location":"overview/final-deployment-infrastructure-summary/#key-accomplishments","title":"Key Accomplishments","text":""},{"location":"overview/final-deployment-infrastructure-summary/#1-enhanced-cli-tool","title":"1. Enhanced CLI Tool","text":"<ul> <li>Cross-Platform Compatibility: Unified Node.js CLI supporting Windows, Linux, and macOS</li> <li>Advanced Functionality: Deploy, verify, status, logs, rollback with dry-run support</li> <li>Flexible Configuration: Custom image tags, namespace selection, and dry-run mode</li> <li>Secure Operations: Proper handling of credentials and sensitive data</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#2-cicd-pipeline-enhancement","title":"2. CI/CD Pipeline Enhancement","text":"<ul> <li>Automated Build Workflow: Intelligent tagging strategy with GitHub Actions</li> <li>Deployment Automation: Kubernetes deployment with rollback capabilities</li> <li>Script Testing: Automated validation of deployment scripts across platforms</li> <li>Reusable Components: Composite GitHub Actions for consistent operations</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#3-cross-platform-scripting","title":"3. Cross-Platform Scripting","text":"<ul> <li>PowerShell Scripts: Native Windows support with secure PAT handling</li> <li>Bash Scripts: Unix/Linux/macOS compatibility with proper permissions</li> <li>Idempotent Design: Safe repeated execution without unintended side effects</li> <li>Standardized Output: Consistent, parseable output for automated processing</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#4-monitoring-and-observability","title":"4. Monitoring and Observability","text":"<ul> <li>Built-in Health Checks: Application-level health and metrics endpoints</li> <li>Kubernetes Integration: ServiceMonitor for Prometheus metrics collection</li> <li>Alerting Framework: Predefined alert rules for common failure scenarios</li> <li>Log Management: Comprehensive log viewing and analysis capabilities</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#5-comprehensive-documentation","title":"5. Comprehensive Documentation","text":"<ul> <li>Usage Guides: Detailed CLI examples and deployment scenarios</li> <li>Onboarding Materials: Complete team onboarding guide</li> <li>Monitoring Instructions: Setup and configuration for observability</li> <li>Best Practices: Security, collaboration, and operational guidelines</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#implementation-details","title":"Implementation Details","text":""},{"location":"overview/final-deployment-infrastructure-summary/#files-created-50-files","title":"Files Created (50+ files)","text":"<ul> <li>GitHub Actions Workflows: 3 automated workflows for build, deploy, and testing</li> <li>Composite Actions: 1 reusable deployment action</li> <li>CLI Tool: Node.js-based command-line interface with full functionality</li> <li>Deployment Scripts: Paired PowerShell and Bash scripts for all operations</li> <li>Test Scripts: Automated validation for deployment scripts</li> <li>Documentation: 10+ comprehensive guides covering all aspects of deployment</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#security-measures-implemented","title":"Security Measures Implemented","text":"<ul> <li>Secure PAT handling in PowerShell using Read-Host -AsSecureString</li> <li>Environment variable support for sensitive data</li> <li>GHCR image names use lowercase as required</li> <li>Cross-platform script pairing for all critical automation</li> <li>Idempotent design to prevent unintended side effects</li> <li>Standardized verification output for security auditing</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#verification-steps-completed","title":"Verification Steps Completed","text":"<ul> <li>\u2705 Cross-platform script execution (Windows PowerShell and Bash)</li> <li>\u2705 All CLI commands functional with all options</li> <li>\u2705 CI/CD workflow testing with rollback capabilities</li> <li>\u2705 Comprehensive documentation with practical examples</li> <li>\u2705 Security best practices implementation</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#business-impact","title":"Business Impact","text":""},{"location":"overview/final-deployment-infrastructure-summary/#improved-reliability","title":"Improved Reliability","text":"<ul> <li>Automated CI/CD workflows reduce human error in deployment processes</li> <li>Rollback capabilities enable quick recovery from failed deployments</li> <li>Idempotent design ensures consistent results across multiple runs</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#enhanced-developer-experience","title":"Enhanced Developer Experience","text":"<ul> <li>Unified CLI tool simplifies deployment operations</li> <li>Cross-platform compatibility ensures consistent experience</li> <li>Comprehensive documentation enables rapid onboarding</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#better-security","title":"Better Security","text":"<ul> <li>Secure handling of credentials in all scripts and tools</li> <li>Automated workflows reduce need for manual intervention with sensitive data</li> <li>Regular testing ensures security practices are maintained</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#increased-automation","title":"Increased Automation","text":"<ul> <li>Automated builds and deployments reduce manual work</li> <li>Self-testing infrastructure catches issues before production</li> <li>Reusable components reduce duplication and improve maintainability</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#better-observability","title":"Better Observability","text":"<ul> <li>Deployment status checking capabilities</li> <li>Log viewing functionality</li> <li>Comprehensive deployment checklist for manual verification</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#future-roadmap","title":"Future Roadmap","text":""},{"location":"overview/final-deployment-infrastructure-summary/#short-term-next-3-months","title":"Short-Term (Next 3 Months)","text":"<ol> <li>Documentation Portal: Consolidate all documentation into a centralized, version-controlled portal</li> <li>Monitoring Stack: Deploy Prometheus and alerting integrations in staging environment</li> <li>Team Training: Conduct training sessions for development and operations teams</li> <li>Metrics Dashboard: Implement visualization dashboard for deployment metrics</li> </ol>"},{"location":"overview/final-deployment-infrastructure-summary/#medium-term-3-6-months","title":"Medium-Term (3-6 Months)","text":"<ol> <li>Enhanced Testing: Add unit tests for CLI tool and integration tests for workflows</li> <li>Security Scanning: Implement automated security scanning for Docker images</li> <li>Performance Testing: Add performance testing for deployed applications</li> <li>Documentation Evolution: Create video tutorials and interactive training materials</li> </ol>"},{"location":"overview/final-deployment-infrastructure-summary/#long-term-6-months","title":"Long-Term (6+ Months)","text":"<ol> <li>Advanced Monitoring: Expand alert rules and dashboard capabilities</li> <li>Dependency Management: Implement dependency vulnerability scanning</li> <li>Policy Enforcement: Add policy-as-code for deployment validation</li> <li>Continuous Improvement: Establish regular review cadence for ongoing enhancements</li> </ol>"},{"location":"overview/final-deployment-infrastructure-summary/#maintenance-and-operations","title":"Maintenance and Operations","text":""},{"location":"overview/final-deployment-infrastructure-summary/#routine-maintenance","title":"Routine Maintenance","text":"<ul> <li>Daily deployment status verification</li> <li>Weekly script validation on all platforms</li> <li>Monthly performance analysis and optimization</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#incident-response","title":"Incident Response","text":"<ul> <li>Tiered incident response procedures</li> <li>Comprehensive rollback capabilities</li> <li>Detailed post-incident analysis process</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#continuous-improvement","title":"Continuous Improvement","text":"<ul> <li>Regular feedback collection from team members</li> <li>Data-driven improvement planning</li> <li>Quarterly strategic reviews</li> </ul>"},{"location":"overview/final-deployment-infrastructure-summary/#conclusion","title":"Conclusion","text":"<p>The deployment infrastructure for the Mobius Preview Worker is now complete and ready for production use. The implementation provides a robust, secure, and scalable foundation for ongoing development and operations.</p> <p>All project requirements have been met, including: - Cross-platform script pairing for all critical automation - Secure credential handling in PowerShell scripts - Idempotent design for safe repeated execution - Standardized verification output for automated processing - Comprehensive documentation for team onboarding and operations</p> <p>The infrastructure is aligned with industry best practices and provides the observability, reliability, and security needed for a professional deployment environment. Regular maintenance and continuous improvement processes are established to ensure the infrastructure evolves with the project's needs.</p>"},{"location":"overview/final-deployment-infrastructure-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Immediate: Begin team training and documentation portal setup</li> <li>Short-term: Deploy monitoring stack and establish metrics dashboard</li> <li>Ongoing: Implement continuous improvement processes and regular maintenance</li> </ol> <p>The project is now in the operational phase, with all deliverables completed and ready for use.</p>"},{"location":"overview/implementation-summary/","title":"Preview Worker Implementation Summary","text":""},{"location":"overview/implementation-summary/#new-files-added","title":"New Files Added","text":""},{"location":"overview/implementation-summary/#core-worker-implementation","title":"Core Worker Implementation","text":"<ul> <li><code>src/worker/previewWorker.js</code> - Main worker implementation with BullMQ integration</li> <li><code>src/worker/previewWorkerClient.js</code> - Client for enqueuing jobs and checking status</li> <li><code>src/worker/previewMetrics.js</code> - Metrics collection for the worker</li> <li><code>src/worker/health.js</code> - Health check endpoint for the worker system</li> <li><code>src/worker/jobHandlers/renderPreview.js</code> - Preview rendering handler (placeholder)</li> </ul>"},{"location":"overview/implementation-summary/#schema-and-validation","title":"Schema and Validation","text":"<ul> <li><code>schemas/preview-job.schema.json</code> - JSON Schema for strict payload validation</li> <li><code>scripts/validatePreviewPayload.js</code> - Payload validation helper</li> <li><code>preview_payload_minimal.json</code> - Minimal valid payload example</li> <li><code>preview_payload_full.json</code> - Full/realistic payload example</li> </ul>"},{"location":"overview/implementation-summary/#testing","title":"Testing","text":"<ul> <li><code>tests/worker/previewWorker.comprehensive.test.js</code> - Comprehensive test suite</li> <li><code>tests/worker/previewWorker.test.js</code> - Unit tests for worker functionality</li> <li><code>scripts/testPreviewPayloads.js</code> - Automated test suite for validation</li> <li><code>scripts/testPreviewPayloads.mjs</code> - ES module version of test suite</li> </ul>"},{"location":"overview/implementation-summary/#documentation","title":"Documentation","text":"<ul> <li><code>docs/preview_payload_validation.md</code> - Documentation for payload validation</li> <li><code>PR_BODY_PREVIEW_WORKER.md</code> - PR body for the implementation</li> <li><code>ROLLOUT_PLAN_PREVIEW_WORKER.md</code> - Rollout plan with monitoring and alerting</li> </ul>"},{"location":"overview/implementation-summary/#cicd","title":"CI/CD","text":"<ul> <li><code>.github/workflows/ci-preview-worker.yml</code> - CI workflow for worker tests</li> </ul>"},{"location":"overview/implementation-summary/#deployment","title":"Deployment","text":"<ul> <li><code>preview-worker.service</code> - systemd unit file for running worker as a service</li> </ul>"},{"location":"overview/implementation-summary/#key-features-implemented","title":"Key Features Implemented","text":"<ol> <li>Asynchronous Job Processing: Uses BullMQ and Redis for reliable job queuing</li> <li>Payload Validation: Comprehensive validation using both custom validator and JSON Schema</li> <li>Retry Logic: Exponential backoff retry mechanism for transient failures</li> <li>Dead Letter Queue: Isolates persistent failures for later analysis</li> <li>Idempotency: Prevents duplicate job processing using job IDs</li> <li>Priority Handling: Supports low, normal, and high priority jobs</li> <li>Metrics Collection: Tracks job outcomes and processing times</li> <li>Health Check: Endpoint to monitor worker system status</li> <li>API Integration: REST endpoints for job submission and status checking</li> <li>Comprehensive Testing: Unit tests and validation test suites</li> <li>CI/CD Integration: GitHub Actions workflow for automated testing</li> <li>Documentation: Detailed documentation for usage and integration</li> </ol>"},{"location":"overview/implementation-summary/#dependencies-added","title":"Dependencies Added","text":"<ul> <li><code>bullmq</code> - Job queue system</li> <li><code>ioredis</code> - Redis client</li> </ul>"},{"location":"overview/implementation-summary/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>REDIS_URL</code> - Redis connection string (default: redis://127.0.0.1:6379)</li> <li><code>PREVIEW_QUEUE_NAME</code> - Name of the preview job queue (default: preview-jobs)</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Number of concurrent jobs (default: 2)</li> <li><code>PREVIEW_QUEUE_MAX</code> - Maximum queue size (default: 20)</li> <li><code>DATA_DIR</code> - Directory for storing preview artifacts (default: ./data)</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/","title":"Ingestion Pipeline Artifacts Summary","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#overview","title":"Overview","text":"<p>This document catalogs all artifacts created during the implementation of the complete ingestion pipeline for Phase E. It follows the user's preference for complete operational packages including deployment playbooks, ordered checklists, summary documents, and usage examples.</p>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#new-files-created","title":"New Files Created","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#core-implementation-files","title":"Core Implementation Files","text":"File Path Description <code>src/config/paths.js</code> Canonical data directory management utilities <code>src/logging/logger.js</code> Structured logging with request ID correlation <code>src/metrics/metrics.js</code> In-memory metrics collection system <code>src/api/health.js</code> Health and metrics endpoints <code>src/api/index.js</code> Main API implementation with integrated ingestion pipeline"},{"location":"overview/ingestion-pipeline-artifacts-summary/#migration-utilities","title":"Migration &amp; Utilities","text":"File Path Description <code>scripts/migrate-data.js</code> Legacy data migration script"},{"location":"overview/ingestion-pipeline-artifacts-summary/#verification-scripts-cross-platform","title":"Verification Scripts (Cross-Platform)","text":"File Path Description <code>scripts/verify-phase-e.sh</code> Bash verification script for Unix-like systems <code>scripts/verify-phase-e.ps1</code> PowerShell verification script for Windows systems <code>scripts/verify-phase-e-junit.sh</code> Bash JUnit wrapper for CI dashboards <code>scripts/verify-phase-e-junit.ps1</code> PowerShell JUnit wrapper for CI dashboards"},{"location":"overview/ingestion-pipeline-artifacts-summary/#cicd-configuration","title":"CI/CD Configuration","text":"File Path Description <code>.github/workflows/phase-e-verification.yml</code> GitHub Actions workflow for automated testing <code>data/fixtures/test-rulebook.txt</code> Redacted test fixture for CI verification"},{"location":"overview/ingestion-pipeline-artifacts-summary/#documentation","title":"Documentation","text":"File Path Description <code>README.md</code> Updated with Phase E instructions <code>.github/PRs/feature-phase-e-director-execution.md</code> Initial PR draft <code>.github/PRs/feature-phase-e-complete-integration.md</code> Complete integration PR draft <code>docs/PHASE_E_ARTIFACTS_SUMMARY.md</code> Phase E artifacts summary <code>docs/INGESTION_PIPELINE_ARTIFACTS_SUMMARY.md</code> This document"},{"location":"overview/ingestion-pipeline-artifacts-summary/#integrated-pipeline-components","title":"Integrated Pipeline Components","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#pdf-text-extraction-srcingestpdfjs","title":"PDF Text Extraction (<code>src/ingest/pdf.js</code>)","text":"<ul> <li>Extracts text from PDFs using <code>pdf-parse</code> when possible</li> <li>Falls back to OCR using system Tesseract or <code>tesseract.js</code> if installed</li> <li>Provides high-level function: <code>ingestPdf(pdfPath, options)</code></li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#bgg-metadata-fetching-srcingestbggjs","title":"BGG Metadata Fetching (<code>src/ingest/bgg.js</code>)","text":"<ul> <li>Fetches metadata for a BGG game by ID or URL</li> <li>Parses the XML response into a structured JSON object</li> <li>Handles errors gracefully and returns partial data when possible</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#storyboard-generation-srcingeststoryboardjs","title":"Storyboard Generation (<code>src/ingest/storyboard.js</code>)","text":"<ul> <li>Converts parsed pages + BGG metadata \u2192 minimal storyboard JSON model</li> <li>Provides simple heuristics for detecting TOC, headings, and numbered steps</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#key-features-implemented","title":"Key Features Implemented","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#1-canonical-data-directory-layout","title":"1. Canonical Data Directory Layout","text":"<ul> <li>Standardized on <code>./data</code> as single canonical data directory</li> <li>All storage paths consolidated under DATA_DIR</li> <li>Migration script for legacy locations</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#2-structured-logging","title":"2. Structured Logging","text":"<ul> <li>JSON-formatted logs with timestamps and log levels</li> <li>Per-request correlation with unique request IDs</li> <li>Automatic request timing and completion logging</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#3-metrics-system","title":"3. Metrics System","text":"<ul> <li>Lightweight counter-based metrics collection</li> <li>Built-in counters for requests, errors, ingest operations</li> <li>Easy-to-extend metrics framework</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#4-health-monitoring-endpoints","title":"4. Health &amp; Monitoring Endpoints","text":"<ul> <li><code>/health</code> endpoint returning system status and metadata</li> <li><code>/metrics</code> endpoint exposing all collected counters</li> <li>Proper JSON responses for monitoring tools</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#5-file-handling","title":"5. File Handling","text":"<ul> <li>Multer uploads targeting canonical data directory</li> <li>Safe filename generation with timestamps</li> <li>Static file serving from uploads directory</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#6-complete-ingestion-pipeline","title":"6. Complete Ingestion Pipeline","text":"<ul> <li>PDF text extraction with OCR fallback</li> <li>BGG metadata fetching with error handling</li> <li>Storyboard generation with heuristic detection</li> <li>Integrated API endpoint with proper error handling</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#run-commands","title":"Run Commands","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#start-server","title":"Start Server","text":"<pre><code>DATA_DIR=./data PORT=5001 npm run server\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:5001/health\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#view-metrics","title":"View Metrics","text":"<pre><code>curl http://localhost:5001/metrics\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#ingest-a-pdf","title":"Ingest a PDF","text":"<pre><code>curl -F \"file=@/path/to/rulebook.pdf\" http://localhost:5001/api/ingest\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#ingest-with-bgg-metadata","title":"Ingest with BGG Metadata","text":"<pre><code>curl -F \"file=@/path/to/rulebook.pdf\" -F \"bggId=12345\" http://localhost:5001/api/ingest\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#migrate-legacy-data","title":"Migrate Legacy Data","text":"<pre><code>DATA_DIR=./data npm run migrate:data\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#run-verifications","title":"Run Verifications","text":"<pre><code># Unix/Linux\nnpm run verify:unix\n\n# Windows\nnpm run verify:win\n\n# JUnit output (for CI)\nnpm run verify:junit:unix\nnpm run verify:junit:win\n</code></pre>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#api-endpoints","title":"API Endpoints","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#post-apiingest","title":"POST /api/ingest","text":"<p>Accepts a PDF file and optional BGG ID, processes the document through the full pipeline: 1. PDF text extraction with <code>ingestPdf()</code> 2. Storyboard generation with <code>generateStoryboard()</code> 3. BGG metadata fetching with <code>fetchBggMetadata()</code> (if bggId provided) 4. Results returned as JSON</p>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#get-health","title":"GET /health","text":"<p>Returns system health status with metadata.</p>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#get-metrics","title":"GET /metrics","text":"<p>Returns current metrics counters.</p>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#verification-procedures","title":"Verification Procedures","text":""},{"location":"overview/ingestion-pipeline-artifacts-summary/#automated-verification","title":"Automated Verification","text":"<ol> <li>Execute <code>npm run verify:unix</code> (Unix-like) or <code>npm run verify:win</code> (Windows)</li> <li>Script will automatically:</li> <li>Check prerequisites</li> <li>Run migration</li> <li>Start server</li> <li>Test health endpoint</li> <li>Test metrics endpoint</li> <li>Test file upload</li> <li>Verify file storage location</li> <li>Clean up and stop server</li> </ol>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#ci-verification","title":"CI Verification","text":"<ol> <li>GitHub Actions workflow runs on every PR:</li> <li>Ubuntu: <code>npm run verify:unix</code> and <code>npm run verify:junit:unix</code></li> <li>Windows: <code>npm run verify:win</code> and <code>npm run verify:junit:win</code></li> <li>JUnit XML reports uploaded as artifacts</li> <li>PR blocked if either job fails</li> </ol>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#acceptance-criteria-status","title":"Acceptance Criteria Status","text":"Criteria Status Notes Health endpoint returns 200 with status \"ok\" \u2705 Returns system metadata Metrics endpoint returns counters \u2705 Shows request counts File uploads land in DATA_DIR/uploads \u2705 Verified by migration script Logs are JSON with request ID and timing \u2705 Structured logging implemented DATA_DIR env var changes all storage paths \u2705 Path resolution uses DATA_DIR PDF parsing pipeline integrated \u2705 pdf.js \u2192 text extraction BGG metadata fetching integrated \u2705 bgg.js \u2192 metadata retrieval Storyboard generation integrated \u2705 storyboard.js \u2192 chapter/step JSON Cross-platform verification scripts \u2705 .sh and .ps1 versions CI workflow with JUnit output \u2705 GitHub Actions with test reports"},{"location":"overview/ingestion-pipeline-artifacts-summary/#breaking-changes-handled","title":"Breaking Changes Handled","text":"Change Solution Legacy file locations Migration script consolidates to DATA_DIR Backward compatibility Maintained through migration process"},{"location":"overview/ingestion-pipeline-artifacts-summary/#cross-platform-compatibility","title":"Cross-Platform Compatibility","text":"<p>This implementation follows the user's cross-platform requirements: - \u2705 Paired verification scripts (.sh and .ps1) - \u2705 Cross-platform script pairing for critical automation - \u2705 Standardized verification output with clear status indicators - \u2705 JUnit wrappers for CI dashboard integration - \u2705 GitHub Actions matrix testing on Linux and Windows</p>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#copyright-compliance","title":"Copyright Compliance","text":"<ul> <li>Uploaded rulebook PDFs kept private in <code>./data/fixtures</code></li> <li>Not committed to repository per copyright requirements</li> <li>Only redacted samples used in CI/CD pipelines</li> <li>Redacted test fixture provided for verification</li> </ul>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Add sampling logs for LLM calls (when introduced)</li> <li>Implement dry-run mode flag for tests</li> <li>Extend storyboard generation with more sophisticated heuristics</li> <li>Add more comprehensive error handling and recovery</li> <li>Implement rate limiting for external API calls (BGG)</li> </ol>"},{"location":"overview/ingestion-pipeline-artifacts-summary/#testing","title":"Testing","text":"<p>All functionality has been tested locally and verified through: - Manual API testing with curl - Automated verification scripts - GitHub Actions CI workflow - Cross-platform compatibility testing</p>"},{"location":"overview/merge-complete-summary/","title":"Merge Complete Summary","text":"<p>The merge of main into the feat/preview-worker-k8s-final branch has been completed successfully.</p>"},{"location":"overview/merge-complete-summary/#what-was-accomplished","title":"What Was Accomplished","text":"<ol> <li>Branch Update: Merged the latest changes from origin/main into feat/preview-worker-k8s-final</li> <li>CI Configuration: Updated CI workflow configurations to match the latest from main</li> <li>Dependency Sync: Synchronized package dependencies with the main branch</li> <li>Test Updates: Updated test scripts and configurations</li> </ol>"},{"location":"overview/merge-complete-summary/#next-steps","title":"Next Steps","text":""},{"location":"overview/merge-complete-summary/#1-verify-ci-checks","title":"1. Verify CI Checks","text":"<ul> <li>Check GitHub Actions to see if the CI checks are now passing</li> <li>If any checks are still failing, examine the logs for specific errors</li> </ul>"},{"location":"overview/merge-complete-summary/#2-update-image-tag","title":"2. Update Image Tag","text":"<p>Once CI is passing, update the Kubernetes manifests with your production image tag:</p> <pre><code># For Unix/Linux/macOS:\n./update-preview-worker-image-with-tag.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n\n# For Windows:\n.\\update-preview-worker-image-with-tag.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"overview/merge-complete-summary/#3-final-validation","title":"3. Final Validation","text":"<ul> <li>Run <code>kubectl apply --dry-run=client -f k8s/preview-worker/</code> to validate manifests</li> <li>Ensure all documentation is up to date</li> <li>Verify all scripts are working correctly</li> </ul>"},{"location":"overview/merge-complete-summary/#4-push-changes","title":"4. Push Changes","text":"<p>After updating the image tag: <pre><code>git add .\ngit commit -m \"chore(k8s): update preview worker image tag\"\ngit push origin feat/preview-worker-k8s-final\n</code></pre></p>"},{"location":"overview/merge-complete-summary/#files-updated-during-merge","title":"Files Updated During Merge","text":"<p>The merge brought in updates to: - CI workflow configurations - Test scripts and configurations - Package dependencies - Documentation files</p>"},{"location":"overview/merge-complete-summary/#troubleshooting","title":"Troubleshooting","text":"<p>If you encounter any issues:</p> <ol> <li>CI Failures: Check <code>CI_TROUBLESHOOTING_GUIDE.md</code> for common solutions</li> <li>Script Issues: Ensure you're using the correct script for your platform</li> <li>Connectivity Problems: Verify your git remote configuration with <code>git remote -v</code></li> </ol>"},{"location":"overview/merge-complete-summary/#ready-for-review","title":"Ready for Review","text":"<p>Once the image tag is updated and all CI checks are passing, the PR will be ready for final review and merge.</p> <p>The Preview Worker implementation is feature-complete with all necessary components: - Kubernetes manifests - Cross-platform deployment scripts - Comprehensive documentation - Validation and testing frameworks</p>"},{"location":"overview/next-steps-summary/","title":"Next Steps Summary","text":"<p>This document outlines the recommended next steps to get the Preview Worker PR merge-ready.</p>"},{"location":"overview/next-steps-summary/#immediate-actions-required","title":"Immediate Actions Required","text":""},{"location":"overview/next-steps-summary/#1-merge-main-into-feature-branch","title":"1. Merge Main into Feature Branch","text":"<p>Why: The PR shows \"branch is out-of-date\" which can cause false negatives in CI.</p> <p>How: <pre><code># Option A: Use provided scripts\n./merge-main-into-branch.sh  # Unix/Linux/macOS\n.\\merge-main-into-branch.ps1 # Windows PowerShell\n\n# Option B: Manual commands\ngit fetch origin\ngit merge origin/main\nnpm ci\nnpm run test:preview-payloads\nnpm test\ngit add .\ngit commit -m \"chore(ci): merge main into feat/preview-worker-k8s-final\"\ngit push origin feat/preview-worker-k8s-final\n</code></pre></p>"},{"location":"overview/next-steps-summary/#2-update-image-tag-in-kubernetes-manifests","title":"2. Update Image Tag in Kubernetes Manifests","text":"<p>Why: Replace placeholder image with actual built image.</p> <p>How: <pre><code># Option A: Use provided scripts (after you provide the image tag)\n./update-preview-worker-image-with-tag.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0  # Unix/Linux/macOS\n.\\update-preview-worker-image-with-tag.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\" # Windows PowerShell\n\n# Option B: Manual update\n# Edit k8s/preview-worker/deployment.yaml\n# Replace: ghcr.io/your-org/mobius-preview-worker:latest\n# With: YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre></p>"},{"location":"overview/next-steps-summary/#ci-troubleshooting","title":"CI Troubleshooting","text":""},{"location":"overview/next-steps-summary/#if-ci-checks-are-still-failing","title":"If CI Checks Are Still Failing","text":"<ol> <li>Check the logs: Look at the first error message in each failing job</li> <li>Reproduce locally: Run the same tests on your machine</li> <li>Common fixes:</li> <li>ESM/Jest issues: Use <code>NODE_OPTIONS=--experimental-vm-modules npm test</code></li> <li>Node version issues: Test with both Node 18 and 20</li> <li>Missing dependencies: Run <code>npm ci</code> to ensure clean install</li> </ol>"},{"location":"overview/next-steps-summary/#reference-materials","title":"Reference Materials","text":"<ul> <li><code>CI_TROUBLESHOOTING_GUIDE.md</code> - Detailed troubleshooting steps</li> <li><code>.github/workflows/ci-preview-worker.yml</code> - Preview worker CI workflow</li> <li><code>.github/workflows/ci.yml</code> - Main CI workflow</li> </ul>"},{"location":"overview/next-steps-summary/#files-created","title":"Files Created","text":""},{"location":"overview/next-steps-summary/#image-update-scripts","title":"Image Update Scripts","text":"<ul> <li><code>update-preview-worker-image-with-tag.sh</code> - Unix/Linux/macOS</li> <li><code>update-preview-worker-image-with-tag.ps1</code> - Windows PowerShell</li> </ul>"},{"location":"overview/next-steps-summary/#branch-management-scripts","title":"Branch Management Scripts","text":"<ul> <li><code>merge-main-into-branch.sh</code> - Unix/Linux/macOS</li> <li><code>merge-main-into-branch.ps1</code> - Windows PowerShell</li> </ul>"},{"location":"overview/next-steps-summary/#documentation","title":"Documentation","text":"<ul> <li><code>CI_TROUBLESHOOTING_GUIDE.md</code> - Comprehensive CI troubleshooting guide</li> <li><code>NEXT_STEPS_SUMMARY.md</code> - This document</li> </ul>"},{"location":"overview/next-steps-summary/#what-you-need-to-provide","title":"What You Need to Provide","text":"<p>To proceed with the next steps, please provide:</p> <ol> <li> <p>Image Tag: The final image tag you want to use in k8s manifests    Example: <code>my-registry/mobius-preview-worker:1.0.0</code></p> </li> <li> <p>Failing CI Logs: If CI checks are still failing, please share:</p> </li> <li>The first 20-30 lines of the error message</li> <li>The job name that's failing</li> <li>Any specific error codes or stack traces</li> </ol>"},{"location":"overview/next-steps-summary/#suggested-workflow","title":"Suggested Workflow","text":"<ol> <li>Merge main into your branch</li> <li>Push the updated branch</li> <li>Re-run failing workflows in GitHub UI</li> <li>If CI is still failing, share the error logs</li> <li>Once CI is green, update the image tag</li> <li>Push final changes</li> <li>Request final review and merge</li> </ol>"},{"location":"overview/next-steps-summary/#final-verification","title":"Final Verification","text":"<p>Before merging, ensure:</p> <ul> <li>[ ] All CI checks are passing</li> <li>[ ] Kubernetes manifests validate with <code>kubectl apply --dry-run=client</code></li> <li>[ ] Image tag is updated to your production registry</li> <li>[ ] Documentation is complete and accurate</li> <li>[ ] All required reviewers have approved</li> </ul> <p>The Preview Worker implementation is feature-complete and well-documented. With these steps, the PR should be ready for final review and merge.</p>"},{"location":"overview/phase-e-artifacts-summary/","title":"Phase E Artifacts Summary","text":""},{"location":"overview/phase-e-artifacts-summary/#overview","title":"Overview","text":"<p>This document catalogs all artifacts created during Phase E implementation: Ingestion POC Hardening, Canonical Data Dir, Observability (Health + Metrics + Structured Logs).</p>"},{"location":"overview/phase-e-artifacts-summary/#new-files-created","title":"New Files Created","text":""},{"location":"overview/phase-e-artifacts-summary/#core-implementation-files","title":"Core Implementation Files","text":"File Path Description <code>src/config/paths.js</code> Canonical data directory management utilities <code>src/logging/logger.js</code> Structured logging with request ID correlation <code>src/metrics/metrics.js</code> In-memory metrics collection system <code>src/api/health.js</code> Health and metrics endpoints <code>src/api/index.js</code> Main API implementation with new middleware <code>scripts/migrate-data.js</code> Legacy data migration script"},{"location":"overview/phase-e-artifacts-summary/#verification-scripts","title":"Verification Scripts","text":"File Path Description <code>scripts/verify-phase-e.sh</code> Bash verification script for Unix-like systems <code>scripts/verify-phase-e.ps1</code> PowerShell verification script for Windows systems"},{"location":"overview/phase-e-artifacts-summary/#documentation","title":"Documentation","text":"File Path Description <code>README.md</code> Updated with Phase E instructions <code>.github/PRs/feature-phase-e-director-execution.md</code> Comprehensive PR draft <code>docs/PHASE_E_ARTIFACTS_SUMMARY.md</code> This document"},{"location":"overview/phase-e-artifacts-summary/#key-features-implemented","title":"Key Features Implemented","text":""},{"location":"overview/phase-e-artifacts-summary/#1-canonical-data-directory-layout","title":"1. Canonical Data Directory Layout","text":"<ul> <li>Standardized on <code>./data</code> as single canonical data directory</li> <li>All storage paths consolidated under DATA_DIR</li> <li>Migration script for legacy locations</li> </ul>"},{"location":"overview/phase-e-artifacts-summary/#2-structured-logging","title":"2. Structured Logging","text":"<ul> <li>JSON-formatted logs with timestamps and log levels</li> <li>Per-request correlation with unique request IDs</li> <li>Automatic request timing and completion logging</li> </ul>"},{"location":"overview/phase-e-artifacts-summary/#3-metrics-system","title":"3. Metrics System","text":"<ul> <li>Lightweight counter-based metrics collection</li> <li>Built-in counters for requests, errors, ingest operations</li> <li>Easy-to-extend metrics framework</li> </ul>"},{"location":"overview/phase-e-artifacts-summary/#4-health-monitoring-endpoints","title":"4. Health &amp; Monitoring Endpoints","text":"<ul> <li><code>/health</code> endpoint returning system status and metadata</li> <li><code>/metrics</code> endpoint exposing all collected counters</li> <li>Proper JSON responses for monitoring tools</li> </ul>"},{"location":"overview/phase-e-artifacts-summary/#5-file-handling","title":"5. File Handling","text":"<ul> <li>Multer uploads targeting canonical data directory</li> <li>Safe filename generation with timestamps</li> <li>Static file serving from uploads directory</li> </ul>"},{"location":"overview/phase-e-artifacts-summary/#run-commands","title":"Run Commands","text":""},{"location":"overview/phase-e-artifacts-summary/#start-server","title":"Start Server","text":"<pre><code>DATA_DIR=./data PORT=5001 npm run server\n</code></pre>"},{"location":"overview/phase-e-artifacts-summary/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:5001/health\n</code></pre>"},{"location":"overview/phase-e-artifacts-summary/#view-metrics","title":"View Metrics","text":"<pre><code>curl http://localhost:5001/metrics\n</code></pre>"},{"location":"overview/phase-e-artifacts-summary/#test-file-upload","title":"Test File Upload","text":"<pre><code>curl -F \"file=@/path/to/rulebook.pdf\" http://localhost:5001/api/ingest\n</code></pre>"},{"location":"overview/phase-e-artifacts-summary/#migrate-legacy-data","title":"Migrate Legacy Data","text":"<pre><code>DATA_DIR=./data npm run migrate:data\n</code></pre>"},{"location":"overview/phase-e-artifacts-summary/#verification-procedures","title":"Verification Procedures","text":""},{"location":"overview/phase-e-artifacts-summary/#automated-verification","title":"Automated Verification","text":"<ol> <li>Execute <code>scripts/verify-phase-e.sh</code> (Unix-like) or <code>scripts/verify-phase-e.ps1</code> (Windows)</li> <li>Script will automatically:</li> <li>Check prerequisites</li> <li>Run migration</li> <li>Start server</li> <li>Test health endpoint</li> <li>Test metrics endpoint</li> <li>Test file upload</li> <li>Verify file storage location</li> <li>Clean up and stop server</li> </ol>"},{"location":"overview/phase-e-artifacts-summary/#manual-verification","title":"Manual Verification","text":"<ol> <li>Start server with <code>DATA_DIR=./data PORT=5001 npm run server</code></li> <li>Access <code>http://localhost:5001/health</code> - should return status \"ok\"</li> <li>Access <code>http://localhost:5001/metrics</code> - should return counters</li> <li>Upload a test file using curl</li> <li>Verify file is stored in <code>./data/uploads/</code></li> <li>Check logs for JSON format with request IDs</li> </ol>"},{"location":"overview/phase-e-artifacts-summary/#acceptance-criteria-status","title":"Acceptance Criteria Status","text":"Criteria Status Notes Health endpoint returns 200 with status \"ok\" \u2705 Returns system metadata Metrics endpoint returns counters \u2705 Shows request counts File uploads land in DATA_DIR/uploads \u2705 Verified by migration script Logs are JSON with request ID and timing \u2705 Structured logging implemented DATA_DIR env var changes all storage paths \u2705 Path resolution uses DATA_DIR"},{"location":"overview/phase-e-artifacts-summary/#breaking-changes-handled","title":"Breaking Changes Handled","text":"Change Solution Legacy file locations Migration script consolidates to DATA_DIR Backward compatibility Maintained through migration process"},{"location":"overview/phase-e-artifacts-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Wire existing PDF parser + BGG + storyboard modules into <code>/api/ingest</code></li> <li>Add JUnit-style test output for ingest smoke test using redacted fixtures</li> <li>Add request sampling around LLM calls once hooked in</li> <li>Keep uploaded PDFs private under DATA_DIR; only redacted samples in CI</li> </ol>"},{"location":"overview/phase-e-artifacts-summary/#cross-platform-compatibility","title":"Cross-Platform Compatibility","text":"<p>This implementation follows the user's cross-platform requirements: - \u2705 Paired verification scripts (.sh and .ps1) - \u2705 Cross-platform script pairing for critical automation - \u2705 Standardized verification output with clear status indicators</p>"},{"location":"overview/phase-e-artifacts-summary/#copyright-compliance","title":"Copyright Compliance","text":"<ul> <li>Uploaded rulebook PDFs kept private in <code>./data/fixtures</code></li> <li>Not committed to repository per copyright requirements</li> <li>Only redacted samples used in CI/CD pipelines</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/","title":"Phase E Enhancements Summary","text":""},{"location":"overview/phase-e-enhancements-summary/#overview","title":"Overview","text":"<p>This document summarizes the infrastructure hardening and performance enhancements implemented for Phase E of the Mobius Games Tutorial Generator.</p>"},{"location":"overview/phase-e-enhancements-summary/#1-inf-101-queue-and-back-pressure-management","title":"1. INF-101 \u2014 Queue and Back-Pressure Management","text":""},{"location":"overview/phase-e-enhancements-summary/#implementation","title":"Implementation","text":"<ul> <li>Created <code>src/utils/ingestQueue.js</code> with configurable concurrency and queue limits</li> <li>Integrated queue management into <code>/api/ingest</code> endpoint</li> <li>Added metrics collection for queue saturation events</li> <li>Implemented proper HTTP 503 responses with <code>Retry-After</code> headers</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#configuration","title":"Configuration","text":"<ul> <li><code>INGEST_MAX_CONCURRENCY</code> - Maximum concurrent ingestion tasks (default: 3)</li> <li><code>INGEST_QUEUE_MAX</code> - Maximum queue size (default: 20)</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#features","title":"Features","text":"<ul> <li>Limits concurrent processing to prevent resource exhaustion</li> <li>Rejects new requests when queue is full with clear error messages</li> <li>Provides clients with retry guidance via <code>Retry-After</code> header</li> <li>Tracks saturation events via <code>ingest_rejected_saturated_total</code> metric</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#2-sec-112-security-enhancements","title":"2. SEC-112 \u2014 Security Enhancements","text":""},{"location":"overview/phase-e-enhancements-summary/#implementation_1","title":"Implementation","text":"<ul> <li>Enhanced Multer configuration with file size limits</li> <li>Added strict file type validation (PDF only in production)</li> <li>Implemented PDF header validation</li> <li>Added suspicious content scanning for JavaScript/OpenAction</li> <li>Added encrypted PDF detection and rejection</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#configuration_1","title":"Configuration","text":"<ul> <li><code>UPLOAD_MAX_MB</code> - Maximum upload file size in MB (default: 25)</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#features_1","title":"Features","text":"<ul> <li>File size enforcement via Multer limits</li> <li>MIME type and extension validation</li> <li>PDF header verification</li> <li>Suspicious content detection</li> <li>Encrypted PDF rejection</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#3-pdf-123-parser-robustness","title":"3. PDF-123 \u2014 Parser Robustness","text":""},{"location":"overview/phase-e-enhancements-summary/#implementation_2","title":"Implementation","text":"<ul> <li>Enhanced <code>src/ingest/pdf.js</code> with retry logic and backoff</li> <li>Added heuristic analysis for low-text pages and component detection</li> <li>Improved error handling with fallback mechanisms</li> <li>Added dry-run mode for CI testing</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#features_2","title":"Features","text":"<ul> <li>Retry mechanism with exponential backoff</li> <li>Heuristic analysis for content quality</li> <li>Dry-run mode for performance testing</li> <li>Better error handling and recovery</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#4-bgg-131-cache-and-rate-limiting","title":"4. BGG-131 \u2014 Cache and Rate Limiting","text":""},{"location":"overview/phase-e-enhancements-summary/#implementation_3","title":"Implementation","text":"<ul> <li>Created <code>src/services/cache.js</code> for BGG metadata caching</li> <li>Enhanced <code>src/ingest/bgg.js</code> with caching and rate limiting</li> <li>Added cache freshness checking</li> <li>Implemented rate limiting with configurable QPS</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#configuration_2","title":"Configuration","text":"<ul> <li><code>BGG_CACHE_TTL_MS</code> - Cache time-to-live in milliseconds (default: 86400000)</li> <li><code>BGG_RATE_LIMIT_QPS</code> - Rate limit in queries per second (default: 2)</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#features_3","title":"Features","text":"<ul> <li>Persistent caching of BGG metadata</li> <li>Automatic cache expiration</li> <li>Rate limiting to prevent API abuse</li> <li>Fallback mechanisms for API failures</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#5-api-160-versioning","title":"5. API-160 \u2014 Versioning","text":""},{"location":"overview/phase-e-enhancements-summary/#implementation_4","title":"Implementation","text":"<ul> <li>Added <code>x-api-version</code> header to all responses</li> <li>Documented v1 response schema in README</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#configuration_3","title":"Configuration","text":"<ul> <li><code>API_VERSION</code> - API version header (default: v1)</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#6-ret-150-retention-janitor","title":"6. RET-150 \u2014 Retention Janitor","text":""},{"location":"overview/phase-e-enhancements-summary/#implementation_5","title":"Implementation","text":"<ul> <li>Created <code>src/jobs/janitor.js</code> for automated file cleanup</li> <li>Added scheduled execution in <code>src/api/index.js</code></li> <li>Configurable retention periods for uploads and output</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#configuration_4","title":"Configuration","text":"<ul> <li><code>KEEP_UPLOADS_DAYS</code> - Days to retain uploaded files (default: 30)</li> <li><code>KEEP_OUTPUT_DAYS</code> - Days to retain output files (default: 90)</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#features_4","title":"Features","text":"<ul> <li>Automated daily cleanup of expired files</li> <li>Configurable retention periods</li> <li>Safe file deletion with error handling</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#7-observability-and-monitoring","title":"7. Observability and Monitoring","text":""},{"location":"overview/phase-e-enhancements-summary/#metrics","title":"Metrics","text":"<ul> <li><code>ingest_rejected_saturated_total</code> - Count of rejected ingestion requests due to queue saturation</li> <li><code>requests_total</code> - Total HTTP requests</li> <li><code>ingest_total</code> - Successful ingestions</li> <li><code>ingest_errors_total</code> - Failed ingestions</li> <li><code>errors_total</code> - Total application errors</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#logging","title":"Logging","text":"<ul> <li>Structured JSON logging with request correlation</li> <li>Detailed error logging with stack traces</li> <li>Warning logs for BGG fetch failures</li> <li>Info logs for successful operations</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#8-documentation","title":"8. Documentation","text":""},{"location":"overview/phase-e-enhancements-summary/#created","title":"Created","text":"<ul> <li><code>docs/operational-runbook.md</code> - Comprehensive operational guide</li> <li>Updated <code>README.md</code> with new features and configuration options</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#content","title":"Content","text":"<ul> <li>Configuration parameters documentation</li> <li>Monitoring and alerting guidance</li> <li>Saturation handling procedures</li> <li>Retention policies</li> <li>Security features</li> <li>Performance features</li> <li>Response schema documentation</li> <li>Troubleshooting guide</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#9-testing","title":"9. Testing","text":""},{"location":"overview/phase-e-enhancements-summary/#unit-tests","title":"Unit Tests","text":"<ul> <li>Queue management tests</li> <li>Cache service tests</li> <li>Janitor job tests</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#integration-points","title":"Integration Points","text":"<ul> <li>API endpoint testing with queue saturation</li> <li>File upload validation</li> <li>Security scanning verification</li> <li>Cache behavior validation</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#10-performance-optimizations","title":"10. Performance Optimizations","text":""},{"location":"overview/phase-e-enhancements-summary/#concurrency-control","title":"Concurrency Control","text":"<ul> <li>Configurable maximum concurrent tasks</li> <li>Queue-based back-pressure management</li> <li>Resource protection from overload</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#caching","title":"Caching","text":"<ul> <li>BGG metadata caching with TTL</li> <li>Reduced external API calls</li> <li>Improved response times for cached data</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#rate-limiting","title":"Rate Limiting","text":"<ul> <li>Configurable QPS limits</li> <li>Proper delay between API calls</li> <li>Protection of external services</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#11-configuration-summary","title":"11. Configuration Summary","text":"Variable Default Description API_VERSION v1 API version header DATA_DIR ./data Canonical data directory PORT 5001 Server port INGEST_MAX_CONCURRENCY 3 Maximum concurrent ingestion tasks INGEST_QUEUE_MAX 20 Maximum queue size for ingestion UPLOAD_MAX_MB 25 Maximum upload file size in MB NODE_ENV production Environment (production/development) BGG_CACHE_TTL_MS 86400000 (24h) BGG cache time-to-live in milliseconds BGG_RATE_LIMIT_QPS 2 BGG API rate limit in queries per second KEEP_UPLOADS_DAYS 30 Days to retain uploaded files KEEP_OUTPUT_DAYS 90 Days to retain output files"},{"location":"overview/phase-e-enhancements-summary/#12-api-response-schema-v1","title":"12. API Response Schema (v1)","text":""},{"location":"overview/phase-e-enhancements-summary/#success-response","title":"Success Response","text":"<pre><code>{\n  \"ok\": true,\n  \"id\": \"string\",\n  \"file\": \"string\",\n  \"summary\": {\n    \"pages\": \"number\",\n    \"chunks\": \"number\",\n    \"tocDetected\": \"boolean\",\n    \"flags\": {\n      \"pagesWithLowTextRatio\": \"array\",\n      \"componentsDetected\": \"boolean\",\n      \"dryRun\": \"boolean\"\n    }\n  },\n  \"bgg\": {\n    \"title\": \"string\",\n    \"year\": \"number\",\n    \"designers\": \"array\",\n    \"players\": \"string\",\n    \"time\": \"string\",\n    \"age\": \"string\"\n  },\n  \"storyboardPath\": \"string\"\n}\n</code></pre>"},{"location":"overview/phase-e-enhancements-summary/#error-response","title":"Error Response","text":"<pre><code>{\n  \"error\": \"string\"\n}\n</code></pre>"},{"location":"overview/phase-e-enhancements-summary/#13-security-features","title":"13. Security Features","text":"<ul> <li>File type validation (PDF only in production)</li> <li>File size limits (configurable via UPLOAD_MAX_MB)</li> <li>PDF header validation</li> <li>Suspicious content scanning</li> <li>Encrypted PDF rejection</li> <li>Rate limiting for external APIs</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#14-performance-features","title":"14. Performance Features","text":"<ul> <li>Concurrent ingestion processing (configurable via INGEST_MAX_CONCURRENCY)</li> <li>Ingestion queue with back-pressure handling (configurable via INGEST_QUEUE_MAX)</li> <li>BGG metadata caching (configurable via BGG_CACHE_TTL_MS)</li> <li>BGG API rate limiting (configurable via BGG_RATE_LIMIT_QPS)</li> <li>Dry-run mode for CI testing</li> </ul>"},{"location":"overview/phase-e-enhancements-summary/#15-operational-features","title":"15. Operational Features","text":"<ul> <li>Automated file retention with configurable periods</li> <li>Structured logging with request correlation</li> <li>Comprehensive metrics collection</li> <li>Health and metrics endpoints</li> <li>Queue saturation handling with client guidance</li> </ul>"},{"location":"overview/phase-e-summary/","title":"Phase E Implementation Summary","text":""},{"location":"overview/phase-e-summary/#overview","title":"Overview","text":"<p>This document summarizes the implementation of Phase E: Ingestion POC and Infrastructure Hardening for the Mobius Games Tutorial Generator.</p>"},{"location":"overview/phase-e-summary/#key-features-implemented","title":"Key Features Implemented","text":""},{"location":"overview/phase-e-summary/#1-finalized-apiingest-endpoint","title":"1. Finalized /api/ingest Endpoint","text":"<ul> <li>Complete implementation of the ingestion endpoint with all specified functionality</li> <li>File filtering for production (PDF only) and development (PDF + text fixtures)</li> <li>Dry-run support for CI performance optimization</li> <li>Proper error handling with distinct HTTP status codes (400, 422, 500)</li> <li>Structured logging with request correlation</li> <li>Metrics collection for observability</li> </ul>"},{"location":"overview/phase-e-summary/#2-ingestion-pipeline-modules","title":"2. Ingestion Pipeline Modules","text":"<ul> <li>PDF Module: Text extraction and chunking with TOC detection</li> <li>BGG Module: Metadata fetching with normalization</li> <li>Storyboard Module: Chapter and step generation from chunks</li> </ul>"},{"location":"overview/phase-e-summary/#3-data-directory-structure","title":"3. Data Directory Structure","text":"<ul> <li>Canonical <code>./data</code> directory layout</li> <li>Subdirectories: uploads, output, pdf_images, fixtures</li> <li>Proper file storage and artifact persistence</li> </ul>"},{"location":"overview/phase-e-summary/#4-unit-tests","title":"4. Unit Tests","text":"<ul> <li>PDF Unit Tests: Chunk extraction and empty PDF handling</li> <li>BGG Unit Tests: Data normalization and API fallback paths</li> <li>Storyboard Unit Tests: Chapter/steps generation with proper limits</li> </ul>"},{"location":"overview/phase-e-summary/#5-integration-tests","title":"5. Integration Tests","text":"<ul> <li>API endpoint testing with various scenarios</li> <li>File upload validation</li> <li>BGG failure handling</li> <li>Dry-run functionality verification</li> </ul>"},{"location":"overview/phase-e-summary/#6-cicd-integration","title":"6. CI/CD Integration","text":"<ul> <li>JUnit wrapper scripts for test reporting</li> <li>Cross-platform verification scripts (Unix/Windows)</li> <li>Artifact publishing support</li> <li>Health and metrics endpoint validation</li> </ul>"},{"location":"overview/phase-e-summary/#api-endpoints","title":"API Endpoints","text":""},{"location":"overview/phase-e-summary/#post-apiingest","title":"POST /api/ingest","text":"<p>Ingests a game rulebook PDF and generates tutorial content.</p> <p>Parameters: - <code>file</code> (required): PDF file upload - <code>bggId</code> (optional): BoardGameGeek ID - <code>bggUrl</code> (optional): BoardGameGeek URL - <code>title</code> (optional): Game title - <code>dryRun</code> (optional): Skip heavy processing steps</p> <p>Response: <pre><code>{\n  \"ok\": true,\n  \"id\": \"string\",\n  \"file\": \"string\",\n  \"summary\": {\n    \"pages\": \"number\",\n    \"chunks\": \"number\",\n    \"tocDetected\": \"boolean\"\n  },\n  \"bgg\": {\n    \"title\": \"string\",\n    \"year\": \"number\",\n    \"designers\": \"array\",\n    \"players\": \"string\",\n    \"time\": \"string\",\n    \"age\": \"string\"\n  },\n  \"storyboardPath\": \"string\"\n}\n</code></pre></p>"},{"location":"overview/phase-e-summary/#security-and-compliance","title":"Security and Compliance","text":"<ul> <li>File filtering prevents unauthorized file types in production</li> <li>Private storage of uploaded PDFs (not committed to repository)</li> <li>Structured logging without exposing sensitive content</li> <li>Proper error handling without information leakage</li> </ul>"},{"location":"overview/phase-e-summary/#performance-optimizations","title":"Performance Optimizations","text":"<ul> <li>Dry-run mode for CI testing</li> <li>Efficient chunking algorithms</li> <li>Caching mechanisms for BGG metadata</li> <li>Lightweight metrics collection</li> </ul>"},{"location":"overview/phase-e-summary/#testing","title":"Testing","text":"<ul> <li>Unit tests for all ingestion modules</li> <li>Integration tests for API endpoints</li> <li>Cross-platform verification scripts</li> <li>JUnit reporting for CI/CD integration</li> </ul>"},{"location":"overview/phase-e-summary/#scripts","title":"Scripts","text":"<ul> <li><code>test-ingest-api.sh</code>: Unix/Linux/macOS API testing</li> <li><code>test-ingest-api.ps1</code>: Windows API testing</li> <li><code>verify-phase-e-junit.sh</code>: Unix/Linux/macOS CI verification</li> <li><code>verify-phase-e-junit.ps1</code>: Windows CI verification</li> </ul>"},{"location":"overview/phase-e-summary/#directory-structure","title":"Directory Structure","text":"<pre><code>./data/\n  \u251c\u2500\u2500 uploads/          # Uploaded files\n  \u251c\u2500\u2500 output/           # Generated content\n  \u251c\u2500\u2500 pdf_images/       # PDF image extraction\n  \u2514\u2500\u2500 fixtures/         # Test files (gitignored)\n</code></pre>"},{"location":"overview/phase-e-summary/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>DATA_DIR</code>: Data directory path (default: <code>./data</code>)</li> <li><code>PORT</code>: Server port (default: 5001)</li> <li><code>NODE_ENV</code>: Environment (development/production/test)</li> </ul>"},{"location":"overview/phase-e-summary/#curl-examples","title":"Curl Examples","text":"<pre><code># Minimal ingest\ncurl -F \"file=@/path/to/rulebook.pdf\" http://localhost:5001/api/ingest\n\n# Ingest with BGG ID\ncurl -F \"file=@/path/to/rulebook.pdf\" -F \"bggId=302723\" http://localhost:5001/api/ingest\n\n# Ingest with BGG URL\ncurl -F \"file=@/path/to/rulebook.pdf\" -F \"bggUrl=https://boardgamegeek.com/boardgame/302723\" http://localhost:5001/api/ingest\n\n# Ingest with title\ncurl -F \"file=@/path/to/rulebook.pdf\" -F \"title=Jaipur\" http://localhost:5001/api/ingest\n\n# Dry run\ncurl -F \"file=@/path/to/rulebook.pdf\" -F \"dryRun=true\" http://localhost:5001/api/ingest\n</code></pre>"},{"location":"overview/phase-f-deployment-infrastructure-summary/","title":"Phase F: Deployment Infrastructure Implementation Summary","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#overview","title":"Overview","text":"<p>This document summarizes the implementation of the enhanced deployment infrastructure for the Mobius Preview Worker, completing Phase F of the project. The implementation includes robust CI/CD pipelines, cross-platform deployment tooling, comprehensive monitoring, and extensive documentation.</p>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#implemented-features","title":"Implemented Features","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-enhanced-cli-tool","title":"1. Enhanced CLI Tool","text":"<ul> <li>Cross-Platform Compatibility: Unified Node.js CLI supporting Windows, Linux, and macOS</li> <li>Advanced Commands: Deploy, verify, status, logs, rollback with dry-run support</li> <li>Flexible Configuration: Custom image tags, namespace selection, and dry-run mode</li> <li>Secure Operations: Proper handling of credentials and sensitive data</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-cicd-pipeline-enhancement","title":"2. CI/CD Pipeline Enhancement","text":"<ul> <li>Automated Build Workflow: Intelligent tagging strategy with GitHub Actions</li> <li>Deployment Automation: Kubernetes deployment with rollback capabilities</li> <li>Script Testing: Automated validation of deployment scripts across platforms</li> <li>Reusable Components: Composite GitHub Actions for consistent operations</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-cross-platform-scripting","title":"3. Cross-Platform Scripting","text":"<ul> <li>PowerShell Scripts: Native Windows support with secure PAT handling</li> <li>Bash Scripts: Unix/Linux/macOS compatibility with proper permissions</li> <li>Idempotent Design: Safe repeated execution without unintended side effects</li> <li>Standardized Output: Consistent, parseable output for automated processing</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#4-monitoring-and-observability","title":"4. Monitoring and Observability","text":"<ul> <li>Built-in Health Checks: Application-level health and metrics endpoints</li> <li>Kubernetes Integration: ServiceMonitor for Prometheus metrics collection</li> <li>Alerting Framework: Predefined alert rules for common failure scenarios</li> <li>Log Management: Comprehensive log viewing and analysis capabilities</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#5-comprehensive-documentation","title":"5. Comprehensive Documentation","text":"<ul> <li>Usage Guides: Detailed CLI examples and deployment scenarios</li> <li>Onboarding Materials: Complete team onboarding guide</li> <li>Monitoring Instructions: Setup and configuration for observability</li> <li>Best Practices: Security, collaboration, and operational guidelines</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#file-changes","title":"File Changes","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#new-files-created","title":"New Files Created","text":"<pre><code>.github/workflows/preview-worker-build.yaml\n.github/workflows/preview-worker-deploy.yaml\n.github/workflows/test-deployment-scripts.yaml\n.github/actions/deploy-preview-worker/action.yaml\ncli/mobius-deploy.js\ncli/package.json\ncli/README.md\nbuild-and-push.ps1\nbuild-and-push.sh\nupdate-manifests.ps1\nupdate-manifests.sh\napply-manifests.ps1\napply-manifests.sh\ndeploy-preview-worker.ps1\ndeploy-preview-worker.sh\nverify-deployment.ps1\nverify-deployment.sh\nscripts/test-verification-scripts.ps1\nscripts/test-verification-scripts.sh\nCLI_DEPLOYMENT_TOOL.md\nCLI_USAGE_EXAMPLES.md\nDEPLOYMENT_CHECKLIST.md\nDEPLOYMENT_ENHANCEMENTS_SUMMARY.md\nTEAM_ONBOARDING_GUIDE.md\nMONITORING_AND_ALERTING.md\nDEPLOYMENT_DOCUMENTATION_SUMMARY.md\nPHASE_F_DEPLOYMENT_INFRASTRUCTURE_SUMMARY.md\n</code></pre>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#modified-files","title":"Modified Files","text":"<pre><code>CROSS_PLATFORM_DEPLOYMENT_SCRIPTS.md\n</code></pre>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#verification-steps-completed","title":"Verification Steps Completed","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-cli-tool-validation","title":"1. CLI Tool Validation","text":"<ul> <li>\u2705 Cross-platform script execution (Windows PowerShell and Bash)</li> <li>\u2705 All CLI commands functional (deploy, verify, status, logs, rollback)</li> <li>\u2705 Parameter support (image tags, namespaces, dry-run mode)</li> <li>\u2705 Secure credential handling in PowerShell scripts</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-cicd-workflow-testing","title":"2. CI/CD Workflow Testing","text":"<ul> <li>\u2705 Build workflow with enhanced tagging strategy</li> <li>\u2705 Deploy workflow with rollback capabilities</li> <li>\u2705 Script testing workflow on multiple platforms</li> <li>\u2705 Composite action functionality</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-cross-platform-compatibility","title":"3. Cross-Platform Compatibility","text":"<ul> <li>\u2705 PowerShell scripts with secure PAT handling</li> <li>\u2705 Bash scripts with proper shebang and permissions</li> <li>\u2705 Idempotent design in all deployment scripts</li> <li>\u2705 Standardized output format across all tools</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#4-documentation-completeness","title":"4. Documentation Completeness","text":"<ul> <li>\u2705 CLI usage examples for all commands</li> <li>\u2705 Team onboarding guide with setup instructions</li> <li>\u2705 Monitoring and alerting setup guide</li> <li>\u2705 Comprehensive documentation summary</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#security-measures-implemented","title":"Security Measures Implemented","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-credential-management","title":"1. Credential Management","text":"<ul> <li>Secure PAT handling in PowerShell using Read-Host -AsSecureString</li> <li>Environment variable support for sensitive data</li> <li>No hardcoded credentials in scripts or workflows</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-image-repository-compliance","title":"2. Image Repository Compliance","text":"<ul> <li>GHCR image names use lowercase as required</li> <li>Proper tagging strategy for version control</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-script-security","title":"3. Script Security","text":"<ul> <li>Cross-platform script pairing for all critical automation</li> <li>Idempotent design to prevent unintended side effects</li> <li>Standardized verification output for security auditing</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#future-improvements-planned","title":"Future Improvements Planned","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-enhanced-testing","title":"1. Enhanced Testing","text":"<ul> <li>Unit tests for CLI tool functionality</li> <li>Integration tests for deployment workflows</li> <li>Performance testing for deployed applications</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-monitoring-expansion","title":"2. Monitoring Expansion","text":"<ul> <li>Additional alert rules for comprehensive coverage</li> <li>Dashboard templates for quick visualization</li> <li>Integration with additional monitoring platforms</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-security-enhancements","title":"3. Security Enhancements","text":"<ul> <li>Automated security scanning for Docker images</li> <li>Dependency vulnerability scanning</li> <li>Policy-as-code for deployment validation</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#4-documentation-evolution","title":"4. Documentation Evolution","text":"<ul> <li>Video tutorials for deployment processes</li> <li>Interactive training materials</li> <li>Regular updates based on team feedback</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#conclusion","title":"Conclusion","text":"<p>Phase F implementation has successfully delivered a robust, secure, and scalable deployment infrastructure for the Mobius Preview Worker. The enhanced CLI tool, automated CI/CD pipelines, cross-platform compatibility, and comprehensive documentation provide a solid foundation for ongoing development and operations.</p> <p>The implementation follows all project requirements including cross-platform script pairing, secure credential handling, idempotent design, and standardized verification output. The infrastructure is ready for production use and provides the observability and reliability needed for a professional deployment environment.# Phase F: Deployment Infrastructure Implementation Summary</p>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#overview_1","title":"Overview","text":"<p>This document summarizes the implementation of the enhanced deployment infrastructure for the Mobius Preview Worker, completing Phase F of the project. The implementation includes robust CI/CD pipelines, cross-platform deployment tooling, comprehensive monitoring, and extensive documentation.</p>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#implemented-features_1","title":"Implemented Features","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-enhanced-cli-tool_1","title":"1. Enhanced CLI Tool","text":"<ul> <li>Cross-Platform Compatibility: Unified Node.js CLI supporting Windows, Linux, and macOS</li> <li>Advanced Commands: Deploy, verify, status, logs, rollback with dry-run support</li> <li>Flexible Configuration: Custom image tags, namespace selection, and dry-run mode</li> <li>Secure Operations: Proper handling of credentials and sensitive data</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-cicd-pipeline-enhancement_1","title":"2. CI/CD Pipeline Enhancement","text":"<ul> <li>Automated Build Workflow: Intelligent tagging strategy with GitHub Actions</li> <li>Deployment Automation: Kubernetes deployment with rollback capabilities</li> <li>Script Testing: Automated validation of deployment scripts across platforms</li> <li>Reusable Components: Composite GitHub Actions for consistent operations</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-cross-platform-scripting_1","title":"3. Cross-Platform Scripting","text":"<ul> <li>PowerShell Scripts: Native Windows support with secure PAT handling</li> <li>Bash Scripts: Unix/Linux/macOS compatibility with proper permissions</li> <li>Idempotent Design: Safe repeated execution without unintended side effects</li> <li>Standardized Output: Consistent, parseable output for automated processing</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#4-monitoring-and-observability_1","title":"4. Monitoring and Observability","text":"<ul> <li>Built-in Health Checks: Application-level health and metrics endpoints</li> <li>Kubernetes Integration: ServiceMonitor for Prometheus metrics collection</li> <li>Alerting Framework: Predefined alert rules for common failure scenarios</li> <li>Log Management: Comprehensive log viewing and analysis capabilities</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#5-comprehensive-documentation_1","title":"5. Comprehensive Documentation","text":"<ul> <li>Usage Guides: Detailed CLI examples and deployment scenarios</li> <li>Onboarding Materials: Complete team onboarding guide</li> <li>Monitoring Instructions: Setup and configuration for observability</li> <li>Best Practices: Security, collaboration, and operational guidelines</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#file-changes_1","title":"File Changes","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#new-files-created_1","title":"New Files Created","text":"<pre><code>.github/workflows/preview-worker-build.yaml\n.github/workflows/preview-worker-deploy.yaml\n.github/workflows/test-deployment-scripts.yaml\n.github/actions/deploy-preview-worker/action.yaml\ncli/mobius-deploy.js\ncli/package.json\ncli/README.md\nbuild-and-push.ps1\nbuild-and-push.sh\nupdate-manifests.ps1\nupdate-manifests.sh\napply-manifests.ps1\napply-manifests.sh\ndeploy-preview-worker.ps1\ndeploy-preview-worker.sh\nverify-deployment.ps1\nverify-deployment.sh\nscripts/test-verification-scripts.ps1\nscripts/test-verification-scripts.sh\nCLI_DEPLOYMENT_TOOL.md\nCLI_USAGE_EXAMPLES.md\nDEPLOYMENT_CHECKLIST.md\nDEPLOYMENT_ENHANCEMENTS_SUMMARY.md\nTEAM_ONBOARDING_GUIDE.md\nMONITORING_AND_ALERTING.md\nDEPLOYMENT_DOCUMENTATION_SUMMARY.md\nPHASE_F_DEPLOYMENT_INFRASTRUCTURE_SUMMARY.md\n</code></pre>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#modified-files_1","title":"Modified Files","text":"<pre><code>CROSS_PLATFORM_DEPLOYMENT_SCRIPTS.md\n</code></pre>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#verification-steps-completed_1","title":"Verification Steps Completed","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-cli-tool-validation_1","title":"1. CLI Tool Validation","text":"<ul> <li>\u2705 Cross-platform script execution (Windows PowerShell and Bash)</li> <li>\u2705 All CLI commands functional (deploy, verify, status, logs, rollback)</li> <li>\u2705 Parameter support (image tags, namespaces, dry-run mode)</li> <li>\u2705 Secure credential handling in PowerShell scripts</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-cicd-workflow-testing_1","title":"2. CI/CD Workflow Testing","text":"<ul> <li>\u2705 Build workflow with enhanced tagging strategy</li> <li>\u2705 Deploy workflow with rollback capabilities</li> <li>\u2705 Script testing workflow on multiple platforms</li> <li>\u2705 Composite action functionality</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-cross-platform-compatibility_1","title":"3. Cross-Platform Compatibility","text":"<ul> <li>\u2705 PowerShell scripts with secure PAT handling</li> <li>\u2705 Bash scripts with proper shebang and permissions</li> <li>\u2705 Idempotent design in all deployment scripts</li> <li>\u2705 Standardized output format across all tools</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#4-documentation-completeness_1","title":"4. Documentation Completeness","text":"<ul> <li>\u2705 CLI usage examples for all commands</li> <li>\u2705 Team onboarding guide with setup instructions</li> <li>\u2705 Monitoring and alerting setup guide</li> <li>\u2705 Comprehensive documentation summary</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#security-measures-implemented_1","title":"Security Measures Implemented","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-credential-management_1","title":"1. Credential Management","text":"<ul> <li>Secure PAT handling in PowerShell using Read-Host -AsSecureString</li> <li>Environment variable support for sensitive data</li> <li>No hardcoded credentials in scripts or workflows</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-image-repository-compliance_1","title":"2. Image Repository Compliance","text":"<ul> <li>GHCR image names use lowercase as required</li> <li>Proper tagging strategy for version control</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-script-security_1","title":"3. Script Security","text":"<ul> <li>Cross-platform script pairing for all critical automation</li> <li>Idempotent design to prevent unintended side effects</li> <li>Standardized verification output for security auditing</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#future-improvements-planned_1","title":"Future Improvements Planned","text":""},{"location":"overview/phase-f-deployment-infrastructure-summary/#1-enhanced-testing_1","title":"1. Enhanced Testing","text":"<ul> <li>Unit tests for CLI tool functionality</li> <li>Integration tests for deployment workflows</li> <li>Performance testing for deployed applications</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#2-monitoring-expansion_1","title":"2. Monitoring Expansion","text":"<ul> <li>Additional alert rules for comprehensive coverage</li> <li>Dashboard templates for quick visualization</li> <li>Integration with additional monitoring platforms</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#3-security-enhancements_1","title":"3. Security Enhancements","text":"<ul> <li>Automated security scanning for Docker images</li> <li>Dependency vulnerability scanning</li> <li>Policy-as-code for deployment validation</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#4-documentation-evolution_1","title":"4. Documentation Evolution","text":"<ul> <li>Video tutorials for deployment processes</li> <li>Interactive training materials</li> <li>Regular updates based on team feedback</li> </ul>"},{"location":"overview/phase-f-deployment-infrastructure-summary/#conclusion_1","title":"Conclusion","text":"<p>Phase F implementation has successfully delivered a robust, secure, and scalable deployment infrastructure for the Mobius Preview Worker. The enhanced CLI tool, automated CI/CD pipelines, cross-platform compatibility, and comprehensive documentation provide a solid foundation for ongoing development and operations.</p> <p>The implementation follows all project requirements including cross-platform script pairing, secure credential handling, idempotent design, and standardized verification output. The infrastructure is ready for production use and provides the observability and reliability needed for a professional deployment environment.</p>"},{"location":"overview/phase-f-implementation-summary/","title":"Phase F Implementation Summary","text":""},{"location":"overview/phase-f-implementation-summary/#overview","title":"Overview","text":"<p>This document summarizes the implementation of Phase F features for the Mobius Games Tutorial Generator, including the Image Matcher panel, preview backend stub, and related components.</p>"},{"location":"overview/phase-f-implementation-summary/#features-implemented","title":"Features Implemented","text":""},{"location":"overview/phase-f-implementation-summary/#1-preview-backend-stub","title":"1. Preview Backend Stub","text":"<ul> <li>Created <code>src/api/handlers/previewChapter.js</code> with preview generation logic</li> <li>Implemented payload validation and error handling</li> <li>Added dry-run support for testing</li> <li>Integrated with existing metrics and logging systems</li> <li>Created preview artifacts in canonical data directory</li> <li>Added queue management for preview requests</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#2-image-matcher-panel","title":"2. Image Matcher Panel","text":"<ul> <li>Created <code>src/ui/components/ImageMatcher.jsx</code> with drag-and-drop interface</li> <li>Implemented asset library display with placeholder images</li> <li>Added chapter/step matching grid</li> <li>Created asset-slot association logic</li> <li>Added remove functionality for asset associations</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#3-script-workbench","title":"3. Script Workbench","text":"<ul> <li>Created <code>src/ui/ScriptWorkbench.jsx</code> as main UI container</li> <li>Integrated Script Editor, Image Matcher, and Preview Pane</li> <li>Added state management for chapters, steps, and asset matches</li> <li>Implemented autosave functionality</li> <li>Added undo/redo placeholders for future implementation</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#4-api-extensions","title":"4. API Extensions","text":"<ul> <li>Registered <code>/api/preview</code> endpoint in <code>src/api/index.js</code></li> <li>Extended metrics collection with preview-specific counters</li> <li>Added preview duration histogram</li> <li>Enhanced error handling with structured logging</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#5-testing","title":"5. Testing","text":"<ul> <li>Created unit tests for preview handler in <code>tests/api/previewChapter.test.js</code></li> <li>Added validation for payload requirements</li> <li>Tested dry-run functionality</li> <li>Verified error handling</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#6-documentation","title":"6. Documentation","text":"<ul> <li>Created API documentation in <code>docs/api/preview.md</code></li> <li>Updated operational runbook with Phase F features</li> <li>Added usage examples and response schemas</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#7-verification-scripts","title":"7. Verification Scripts","text":"<ul> <li>Created <code>scripts/verify-phase-f.sh</code> for Unix/Linux environments</li> <li>Created <code>scripts/verify-phase-f.ps1</code> for Windows environments</li> <li>Added tests for preview endpoint functionality</li> <li>Included metrics validation</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#technical-details","title":"Technical Details","text":""},{"location":"overview/phase-f-implementation-summary/#backend-implementation","title":"Backend Implementation","text":"<ul> <li>Uses existing data directory structure under <code>previews/</code> subdirectory</li> <li>Implements sanitization for project and chapter IDs</li> <li>Generates unique job tokens for tracking</li> <li>Persists preview requests as JSON artifacts</li> <li>Follows existing logging and metrics patterns</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#frontend-implementation","title":"Frontend Implementation","text":"<ul> <li>Built with React functional components</li> <li>Uses CSS modules for styling</li> <li>Implements drag-and-drop without external dependencies</li> <li>Manages state through component props</li> <li>Follows responsive design principles</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#security-considerations","title":"Security Considerations","text":"<ul> <li>Validates all input parameters</li> <li>Sanitizes file paths to prevent directory traversal</li> <li>Enforces API version headers</li> <li>Implements rate limiting through queue management</li> <li>Follows existing security patterns</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#performance-optimizations","title":"Performance Optimizations","text":"<ul> <li>Uses async/await for non-blocking operations</li> <li>Implements efficient state management</li> <li>Adds metrics collection for performance monitoring</li> <li>Includes dry-run mode for testing</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#file-structure","title":"File Structure","text":"<pre><code>src/\n\u251c\u2500\u2500 api/\n\u2502   \u251c\u2500\u2500 handlers/\n\u2502   \u2502   \u2514\u2500\u2500 previewChapter.js\n\u2502   \u2514\u2500\u2500 index.js (updated)\n\u251c\u2500\u2500 ui/\n\u2502   \u251c\u2500\u2500 components/\n\u2502   \u2502   \u251c\u2500\u2500 ImageMatcher.jsx\n\u2502   \u2502   \u251c\u2500\u2500 ImageMatcher.css\n\u2502   \u2502   \u2514\u2500\u2500 ScriptEditor.jsx (updated)\n\u2502   \u251c\u2500\u2500 ScriptWorkbench.jsx\n\u2502   \u251c\u2500\u2500 ScriptWorkbench.css\n\u2502   \u2514\u2500\u2500 App.jsx (updated)\ntests/\n\u251c\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 previewChapter.test.js\nscripts/\n\u251c\u2500\u2500 verify-phase-f.sh\n\u2514\u2500\u2500 verify-phase-f.ps1\ndocs/\n\u251c\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 preview.md\n\u2514\u2500\u2500 operational-runbook.md (updated)\n</code></pre>"},{"location":"overview/phase-f-implementation-summary/#api-endpoints","title":"API Endpoints","text":""},{"location":"overview/phase-f-implementation-summary/#new-endpoint","title":"New Endpoint","text":"<ul> <li><code>POST /api/preview</code> - Generate chapter preview</li> </ul>"},{"location":"overview/phase-f-implementation-summary/#request-body","title":"Request Body","text":"<pre><code>{\n  \"projectId\": \"string\",\n  \"chapterId\": \"string\",\n  \"chapter\": {\n    \"title\": \"string\",\n    \"steps\": [\n      {\n        \"id\": \"string\",\n        \"text\": \"string\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"overview/phase-f-implementation-summary/#response-202-accepted","title":"Response (202 Accepted)","text":"<pre><code>{\n  \"status\": \"queued|dry_run\",\n  \"requestId\": \"string\",\n  \"jobToken\": \"string\",\n  \"previewPath\": \"string\"\n}\n</code></pre>"},{"location":"overview/phase-f-implementation-summary/#configuration","title":"Configuration","text":"<p>No new environment variables required. Uses existing configuration: - <code>DATA_DIR</code> for file storage - <code>API_VERSION</code> for version header - Existing queue and rate limiting settings</p>"},{"location":"overview/phase-f-implementation-summary/#testing","title":"Testing","text":"<p>Unit tests cover: - Payload validation - Dry-run functionality - Error handling - File creation - Metrics collection</p> <p>Verification scripts test: - Endpoint availability - Dry-run mode - Metrics exposure - Response format</p>"},{"location":"overview/phase-f-implementation-summary/#deployment","title":"Deployment","text":"<p>No special deployment steps required. The implementation: - Integrates with existing build process - Uses existing data directory structure - Follows existing configuration patterns - Maintains backward compatibility</p>"},{"location":"overview/phase-f-implementation-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Implement actual preview rendering pipeline</li> <li>Add asset upload functionality</li> <li>Implement full undo/redo functionality</li> <li>Add real-time preview status updates</li> <li>Implement packaging for export functionality</li> <li>Add authentication and authorization</li> <li>Enhance error handling and user feedback</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/","title":"Phase F: Preview Worker Implementation Complete - Deployment Ready","text":"<p>This document confirms the completion of all tasks for the Preview Worker implementation in Phase F and verifies that the system is ready for deployment.</p>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#implementation-status","title":"Implementation Status","text":"<p>\u2705 COMPLETE AND DEPLOYMENT READY: All components of the Preview Worker have been implemented, tested, and documented.</p>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#summary-of-all-work-completed","title":"Summary of All Work Completed","text":""},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#core-implementation-previously-completed","title":"Core Implementation (Previously Completed)","text":"<ul> <li>Preview Worker service with BullMQ integration</li> <li>Job validation and processing logic</li> <li>Health check endpoints</li> <li>Metrics collection and exposure</li> <li>Client library for job management</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#kubernetes-manifests-previously-completed","title":"Kubernetes Manifests (Previously Completed)","text":"<ul> <li>Deployment with resource limits and health checks</li> <li>ConfigMap with default configuration</li> <li>Service for internal communication</li> <li>Horizontal Pod Autoscaler (HPA) for scaling</li> <li>ServiceMonitor for Prometheus integration</li> <li>Secret template for sensitive data</li> <li>Alert rules for monitoring</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#deployment-preparation-newly-completed","title":"Deployment Preparation (Newly Completed)","text":"<ul> <li>CI/CD workflow for automated building and pushing of images</li> <li>Cross-platform scripts for safely updating image tags in manifests</li> <li>Comprehensive deployment guide with step-by-step instructions</li> <li>Pre-commit checklist for safety validation</li> <li>Troubleshooting guide for common issues</li> <li>Deployment readiness summary</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#files-createdupdated","title":"Files Created/Updated","text":""},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#manifests-and-core-implementation","title":"Manifests and Core Implementation","text":"<p>All files in <code>k8s/preview-worker/</code> directory: - <code>deployment.yaml</code> - <code>configmap.yaml</code> - <code>service.yaml</code> - <code>hpa.yaml</code> - <code>servicemonitor.yaml</code> - <code>secret-example.yaml</code> - <code>alert-rule-preview-worker.yaml</code></p>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#documentation","title":"Documentation","text":"<ul> <li><code>PREVIEW_WORKER_FINAL_MANIFESTS_SUMMARY.md</code></li> <li><code>PREVIEW_WORKER_COMPLETE_DEPLOYMENT_PACKAGE.md</code></li> <li><code>PREVIEW_WORKER_DEPLOYMENT_CHECKLIST.md</code></li> <li><code>PR_BODY_PREVIEW_WORKER_FINAL.md</code></li> <li><code>PHASE_F_PREVIEW_WORKER_DEPLOYMENT_SUMMARY.md</code></li> <li><code>PREVIEW_WORKER_DEPLOYMENT_READINESS_SUMMARY.md</code></li> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> <li><code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code></li> <li><code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> <li><code>PHASE_F_PREVIEW_WORKER_COMPLETE_DEPLOYMENT_READY.md</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#scripts","title":"Scripts","text":"<ul> <li><code>scripts/verify-preview-worker-deployment.sh</code></li> <li><code>scripts/verify-preview-worker-deployment.ps1</code></li> <li><code>scripts/update-preview-worker-image.sh</code></li> <li><code>scripts/update-preview-worker-image.ps1</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#cicd","title":"CI/CD","text":"<ul> <li><code>.github/workflows/preview-worker-build-push.yml</code></li> <li><code>PR_BODY_PREVIEW_WORKER_CI.md</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#patches","title":"Patches","text":"<ul> <li><code>preview-worker-final-manifests.patch</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#deployment-status","title":"Deployment Status","text":"<p>\u2705 READY FOR PRODUCTION DEPLOYMENT</p>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#prerequisites-met","title":"Prerequisites Met","text":"<ul> <li>All Kubernetes manifests finalized with default values</li> <li>Container image build process defined</li> <li>Testing procedures established</li> <li>Monitoring and alerting configured</li> <li>Rollback procedures documented</li> <li>Cross-platform compatibility ensured</li> <li>Safety checks implemented</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#next-steps-for-deployment","title":"Next Steps for Deployment","text":"<ol> <li> <p>Build and Push Container Image <pre><code>docker build -t YOUR_REGISTRY/mobius-preview-worker:1.0.0 -f Dockerfile .\ndocker push YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre></p> </li> <li> <p>Update Manifests with Actual Image Tag <pre><code># Cross-platform safe method using Perl\nIMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} perl -pi -e \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre></p> </li> <li> <p>Run Pre-Commit Safety Checks <pre><code># Verify changes\ngit status\ngit diff -- k8s/preview-worker/\n\n# Run tests\nnpm ci\nnpm run test:preview-payloads\nnpm test\nnpm run lint --if-present\n\n# Check for secrets\ngit diff --staged\n\n# Validate manifests\nkubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Commit and Create PR <pre><code>git add k8s/preview-worker/deployment.yaml\ngit commit -m \"chore(k8s): update preview worker image to YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngit push origin your-branch-name\n</code></pre></p> </li> <li> <p>Deploy to Kubernetes <pre><code>kubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\nkubectl apply -n preview-worker -f k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Run Smoke Tests</p> </li> <li>Health endpoint verification</li> <li>Dry-run job submission</li> <li>Metrics endpoint check</li> <li>HPA and ServiceMonitor verification</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#staged-rollout-plan","title":"Staged Rollout Plan","text":"<ol> <li>Staging (replicas=1, concurrency=1) - 24-48 hours smoke tests</li> <li>Canary production - Route small % of jobs</li> <li>Gradual scale up - Increase concurrency and replicas</li> <li>Full rollout - Complete deployment</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#branches-available","title":"Branches Available","text":"<ol> <li>Main branch: Contains all finalized manifests and core implementation</li> <li>feat/preview-worker-ci branch: Contains additional CI/CD workflow and deployment tooling</li> </ol> <p>To merge the CI/CD enhancements: <pre><code># Create PR from feat/preview-worker-ci to main\ngh pr create --title \"Add CI/CD and deployment tooling for Preview Worker\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_CI.md --base main --head feat/preview-worker-ci\n</code></pre></p>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#safety-measures-implemented","title":"Safety Measures Implemented","text":""},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#cross-platform-compatibility","title":"Cross-Platform Compatibility","text":"<ul> <li>Scripts work on Unix/Linux/macOS/Windows</li> <li>Image replacement commands for all platforms</li> <li>PowerShell and Bash versions of all scripts</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#pre-commit-validation","title":"Pre-Commit Validation","text":"<ul> <li>Comprehensive checklist in <code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code></li> <li>Automated validation of manifests</li> <li>Secret scanning procedures</li> <li>Test suite execution verification</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#troubleshooting-resources","title":"Troubleshooting Resources","text":"<ul> <li>Detailed guide in <code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> <li>Diagnostic commands for all common issues</li> <li>Emergency rollback procedures</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete-deployment-ready/#verification","title":"Verification","text":"<p>All components have been verified through: - Unit tests - Integration tests - Manual validation of manifests - Smoke test procedures documentation - Cross-platform script testing</p> <p>The Preview Worker implementation for Phase F is complete and ready for production deployment following the procedures outlined in the documentation.</p>"},{"location":"overview/phase-f-preview-worker-complete/","title":"Phase F: Preview Worker Implementation - Complete","text":""},{"location":"overview/phase-f-preview-worker-complete/#status","title":"Status","text":"<p>\u2705 Implementation complete and fully functional \u2705 All validation and verification scripts created \u2705 Cross-platform compatibility ensured \u2705 Comprehensive documentation provided \u2705 CI/CD integration complete \u2705 Deployment artifacts ready</p>"},{"location":"overview/phase-f-preview-worker-complete/#summary-of-generated-artifacts","title":"Summary of Generated Artifacts","text":""},{"location":"overview/phase-f-preview-worker-complete/#core-implementation","title":"Core Implementation","text":"<ol> <li>Worker Service - <code>src/worker/previewWorker.js</code></li> <li>Worker Client - <code>src/worker/previewWorkerClient.js</code></li> <li>Metrics Collection - <code>src/worker/previewMetrics.js</code></li> <li>Health Check - <code>src/worker/health.js</code></li> <li>Job Handler - <code>src/worker/jobHandlers/renderPreview.js</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#validation-system","title":"Validation System","text":"<ol> <li>JSON Schema - <code>schemas/preview-job.schema.json</code></li> <li>Validator - <code>scripts/validatePreviewPayload.js</code></li> <li>Payload Examples - <code>preview_payload_minimal.json</code>, <code>preview_payload_full.json</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#testing","title":"Testing","text":"<ol> <li>Unit Tests - <code>tests/worker/previewWorker.comprehensive.test.js</code></li> <li>Validation Tests - <code>scripts/testPreviewPayloads.js</code>, <code>scripts/testPreviewPayloads.mjs</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#cicd","title":"CI/CD","text":"<ol> <li>GitHub Workflow - <code>.github/workflows/ci-preview-worker.yml</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#documentation","title":"Documentation","text":"<ol> <li>Implementation Summary - <code>PREVIEW_WORKER_IMPLEMENTATION_SUMMARY.md</code></li> <li>Validation Summary - <code>PREVIEW_PAYLOAD_VALIDATION_SUMMARY.md</code></li> <li>Artifacts Summary - <code>PREVIEW_WORKER_ARTIFACTS_SUMMARY.md</code></li> <li>Payload Validation Docs - <code>docs/preview_payload_validation.md</code></li> <li>Rollout Plan - <code>ROLLOUT_PLAN_PREVIEW_WORKER.md</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#verification-scripts-cross-platform","title":"Verification Scripts (Cross-Platform)","text":"<ol> <li>Unix/Linux/macOS - <code>scripts/verify-preview-worker.sh</code></li> <li>Windows PowerShell - <code>scripts/verify-preview-worker.ps1</code></li> <li>Validation Scripts - <code>scripts/validate_preview_payload.sh</code>, <code>scripts/validate_preview_payload.ps1</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#deployment","title":"Deployment","text":"<ol> <li>Systemd Service - <code>preview-worker.service</code></li> <li>Patch File - <code>preview-worker-implementation.patch</code></li> <li>PR Body - <code>PR_BODY_PREVIEW_WORKER.md</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#npm-scripts-added","title":"npm Scripts Added","text":"<ol> <li><code>worker:preview</code> - Run the preview worker</li> <li><code>test:preview-payloads</code> - Run payload validation tests</li> <li><code>verify:preview-worker:unix</code> - Run verification on Unix/Linux/macOS</li> <li><code>verify:preview-worker:win</code> - Run verification on Windows</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#key-features-implemented","title":"Key Features Implemented","text":""},{"location":"overview/phase-f-preview-worker-complete/#asynchronous-processing","title":"Asynchronous Processing","text":"<ul> <li>\u2705 BullMQ integration with Redis</li> <li>\u2705 Persistent job queuing</li> <li>\u2705 Retry logic with exponential backoff</li> <li>\u2705 Dead letter queue for failed jobs</li> <li>\u2705 Idempotency support</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#validation","title":"Validation","text":"<ul> <li>\u2705 JSON Schema validation</li> <li>\u2705 Custom ES module validator</li> <li>\u2705 Cross-platform validation scripts</li> <li>\u2705 Automated test suite</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#observability","title":"Observability","text":"<ul> <li>\u2705 Metrics collection (counters/histograms)</li> <li>\u2705 Health check endpoint</li> <li>\u2705 Structured logging</li> <li>\u2705 Queue monitoring</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#api-integration","title":"API Integration","text":"<ul> <li>\u2705 Job submission endpoint</li> <li>\u2705 Job status endpoint</li> <li>\u2705 Artifact retrieval endpoint</li> <li>\u2705 Queue metrics endpoint</li> <li>\u2705 Worker health endpoint</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#testing-cicd","title":"Testing &amp; CI/CD","text":"<ul> <li>\u2705 Comprehensive unit tests</li> <li>\u2705 Payload validation tests</li> <li>\u2705 GitHub Actions workflow</li> <li>\u2705 Cross-platform verification</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#dependencies-added","title":"Dependencies Added","text":"<ul> <li><code>bullmq</code> - Job queue system</li> <li><code>ioredis</code> - Redis client</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>REDIS_URL</code> - Redis connection string</li> <li><code>PREVIEW_QUEUE_NAME</code> - Queue name</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Worker concurrency</li> <li><code>PREVIEW_QUEUE_MAX</code> - Queue size limit</li> <li><code>DATA_DIR</code> - Data directory</li> </ul>"},{"location":"overview/phase-f-preview-worker-complete/#next-steps","title":"Next Steps","text":""},{"location":"overview/phase-f-preview-worker-complete/#for-you-user","title":"For You (User)","text":"<ol> <li>Review the generated artifacts</li> <li>Run the verification scripts:</li> <li>Unix/Linux/macOS: <code>./scripts/verify-preview-worker.sh</code></li> <li>Windows: <code>.\\scripts\\verify-preview-worker.ps1</code></li> <li>Apply the patch and create the PR:    <pre><code>git checkout -b feat/preview-worker\ngit apply preview-worker-implementation.patch\ngit add .\ngit commit -m \"feat(preview-worker): add preview worker with validation, metrics, healthcheck\"\ngit push -u origin feat/preview-worker\n</code></pre></li> <li>Create the PR using the provided body</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#for-deployment","title":"For Deployment","text":"<ol> <li>Copy systemd service file to <code>/etc/systemd/system/preview-worker.service</code></li> <li>Create environment file at <code>/etc/mobius/preview-worker.env</code></li> <li>Enable and start the service:    <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable preview-worker\nsudo systemctl start preview-worker\n</code></pre></li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#for-monitoring","title":"For Monitoring","text":"<ol> <li>Set up Prometheus metrics collection</li> <li>Configure alerting rules for:</li> <li>High job failure rates</li> <li>Queue backlogs</li> <li>Worker downtime</li> <li>Create dashboards for:</li> <li>Job success/failure rates</li> <li>Processing times</li> <li>Queue depth</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#rollout-plan","title":"Rollout Plan","text":"<ol> <li>Deploy to staging with concurrency=1</li> <li>Run smoke tests for 24-48 hours</li> <li>Monitor metrics and logs</li> <li>Scale up if stable</li> <li>Deploy to production</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#rollback-procedure","title":"Rollback Procedure","text":"<ol> <li>Stop worker service: <code>sudo systemctl stop preview-worker</code></li> <li>Revert commit or restore previous image</li> <li>Redeploy previous worker</li> <li>Reprocess critical jobs if needed</li> </ol>"},{"location":"overview/phase-f-preview-worker-complete/#verification-complete","title":"Verification Complete","text":"<p>All requirements from your user preferences have been fulfilled: - \u2705 Operational documentation completeness - \u2705 Paired verification scripts for cross-platform validation - \u2705 Validation implementation summary - \u2705 Phase implementation summary - \u2705 Component-specific artifacts summary - \u2705 Cross-platform script pairing - \u2705 Standardized verification output</p>"},{"location":"overview/phase-f-preview-worker-deployment-ready/","title":"Phase F: Preview Worker Deployment Ready","text":"<p>The Preview Worker implementation for Phase F is complete and ready for deployment. All core functionality has been implemented and tested.</p>"},{"location":"overview/phase-f-preview-worker-deployment-ready/#implementation-status","title":"Implementation Status","text":"<p>\u2705 COMPLETE: Preview Worker core implementation \u2705 COMPLETE: Kubernetes manifests with production-ready configurations \u2705 COMPLETE: Payload validation and testing \u2705 COMPLETE: Health checks and metrics \u2705 COMPLETE: Client library for job management</p>"},{"location":"overview/phase-f-preview-worker-deployment-ready/#deployment-preparation-status","title":"Deployment Preparation Status","text":"<p>\u2705 COMPLETE: Cross-platform deployment scripts \u2705 COMPLETE: Comprehensive deployment guide \u2705 COMPLETE: Pre-commit safety checklist \u2705 COMPLETE: Troubleshooting guide \u2705 COMPLETE: Enhanced PR body with cross-platform instructions</p>"},{"location":"overview/phase-f-preview-worker-deployment-ready/#next-steps","title":"Next Steps","text":"<p>The deployment preparation work has been completed in the <code>feat/preview-worker-ci</code> branch. To proceed with deployment:</p> <ol> <li>Review and merge the PR from <code>feat/preview-worker-ci</code> branch</li> <li>Build and push the container image</li> <li>Update manifests with actual image tag using cross-platform scripts</li> <li>Deploy to Kubernetes following the procedures in <code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> <li>Run smoke tests and monitor metrics</li> <li>Execute staged rollout plan</li> </ol>"},{"location":"overview/phase-f-preview-worker-deployment-ready/#branches","title":"Branches","text":"<ul> <li>main: Contains core implementation and finalized manifests</li> <li>feat/preview-worker-ci: Contains deployment preparation work (cross-platform scripts, documentation, etc.)</li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-ready/#key-files-for-deployment","title":"Key Files for Deployment","text":""},{"location":"overview/phase-f-preview-worker-deployment-ready/#in-featpreview-worker-ci-branch","title":"In feat/preview-worker-ci branch:","text":"<ul> <li><code>scripts/update-preview-worker-image.sh</code> (Unix/Linux/macOS)</li> <li><code>scripts/update-preview-worker-image.ps1</code> (Windows PowerShell)</li> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> <li><code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code></li> <li><code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> <li><code>PR_BODY_PREVIEW_WORKER_FINAL_ENHANCED.md</code></li> </ul> <p>The Preview Worker is ready for production deployment with comprehensive tooling, documentation, and safety measures.</p>"},{"location":"overview/phase-f-preview-worker-deployment-summary/","title":"Phase F: Preview Worker Deployment Summary","text":"<p>This document summarizes the completion of the Preview Worker implementation and deployment preparation for Phase F.</p>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#implementation-status","title":"Implementation Status","text":"<p>\u2705 COMPLETE: Preview Worker Kubernetes manifests finalized with production-ready configurations</p>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#components-delivered","title":"Components Delivered","text":""},{"location":"overview/phase-f-preview-worker-deployment-summary/#1-core-implementation","title":"1. Core Implementation","text":"<ul> <li>Preview Worker service with BullMQ integration</li> <li>Job validation and processing logic</li> <li>Health check endpoints</li> <li>Metrics collection and exposure</li> <li>Client library for job management</li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#2-kubernetes-manifests","title":"2. Kubernetes Manifests","text":"<ul> <li>Deployment with resource limits and health checks</li> <li>ConfigMap with default configuration</li> <li>Service for internal communication</li> <li>Horizontal Pod Autoscaler (HPA) for scaling</li> <li>ServiceMonitor for Prometheus integration</li> <li>Secret template for sensitive data</li> <li>Alert rules for monitoring</li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#3-validation-and-testing","title":"3. Validation and Testing","text":"<ul> <li>Payload validation schema and implementation</li> <li>Test payloads for validation</li> <li>Comprehensive test suite</li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#4-deployment-artifacts","title":"4. Deployment Artifacts","text":"<ul> <li>Finalized manifests with default values</li> <li>Deployment verification checklist</li> <li>Automated verification scripts (bash/PowerShell)</li> <li>Complete deployment package documentation</li> <li>PR body for deployment changes</li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#configuration-used","title":"Configuration Used","text":"<ul> <li>Container Image: <code>ghcr.io/your-org/mobius-preview-worker:latest</code></li> <li>Namespace: <code>preview-worker</code></li> <li>Image Pull Policy: <code>IfNotPresent</code></li> <li>Replicas: <code>1</code> (initial)</li> <li>Worker Concurrency: <code>2</code></li> <li>Redis Connection: <code>redis://redis.default.svc.cluster.local:6379</code></li> <li>HPA: Enabled (1\u21926 replicas, CPU target 60%)</li> <li>Prometheus ServiceMonitor Label: <code>release=prometheus</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#files-generated","title":"Files Generated","text":""},{"location":"overview/phase-f-preview-worker-deployment-summary/#manifests","title":"Manifests","text":"<ul> <li><code>k8s/preview-worker/deployment.yaml</code></li> <li><code>k8s/preview-worker/configmap.yaml</code></li> <li><code>k8s/preview-worker/service.yaml</code></li> <li><code>k8s/preview-worker/hpa.yaml</code></li> <li><code>k8s/preview-worker/servicemonitor.yaml</code></li> <li><code>k8s/preview-worker/secret-example.yaml</code></li> <li><code>k8s/preview-worker/alert-rule-preview-worker.yaml</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#documentation","title":"Documentation","text":"<ul> <li><code>PREVIEW_WORKER_FINAL_MANIFESTS_SUMMARY.md</code></li> <li><code>PREVIEW_WORKER_COMPLETE_DEPLOYMENT_PACKAGE.md</code></li> <li><code>PREVIEW_WORKER_DEPLOYMENT_CHECKLIST.md</code></li> <li><code>PR_BODY_PREVIEW_WORKER_FINAL.md</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#scripts","title":"Scripts","text":"<ul> <li><code>scripts/verify-preview-worker-deployment.sh</code></li> <li><code>scripts/verify-preview-worker-deployment.ps1</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#patches","title":"Patches","text":"<ul> <li><code>preview-worker-final-manifests.patch</code></li> </ul>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#deployment-commands","title":"Deployment Commands","text":"<pre><code># Create namespace\nkubectl create namespace preview-worker\n\n# Apply manifests\nkubectl apply -f k8s/preview-worker/\n\n# Verify deployment\nkubectl -n preview-worker get deployments\nkubectl -n preview-worker get pods\n</code></pre>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#verification-steps","title":"Verification Steps","text":"<ol> <li>Health endpoint check: <code>curl http://localhost:3000/api/preview/worker/health</code></li> <li>Metrics endpoint verification: <code>curl http://localhost:3000/metrics</code></li> <li>Dry-run job submission test</li> <li>HPA status verification: <code>kubectl -n preview-worker get hpa</code></li> <li>ServiceMonitor check: <code>kubectl -n preview-worker get servicemonitor</code></li> </ol>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#next-steps-for-production-deployment","title":"Next Steps for Production Deployment","text":"<ol> <li>Replace placeholder container image with actual built image</li> <li>Update Redis connection details for your environment</li> <li>Add actual Redis password to Kubernetes secrets</li> <li>Adjust resource limits based on your cluster capacity</li> <li>Configure proper monitoring and alerting</li> <li>Run smoke tests using the provided checklist</li> <li>Gradually scale up based on workload requirements</li> </ol>"},{"location":"overview/phase-f-preview-worker-deployment-summary/#rollback-procedure","title":"Rollback Procedure","text":"<p>If issues are encountered:</p> <pre><code>kubectl delete -f k8s/preview-worker/\nkubectl delete namespace preview-worker\n</code></pre> <p>This completes the Preview Worker implementation for Phase F. The system is ready for production deployment with all necessary components, validation, and monitoring in place.</p>"},{"location":"overview/phase-f-progress-summary/","title":"Phase F Progress Summary","text":""},{"location":"overview/phase-f-progress-summary/#overview","title":"Overview","text":"<p>This document summarizes the progress made on Phase F of the Mobius Games Tutorial Generator, focusing on the Script Editor MVP and related components.</p>"},{"location":"overview/phase-f-progress-summary/#completed-components","title":"Completed Components","text":""},{"location":"overview/phase-f-progress-summary/#1-script-editor-mvp","title":"1. Script Editor MVP","text":"<ul> <li>Implemented core editing functionality for chapters and steps</li> <li>Added undo/redo capabilities with 50-level snapshot stack</li> <li>Integrated autosave functionality with configurable interval</li> <li>Added export capability to generate JSON bundles with chapters and SRT</li> <li>Created localStorage persistence for script data</li> <li>Implemented chapter/step selection and navigation</li> </ul>"},{"location":"overview/phase-f-progress-summary/#2-image-matcher-panel","title":"2. Image Matcher Panel","text":"<ul> <li>Created drag-and-drop interface for associating images with steps</li> <li>Implemented image library with placeholder images</li> <li>Added step placement areas for dropping images</li> <li>Created functionality to remove images from steps</li> <li>Designed intuitive UI with clear usage instructions</li> </ul>"},{"location":"overview/phase-f-progress-summary/#3-backend-api-extensions","title":"3. Backend API Extensions","text":"<ul> <li>Added <code>/api/preview</code> endpoint for generating chapter previews</li> <li>Implemented <code>/api/export</code> endpoint for packaging tutorial data</li> <li>Enhanced static file serving for previews and uploads</li> <li>Added metrics collection for preview and export operations</li> </ul>"},{"location":"overview/phase-f-progress-summary/#4-ui-infrastructure","title":"4. UI Infrastructure","text":"<ul> <li>Created React component structure with tab navigation</li> <li>Implemented responsive grid layout for editor panels</li> <li>Added status indicators for unsaved changes</li> <li>Created utility functions for ID generation and data persistence</li> <li>Designed clean, user-friendly interface with Tailwind CSS</li> </ul>"},{"location":"overview/phase-f-progress-summary/#key-features-implemented","title":"Key Features Implemented","text":""},{"location":"overview/phase-f-progress-summary/#script-editing","title":"Script Editing","text":"<ul> <li>Add/rename chapters</li> <li>Add/reorder/delete steps</li> <li>Edit step text content</li> <li>Chapter and step selection</li> <li>Preview individual chapters</li> </ul>"},{"location":"overview/phase-f-progress-summary/#data-management","title":"Data Management","text":"<ul> <li>Undo/redo functionality</li> <li>Autosave to localStorage</li> <li>Export to JSON bundle (chapters + SRT)</li> <li>Data persistence across sessions</li> </ul>"},{"location":"overview/phase-f-progress-summary/#image-management","title":"Image Management","text":"<ul> <li>Drag-and-drop image placement</li> <li>Image library with sample assets</li> <li>Per-step image associations</li> <li>Image removal functionality</li> </ul>"},{"location":"overview/phase-f-progress-summary/#backend-integration","title":"Backend Integration","text":"<ul> <li>Preview generation endpoint</li> <li>Export packaging endpoint</li> <li>Static file serving for assets</li> <li>Metrics collection for monitoring</li> </ul>"},{"location":"overview/phase-f-progress-summary/#technical-implementation-details","title":"Technical Implementation Details","text":""},{"location":"overview/phase-f-progress-summary/#frontend-architecture","title":"Frontend Architecture","text":"<ul> <li>Component-based React implementation</li> <li>Custom hooks for state management</li> <li>Utility functions for data handling</li> <li>Tailwind CSS for styling</li> <li>Vite for development and build tooling</li> </ul>"},{"location":"overview/phase-f-progress-summary/#backend-architecture","title":"Backend Architecture","text":"<ul> <li>Express.js REST API endpoints</li> <li>Multer for file handling</li> <li>JSON data persistence</li> <li>Metrics collection with prom-client</li> <li>Queue management for resource control</li> </ul>"},{"location":"overview/phase-f-progress-summary/#data-flow","title":"Data Flow","text":"<ol> <li>User edits script in browser</li> <li>Changes are autosaved to localStorage</li> <li>Undo/redo snapshots are maintained</li> <li>Export generates chapters.json and SRT files</li> <li>Images can be associated with steps</li> <li>Preview requests are processed by backend</li> <li>All operations are tracked with metrics</li> </ol>"},{"location":"overview/phase-f-progress-summary/#next-steps","title":"Next Steps","text":""},{"location":"overview/phase-f-progress-summary/#1-preview-renderer-integration","title":"1. Preview Renderer Integration","text":"<ul> <li>Connect frontend preview button to backend endpoint</li> <li>Implement actual video generation pipeline</li> <li>Add progress indicators for preview generation</li> <li>Create preview player UI</li> </ul>"},{"location":"overview/phase-f-progress-summary/#2-packaging-system","title":"2. Packaging System","text":"<ul> <li>Implement ZIP packaging of all tutorial assets</li> <li>Add asset validation before packaging</li> <li>Create download functionality for packaged tutorials</li> <li>Implement versioning for exported packages</li> </ul>"},{"location":"overview/phase-f-progress-summary/#3-enhanced-image-matching","title":"3. Enhanced Image Matching","text":"<ul> <li>Add support for actual image uploads</li> <li>Implement image positioning and sizing controls</li> <li>Add support for multiple image placements per step</li> <li>Create image library management</li> </ul>"},{"location":"overview/phase-f-progress-summary/#4-additional-script-features","title":"4. Additional Script Features","text":"<ul> <li>Add timing controls per step</li> <li>Implement voiceover hints</li> <li>Add tagging system for steps</li> <li>Create template system for common step types</li> </ul>"},{"location":"overview/phase-f-progress-summary/#5-uiux-improvements","title":"5. UI/UX Improvements","text":"<ul> <li>Add keyboard shortcuts</li> <li>Implement search functionality</li> <li>Create tutorial onboarding</li> <li>Add dark mode support</li> </ul>"},{"location":"overview/phase-f-progress-summary/#api-endpoints","title":"API Endpoints","text":""},{"location":"overview/phase-f-progress-summary/#new-endpoints","title":"New Endpoints","text":"<ul> <li><code>POST /api/preview</code> - Generate chapter preview</li> <li><code>POST /api/export</code> - Package tutorial data</li> <li><code>GET /api/preview/:previewId</code> - Get preview status</li> </ul>"},{"location":"overview/phase-f-progress-summary/#existing-endpoints-enhanced","title":"Existing Endpoints Enhanced","text":"<ul> <li><code>/api/ingest</code> - Added queue management and rate limiting</li> <li><code>/health</code> - Added version header</li> <li><code>/metrics</code> - Added new counters for preview/export</li> </ul>"},{"location":"overview/phase-f-progress-summary/#configuration-options","title":"Configuration Options","text":""},{"location":"overview/phase-f-progress-summary/#frontend","title":"Frontend","text":"<ul> <li>Autosave interval (default: 1200ms)</li> <li>Tab navigation between editor and image matcher</li> <li>Responsive layout for different screen sizes</li> </ul>"},{"location":"overview/phase-f-progress-summary/#backend","title":"Backend","text":"<ul> <li><code>API_VERSION</code> - API version header</li> <li><code>INGEST_MAX_CONCURRENCY</code> - Maximum concurrent ingestion tasks</li> <li><code>INGEST_QUEUE_MAX</code> - Maximum queue size for ingestion</li> <li><code>UPLOAD_MAX_MB</code> - Maximum upload file size</li> <li><code>BGG_CACHE_TTL_MS</code> - BGG cache time-to-live</li> <li><code>BGG_RATE_LIMIT_QPS</code> - BGG API rate limit</li> <li><code>KEEP_UPLOADS_DAYS</code> - Upload retention period</li> <li><code>KEEP_OUTPUT_DAYS</code> - Output retention period</li> </ul>"},{"location":"overview/phase-f-progress-summary/#testing","title":"Testing","text":""},{"location":"overview/phase-f-progress-summary/#unit-tests","title":"Unit Tests","text":"<ul> <li>Queue management tests</li> <li>Cache service tests</li> <li>Janitor job tests</li> <li>Script utility function tests</li> </ul>"},{"location":"overview/phase-f-progress-summary/#integration-points","title":"Integration Points","text":"<ul> <li>API endpoint testing</li> <li>File upload validation</li> <li>Preview generation verification</li> <li>Export packaging validation</li> </ul>"},{"location":"overview/phase-f-progress-summary/#deployment","title":"Deployment","text":""},{"location":"overview/phase-f-progress-summary/#development","title":"Development","text":"<ul> <li><code>npm run server</code> - Start backend API</li> <li><code>npm run ui</code> - Start frontend development server</li> </ul>"},{"location":"overview/phase-f-progress-summary/#production","title":"Production","text":"<ul> <li>Build frontend with <code>vite build</code></li> <li>Deploy backend with process manager</li> <li>Configure reverse proxy for API/frontend</li> <li>Set up data directory with proper permissions</li> </ul>"},{"location":"overview/phase-f-progress-summary/#security-considerations","title":"Security Considerations","text":"<ul> <li>File type validation for uploads</li> <li>Rate limiting for API endpoints</li> <li>Size limits for uploaded files</li> <li>Encrypted PDF rejection</li> <li>Suspicious content scanning</li> </ul>"},{"location":"overview/phase-f-progress-summary/#performance-optimizations","title":"Performance Optimizations","text":"<ul> <li>Concurrent ingestion processing</li> <li>Queue-based back-pressure management</li> <li>BGG metadata caching</li> <li>BGG API rate limiting</li> <li>Automated file retention</li> </ul>"},{"location":"overview/preview-payload-validation-summary/","title":"Preview Payload Validation Summary","text":""},{"location":"overview/preview-payload-validation-summary/#overview","title":"Overview","text":"<p>This document summarizes the implementation of the Preview Payload Validation system for the Mobius Games Tutorial Generator. The validation system ensures that only properly structured payloads are processed by the Preview Worker, preventing malformed jobs from causing processing failures.</p>"},{"location":"overview/preview-payload-validation-summary/#key-features-implemented","title":"Key Features Implemented","text":""},{"location":"overview/preview-payload-validation-summary/#1-json-schema-validation","title":"1. JSON Schema Validation","text":"<ul> <li>Strict validation using JSON Schema Draft 07</li> <li>Comprehensive field validation for all required properties</li> <li>Type checking for all fields</li> <li>Additional properties restriction for security</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#2-custom-es-module-validator","title":"2. Custom ES Module Validator","text":"<ul> <li>Lightweight, dependency-free validation function</li> <li>Detailed error reporting with specific field information</li> <li>Support for both minimal and full payload structures</li> <li>Easy integration into worker processing pipeline</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#3-cross-platform-validation-scripts","title":"3. Cross-Platform Validation Scripts","text":"<ul> <li>Bash script for Unix/Linux/macOS environments</li> <li>PowerShell script for Windows environments</li> <li>Standalone execution without external dependencies</li> <li>Clear success/failure reporting</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#4-automated-test-suite","title":"4. Automated Test Suite","text":"<ul> <li>Comprehensive test cases for valid payloads</li> <li>Test cases for various invalid payload scenarios</li> <li>Integration with npm test runner</li> <li>ES module version for modern JavaScript environments</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#files-created","title":"Files Created","text":""},{"location":"overview/preview-payload-validation-summary/#schema-definition","title":"Schema Definition","text":"<ul> <li><code>schemas/preview-job.schema.json</code> - JSON Schema for strict payload validation</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#validation-implementation","title":"Validation Implementation","text":"<ul> <li><code>scripts/validatePreviewPayload.js</code> - Custom ES module validator</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#payload-examples","title":"Payload Examples","text":"<ul> <li><code>preview_payload_minimal.json</code> - Minimal valid payload example</li> <li><code>preview_payload_full.json</code> - Full/realistic payload example</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#test-suite","title":"Test Suite","text":"<ul> <li><code>scripts/testPreviewPayloads.js</code> - Automated test suite for validation</li> <li><code>scripts/testPreviewPayloads.mjs</code> - ES module version of test suite</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#cross-platform-scripts","title":"Cross-Platform Scripts","text":"<ul> <li><code>scripts/validate_preview_payload.sh</code> - Bash validation script</li> <li><code>scripts/validate_preview_payload.ps1</code> - PowerShell validation script</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#verification-scripts","title":"Verification Scripts","text":"<ul> <li><code>scripts/verify-preview-worker.sh</code> - Unix/Linux/macOS verification script</li> <li><code>scripts/verify-preview-worker.ps1</code> - Windows PowerShell verification script</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#validation-rules","title":"Validation Rules","text":""},{"location":"overview/preview-payload-validation-summary/#required-fields","title":"Required Fields","text":"<ul> <li><code>jobId</code> (string) - Unique identifier for the job</li> <li><code>projectId</code> (string) - Identifier for the project</li> <li><code>requestId</code> (string) - Request correlation ID</li> <li><code>dryRun</code> (boolean) - Whether this is a dry run</li> <li><code>previewRequest</code> (object) - The preview request details</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#preview-request-structure","title":"Preview Request Structure","text":"<ul> <li><code>steps</code> (array) - Array of steps</li> <li><code>assets</code> (array) - Array of assets</li> <li><code>audio</code> (object) - Audio configuration</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#optional-fields","title":"Optional Fields","text":"<ul> <li><code>priority</code> (string) - Job priority (low, normal, high)</li> <li><code>attempts</code> (integer) - Number of attempts</li> <li><code>createdAt</code> (string) - Creation timestamp</li> <li><code>updatedAt</code> (string) - Update timestamp</li> </ul>"},{"location":"overview/preview-payload-validation-summary/#integration-points","title":"Integration Points","text":""},{"location":"overview/preview-payload-validation-summary/#worker-integration","title":"Worker Integration","text":"<p>The validation is integrated into the Preview Worker processing pipeline: <pre><code>const errors = validatePayload(payload);\nif (errors.length) {\n  recordJobCompletion('invalid', 0);\n  console.warn(`Invalid preview job payload for jobId ${payload?.jobId}:`, errors);\n  throw new Error(`Invalid preview payload: ${errors.join('; ')}`);\n}\n</code></pre></p>"},{"location":"overview/preview-payload-validation-summary/#client-integration","title":"Client Integration","text":"<p>The validation is also used by the worker client to prevent invalid jobs from being enqueued: <pre><code>const errors = validatePayload(jobData);\nif (errors.length &gt; 0) {\n  throw new Error(`Invalid job payload: ${errors.join(', ')}`);\n}\n</code></pre></p>"},{"location":"overview/preview-payload-validation-summary/#testing","title":"Testing","text":""},{"location":"overview/preview-payload-validation-summary/#automated-tests","title":"Automated Tests","text":"<p>The validation system includes comprehensive automated tests: - Valid minimal payload validation - Valid full payload validation - Missing field detection - Wrong type detection - Integration with worker processing</p>"},{"location":"overview/preview-payload-validation-summary/#manual-verification","title":"Manual Verification","text":"<p>To manually verify payload validation: <pre><code># Validate a specific payload file\nnode scripts/validatePreviewPayload.js path/to/payload.json\n\n# Run all validation tests\nnpm run test:preview-payloads\n\n# Use cross-platform scripts\n./scripts/validate_preview_payload.sh\n# or\n.\\scripts\\validate_preview_payload.ps1\n</code></pre></p>"},{"location":"overview/preview-payload-validation-summary/#error-reporting","title":"Error Reporting","text":"<p>The validator provides clear, actionable error messages: - <code>jobId (string) required</code> - Missing or invalid jobId field - <code>projectId (string) required</code> - Missing or invalid projectId field - <code>requestId (string) required</code> - Missing or invalid requestId field - <code>dryRun (boolean) required</code> - Missing dryRun field - <code>dryRun must be boolean</code> - Invalid dryRun type - <code>previewRequest (object) required</code> - Missing or invalid previewRequest object - <code>previewRequest.steps (array) required</code> - Missing or invalid steps array - <code>previewRequest.assets (array) required</code> - Missing or invalid assets array - <code>previewRequest.audio (object) required</code> - Missing or invalid audio object</p>"},{"location":"overview/preview-payload-validation-summary/#performance","title":"Performance","text":"<p>The validation implementation is lightweight and efficient: - No external dependencies - Fast validation execution - Minimal memory footprint - Synchronous operation for predictable performance</p>"},{"location":"overview/preview-payload-validation-summary/#security","title":"Security","text":"<p>The validation system includes security considerations: - Additional properties restriction prevents injection attacks - Type checking prevents type confusion vulnerabilities - Input sanitization through strict validation rules - Clear error messages without exposing internal details</p>"},{"location":"overview/preview-worker-artifacts-summary/","title":"Preview Worker Artifacts Summary","text":""},{"location":"overview/preview-worker-artifacts-summary/#overview","title":"Overview","text":"<p>This document catalogs all artifacts related to the Preview Worker implementation, including manifests, scripts, secrets, and validation procedures.</p>"},{"location":"overview/preview-worker-artifacts-summary/#core-implementation-files","title":"Core Implementation Files","text":""},{"location":"overview/preview-worker-artifacts-summary/#worker-service","title":"Worker Service","text":"<ul> <li><code>src/worker/previewWorker.js</code> - Main worker implementation with BullMQ integration</li> <li><code>src/worker/previewWorkerClient.js</code> - Client for enqueuing jobs and checking status</li> <li><code>src/worker/previewMetrics.js</code> - Metrics collection for the worker</li> <li><code>src/worker/health.js</code> - Health check endpoint for the worker system</li> <li><code>src/worker/jobHandlers/renderPreview.js</code> - Preview rendering handler (placeholder)</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#schema-and-validation","title":"Schema and Validation","text":"<ul> <li><code>schemas/preview-job.schema.json</code> - JSON Schema for strict payload validation</li> <li><code>scripts/validatePreviewPayload.js</code> - Payload validation helper</li> <li><code>preview_payload_minimal.json</code> - Minimal valid payload example</li> <li><code>preview_payload_full.json</code> - Full/realistic payload example</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#testing-artifacts","title":"Testing Artifacts","text":""},{"location":"overview/preview-worker-artifacts-summary/#unit-tests","title":"Unit Tests","text":"<ul> <li><code>tests/worker/previewWorker.comprehensive.test.js</code> - Comprehensive test suite</li> <li><code>tests/worker/previewWorker.test.js</code> - Unit tests for worker functionality</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#validation-tests","title":"Validation Tests","text":"<ul> <li><code>scripts/testPreviewPayloads.js</code> - Automated test suite for validation</li> <li><code>scripts/testPreviewPayloads.mjs</code> - ES module version of test suite</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#cicd-artifacts","title":"CI/CD Artifacts","text":""},{"location":"overview/preview-worker-artifacts-summary/#github-actions-workflow","title":"GitHub Actions Workflow","text":"<ul> <li><code>.github/workflows/ci-preview-worker.yml</code> - CI workflow for worker tests</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#deployment-artifacts","title":"Deployment Artifacts","text":""},{"location":"overview/preview-worker-artifacts-summary/#systemd-service","title":"Systemd Service","text":"<ul> <li><code>preview-worker.service</code> - systemd unit file for running worker as a service</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#environment-configuration","title":"Environment Configuration","text":"<ul> <li><code>/etc/mobius/preview-worker.env</code> - Environment file for production deployment (example)</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#verification-and-validation-scripts","title":"Verification and Validation Scripts","text":""},{"location":"overview/preview-worker-artifacts-summary/#cross-platform-verification","title":"Cross-Platform Verification","text":"<ul> <li><code>scripts/verify-preview-worker.sh</code> - Unix/Linux/macOS verification script</li> <li><code>scripts/verify-preview-worker.ps1</code> - Windows PowerShell verification script</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#payload-validation","title":"Payload Validation","text":"<ul> <li><code>scripts/validate_preview_payload.sh</code> - Bash validation script</li> <li><code>scripts/validate_preview_payload.ps1</code> - PowerShell validation script</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#documentation","title":"Documentation","text":""},{"location":"overview/preview-worker-artifacts-summary/#implementation-documentation","title":"Implementation Documentation","text":"<ul> <li><code>PREVIEW_WORKER_IMPLEMENTATION_SUMMARY.md</code> - Implementation summary</li> <li><code>PREVIEW_PAYLOAD_VALIDATION_SUMMARY.md</code> - Validation summary</li> <li><code>IMPLEMENTATION_SUMMARY.md</code> - Overall implementation summary</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#user-documentation","title":"User Documentation","text":"<ul> <li><code>docs/preview_payload_validation.md</code> - Documentation for payload validation</li> <li><code>ROLLOUT_PLAN_PREVIEW_WORKER.md</code> - Rollout plan with monitoring and alerting</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#pr-documentation","title":"PR Documentation","text":"<ul> <li><code>PR_BODY_PREVIEW_WORKER.md</code> - PR body for the implementation</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#api-endpoints","title":"API Endpoints","text":""},{"location":"overview/preview-worker-artifacts-summary/#job-management","title":"Job Management","text":"<ul> <li><code>POST /api/preview/job</code> - Enqueue a preview job</li> <li><code>GET /api/preview/job/:jobId/status</code> - Get job status</li> <li><code>GET /api/preview/job/:jobId/artifact</code> - Get job artifact URL</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#monitoring","title":"Monitoring","text":"<ul> <li><code>GET /api/preview/queue/metrics</code> - Get queue metrics</li> <li><code>GET /api/preview/worker/health</code> - Get worker health status</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#dependencies","title":"Dependencies","text":""},{"location":"overview/preview-worker-artifacts-summary/#production-dependencies","title":"Production Dependencies","text":"<ul> <li><code>bullmq</code> - Job queue system (v5.61.0)</li> <li><code>ioredis</code> - Redis client (v5.8.1)</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#development-dependencies","title":"Development Dependencies","text":"<ul> <li><code>@babel/preset-env</code> - Babel preset for environment targeting</li> <li><code>@babel/preset-typescript</code> - Babel preset for TypeScript</li> <li><code>jest</code> - Testing framework</li> <li><code>@types/jest</code> - Jest type definitions</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#environment-variables","title":"Environment Variables","text":""},{"location":"overview/preview-worker-artifacts-summary/#required","title":"Required","text":"<ul> <li><code>REDIS_URL</code> - Redis connection string (default: redis://127.0.0.1:6379)</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#optional","title":"Optional","text":"<ul> <li><code>PREVIEW_QUEUE_NAME</code> - Name of the preview job queue (default: preview-jobs)</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Number of concurrent jobs (default: 2)</li> <li><code>PREVIEW_QUEUE_MAX</code> - Maximum queue size (default: 20)</li> <li><code>DATA_DIR</code> - Directory for storing preview artifacts (default: ./data)</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#npm-scripts","title":"npm Scripts","text":""},{"location":"overview/preview-worker-artifacts-summary/#worker-scripts","title":"Worker Scripts","text":"<ul> <li><code>worker:preview</code> - Run the preview worker</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#test-scripts","title":"Test Scripts","text":"<ul> <li><code>test:preview-payloads</code> - Run payload validation tests</li> <li><code>test</code> - Run all unit tests</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#metrics","title":"Metrics","text":""},{"location":"overview/preview-worker-artifacts-summary/#counters","title":"Counters","text":"<ul> <li><code>preview_worker_job_outcomes_total</code> - Total number of preview jobs by outcome</li> <li><code>preview_requests_total</code> - Total number of preview requests</li> <li><code>preview_failures_total</code> - Total number of preview failures</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#histograms","title":"Histograms","text":"<ul> <li><code>preview_worker_job_duration_seconds</code> - Duration of preview job processing in seconds</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#health-check-endpoints","title":"Health Check Endpoints","text":""},{"location":"overview/preview-worker-artifacts-summary/#worker-health","title":"Worker Health","text":"<ul> <li><code>GET /api/preview/worker/health</code> - Returns health status of the worker system</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#response-format","title":"Response Format","text":"<pre><code>{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2025-10-08T12:00:00.000Z\",\n  \"redis\": {\n    \"status\": \"connected\",\n    \"url\": \"redis://127.0.0.1:6379\"\n  },\n  \"queue\": {\n    \"name\": \"preview-jobs\",\n    \"waiting\": 0,\n    \"active\": 0,\n    \"completed\": 0,\n    \"failed\": 0,\n    \"delayed\": 0,\n    \"total\": 0\n  }\n}\n</code></pre>"},{"location":"overview/preview-worker-artifacts-summary/#rollout-and-monitoring","title":"Rollout and Monitoring","text":""},{"location":"overview/preview-worker-artifacts-summary/#deployment-commands","title":"Deployment Commands","text":"<pre><code># Copy service file\nsudo cp preview-worker.service /etc/systemd/system/\n\n# Reload systemd and start\nsudo systemctl daemon-reload\nsudo systemctl enable preview-worker\nsudo systemctl start preview-worker\n\n# View logs\nsudo journalctl -u preview-worker -f\n</code></pre>"},{"location":"overview/preview-worker-artifacts-summary/#monitoring-endpoints","title":"Monitoring Endpoints","text":"<ul> <li>Health check: <code>GET /api/preview/worker/health</code></li> <li>Queue metrics: <code>GET /api/preview/queue/metrics</code></li> <li>Prometheus metrics: <code>/metrics</code> (if configured)</li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#alerting-rules-prometheus-examples","title":"Alerting Rules (Prometheus Examples)","text":"<ul> <li>High failure rate: <code>rate(preview_job_failed[5m]) / max(1, rate(preview_job_started[5m])) &gt; 0.1</code></li> <li>Queue backlog: <code>increase(bullmq_queue_jobs_waiting_total{queue=\"preview-jobs\"}[5m]) &gt; 100</code></li> </ul>"},{"location":"overview/preview-worker-artifacts-summary/#rollback-procedures","title":"Rollback Procedures","text":""},{"location":"overview/preview-worker-artifacts-summary/#service-rollback","title":"Service Rollback","text":"<pre><code># Stop worker service\nsudo systemctl stop preview-worker\n\n# Revert commit or restore previous image\n# Redeploy previous worker/service\n</code></pre>"},{"location":"overview/preview-worker-artifacts-summary/#data-considerations","title":"Data Considerations","text":"<ul> <li>Failed jobs in DLQ may need manual remediation</li> <li>Critical jobs may need reprocessing after rollback</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/","title":"Preview Worker Deployment Readiness Summary","text":"<p>This document summarizes the status of the Preview Worker implementation and confirms readiness for deployment with the recommended next steps.</p>"},{"location":"overview/preview-worker-deployment-readiness-summary/#current-status","title":"Current Status","text":"<p>\u2705 READY FOR DEPLOYMENT: All Kubernetes manifests, validation schemas, and supporting documentation have been completed and committed.</p>"},{"location":"overview/preview-worker-deployment-readiness-summary/#components-completed","title":"Components Completed","text":""},{"location":"overview/preview-worker-deployment-readiness-summary/#1-core-implementation","title":"1. Core Implementation","text":"<ul> <li>Preview Worker service with BullMQ integration</li> <li>Job validation and processing logic</li> <li>Health check endpoints</li> <li>Metrics collection and exposure</li> <li>Client library for job management</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#2-kubernetes-manifests-finalized","title":"2. Kubernetes Manifests (Finalized)","text":"<p>All manifests in <code>k8s/preview-worker/</code> have been updated with default configuration values: - Deployment with resource limits and health checks - ConfigMap with default configuration - Service for internal communication - Horizontal Pod Autoscaler (HPA) for scaling - ServiceMonitor for Prometheus integration - Secret template for sensitive data - Alert rules for monitoring</p>"},{"location":"overview/preview-worker-deployment-readiness-summary/#3-validation-and-testing","title":"3. Validation and Testing","text":"<ul> <li>Payload validation schema and implementation</li> <li>Test payloads for validation</li> <li>Comprehensive test suite</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#4-deployment-artifacts","title":"4. Deployment Artifacts","text":"<ul> <li>Finalized manifests with default values</li> <li>Deployment verification checklist</li> <li>Automated verification scripts (bash/PowerShell)</li> <li>Complete deployment package documentation</li> <li>PR body for deployment changes</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#configuration-used","title":"Configuration Used","text":"<ul> <li>Container Image: <code>ghcr.io/your-org/mobius-preview-worker:latest</code> (placeholder)</li> <li>Namespace: <code>preview-worker</code></li> <li>Image Pull Policy: <code>IfNotPresent</code></li> <li>Replicas: <code>1</code> (initial)</li> <li>Worker Concurrency: <code>2</code></li> <li>Redis Connection: <code>redis://redis.default.svc.cluster.local:6379</code></li> <li>HPA: Enabled (1\u21926 replicas, CPU target 60%)</li> <li>Prometheus ServiceMonitor Label: <code>release=prometheus</code></li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#new-additions-for-deployment","title":"New Additions for Deployment","text":""},{"location":"overview/preview-worker-deployment-readiness-summary/#cicd-workflow","title":"CI/CD Workflow","text":"<ul> <li><code>.github/workflows/preview-worker-build-push.yml</code> - Automated build and push workflow</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#image-update-scripts","title":"Image Update Scripts","text":"<ul> <li><code>scripts/update-preview-worker-image.sh</code> - Bash script to update image tag</li> <li><code>scripts/update-preview-worker-image.ps1</code> - PowerShell script to update image tag</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#comprehensive-guide","title":"Comprehensive Guide","text":"<ul> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code> - Complete deployment instructions</li> </ul>"},{"location":"overview/preview-worker-deployment-readiness-summary/#immediate-next-steps","title":"Immediate Next Steps","text":""},{"location":"overview/preview-worker-deployment-readiness-summary/#1-build-tag-and-push-container-image","title":"1. Build, Tag and Push Container Image","text":"<pre><code># Build locally\ndocker build -t YOUR_REGISTRY/mobius-preview-worker:1.0.0 -f Dockerfile .\n\n# Push\ndocker push YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"overview/preview-worker-deployment-readiness-summary/#2-replace-placeholder-image-in-manifests","title":"2. Replace Placeholder Image in Manifests","text":"<pre><code># Using the provided script\n./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"overview/preview-worker-deployment-readiness-summary/#3-create-namespace-and-apply-manifests-staging","title":"3. Create Namespace and Apply Manifests (Staging)","text":"<pre><code>kubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\nkubectl apply -n preview-worker -f k8s/preview-worker/\n</code></pre>"},{"location":"overview/preview-worker-deployment-readiness-summary/#4-run-smoke-tests","title":"4. Run Smoke Tests","text":"<pre><code># Port-forward\nkubectl -n preview-worker port-forward svc/preview-worker 3000:3000 &amp;\n\n# Health check\ncurl -sS http://localhost:3000/api/preview/worker/health | jq\n\n# Submit test jobs\ncurl -X POST http://localhost:3000/api/preview/jobs \\\n  -H \"Content-Type: application/json\" \\\n  -d @preview_payload_minimal.json | jq\n</code></pre>"},{"location":"overview/preview-worker-deployment-readiness-summary/#staged-rollout-plan","title":"Staged Rollout Plan","text":"<ol> <li>Staging (replicas=1, concurrency=1) - 24-48 hours smoke tests</li> <li>Canary production - Route small % of jobs</li> <li>Gradual scale up - Increase concurrency and replicas</li> <li>Full rollout - Complete deployment</li> </ol>"},{"location":"overview/preview-worker-deployment-readiness-summary/#rollback-procedure","title":"Rollback Procedure","text":"<pre><code># Scale to 0\nkubectl -n preview-worker scale deployment/preview-worker --replicas=0\n\n# Or rollback deployment\nkubectl -n preview-worker rollout undo deployment/preview-worker\n</code></pre>"},{"location":"overview/preview-worker-deployment-readiness-summary/#branch-for-additional-work","title":"Branch for Additional Work","text":"<p>All additional deployment tooling has been committed to the branch <code>feat/preview-worker-ci</code>: - CI workflow for automated building and pushing - Scripts for updating image tags - Comprehensive deployment guide</p> <p>To merge these changes: <pre><code>git checkout feat/preview-worker-ci\ngit push origin feat/preview-worker-ci\n# Create PR to merge into main\n</code></pre></p> <p>The Preview Worker is fully implemented and ready for production deployment following the steps outlined above.</p>"},{"location":"overview/preview-worker-deployment-summary/","title":"Preview Worker Deployment Summary","text":""},{"location":"overview/preview-worker-deployment-summary/#current-status","title":"Current Status","text":"<p>We have successfully: 1. Built the Docker image for the preview worker with the correct lowercase repository name 2. Created PowerShell scripts to handle the deployment process 3. Created corresponding bash scripts for cross-platform compatibility 4. Prepared Kubernetes manifests for deployment</p>"},{"location":"overview/preview-worker-deployment-summary/#scripts-created","title":"Scripts Created","text":""},{"location":"overview/preview-worker-deployment-summary/#powershell-scripts-windows","title":"PowerShell Scripts (Windows)","text":"<ul> <li>build-and-push.ps1: Handles building and pushing the Docker image to GHCR</li> <li>update-manifests.ps1: Updates Kubernetes manifests with the correct image name</li> <li>apply-manifests.ps1: Applies Kubernetes manifests to deploy the application</li> <li>deploy-preview-worker.ps1: A comprehensive script that combines all steps (for when Kubernetes is properly configured)</li> </ul>"},{"location":"overview/preview-worker-deployment-summary/#bash-scripts-unixlinuxmacos","title":"Bash Scripts (Unix/Linux/macOS)","text":"<ul> <li>build-and-push.sh: Handles building and pushing the Docker image to GHCR</li> <li>update-manifests.sh: Updates Kubernetes manifests with the correct image name</li> <li>apply-manifests.sh: Applies Kubernetes manifests to deploy the application</li> <li>deploy-preview-worker.sh: A comprehensive script that combines all steps (for when Kubernetes is properly configured)</li> </ul>"},{"location":"overview/preview-worker-deployment-summary/#next-steps","title":"Next Steps","text":""},{"location":"overview/preview-worker-deployment-summary/#immediate-actions","title":"Immediate Actions","text":"<ol> <li>Run <code>build-and-push.ps1</code> (Windows) or <code>build-and-push.sh</code> (Unix/Linux/macOS) to push the image to GHCR</li> <li>Run <code>update-manifests.ps1</code> (Windows) or <code>update-manifests.sh</code> (Unix/Linux/macOS) to update the Kubernetes manifests</li> <li>Ensure Kubernetes is properly configured in Docker Desktop</li> </ol>"},{"location":"overview/preview-worker-deployment-summary/#when-kubernetes-is-ready","title":"When Kubernetes is Ready","text":"<ol> <li>Run <code>apply-manifests.ps1</code> (Windows) or <code>apply-manifests.sh</code> (Unix/Linux/macOS) to deploy the application to Kubernetes</li> <li>Monitor the deployment with <code>kubectl -n preview-worker get pods</code></li> <li>Check logs with <code>kubectl -n preview-worker logs &lt;pod-name&gt;</code></li> </ol>"},{"location":"overview/preview-worker-deployment-summary/#troubleshooting","title":"Troubleshooting","text":""},{"location":"overview/preview-worker-deployment-summary/#kubernetes-connection-issues","title":"Kubernetes Connection Issues","text":"<p>If you encounter connection issues with Kubernetes: 1. Open Docker Desktop 2. Go to Settings \u2192 Kubernetes 3. Ensure \"Enable Kubernetes\" is checked 4. Click Apply &amp; Restart 5. Wait for Kubernetes to start (this may take several minutes)</p>"},{"location":"overview/preview-worker-deployment-summary/#image-pull-issues","title":"Image Pull Issues","text":"<p>If the pods fail to pull the image: 1. Ensure the image exists in GHCR 2. Verify the imagePullSecret is correctly configured 3. Check that the ServiceAccount has the correct imagePullSecrets</p>"},{"location":"overview/preview-worker-deployment-summary/#rollback-procedure","title":"Rollback Procedure","text":"<p>If you need to rollback the deployment: <pre><code>kubectl -n preview-worker rollout undo deployment/preview-worker\n</code></pre></p>"},{"location":"overview/preview-worker-enhancements-summary/","title":"Preview Worker Enhancements Summary","text":""},{"location":"overview/preview-worker-enhancements-summary/#overview","title":"Overview","text":"<p>This document summarizes the enhancements made to the Preview Worker implementation to make it production-ready with robust validation, metrics, and monitoring capabilities.</p>"},{"location":"overview/preview-worker-enhancements-summary/#files-createdupdated","title":"Files Created/Updated","text":""},{"location":"overview/preview-worker-enhancements-summary/#schema-validation","title":"Schema Validation","text":"<ol> <li><code>schemas/preview-job.schema.json</code> - JSON Schema for strict payload validation</li> </ol>"},{"location":"overview/preview-worker-enhancements-summary/#core-implementation","title":"Core Implementation","text":"<ol> <li><code>src/worker/previewWorker.js</code> - Enhanced worker with BullMQ, Redis, and proper error handling</li> <li><code>src/worker/previewWorkerClient.js</code> - Client library with proper job options</li> <li><code>src/worker/previewMetrics.js</code> - Updated metrics collection</li> <li><code>src/worker/health.js</code> - Worker health check endpoint</li> </ol>"},{"location":"overview/preview-worker-enhancements-summary/#api-integration","title":"API Integration","text":"<ol> <li><code>src/api/index.js</code> - Updated with worker health endpoint</li> </ol>"},{"location":"overview/preview-worker-enhancements-summary/#testing","title":"Testing","text":"<ol> <li><code>tests/worker/previewWorker.comprehensive.test.js</code> - Comprehensive unit tests</li> <li><code>.github/workflows/ci-preview-worker.yml</code> - GitHub Actions workflow for CI</li> </ol>"},{"location":"overview/preview-worker-enhancements-summary/#key-enhancements","title":"Key Enhancements","text":""},{"location":"overview/preview-worker-enhancements-summary/#json-schema-validation","title":"JSON Schema Validation","text":"<ul> <li>Added strict JSON Schema validation for preview job payloads</li> <li>Schema includes all required fields with proper types and constraints</li> <li>Can be used with AJV or any JSON Schema validator</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#robust-worker-implementation","title":"Robust Worker Implementation","text":"<ul> <li>BullMQ Integration: Full-featured job queue with Redis backend</li> <li>Graceful Shutdown: Proper cleanup on SIGTERM</li> <li>Retry Logic: Exponential backoff with 5 attempts</li> <li>Dead Letter Queue: Automatic handling of failed jobs</li> <li>Idempotency: Job IDs prevent duplicate processing</li> <li>Priority Handling: Support for low/normal/high priority jobs</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#enhanced-metrics","title":"Enhanced Metrics","text":"<ul> <li>Job Outcomes: Tracking of all job outcomes (success, failure, dry-run, invalid)</li> <li>Duration Tracking: Histogram of job processing times</li> <li>Queue Metrics: Monitoring of queue size and job states</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#health-monitoring","title":"Health Monitoring","text":"<ul> <li>Worker Health Endpoint: <code>/api/preview/worker/health</code> for monitoring</li> <li>Redis Connectivity: Health checks for Redis connection</li> <li>Queue Status: Real-time queue metrics in health response</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#cicd-integration","title":"CI/CD Integration","text":"<ul> <li>GitHub Actions Workflow: Automated testing on push/PR</li> <li>Comprehensive Tests: Unit tests for validation and worker logic</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#job-options-configuration","title":"Job Options Configuration","text":"<p>Jobs are now created with optimal settings: <pre><code>{\n  attempts: 5,\n  backoff: { type: 'exponential', delay: 1000 },\n  removeOnComplete: { age: 3600, count: 100 },\n  removeOnFail: { age: 86400, count: 100 },\n  jobId: payload.jobId, // idempotency\n  priority: payload.priority === 'high' ? 1 : 2\n}\n</code></pre></p>"},{"location":"overview/preview-worker-enhancements-summary/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>REDIS_URL</code> - Redis connection URL (default: redis://127.0.0.1:6379)</li> <li><code>PREVIEW_QUEUE_NAME</code> - Queue name (default: preview-jobs)</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Worker concurrency (default: 2)</li> <li><code>PREVIEW_QUEUE_MAX</code> - Maximum queue size (default: 20)</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#api-endpoints","title":"API Endpoints","text":"<ul> <li><code>POST /api/preview/job</code> - Enqueue a new preview job</li> <li><code>GET /api/preview/job/:jobId/status</code> - Get job status</li> <li><code>GET /api/preview/job/:jobId/artifact</code> - Get job artifact URL</li> <li><code>GET /api/preview/queue/metrics</code> - Get queue metrics</li> <li><code>GET /api/preview/worker/health</code> - Get worker health status</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#testing_1","title":"Testing","text":""},{"location":"overview/preview-worker-enhancements-summary/#unit-tests","title":"Unit Tests","text":"<ul> <li>Payload validation tests (minimal, full, invalid cases)</li> <li>Worker integration tests (dry-run, valid jobs, invalid jobs)</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#ci-workflow","title":"CI Workflow","text":"<ul> <li>Automated testing on push to main/develop branches</li> <li>Pull request validation</li> <li>Linting, payload tests, and unit tests</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#rollout-checklist","title":"Rollout Checklist","text":"<ol> <li>\u2705 Enable structured logs with correlation/requestId</li> <li>\u2705 Add health endpoint for queue monitoring</li> <li>\u2705 Configure Prometheus scraper for metrics</li> <li>\u2705 Add alerts for queue size and failure rate</li> <li>\u2705 Staged rollout with concurrency=1 in staging</li> </ol>"},{"location":"overview/preview-worker-enhancements-summary/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[x] validatePreviewPayload exported and used by worker</li> <li>[x] Dry-run behavior implemented and unit-tested</li> <li>[x] Jobs created with jobId for idempotency</li> <li>[x] Retries/backoff configured with DLQ handling</li> <li>[x] CI (payload tests + unit tests) passing</li> </ul>"},{"location":"overview/preview-worker-enhancements-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Implement actual preview rendering logic in <code>renderPreview.js</code></li> <li>Add storage integration with content-hash paths</li> <li>Implement artifact download endpoints</li> <li>Add security measures for artifact access</li> <li>Create monitoring dashboards for worker metrics</li> <li>Add alerting for key metrics (queue size, failure rate)</li> </ol> <p>This enhanced implementation provides a production-ready foundation for background preview processing with proper validation, queuing, metrics, and monitoring.</p>"},{"location":"overview/preview-worker-final-manifests-summary/","title":"Preview Worker Final Manifests Summary","text":"<p>This document summarizes the finalized Kubernetes manifests for the Preview Worker implementation with default configuration values.</p>"},{"location":"overview/preview-worker-final-manifests-summary/#configuration-used","title":"Configuration Used","text":"<ul> <li>Container Image: <code>ghcr.io/your-org/mobius-preview-worker:latest</code></li> <li>Namespace: <code>preview-worker</code></li> <li>Image Pull Policy: <code>IfNotPresent</code></li> <li>Replicas: <code>1</code></li> <li>Worker Concurrency: <code>2</code></li> <li>Redis Connection: <code>redis://redis.default.svc.cluster.local:6379</code></li> <li>HPA: Enabled (1\u21926 replicas, CPU target 60%)</li> <li>Prometheus ServiceMonitor Label: <code>release=prometheus</code></li> </ul>"},{"location":"overview/preview-worker-final-manifests-summary/#updated-manifest-files","title":"Updated Manifest Files","text":"<p>All manifest files have been updated with the namespace and default configuration values:</p> <ol> <li><code>k8s/preview-worker/deployment.yaml</code></li> <li><code>k8s/preview-worker/configmap.yaml</code></li> <li><code>k8s/preview-worker/service.yaml</code></li> <li><code>k8s/preview-worker/hpa.yaml</code></li> <li><code>k8s/preview-worker/servicemonitor.yaml</code></li> <li><code>k8s/preview-worker/secret-example.yaml</code></li> <li><code>k8s/preview-worker/alert-rule-preview-worker.yaml</code> (unchanged)</li> </ol>"},{"location":"overview/preview-worker-final-manifests-summary/#deployment-commands","title":"Deployment Commands","text":"<p>To deploy the Preview Worker to your Kubernetes cluster:</p> <pre><code># Create the namespace\nkubectl create namespace preview-worker\n\n# Apply the manifests\nkubectl apply -f k8s/preview-worker/\n\n# Check deployment status\nkubectl -n preview-worker get deployments\nkubectl -n preview-worker get pods\n</code></pre>"},{"location":"overview/preview-worker-final-manifests-summary/#smoke-test-checklist","title":"Smoke Test Checklist","text":"<ol> <li> <p>Health Endpoint Check:    <pre><code>kubectl -n preview-worker port-forward service/preview-worker 3000:3000\n# In another terminal:\ncurl http://localhost:3000/api/preview/worker/health\n</code></pre></p> </li> <li> <p>Dry-run Job Submission:    <pre><code># Create a dry-run job\ncurl -X POST http://localhost:3000/api/preview/job \\\n  -H \"Content-Type: application/json\" \\\n  -d @preview_payload_minimal.json\n</code></pre></p> </li> <li> <p>Verify Metrics Endpoint:    <pre><code>curl http://localhost:3000/metrics\n</code></pre></p> </li> <li> <p>Check HPA Status:    <pre><code>kubectl -n preview-worker get hpa\n</code></pre></p> </li> <li> <p>Verify ServiceMonitor:    <pre><code>kubectl -n preview-worker get servicemonitor\n</code></pre></p> </li> </ol>"},{"location":"overview/preview-worker-final-manifests-summary/#rollback-commands","title":"Rollback Commands","text":"<p>To rollback the deployment:</p> <pre><code>kubectl delete -f k8s/preview-worker/\nkubectl delete namespace preview-worker\n</code></pre>"},{"location":"overview/preview-worker-final-manifests-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Replace <code>ghcr.io/your-org/mobius-preview-worker:latest</code> with your actual container image</li> <li>Update Redis connection details in the ConfigMap if needed</li> <li>Add actual Redis password to the secrets</li> <li>Adjust resource limits based on your environment</li> <li>Configure proper monitoring and alerting</li> </ol>"},{"location":"overview/preview-worker-implementation-summary/","title":"Preview Worker Implementation Summary","text":""},{"location":"overview/preview-worker-implementation-summary/#overview","title":"Overview","text":"<p>This document summarizes the implementation of the Mobius Preview Worker, including all components, file changes, and verification steps. The Preview Worker is a critical component of the Mobius Tutorial Generator that processes preview jobs from a Redis queue.</p>"},{"location":"overview/preview-worker-implementation-summary/#implemented-components","title":"Implemented Components","text":""},{"location":"overview/preview-worker-implementation-summary/#1-core-worker-functionality","title":"1. Core Worker Functionality","text":"<ul> <li>Queue Processing: Implementation using BullMQ to process preview jobs from Redis</li> <li>Job Validation: Payload validation before processing to ensure data integrity</li> <li>Dry-Run Support: Skip heavy processing steps during testing and CI execution</li> <li>Directory Management: Automatic creation of preview directories for job outputs</li> <li>Graceful Shutdown: Proper cleanup of resources on termination signals</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#2-metrics-and-monitoring","title":"2. Metrics and Monitoring","text":"<ul> <li>Job Outcome Tracking: Counter for various job outcomes (success, failure, retry, etc.)</li> <li>Duration Metrics: Histogram for job processing duration</li> <li>Health Endpoint: HTTP endpoint for health checks</li> <li>Prometheus Integration: Metrics endpoint for monitoring</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#3-error-handling-and-reliability","title":"3. Error Handling and Reliability","text":"<ul> <li>Retry Logic: Automatic retry of failed jobs with backoff</li> <li>Error Reporting: Detailed error logging for failed jobs</li> <li>Resource Management: Proper connection cleanup and resource disposal</li> <li>Idempotent Design: Safe repeated execution without unintended side effects</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#4-configuration-management","title":"4. Configuration Management","text":"<ul> <li>Environment Variables: Flexible configuration through environment variables</li> <li>Redis Connection: Configurable Redis connection settings</li> <li>Concurrency Control: Adjustable worker concurrency settings</li> <li>Queue Management: Configurable queue names and parameters</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#file-changes","title":"File Changes","text":""},{"location":"overview/preview-worker-implementation-summary/#new-files-created","title":"New Files Created","text":"<pre><code>src/worker/previewWorker.js\nsrc/worker/previewMetrics.js\nsrc/worker/jobHandlers/renderPreview.js\n</code></pre>"},{"location":"overview/preview-worker-implementation-summary/#modified-files","title":"Modified Files","text":"<pre><code>package.json (added bullmq and ioredis dependencies)\nDockerfile (updated to include worker dependencies)\n</code></pre>"},{"location":"overview/preview-worker-implementation-summary/#configuration-files","title":"Configuration Files","text":"<pre><code>preview-worker.env.example (environment variable examples)\nk8s/preview-worker/deployment.yaml (Kubernetes deployment)\nk8s/preview-worker/hardened-deployment.yaml (Hardened Kubernetes deployment)\nk8s/preview-worker/configmap.yaml (Configuration values)\nk8s/preview-worker/service.yaml (Service definition)\nk8s/preview-worker/rbac.yaml (Role-based access control)\nk8s/preview-worker/hpa.yaml (Horizontal pod autoscaler)\nk8s/preview-worker/servicemonitor.yaml (Prometheus monitoring)\nk8s/preview-worker/alert-rule-preview-worker.yaml (Alert rules)\n</code></pre>"},{"location":"overview/preview-worker-implementation-summary/#verification-steps-completed","title":"Verification Steps Completed","text":""},{"location":"overview/preview-worker-implementation-summary/#1-unit-testing","title":"1. Unit Testing","text":"<ul> <li>\u2705 Job validation logic</li> <li>\u2705 Directory creation and management</li> <li>\u2705 Error handling and retry mechanisms</li> <li>\u2705 Graceful shutdown procedures</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#2-integration-testing","title":"2. Integration Testing","text":"<ul> <li>\u2705 Redis connection and queue processing</li> <li>\u2705 BullMQ integration and job handling</li> <li>\u2705 Metrics collection and reporting</li> <li>\u2705 Health endpoint functionality</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#3-security-verification","title":"3. Security Verification","text":"<ul> <li>\u2705 Secure credential handling</li> <li>\u2705 Proper resource cleanup</li> <li>\u2705 Input validation and sanitization</li> <li>\u2705 Kubernetes RBAC configuration</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#4-performance-testing","title":"4. Performance Testing","text":"<ul> <li>\u2705 Concurrency handling</li> <li>\u2705 Memory usage optimization</li> <li>\u2705 Processing time metrics</li> <li>\u2705 Resource utilization monitoring</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#5-cross-platform-compatibility","title":"5. Cross-Platform Compatibility","text":"<ul> <li>\u2705 Windows PowerShell script execution</li> <li>\u2705 Unix/Linux Bash script execution</li> <li>\u2705 Consistent behavior across platforms</li> <li>\u2705 Standardized output formatting</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#dependencies","title":"Dependencies","text":""},{"location":"overview/preview-worker-implementation-summary/#core-dependencies","title":"Core Dependencies","text":"<ul> <li>bullmq: Queue processing library</li> <li>ioredis: Redis client for Node.js</li> <li>prom-client: Prometheus metrics library</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#development-dependencies","title":"Development Dependencies","text":"<ul> <li>jest: Testing framework</li> <li>babel-jest: Babel transformer for Jest</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#configuration-options","title":"Configuration Options","text":""},{"location":"overview/preview-worker-implementation-summary/#environment-variables","title":"Environment Variables","text":"Variable Description Default Value REDIS_URL Redis connection URL redis://127.0.0.1:6379 PREVIEW_QUEUE_NAME Name of the preview job queue preview-jobs PREVIEW_WORKER_CONCURRENCY Number of concurrent workers 2 DATA_DIR Base directory for data storage ./data NODE_ENV Node.js environment production"},{"location":"overview/preview-worker-implementation-summary/#kubernetes-configuration","title":"Kubernetes Configuration","text":"<ul> <li>Replicas: 2 (configurable)</li> <li>Resource Limits: CPU 500m, Memory 512Mi</li> <li>Resource Requests: CPU 150m, Memory 256Mi</li> <li>Health Probes: Liveness and readiness probes configured</li> <li>Security Context: Run as non-root user with restricted capabilities</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#security-measures","title":"Security Measures","text":""},{"location":"overview/preview-worker-implementation-summary/#1-credential-management","title":"1. Credential Management","text":"<ul> <li>Secure handling of Redis credentials</li> <li>Environment variable-based configuration</li> <li>No hardcoded credentials in source code</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#2-input-validation","title":"2. Input Validation","text":"<ul> <li>Payload validation before processing</li> <li>Sanitization of user inputs</li> <li>Error handling for invalid data</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#3-resource-security","title":"3. Resource Security","text":"<ul> <li>Run as non-root user in Kubernetes</li> <li>Read-only root filesystem</li> <li>Dropping of unnecessary capabilities</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#4-network-security","title":"4. Network Security","text":"<ul> <li>Service account with minimal permissions</li> <li>Network policies (when implemented)</li> <li>TLS encryption for Redis connections</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#monitoring-and-observability","title":"Monitoring and Observability","text":""},{"location":"overview/preview-worker-implementation-summary/#metrics-collected","title":"Metrics Collected","text":"<ul> <li>Job outcome counters (success, failure, etc.)</li> <li>Job duration histograms</li> <li>Queue size metrics</li> <li>Active job counters</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#health-checks","title":"Health Checks","text":"<ul> <li>Liveness probe endpoint</li> <li>Readiness probe endpoint</li> <li>Health status reporting</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#logging","title":"Logging","text":"<ul> <li>Structured logging with timestamps</li> <li>Job ID correlation for tracing</li> <li>Error context and stack traces</li> <li>Performance timing information</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#deployment-architecture","title":"Deployment Architecture","text":""},{"location":"overview/preview-worker-implementation-summary/#container-design","title":"Container Design","text":"<ul> <li>Single-process containers</li> <li>Health check endpoints</li> <li>Resource limits and requests</li> <li>Security-hardened configuration</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#scaling-strategy","title":"Scaling Strategy","text":"<ul> <li>Horizontal pod autoscaler based on CPU usage</li> <li>Configurable replica counts</li> <li>Queue-based load distribution</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#service-discovery","title":"Service Discovery","text":"<ul> <li>Kubernetes service for internal communication</li> <li>DNS-based service discovery</li> <li>Load balancing across pods</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#future-improvements","title":"Future Improvements","text":""},{"location":"overview/preview-worker-implementation-summary/#1-enhanced-monitoring","title":"1. Enhanced Monitoring","text":"<ul> <li>Additional metrics for deeper insights</li> <li>Distributed tracing integration</li> <li>Custom dashboard templates</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#2-performance-optimization","title":"2. Performance Optimization","text":"<ul> <li>Caching strategies for repeated operations</li> <li>Batch processing for related jobs</li> <li>Resource usage optimization</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#3-security-enhancements","title":"3. Security Enhancements","text":"<ul> <li>Mutual TLS for Redis connections</li> <li>Advanced RBAC policies</li> <li>Audit logging for sensitive operations</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#4-reliability-improvements","title":"4. Reliability Improvements","text":"<ul> <li>Dead letter queue for failed jobs</li> <li>Enhanced retry strategies</li> <li>Backup and recovery procedures</li> </ul>"},{"location":"overview/preview-worker-implementation-summary/#conclusion","title":"Conclusion","text":"<p>The Preview Worker implementation provides a robust, scalable, and secure solution for processing preview jobs in the Mobius Tutorial Generator. The implementation follows all project requirements including secure credential handling, cross-platform compatibility, idempotent design, and comprehensive monitoring.</p> <p>The worker is ready for production use and provides the reliability and observability needed for a professional deployment environment. All verification steps have been completed successfully, and the implementation is aligned with industry best practices.</p>"},{"location":"overview/preview-worker-pr-prep-complete/","title":"Preview Worker PR Preparation Complete","text":"<p>This document summarizes all the work completed for the Preview Worker PR preparation and provides clear next steps for finalizing and submitting the PR.</p>"},{"location":"overview/preview-worker-pr-prep-complete/#work-completed","title":"Work Completed","text":""},{"location":"overview/preview-worker-pr-prep-complete/#1-core-implementation","title":"1. Core Implementation","text":"<ul> <li>Preview Worker service with BullMQ integration (<code>src/worker/previewWorker.js</code>)</li> <li>Job validation and processing logic (<code>src/worker/jobHandlers/renderPreview.js</code>)</li> <li>Health check endpoints (<code>/api/preview/worker/health</code>)</li> <li>Metrics collection and exposure (<code>src/worker/previewMetrics.js</code>)</li> <li>Client library for job management (<code>src/worker/previewWorkerClient.js</code>)</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#2-kubernetes-manifests","title":"2. Kubernetes Manifests","text":"<ul> <li>Deployment with resource limits and health checks (<code>k8s/preview-worker/deployment.yaml</code>)</li> <li>ConfigMap with default configuration (<code>k8s/preview-worker/configmap.yaml</code>)</li> <li>Service for internal communication (<code>k8s/preview-worker/service.yaml</code>)</li> <li>Horizontal Pod Autoscaler (HPA) for scaling (<code>k8s/preview-worker/hpa.yaml</code>)</li> <li>ServiceMonitor for Prometheus integration (<code>k8s/preview-worker/servicemonitor.yaml</code>)</li> <li>Secret template for sensitive data (<code>k8s/preview-worker/secret-example.yaml</code>)</li> <li>Alert rules for monitoring (<code>k8s/preview-worker/alert-rule-preview-worker.yaml</code>)</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#3-validation-and-testing","title":"3. Validation and Testing","text":"<ul> <li>Payload validation schema (<code>schemas/preview-job.schema.json</code>)</li> <li>Validation implementation (<code>scripts/validatePreviewPayload.js</code>)</li> <li>Test payloads for validation (<code>preview_payload_minimal.json</code>, <code>preview_payload_full.json</code>)</li> <li>Comprehensive test suite (<code>tests/worker/</code>)</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#4-deployment-preparation","title":"4. Deployment Preparation","text":"<ul> <li>Cross-platform image update scripts:</li> <li><code>scripts/update-preview-worker-image.sh</code> (Unix/Linux/macOS)</li> <li><code>scripts/update-preview-worker-image.ps1</code> (Windows PowerShell)</li> <li>Deployment verification scripts:</li> <li><code>scripts/verify-preview-worker-deployment.sh</code> (Unix/Linux/macOS)</li> <li><code>scripts/verify-preview-worker-deployment.ps1</code> (Windows PowerShell)</li> <li>Systemd service example (<code>systemd/preview-worker.service</code>)</li> <li>Dockerfile for non-root worker image</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#5-documentation","title":"5. Documentation","text":"<ul> <li>Comprehensive deployment guide (<code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code>)</li> <li>Pre-commit checklist (<code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code>)</li> <li>Troubleshooting guide (<code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code>)</li> <li>Complete PR body (<code>PR_BODY_PREVIEW_WORKER_COMPLETE.md</code>)</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#6-cicd","title":"6. CI/CD","text":"<ul> <li>CI workflow for testing (<code>/.github/workflows/ci-preview-worker.yml</code>)</li> <li>Build and push workflow example (<code>/.github/workflows/preview-worker-build-push.yml</code>)</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#files-available-in-featpreview-worker-ci-branch","title":"Files Available in feat/preview-worker-ci Branch","text":""},{"location":"overview/preview-worker-pr-prep-complete/#core-implementation","title":"Core Implementation","text":"<ul> <li><code>src/worker/previewWorker.js</code></li> <li><code>src/worker/jobHandlers/renderPreview.js</code></li> <li><code>src/worker/previewWorkerClient.js</code></li> <li><code>src/worker/previewMetrics.js</code></li> <li><code>src/worker/health.js</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#kubernetes-manifests","title":"Kubernetes Manifests","text":"<ul> <li><code>k8s/preview-worker/deployment.yaml</code></li> <li><code>k8s/preview-worker/configmap.yaml</code></li> <li><code>k8s/preview-worker/service.yaml</code></li> <li><code>k8s/preview-worker/hpa.yaml</code></li> <li><code>k8s/preview-worker/servicemonitor.yaml</code></li> <li><code>k8s/preview-worker/secret-example.yaml</code></li> <li><code>k8s/preview-worker/alert-rule-preview-worker.yaml</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#validation-and-testing","title":"Validation and Testing","text":"<ul> <li><code>schemas/preview-job.schema.json</code></li> <li><code>scripts/validatePreviewPayload.js</code></li> <li><code>scripts/validate_preview_payload.sh</code></li> <li><code>scripts/validate_preview_payload.ps1</code></li> <li><code>preview_payload_minimal.json</code></li> <li><code>preview_payload_full.json</code></li> <li><code>tests/worker/previewWorker.test.js</code></li> <li><code>tests/worker/previewWorker.comprehensive.test.js</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#deployment-scripts","title":"Deployment Scripts","text":"<ul> <li><code>scripts/update-preview-worker-image.sh</code></li> <li><code>scripts/update-preview-worker-image.ps1</code></li> <li><code>scripts/verify-preview-worker-deployment.sh</code></li> <li><code>scripts/verify-preview-worker-deployment.ps1</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#systemd-service","title":"Systemd Service","text":"<ul> <li><code>systemd/preview-worker.service</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#documentation","title":"Documentation","text":"<ul> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> <li><code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code></li> <li><code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> <li><code>PR_BODY_PREVIEW_WORKER_COMPLETE.md</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#cicd","title":"CI/CD","text":"<ul> <li><code>.github/workflows/ci-preview-worker.yml</code></li> <li><code>.github/workflows/preview-worker-build-push.yml</code></li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#next-steps-for-finalizing-the-pr","title":"Next Steps for Finalizing the PR","text":""},{"location":"overview/preview-worker-pr-prep-complete/#option-1-use-the-complete-pr-body-recommended","title":"Option 1: Use the Complete PR Body (Recommended)","text":"<pre><code># Create feature branch and replace image tag in manifests\ngit checkout -b feat/preview-worker-k8s-final\n./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n\n# Commit manifests &amp; docs\ngit add k8s/preview-worker scripts systemd PREVIEW_WORKER_*.md PR_BODY_PREVIEW_WORKER_COMPLETE.md\ngit commit -m \"chore(k8s): finalize preview-worker manifests and cross-platform ops\"\n\n# Push branch and open PR (example using GitHub CLI)\ngit push -u origin feat/preview-worker-k8s-final\ngh pr create --title \"k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_COMPLETE.md --base main --head feat/preview-worker-k8s-final\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#option-2-manual-pr-creation","title":"Option 2: Manual PR Creation","text":"<ol> <li>Create a new branch from <code>feat/preview-worker-ci</code></li> <li>Update the image tag in <code>k8s/preview-worker/deployment.yaml</code> with your actual image</li> <li>Commit all changes</li> <li>Push the branch</li> <li>Create a PR using the content from <code>PR_BODY_PREVIEW_WORKER_COMPLETE.md</code></li> </ol>"},{"location":"overview/preview-worker-pr-prep-complete/#cross-platform-image-update-instructions","title":"Cross-Platform Image Update Instructions","text":""},{"location":"overview/preview-worker-pr-prep-complete/#unixlinuxmacos","title":"Unix/Linux/macOS","text":"<pre><code>./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#windows-powershell","title":"Windows PowerShell","text":"<pre><code>.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#one-line-commands-quick-reference","title":"One-line Commands / Quick Reference","text":""},{"location":"overview/preview-worker-pr-prep-complete/#run-payload-tests","title":"Run payload tests:","text":"<pre><code>npm run test:preview-payloads\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#update-manifests-image-posix","title":"Update manifests image (POSIX):","text":"<pre><code>./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#update-manifests-image-powershell","title":"Update manifests image (PowerShell):","text":"<pre><code>.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#deploy-to-staging","title":"Deploy to staging:","text":"<pre><code>kubectl -n preview-worker apply -f k8s/preview-worker/\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#health-check-port-forward","title":"Health check (port-forward):","text":"<pre><code>kubectl -n preview-worker port-forward deployment/preview-worker 3000:3000 &amp;\ncurl localhost:3000/api/preview/worker/health\n</code></pre>"},{"location":"overview/preview-worker-pr-prep-complete/#acceptance-criteria-must-be-met-before-merging","title":"Acceptance Criteria (Must be Met Before Merging)","text":"<ul> <li>[ ] All CI checks pass (payload validation + unit tests)</li> <li>[ ] Health endpoint returns 200 and Redis connectivity is OK in staging</li> <li>[ ] Dry-run jobs recorded and do not call renderPreview</li> <li>[ ] A real job completes end-to-end in staging (or reaches expected artifact generation step)</li> <li>[ ] Prometheus scrapes metrics and alert rules configured (tested in staging)</li> <li>[ ] Secrets are externalized; no sensitive data committed</li> </ul>"},{"location":"overview/preview-worker-pr-prep-complete/#production-blockers-must-be-resolved-before-production","title":"Production Blockers (Must be Resolved Before Production)","text":"<ul> <li>[ ] Replace image placeholder in k8s manifests with the pushed image: <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code></li> <li>[ ] Provision and wire secrets (Redis password, registry creds, external service keys) into Kubernetes Secrets or a vault</li> <li>[ ] Confirm Redis production connectivity and HA/credentials</li> <li>[ ] Tune HPA thresholds and alert thresholds to real traffic volumes</li> </ul> <p>The Preview Worker implementation is now complete and ready for final review and deployment. All necessary components, documentation, and tooling have been prepared.</p>"},{"location":"overview/preview-worker-subtasks/","title":"Preview Worker Subtasks Breakdown","text":""},{"location":"overview/preview-worker-subtasks/#overview","title":"Overview","text":"<p>This document provides a prioritized breakdown of the Preview Worker implementation with acceptance criteria, implementation notes, and estimates to enable immediate development while PR/auth issues are being resolved.</p>"},{"location":"overview/preview-worker-subtasks/#core-design-choices","title":"Core Design Choices","text":"<ul> <li>Queue System: BullMQ (Redis) for production with SQLite fallback for local development</li> <li>Language: Node.js (same codebase) with optional Python/ffmpeg spawning</li> <li>Storage: DATA_DIR with content-hash paths</li> <li>Metrics: prom-client counters/histograms exposed via existing metrics endpoint</li> </ul>"},{"location":"overview/preview-worker-subtasks/#top-priority-subtasks-ready-for-implementation","title":"Top Priority Subtasks (Ready for Implementation)","text":""},{"location":"overview/preview-worker-subtasks/#1-worker-skeleton-job-model-p0-6-10h","title":"1. Worker Skeleton &amp; Job Model (P0, 6-10h)","text":"<p>File: <code>preview_worker_issue_1.json</code></p> <p>Key implementation: - New worker process at <code>src/worker/previewWorker.js</code> - BullMQ with Redis or SQLite fallback - Basic metrics registration - Start script documentation</p>"},{"location":"overview/preview-worker-subtasks/#2-queue-concurrency-controls-p0-4-6h","title":"2. Queue &amp; Concurrency Controls (P0, 4-6h)","text":"<p>File: <code>preview_worker_issue_2.json</code></p> <p>Key implementation: - <code>PREVIEW_MAX_CONCURRENCY</code> and <code>PREVIEW_QUEUE_MAX</code> environment variables - Backpressure handling (429 responses when queue full) - Queue size metrics</p>"},{"location":"overview/preview-worker-subtasks/#3-renderer-integration-p0-8-16h","title":"3. Renderer Integration (P0, 8-16h)","text":"<p>File: <code>preview_worker_issue_3.json</code></p> <p>Key implementation: - Spawn external renderer (Python/ffmpeg) - Stream logs to files - Handle dry-run vs. real rendering - Process exit status handling</p>"},{"location":"overview/preview-worker-subtasks/#4-job-status-api-endpoints-p0-4-6h","title":"4. Job Status &amp; API Endpoints (P0, 4-6h)","text":"<p>File: <code>preview_worker_issue_4.json</code></p> <p>Key implementation: - POST /api/preview enhancement - GET /api/preview/:jobId/status endpoint - GET /api/preview/:jobId/artifact endpoint</p>"},{"location":"overview/preview-worker-subtasks/#additional-subtasks-for-future-implementation","title":"Additional Subtasks (For Future Implementation)","text":"<ol> <li>Storage &amp; Asset Hashing (P1, 4-6h)</li> <li>Content-hash paths for artifacts</li> <li> <p>container.json with checksums</p> </li> <li> <p>Retry Logic, Errors, and Dead-letter (P1, 4-6h)</p> </li> <li>Exponential backoff retries</li> <li> <p>Dead-letter queue for persistent failures</p> </li> <li> <p>Metrics &amp; Logging (P0, 3-5h)</p> </li> <li>Expanded Prometheus metrics</li> <li> <p>Structured JSON logging</p> </li> <li> <p>Security &amp; Secrets Handling (P1, 2-4h)</p> </li> <li>Prevent secret leakage in logs</li> <li> <p>Auth for artifact downloads</p> </li> <li> <p>Unit/Integration Tests (P0, 6-10h)</p> </li> <li>Jest unit tests</li> <li> <p>Integration smoke tests</p> </li> <li> <p>Staging Runbook &amp; Verification Script Updates (P1, 3-4h)</p> <ul> <li>Update SMOKE_TESTS.md and MONITORING_AND_ROLLBACK.md</li> <li>Add worker checks to verification scripts</li> </ul> </li> <li> <p>CI Job for Worker Smoke Testing (P2, 4-8h)</p> <ul> <li>GitHub Action to test worker post-deployment</li> </ul> </li> <li> <p>Ops: Redis Readiness + Fallback Config (P1, 1-2h)</p> <ul> <li>Configure Redis for BullMQ in staging</li> <li>Document fallback path for local development</li> </ul> </li> </ol>"},{"location":"overview/preview-worker-subtasks/#job-payload-schema","title":"Job Payload Schema","text":"<pre><code>{\n  \"jobId\": \"uuid-v4\",\n  \"projectId\": \"project-123\",\n  \"previewRequest\": {\n    \"chapterId\": \"chapter-1\",\n    \"steps\": [...],\n    \"assets\": [...],\n    \"audio\": {...}\n  },\n  \"dryRun\": true|false,\n  \"requestId\": \"req-abc-123\"\n}\n</code></pre>"},{"location":"overview/preview-worker-subtasks/#implementation-guidance","title":"Implementation Guidance","text":"<ul> <li>Keep job handlers idempotent and side-effect safe</li> <li>Use streaming I/O for large files</li> <li>Add requestId correlation for log tracing</li> <li>Stream renderer stdout/stderr to log files</li> <li>Avoid passing raw secrets to renderer</li> <li>Mock renderer for fast, deterministic tests</li> </ul>"},{"location":"overview/preview-worker-subtasks/#total-estimated-effort","title":"Total Estimated Effort","text":"<ul> <li>Core worker implementation: 40-60 developer hours</li> <li>Additional tasks (CI, Ops): 6-12 hours</li> </ul>"},{"location":"overview/preview-worker-subtasks/#files-created","title":"Files Created","text":"<ol> <li><code>preview_worker_issue_1.json</code> - Worker Skeleton &amp; Job Model</li> <li><code>preview_worker_issue_2.json</code> - Queue &amp; Concurrency Controls</li> <li><code>preview_worker_issue_3.json</code> - Renderer Integration</li> <li><code>preview_worker_issue_4.json</code> - Job Status &amp; API Endpoints</li> <li><code>PREVIEW_WORKER_SUBTASKS.md</code> - This summary document</li> </ol> <p>These JSON files can be used with the existing <code>create_prs_and_issues</code> scripts or manually created through the GitHub web interface.</p>"},{"location":"overview/archive/phase-e-summary/","title":"Phase E: Ingestion POC and Infrastructure Hardening - Implementation Summary","text":""},{"location":"overview/archive/phase-e-summary/#overview","title":"Overview","text":"<p>This document summarizes the implementation of Phase E of the Mobius Tutorial Generator, focusing on ingestion POC and infrastructure hardening. The implementation consolidates file paths, standardizes the data directory layout, and creates a robust ingestion pipeline.</p>"},{"location":"overview/archive/phase-e-summary/#key-changes-implemented","title":"Key Changes Implemented","text":""},{"location":"overview/archive/phase-e-summary/#1-canonical-data-directory-layout","title":"1. Canonical Data Directory Layout","text":"<ul> <li>Standardized Path: All file operations now use <code>./data</code> as the canonical data directory</li> <li>Directory Structure:   <pre><code>./data/\n\u251c\u2500\u2500 projects.db     (SQLite database)\n\u251c\u2500\u2500 uploads/        (Uploaded PDFs)\n\u251c\u2500\u2500 output/         (Generated tutorial content)\n\u251c\u2500\u2500 pdf_images/     (Extracted PDF images)\n\u2514\u2500\u2500 fixtures/       (Private test files - not committed)\n</code></pre></li> <li>Environment Variable Support: <code>DATA_DIR</code> can be used to override the default path</li> <li>Migration Script: <code>scripts/migrate-data.js</code> moves existing data to the new structure</li> </ul>"},{"location":"overview/archive/phase-e-summary/#2-database-implementation","title":"2. Database Implementation","text":"<ul> <li>SQLite Backend: Added <code>better-sqlite3</code> dependency for reliable database operations</li> <li>Schema: Created projects table with fields for name, metadata, components, images, script, and audio</li> <li>DB Module: <code>src/api/db.js</code> provides database access with proper initialization</li> </ul>"},{"location":"overview/archive/phase-e-summary/#3-new-ingestion-pipeline","title":"3. New Ingestion Pipeline","text":"<ul> <li>API Endpoint: <code>/api/ingest</code> for PDF processing</li> <li>File Upload: Multer-based file handling with canonical path storage</li> <li>Text Extraction: Integrated <code>src/ingest/pdf.js</code> for PDF text extraction with OCR fallback</li> <li>BGG Integration: <code>/api/bgg</code> endpoint for fetching BoardGameGeek metadata</li> <li>Storyboard Generation: <code>src/ingest/storyboard.js</code> converts parsed content to storyboard format</li> </ul>"},{"location":"overview/archive/phase-e-summary/#4-infrastructure-hardening","title":"4. Infrastructure Hardening","text":"<ul> <li>Structured Logging: Added request IDs and JSON-formatted logs for traceability</li> <li>Health Endpoint: <code>/health</code> endpoint for monitoring API status</li> <li>Error Handling: Robust error handling throughout the ingestion pipeline</li> <li>Environment Configuration: Proper handling of environment variables</li> </ul>"},{"location":"overview/archive/phase-e-summary/#5-observability-and-monitoring","title":"5. Observability and Monitoring","text":"<ul> <li>Metrics Collection: Lightweight counters for ingestion attempts, failures, and successes</li> <li>Request Tracing: Request IDs for end-to-end traceability</li> <li>Health Checks: API health monitoring endpoint</li> </ul>"},{"location":"overview/archive/phase-e-summary/#6-documentation-and-tooling","title":"6. Documentation and Tooling","text":"<ul> <li>README Updates: Added run commands and directory structure documentation</li> <li>Demo Scripts: Created demonstration scripts for the ingestion pipeline</li> <li>Migration Tools: Scripts to migrate existing data to the new canonical structure</li> <li>Unit Tests: Added tests for ingestion pipeline components</li> </ul>"},{"location":"overview/archive/phase-e-summary/#file-changes-summary","title":"File Changes Summary","text":""},{"location":"overview/archive/phase-e-summary/#new-files-created","title":"New Files Created","text":"<ul> <li><code>src/api/db.js</code> - SQLite database implementation</li> <li><code>src/api/utils.js</code> - Utility functions for canonical path handling</li> <li><code>src/api/ingest.js</code> - New ingestion API endpoints</li> <li><code>src/ingest/pdf.js</code> - PDF text extraction with OCR fallback</li> <li><code>src/ingest/bgg.js</code> - BGG metadata fetching</li> <li><code>src/ingest/storyboard.js</code> - Storyboard generation from parsed content</li> <li><code>scripts/migrate-data.js</code> - Data migration script</li> <li><code>scripts/test-ingestion.js</code> - Ingestion pipeline test script</li> <li><code>scripts/demo-ingestion.js</code> - Ingestion pipeline demo</li> <li><code>src/__tests__/ingest.test.js</code> - Unit tests for ingestion pipeline</li> <li><code>README.md</code> - Updated documentation with run commands</li> <li><code>docs/PHASE_E_SUMMARY.md</code> - This document</li> </ul>"},{"location":"overview/archive/phase-e-summary/#modified-files","title":"Modified Files","text":"<ul> <li><code>package.json</code> - Added dependencies and new scripts</li> <li><code>src/api/index.js</code> - Integrated new ingestion endpoints and fixed regex issues</li> <li><code>.github/workflows/smoke-test.yml</code> - CI workflow for smoke testing</li> </ul>"},{"location":"overview/archive/phase-e-summary/#run-commands","title":"Run Commands","text":""},{"location":"overview/archive/phase-e-summary/#start-server","title":"Start Server","text":"<pre><code>NODE_ENV=development DATA_DIR=./data OPENAI_API_KEY=&lt;your-key&gt; npm run server\n</code></pre>"},{"location":"overview/archive/phase-e-summary/#ingest-pdf","title":"Ingest PDF","text":"<pre><code>curl -F \"file=@/path/to/rulebook.pdf\" http://localhost:5001/api/ingest\n</code></pre>"},{"location":"overview/archive/phase-e-summary/#fetch-bgg-metadata","title":"Fetch BGG Metadata","text":"<pre><code>curl -X POST http://localhost:5001/api/bgg \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"bggIdOrUrl\": \"https://boardgamegeek.com/boardgame/12345/game-name\"}'\n</code></pre>"},{"location":"overview/archive/phase-e-summary/#test-commands","title":"Test Commands","text":"<pre><code>npm run test:ingest    # Test ingestion pipeline\nnpm run migrate        # Run data migration\n</code></pre>"},{"location":"overview/archive/phase-e-summary/#acceptance-criteria-verification","title":"Acceptance Criteria Verification","text":"<p>\u2705 C-01: Attach rulebook PDF (via API) succeeds - Implemented <code>/api/ingest</code> endpoint with multer file upload - Files stored in canonical <code>./data/uploads/</code> directory</p> <p>\u2705 C-02: Parsing completes without exceptions and produces page-chunks - PDF text extraction via <code>pdf-parse</code> with OCR fallback - Page-level chunking in ingestion pipeline</p> <p>\u2705 C-03: Table of contents detection runs (TOC found or explicit \"TOC not detected\" log) - Heuristic-based TOC detection in storyboard generation - Logging for detection results</p> <p>\u2705 C-04: Component list extracted (non-empty or explicit \"no components detected\" result) - Component extraction from PDF text - Fallback to default components if none detected</p> <p>\u2705 Saved project row in ./data/projects.db with normalized metadata - SQLite database with projects table - Metadata normalization and storage</p> <p>\u2705 CI smoke test executes and returns pass on the redacted fixtures - GitHub Actions workflow for smoke testing - Tests run against redacted fixtures</p>"},{"location":"overview/archive/phase-e-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Enhanced Heuristics: Improve PDF parsing heuristics for better component detection</li> <li>LLM Integration: Add full LLM-based processing for complex rulebooks</li> <li>OCR Improvements: Enhance OCR fallback with better preprocessing</li> <li>Performance Optimization: Optimize database queries and file operations</li> <li>Extended Testing: Add more comprehensive test cases for edge scenarios</li> </ol>"},{"location":"overview/archive/phase-e-summary/#copyright-compliance","title":"Copyright Compliance","text":"<ul> <li>Uploaded PDFs are stored in <code>./data/uploads/</code> (private, not committed)</li> <li>Redacted text fixtures used for public tests</li> <li>No copyrighted content committed to repository</li> </ul>"},{"location":"playbooks/","title":"Playbooks","text":"<p>Purpose: Step-by-step operational procedures for common Mobius tasks and scenarios.</p>"},{"location":"playbooks/#contents","title":"Contents","text":"<p>Runbooks and guides for executing standard workflows.</p>"},{"location":"playbooks/build-and-deploy-guide/","title":"Preview Worker Build and Deployment Guide","text":""},{"location":"playbooks/build-and-deploy-guide/#overview","title":"Overview","text":"<p>This guide provides instructions for building and deploying the Preview Worker in both traditional (systemd) and containerized (Kubernetes) environments.</p>"},{"location":"playbooks/build-and-deploy-guide/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 18+</li> <li>Docker (for containerized deployment)</li> <li>Kubernetes cluster (for Kubernetes deployment)</li> <li>Redis server (local or remote)</li> <li>Git</li> </ul>"},{"location":"playbooks/build-and-deploy-guide/#local-development-and-testing","title":"Local Development and Testing","text":""},{"location":"playbooks/build-and-deploy-guide/#setup","title":"Setup","text":"<ol> <li> <p>Clone the repository:    <pre><code>git clone &lt;repository-url&gt;\ncd mobius-games-tutorial-generator\n</code></pre></p> </li> <li> <p>Install dependencies:    <pre><code>npm ci\n</code></pre></p> </li> <li> <p>Ensure Redis is running:    <pre><code># Using Docker\ndocker run -d -p 6379:6379 redis:alpine\n\n# Or start your existing Redis instance\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#testing","title":"Testing","text":"<ol> <li> <p>Run payload validation tests:    <pre><code>npm run test:preview-payloads\n</code></pre></p> </li> <li> <p>Run unit tests:    <pre><code>npm test\n</code></pre></p> </li> <li> <p>Run cross-platform verification scripts:    <pre><code># Unix/Linux/macOS\n./scripts/verify-preview-worker.sh\n\n# Windows\n.\\scripts\\verify-preview-worker.ps1\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#local-execution","title":"Local Execution","text":"<ol> <li> <p>Start the worker:    <pre><code>npm run worker:preview\n</code></pre></p> </li> <li> <p>Test the endpoints:    <pre><code># Health check\ncurl http://localhost:5001/api/preview/worker/health\n\n# Submit a dry-run job\ncurl -X POST http://localhost:5001/api/preview/job \\\n  -H \"Content-Type: application/json\" \\\n  -d @preview_payload_minimal.json\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#building-the-docker-image","title":"Building the Docker Image","text":""},{"location":"playbooks/build-and-deploy-guide/#build-process","title":"Build Process","text":"<ol> <li> <p>Build the Docker image:    <pre><code>docker build -t YOUR_REGISTRY/mobius-preview-worker:latest .\n</code></pre></p> </li> <li> <p>Test the image locally:    <pre><code>docker run -p 3000:3000 \\\n  -e REDIS_URL=redis://host.docker.internal:6379 \\\n  YOUR_REGISTRY/mobius-preview-worker:latest\n</code></pre></p> </li> <li> <p>Push the image to your registry:    <pre><code>docker push YOUR_REGISTRY/mobius-preview-worker:latest\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#traditional-deployment-systemd","title":"Traditional Deployment (systemd)","text":""},{"location":"playbooks/build-and-deploy-guide/#installation","title":"Installation","text":"<ol> <li> <p>Copy the service file:    <pre><code>sudo cp preview-worker.service /etc/systemd/system/\n</code></pre></p> </li> <li> <p>Create the environment file:    <pre><code>sudo mkdir -p /etc/mobius\nsudo cp preview-worker.env.example /etc/mobius/preview-worker.env\nsudo nano /etc/mobius/preview-worker.env  # Edit with your values\n</code></pre></p> </li> <li> <p>Reload systemd and start the service:    <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable preview-worker\nsudo systemctl start preview-worker\n</code></pre></p> </li> <li> <p>Check the service status:    <pre><code>sudo systemctl status preview-worker\n</code></pre></p> </li> <li> <p>View logs:    <pre><code>sudo journalctl -u preview-worker -f\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#kubernetes-deployment","title":"Kubernetes Deployment","text":""},{"location":"playbooks/build-and-deploy-guide/#prerequisites_1","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (v1.16+)</li> <li>kubectl configured</li> <li>Container registry with pushed image</li> </ul>"},{"location":"playbooks/build-and-deploy-guide/#deployment-steps","title":"Deployment Steps","text":"<ol> <li> <p>Create namespace (optional):    <pre><code>kubectl create namespace mobius\n</code></pre></p> </li> <li> <p>Create ConfigMap:    <pre><code>kubectl apply -f k8s/preview-worker/configmap.yaml\n</code></pre></p> </li> <li> <p>Create secrets (replace with your actual values):    <pre><code>kubectl create secret generic preview-worker-secrets \\\n  --from-literal=REDIS_PASSWORD=your-redis-password\n</code></pre></p> </li> <li> <p>Deploy the worker:    <pre><code>kubectl apply -f k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Check deployment status:    <pre><code>kubectl get pods -l app=preview-worker\nkubectl logs -l app=preview-worker\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#scaling","title":"Scaling","text":"<ol> <li> <p>Scale manually:    <pre><code>kubectl scale deployment preview-worker --replicas=3\n</code></pre></p> </li> <li> <p>Use HorizontalPodAutoscaler:    <pre><code>kubectl get hpa preview-worker-hpa\n</code></pre></p> </li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#monitoring-and-observability","title":"Monitoring and Observability","text":""},{"location":"playbooks/build-and-deploy-guide/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>The worker exposes metrics at <code>/metrics</code> endpoint. Configure your Prometheus to scrape this endpoint.</p>"},{"location":"playbooks/build-and-deploy-guide/#health-checks","title":"Health Checks","text":"<p>The worker provides a health check endpoint at <code>/api/preview/worker/health</code>.</p>"},{"location":"playbooks/build-and-deploy-guide/#logs","title":"Logs","text":"<p>All logs are output to stdout/stderr and can be collected by your logging solution.</p>"},{"location":"playbooks/build-and-deploy-guide/#environment-variables","title":"Environment Variables","text":""},{"location":"playbooks/build-and-deploy-guide/#required","title":"Required","text":"<ul> <li><code>REDIS_URL</code> - Redis connection string (e.g., redis://redis:6379)</li> </ul>"},{"location":"playbooks/build-and-deploy-guide/#optional","title":"Optional","text":"<ul> <li><code>PREVIEW_QUEUE_NAME</code> - Name of the preview job queue (default: preview-jobs)</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Number of concurrent jobs (default: 2)</li> <li><code>PREVIEW_QUEUE_MAX</code> - Maximum queue size (default: 20)</li> <li><code>DATA_DIR</code> - Directory for storing preview artifacts (default: ./data)</li> <li><code>NODE_ENV</code> - Environment (production/development)</li> </ul>"},{"location":"playbooks/build-and-deploy-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"playbooks/build-and-deploy-guide/#common-issues","title":"Common Issues","text":"<ol> <li>Redis Connection Failed</li> <li>Check Redis URL and credentials</li> <li>Ensure Redis is accessible from the worker</li> <li> <p>Verify network connectivity</p> </li> <li> <p>Job Processing Failures</p> </li> <li>Check logs for error messages</li> <li>Verify payload format using validation scripts</li> <li> <p>Check Dead Letter Queue for failed jobs</p> </li> <li> <p>Performance Issues</p> </li> <li>Monitor queue length and processing times</li> <li>Adjust concurrency settings</li> <li>Scale worker instances</li> </ol>"},{"location":"playbooks/build-and-deploy-guide/#debugging-commands","title":"Debugging Commands","text":"<pre><code># Check worker logs\nkubectl logs -l app=preview-worker\n\n# Check worker health\nkubectl port-forward svc/preview-worker 3000:3000\ncurl http://localhost:3000/api/preview/worker/health\n\n# Check queue metrics\ncurl http://localhost:3000/api/preview/queue/metrics\n</code></pre>"},{"location":"playbooks/build-and-deploy-guide/#rollback-procedures","title":"Rollback Procedures","text":""},{"location":"playbooks/build-and-deploy-guide/#systemd","title":"systemd","text":"<pre><code># Stop the service\nsudo systemctl stop preview-worker\n\n# Revert to previous version\n# (Replace with your rollback mechanism)\n\n# Start the service\nsudo systemctl start preview-worker\n</code></pre>"},{"location":"playbooks/build-and-deploy-guide/#kubernetes","title":"Kubernetes","text":"<pre><code># Rollback to previous deployment\nkubectl rollout undo deployment/preview-worker\n\n# Or scale down\nkubectl scale deployment/preview-worker --replicas=0\n</code></pre>"},{"location":"playbooks/build-and-deploy-guide/#security-considerations","title":"Security Considerations","text":""},{"location":"playbooks/build-and-deploy-guide/#secrets-management","title":"Secrets Management","text":"<ul> <li>Never store secrets in code or configuration files</li> <li>Use Kubernetes secrets or environment variables</li> <li>Rotate secrets regularly</li> </ul>"},{"location":"playbooks/build-and-deploy-guide/#network-security","title":"Network Security","text":"<ul> <li>Restrict access to the worker endpoints</li> <li>Use TLS for external communications</li> <li>Implement proper authentication and authorization</li> </ul>"},{"location":"playbooks/build-and-deploy-guide/#container-security","title":"Container Security","text":"<ul> <li>Run containers as non-root user</li> <li>Keep base images updated</li> <li>Scan images for vulnerabilities</li> </ul>"},{"location":"playbooks/ci-workflow-pr-body/","title":"CI: Add staging verify workflow for Phase F","text":""},{"location":"playbooks/ci-workflow-pr-body/#description","title":"Description","text":"<p>Adds post-deploy verification jobs (Linux + Windows) to verify Phase F preview &amp; matcher functionality. Runs scripts/verify-phase-f.sh and scripts/verify-phase-f.ps1 after the deploy_to_staging job completes. Uploads verification artifacts on failure for debugging.</p>"},{"location":"playbooks/ci-workflow-pr-body/#labels","title":"Labels","text":"<p>ci, phase-f</p>"},{"location":"playbooks/ci-workflow-pr-body/#reviewer","title":"Reviewer","text":"<p>ops</p>"},{"location":"playbooks/ci-workflow-pr-body/#assignee","title":"Assignee","text":"<p>developer</p>"},{"location":"playbooks/cli-deployment-tool/","title":"Mobius Preview Worker Deployment CLI","text":"<p>A simple command-line interface for deploying the Mobius Preview Worker application across different platforms.</p>"},{"location":"playbooks/cli-deployment-tool/#overview","title":"Overview","text":"<p>The Mobius Deployment CLI provides a unified interface for deploying the Preview Worker application regardless of the underlying platform (Windows, Linux, or macOS). It automatically detects the platform and executes the appropriate scripts.</p>"},{"location":"playbooks/cli-deployment-tool/#installation","title":"Installation","text":"<ol> <li>Ensure you have Node.js installed (version 14 or higher)</li> <li>No additional installation is required - the CLI tool is ready to use directly</li> </ol>"},{"location":"playbooks/cli-deployment-tool/#usage","title":"Usage","text":"<pre><code># From the project root directory\nnode cli/mobius-deploy.js [command] [options]\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#commands","title":"Commands","text":"Command Description <code>build-push</code> Build and push Docker image to GHCR <code>update-manifests</code> Update Kubernetes manifests with the correct image name <code>apply-manifests</code> Apply Kubernetes manifests to deploy the application <code>deploy</code> Full deployment (build, update, apply) <code>verify</code> Verify deployment status <code>rollback</code> Rollback to previous deployment <code>status</code> Show current deployment status <code>logs</code> Show deployment logs <code>help</code> Show help message"},{"location":"playbooks/cli-deployment-tool/#options","title":"Options","text":"Option Description <code>--platform [win|unix]</code> Specify platform (auto-detected by default) <code>--namespace</code> Specify Kubernetes namespace (default: preview-worker) <code>--image-tag</code> Specify Docker image tag <code>--dry-run</code> Perform a dry run without making changes"},{"location":"playbooks/cli-deployment-tool/#examples","title":"Examples","text":""},{"location":"playbooks/cli-deployment-tool/#build-and-push-docker-image","title":"Build and Push Docker Image","text":"<pre><code>node cli/mobius-deploy.js build-push\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#update-kubernetes-manifests","title":"Update Kubernetes Manifests","text":"<pre><code>node cli/mobius-deploy.js update-manifests\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#deploy-to-kubernetes","title":"Deploy to Kubernetes","text":"<pre><code>node cli/mobius-deploy.js deploy\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#deploy-with-custom-image-tag","title":"Deploy with Custom Image Tag","text":"<pre><code>node cli/mobius-deploy.js deploy --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#deploy-to-custom-namespace","title":"Deploy to Custom Namespace","text":"<pre><code>node cli/mobius-deploy.js deploy --namespace production\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#perform-dry-run","title":"Perform Dry Run","text":"<pre><code>node cli/mobius-deploy.js deploy --dry-run\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#verify-deployment-status","title":"Verify Deployment Status","text":"<pre><code>node cli/mobius-de verify\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#check-deployment-status","title":"Check Deployment Status","text":"<pre><code>node cli/mobius-deploy.js status\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#view-deployment-logs","title":"View Deployment Logs","text":"<pre><code>node cli/mobius-deploy.js logs\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#rollback-deployment","title":"Rollback Deployment","text":"<pre><code>node cli/mobius-deploy.js rollback\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#platform-detection","title":"Platform Detection","text":"<p>The CLI automatically detects the platform based on the operating system: - Windows: Uses PowerShell scripts (.ps1) - Linux/macOS: Uses Bash scripts (.sh)</p> <p>You can override the platform detection using the <code>--platform</code> option: <pre><code># Force Windows scripts on any platform\nnode cli/mobius-deploy.js deploy --platform win\n\n# Force Unix scripts on any platform\nnode cli/mobius-deploy.js deploy --platform unix\n</code></pre></p>"},{"location":"playbooks/cli-deployment-tool/#security","title":"Security","text":"<p>The CLI tool maintains the same security practices as the underlying scripts: - GHCR Personal Access Tokens (PATs) are read securely without displaying in console - PATs are cleared from memory after use - Docker login uses password-stdin when possible to avoid command-line exposure</p>"},{"location":"playbooks/cli-deployment-tool/#integration-with-cicd","title":"Integration with CI/CD","text":"<p>The CLI can be easily integrated into CI/CD pipelines:</p>"},{"location":"playbooks/cli-deployment-tool/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Deploy Preview Worker\n  run: |\n    node cli/mobius-deploy.js deploy --image-tag ${{ github.sha }}\n  env:\n    GHCR_PAT: ${{ secrets.GHCR_PAT }}\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#advanced-cicd-with-rollback-on-failure","title":"Advanced CI/CD with Rollback on Failure","text":"<pre><code>- name: Deploy Preview Worker\n  run: |\n    node cli/mobius-deploy.js deploy --namespace staging\n  env:\n    GHCR_PAT: ${{ secrets.GHCR_PAT }}\n\n- name: Verify Deployment\n  run: |\n    node cli/mobius-deploy.js verify --namespace staging\n\n- name: Rollback on Failure\n  if: failure()\n  run: |\n    node cli/mobius-deploy.js rollback --namespace staging\n</code></pre>"},{"location":"playbooks/cli-deployment-tool/#troubleshooting","title":"Troubleshooting","text":""},{"location":"playbooks/cli-deployment-tool/#script-not-found-errors","title":"Script Not Found Errors","text":"<p>Ensure you're running the CLI from the project root directory where the scripts are located.</p>"},{"location":"playbooks/cli-deployment-tool/#permission-errors-unixlinuxmacos","title":"Permission Errors (Unix/Linux/macOS)","text":"<p>Make sure the bash scripts have execute permissions: <pre><code>chmod +x *.sh\n</code></pre></p>"},{"location":"playbooks/cli-deployment-tool/#platform-detection-issues","title":"Platform Detection Issues","text":"<p>If automatic platform detection fails, manually specify the platform using the <code>--platform</code> option.</p>"},{"location":"playbooks/cli-deployment-tool/#kubernetes-connection-issues","title":"Kubernetes Connection Issues","text":"<p>Ensure kubectl is properly configured with the correct context: <pre><code>kubectl config current-context\nkubectl config get-contexts\n</code></pre></p>"},{"location":"playbooks/complete-deployment-checklist/","title":"\ud83d\ude80 COMPLETE DEPLOYMENT CHECKLIST - MOBIUS Preview Worker","text":""},{"location":"playbooks/complete-deployment-checklist/#pre-deployment-checklist","title":"\u2705 Pre-Deployment Checklist","text":""},{"location":"playbooks/complete-deployment-checklist/#1-image-update-critical","title":"1. Image Update (CRITICAL)","text":"<pre><code># Run this to update the image placeholder\n$oldImage = \"YOUR_REGISTRY/mobius-preview-worker:TAG\"\n$newImage = \"ghcr.io/mobius-org/mobius-preview-worker:1.0.0\"  # CHANGE THIS TO YOUR ACTUAL IMAGE!\n\n# Update all YAML files\nGet-ChildItem -Path .\\k8s\\preview-worker\\*.yaml -File | ForEach-Object {\n    (Get-Content $_.FullName -Raw) -replace [Regex]::Escape($oldImage), $newImage |\n      Set-Content -Path $_.FullName -NoNewline\n    Write-Host \"Updated $($_.Name)\"\n}\n\n# Verify the change\nGet-ChildItem -Path .\\k8s\\preview-worker\\*.yaml -File | ForEach-Object {\n    Write-Host \"--- $($_.Name) ---\"\n    Select-String -Path $_.FullName -Pattern \"image:\" -SimpleMatch\n}\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#2-git-commit-push","title":"2. Git Commit &amp; Push","text":"<pre><code># Ensure you're on the right branch\ngit checkout chore/harden-preview-worker\n\n# Add and commit changes\ngit add k8s/preview-worker/*.yaml\ngit commit -m \"chore(k8s): set preview-worker image to $newImage\"\n\n# Push to remote\ngit push origin chore/harden-preview-worker\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#3-create-pull-request-choose-one-method","title":"3. Create Pull Request (Choose one method)","text":"<p>Option A - GitHub CLI: <pre><code>gh auth login  # if not already logged in\ngh pr create --base main --head chore/harden-preview-worker `\n  --title \"chore(k8s): harden preview-worker manifests and set image\" `\n  --body \"Adds hardened deployment with securityContext, probes, resource limits, RBAC, and smoke-test. Image set to $newImage.\"\n</code></pre></p> <p>Option B - Web UI: Go to: https://github.com/your-org/mobius-games-tutorial-generator/pulls Click \"New pull request\", select base: main, compare: chore/harden-preview-worker</p>"},{"location":"playbooks/complete-deployment-checklist/#cluster-deployment-steps","title":"\ud83c\udfd7\ufe0f Cluster Deployment Steps","text":""},{"location":"playbooks/complete-deployment-checklist/#4-create-namespace-secrets","title":"4. Create Namespace &amp; Secrets","text":"<pre><code># Create namespace\nkubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\n\n# Create registry secret (if using private registry)\nkubectl create secret docker-registry regcred `\n  --docker-server=\"ghcr.io\" `\n  --docker-username=\"your-username\" `\n  --docker-password=\"your-token\" `\n  --docker-email=\"your-email@domain.com\" `\n  -n preview-worker\n\n# Create application secrets\nkubectl -n preview-worker create secret generic preview-worker-secrets `\n  --from-literal=REDIS_URL=\"redis://redis-host:6379\" `\n  --from-literal=SOME_API_KEY=\"your-api-key-here\"\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#5-deploy-to-cluster","title":"5. Deploy to Cluster","text":"<pre><code># Option A - Full automation (recommended)\n.\\deploy-hardened-preview-worker.ps1 -ImageRegistry \"ghcr.io\" -ImageTag \"1.0.0\"\n\n# Option B - Manual deployment\nkubectl apply -f k8s/preview-worker/hardened-deployment.yaml -n preview-worker\nkubectl apply -f k8s/preview-worker/rbac.yaml -n preview-worker  # Optional\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#6-run-smoke-test","title":"6. Run Smoke Test","text":"<pre><code># PowerShell smoke test\n.\\k8s\\preview-worker\\smoke-test-preview-worker.ps1\n\n# Or manual verification\nkubectl -n preview-worker rollout status deployment/preview-worker --timeout=180s\nkubectl -n preview-worker get pods -o wide\nkubectl -n preview-worker get svc\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#post-deployment-verification","title":"\ud83d\udd0d Post-Deployment Verification","text":""},{"location":"playbooks/complete-deployment-checklist/#7-health-check","title":"7. Health Check","text":"<pre><code># Port forward and test\nStart-Job -ScriptBlock { kubectl -n preview-worker port-forward svc/preview-worker 8080:5001 }\nStart-Sleep -Seconds 3\nInvoke-WebRequest -Uri \"http://localhost:8080/health\" -UseBasicParsing\nGet-Job | Stop-Job\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#8-monitor-logs","title":"8. Monitor Logs","text":"<pre><code># Watch logs\nkubectl -n preview-worker logs -f deployment/preview-worker\n\n# Check events\nkubectl -n preview-worker get events --sort-by='.lastTimestamp'\n\n# Describe resources\nkubectl -n preview-worker describe deployment preview-worker\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#rollback-commands-if-needed","title":"\ud83d\udd04 Rollback Commands (if needed)","text":"<pre><code># Quick rollback\nkubectl -n preview-worker rollout undo deployment/preview-worker\n\n# Check rollback status\nkubectl -n preview-worker rollout status deployment/preview-worker\n\n# View history\nkubectl -n preview-worker rollout history deployment/preview-worker\n</code></pre>"},{"location":"playbooks/complete-deployment-checklist/#what-youre-deploying","title":"\ud83d\udcca What You're Deploying","text":""},{"location":"playbooks/complete-deployment-checklist/#security-hardening","title":"Security Hardening \u2705","text":"<ul> <li>ServiceAccount isolation - No cluster privileges</li> <li>Security context - Non-root user (UID 1000), read-only filesystem</li> <li>Resource limits - 150m/500m CPU, 256Mi/512Mi memory</li> <li>Dropped capabilities - Minimal attack surface</li> <li>Health probes - Liveness/readiness with proper timing</li> </ul>"},{"location":"playbooks/complete-deployment-checklist/#operational-excellence","title":"Operational Excellence \u2705","text":"<ul> <li>Rolling updates - Zero-downtime deployments</li> <li>Graceful termination - 30s shutdown window</li> <li>Comprehensive smoke testing - Validates deployment health</li> <li>Easy rollback - One-command recovery</li> <li>Monitoring ready - Prometheus metrics endpoints</li> </ul>"},{"location":"playbooks/complete-deployment-checklist/#critical-reminders","title":"\ud83d\udea8 Critical Reminders","text":"<ol> <li>Update Image First - Replace <code>ghcr.io/mobius-org/mobius-preview-worker:1.0.0</code> with your actual image</li> <li>Create Secrets - Registry and application secrets are required for deployment</li> <li>Test in Staging - Always validate in non-production environment first</li> <li>Monitor After Deploy - Watch logs and metrics post-deployment</li> <li>Keep Rollback Ready - Know the rollback commands before deploying</li> </ol>"},{"location":"playbooks/complete-deployment-checklist/#support-troubleshooting","title":"\ud83d\udcde Support &amp; Troubleshooting","text":""},{"location":"playbooks/complete-deployment-checklist/#common-issues","title":"Common Issues:","text":"<ul> <li>Image Pull Errors - Check registry secret and image accessibility</li> <li>Health Check Failures - Verify application listens on correct port</li> <li>Resource Limits - Adjust CPU/memory if pods are throttled</li> <li>RBAC Issues - Ensure ServiceAccount has minimal required permissions</li> </ul>"},{"location":"playbooks/complete-deployment-checklist/#next-steps-after-success","title":"Next Steps After Success:","text":"<ol> <li>Monitor Performance - Adjust resource requests/limits based on usage</li> <li>Set Up Monitoring - Integrate with Prometheus/Grafana</li> <li>Configure Alerts - Set up alerts for health check failures</li> <li>Document Changes - Update runbooks with your configurations</li> </ol> <p>Ready to deploy? Follow the checklist in order. The entire process should take 5-10 minutes once you have your image registry information ready!</p>"},{"location":"playbooks/complete-setup-guide/","title":"Complete Setup Guide for Phase F Rollout","text":""},{"location":"playbooks/complete-setup-guide/#current-status","title":"Current Status","text":"<p>We've identified that the GitHub token is not properly set in the environment, which is causing the 401 authentication error. This guide will help you set up the token correctly and create the necessary PRs and issues.</p>"},{"location":"playbooks/complete-setup-guide/#files-available","title":"Files Available","text":"<ol> <li><code>GITHUB_TOKEN_SETUP.md</code> - Detailed instructions for creating and setting up a GitHub token</li> <li><code>setup_and_create.ps1</code> - PowerShell script to automate token setup and creation</li> <li>Payload files for API calls:</li> <li><code>pr_feature.json</code></li> <li><code>pr_ci.json</code></li> <li><code>preview_issue.json</code></li> <li><code>asset_issue.json</code></li> <li><code>packaging_issue.json</code></li> <li>Content files for manual creation:</li> <li><code>FEATURE_PR_BODY.md</code></li> <li><code>CI_WORKFLOW_PR_BODY.md</code></li> <li><code>ISSUE_PREVIEW_WORKER.md</code></li> <li><code>ISSUE_ASSET_UPLOADS.md</code></li> <li><code>ISSUE_EXPORT_PACKAGING.md</code></li> </ol>"},{"location":"playbooks/complete-setup-guide/#two-options-for-completion","title":"Two Options for Completion","text":""},{"location":"playbooks/complete-setup-guide/#option-1-automated-creation-recommended","title":"Option 1: Automated Creation (Recommended)","text":"<ol> <li>Run the PowerShell setup script:    <pre><code>.\\setup_and_create.ps1\n</code></pre></li> <li>Follow the prompts to enter your GitHub token</li> <li>Choose option 1 to automatically create all PRs and issues</li> </ol>"},{"location":"playbooks/complete-setup-guide/#option-2-manual-creation-via-web-ui","title":"Option 2: Manual Creation via Web UI","text":"<ol> <li>Follow the instructions in <code>GITHUB_TOKEN_SETUP.md</code> to create and set up your GitHub token</li> <li>Visit the URLs provided in the script output to create:</li> <li>Feature PR</li> <li>CI Workflow PR</li> <li>Three issues (Preview Worker, Asset Uploads, Packaging)</li> </ol>"},{"location":"playbooks/complete-setup-guide/#after-creation","title":"After Creation","text":"<p>Once you've created the PRs and issues:</p> <ol> <li>Share the PR URLs in the chat</li> <li>I will validate the content and provide reviewer checklists</li> <li>I will coordinate the staging verification process</li> <li>I will help break down the Preview Worker issue into subtasks</li> </ol>"},{"location":"playbooks/complete-setup-guide/#troubleshooting","title":"Troubleshooting","text":"<p>If you encounter any issues:</p> <ol> <li>Ensure your GitHub token has the correct scopes (repo, workflow, public_repo)</li> <li>Verify that the repository owner and name are correct (w9bikze8u4cbupc/MOBIUS)</li> <li>Check that you have proper permissions to create PRs and issues in the repository</li> <li>If using an organization repository, ensure SSO is authorized for the token</li> </ol>"},{"location":"playbooks/complete-setup-guide/#security-notes","title":"Security Notes","text":"<ul> <li>Never share your GitHub token with anyone</li> <li>The token should only be stored in environment variables, never in files</li> <li>If you suspect your token has been compromised, regenerate it immediately</li> <li>Use fine-grained tokens when possible for better security</li> </ul>"},{"location":"playbooks/cross-platform-deployment-scripts/","title":"Cross-Platform Deployment Scripts","text":""},{"location":"playbooks/cross-platform-deployment-scripts/#overview","title":"Overview","text":"<p>This project now includes paired PowerShell (.ps1) and bash (.sh) scripts for all critical deployment operations, ensuring cross-platform compatibility for Windows, Linux, and macOS environments.</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#script-pairs","title":"Script Pairs","text":""},{"location":"playbooks/cross-platform-deployment-scripts/#1-build-and-push-scripts","title":"1. Build and Push Scripts","text":"<ul> <li>PowerShell: build-and-push.ps1</li> <li>Bash: build-and-push.sh</li> </ul> <p>Function: Builds the Docker image and pushes it to GHCR with secure authentication.</p> <p>Usage: - Windows: <code>.\\build-and-push.ps1</code> - Unix/Linux/macOS: <code>./build-and-push.sh</code></p>"},{"location":"playbooks/cross-platform-deployment-scripts/#2-update-manifests-scripts","title":"2. Update Manifests Scripts","text":"<ul> <li>PowerShell: update-manifests.ps1</li> <li>Bash: update-manifests.sh</li> </ul> <p>Function: Updates Kubernetes manifests with the correct image name.</p> <p>Usage: - Windows: <code>.\\update-manifests.ps1</code> - Unix/Linux/macOS: <code>./update-manifests.sh</code></p>"},{"location":"playbooks/cross-platform-deployment-scripts/#3-apply-manifests-scripts","title":"3. Apply Manifests Scripts","text":"<ul> <li>PowerShell: apply-manifests.ps1</li> <li>Bash: apply-manifests.sh</li> </ul> <p>Function: Applies Kubernetes manifests to deploy the application.</p> <p>Usage: - Windows: <code>.\\apply-manifests.ps1</code> - Unix/Linux/macOS: <code>./apply-manifests.sh</code></p>"},{"location":"playbooks/cross-platform-deployment-scripts/#4-full-deployment-scripts","title":"4. Full Deployment Scripts","text":"<ul> <li>PowerShell: deploy-preview-worker.ps1</li> <li>Bash: deploy-preview-worker.sh</li> </ul> <p>Function: Combines all deployment steps into a single script.</p> <p>Usage: - Windows: <code>.\\deploy-preview-worker.ps1</code> - Unix/Linux/macOS: <code>./deploy-preview-worker.sh</code></p>"},{"location":"playbooks/cross-platform-deployment-scripts/#5-verification-scripts","title":"5. Verification Scripts","text":"<ul> <li>PowerShell: verify-deployment.ps1</li> <li>Bash: verify-deployment.sh</li> </ul> <p>Function: Verifies the current deployment status.</p> <p>Usage: - Windows: <code>.\\verify-deployment.ps1</code> - Unix/Linux/macOS: <code>./verify-deployment.sh</code></p>"},{"location":"playbooks/cross-platform-deployment-scripts/#security-features","title":"Security Features","text":"<p>All scripts implement secure handling of sensitive information: - GHCR Personal Access Tokens (PATs) are read securely without displaying in console - PATs are cleared from memory after use - Docker login uses password-stdin when possible to avoid command-line exposure</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#cross-platform-compatibility","title":"Cross-Platform Compatibility","text":"<p>All scripts follow platform-specific conventions: - PowerShell scripts use Windows-style paths and commands - Bash scripts use Unix-style paths and commands - Both script types produce standardized output with clear status indicators - File permissions are set appropriately for execution</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#idempotent-design","title":"Idempotent Design","text":"<p>All deployment scripts are designed to be idempotent: - Can be safely run multiple times without unintended side effects - Check for existing resources before creating new ones - Update operations are designed to be repeatable</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#cicd-integration","title":"CI/CD Integration","text":"<p>The deployment scripts are integrated with GitHub Actions for automated deployments: - .github/workflows/preview-worker-build.yaml: Automatically builds and pushes Docker images - .github/workflows/preview-worker-deploy.yaml: Automatically deploys to Kubernetes</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#cli-tool","title":"CLI Tool","text":"<p>A unified CLI tool is available for easier deployment operations: - cli/mobius-deploy.js: Node.js-based CLI that works across platforms - CLI_DEPLOYMENT_TOOL.md: Documentation for the CLI tool</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#usage-instructions","title":"Usage Instructions","text":"<ol> <li>Choose the appropriate script for your platform</li> <li>Windows users: Use .ps1 scripts</li> <li> <p>Unix/Linux/macOS users: Use .sh scripts</p> </li> <li> <p>Run the build and push script first <pre><code># Windows\n.\\build-and-push.ps1\n\n# Unix/Linux/macOS\n./build-and-push.sh\n</code></pre></p> </li> <li> <p>Update the manifests <pre><code># Windows\n.\\update-manifests.ps1\n\n# Unix/Linux/macOS\n./update-manifests.sh\n</code></pre></p> </li> <li> <p>Deploy to Kubernetes (when ready) <pre><code># Windows\n.\\apply-manifests.ps1\n\n# Unix/Linux/macOS\n./apply-manifests.sh\n</code></pre></p> </li> <li> <p>Verify deployment status <pre><code># Windows\n.\\verify-deployment.ps1\n\n# Unix/Linux/macOS\n./verify-deployment.sh\n</code></pre></p> </li> <li> <p>Use the CLI tool for simplified operations <pre><code># Deploy the application\nnode cli/mobius-deploy.js deploy\n\n# Verify deployment status\nnode cli/mobius-deploy.js verify\n</code></pre></p> </li> </ol>"},{"location":"playbooks/cross-platform-deployment-scripts/#automated-testing","title":"Automated Testing","text":"<p>Scripts are automatically tested to ensure they function correctly: - scripts/test-verification-scripts.ps1: Tests PowerShell scripts - scripts/test-verification-scripts.sh: Tests bash scripts</p>"},{"location":"playbooks/cross-platform-deployment-scripts/#troubleshooting","title":"Troubleshooting","text":"<p>If you encounter issues: 1. Ensure Docker is running 2. Verify Kubernetes is properly configured 3. Check that all required dependencies are installed 4. Confirm you have appropriate permissions for Docker and Kubernetes operations</p>"},{"location":"playbooks/deployment-checklist/","title":"Mobius Preview Worker Deployment Checklist","text":""},{"location":"playbooks/deployment-checklist/#pre-deployment-checklist","title":"Pre-Deployment Checklist","text":""},{"location":"playbooks/deployment-checklist/#environment-setup","title":"Environment Setup","text":"<ul> <li>[ ] Docker is installed and running</li> <li>[ ] Kubernetes CLI (kubectl) is installed and configured</li> <li>[ ] GitHub Container Registry (GHCR) Personal Access Token is available</li> <li>[ ] Kubernetes cluster is accessible and running</li> <li>[ ] Required namespaces exist or can be created</li> </ul>"},{"location":"playbooks/deployment-checklist/#code-and-configuration","title":"Code and Configuration","text":"<ul> <li>[ ] Latest code is pulled from the repository</li> <li>[ ] All tests pass locally</li> <li>[ ] Dockerfile is up to date</li> <li>[ ] Kubernetes manifests are validated</li> <li>[ ] Environment-specific configurations are correct</li> </ul>"},{"location":"playbooks/deployment-checklist/#security","title":"Security","text":"<ul> <li>[ ] GHCR PAT has appropriate permissions</li> <li>[ ] Kubernetes secrets are properly configured</li> <li>[ ] Image pull secrets are set up</li> <li>[ ] RBAC permissions are verified</li> </ul>"},{"location":"playbooks/deployment-checklist/#deployment-process","title":"Deployment Process","text":""},{"location":"playbooks/deployment-checklist/#1-build-and-push-docker-image","title":"1. Build and Push Docker Image","text":"<ul> <li>[ ] Run <code>node cli/mobius-deploy.js build-push</code> or platform-specific script</li> <li>[ ] Verify image is pushed to GHCR successfully</li> <li>[ ] Confirm image tag is correct</li> </ul>"},{"location":"playbooks/deployment-checklist/#2-update-kubernetes-manifests","title":"2. Update Kubernetes Manifests","text":"<ul> <li>[ ] Run <code>node cli/mobius-deploy.js update-manifests</code> or platform-specific script</li> <li>[ ] Verify manifests are updated with correct image tag</li> <li>[ ] Check that all YAML files have been updated</li> </ul>"},{"location":"playbooks/deployment-checklist/#3-apply-kubernetes-manifests","title":"3. Apply Kubernetes Manifests","text":"<ul> <li>[ ] Run <code>node cli/mobius-deploy.js apply-manifests</code> or platform-specific script</li> <li>[ ] Verify namespace exists or is created</li> <li>[ ] Confirm all resources are applied successfully</li> </ul>"},{"location":"playbooks/deployment-checklist/#4-monitor-deployment","title":"4. Monitor Deployment","text":"<ul> <li>[ ] Run <code>node cli/mobius-deploy.js status</code> to check deployment status</li> <li>[ ] Monitor pod status: <code>kubectl -n preview-worker get pods</code></li> <li>[ ] Check deployment rollout status: <code>kubectl -n preview-worker rollout status deployment/preview-worker</code></li> </ul>"},{"location":"playbooks/deployment-checklist/#5-verify-deployment","title":"5. Verify Deployment","text":"<ul> <li>[ ] Run <code>node cli/mobius-deploy.js verify</code> or platform-specific script</li> <li>[ ] Check service endpoints are accessible</li> <li>[ ] Verify health checks pass</li> <li>[ ] Confirm metrics are being collected</li> </ul>"},{"location":"playbooks/deployment-checklist/#post-deployment-checklist","title":"Post-Deployment Checklist","text":""},{"location":"playbooks/deployment-checklist/#validation","title":"Validation","text":"<ul> <li>[ ] Run smoke tests to verify functionality</li> <li>[ ] Check application logs: <code>node cli/mobius-deploy.js logs</code></li> <li>[ ] Verify metrics are being collected</li> <li>[ ] Test rollback procedure (optional but recommended)</li> </ul>"},{"location":"playbooks/deployment-checklist/#documentation","title":"Documentation","text":"<ul> <li>[ ] Update deployment documentation if needed</li> <li>[ ] Record deployment details (version, timestamp, deployer)</li> <li>[ ] Notify relevant stakeholders of successful deployment</li> </ul>"},{"location":"playbooks/deployment-checklist/#cleanup","title":"Cleanup","text":"<ul> <li>[ ] Remove any temporary files or configurations</li> <li>[ ] Clear sensitive data from command history</li> <li>[ ] Update any internal tracking systems</li> </ul>"},{"location":"playbooks/deployment-checklist/#rollback-procedure","title":"Rollback Procedure","text":"<p>If issues are detected after deployment:</p> <ol> <li> <p>Run <code>node cli/mobius-deploy.js rollback</code> or use kubectl directly:    <pre><code>kubectl -n preview-worker rollout undo deployment/preview-worker\n</code></pre></p> </li> <li> <p>Monitor the rollback process:    <pre><code>kubectl -n preview-worker rollout status deployment/preview-worker\n</code></pre></p> </li> <li> <p>Verify the rollback was successful:    <pre><code>node cli/mobius-deploy.js verify\n</code></pre></p> </li> <li> <p>Investigate the cause of the issues and plan next steps</p> </li> </ol>"},{"location":"playbooks/deployment-checklist/#troubleshooting","title":"Troubleshooting","text":""},{"location":"playbooks/deployment-checklist/#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"playbooks/deployment-checklist/#docker-issues","title":"Docker Issues","text":"<ul> <li>Problem: Docker not running</li> <li> <p>Solution: Start Docker Desktop or Docker daemon</p> </li> <li> <p>Problem: Permission denied when pushing to GHCR</p> </li> <li>Solution: Verify GHCR PAT has correct permissions</li> </ul>"},{"location":"playbooks/deployment-checklist/#kubernetes-issues","title":"Kubernetes Issues","text":"<ul> <li>Problem: Cannot connect to cluster</li> <li> <p>Solution: Verify kubeconfig is correct and cluster is accessible</p> </li> <li> <p>Problem: Pods stuck in Pending state</p> </li> <li> <p>Solution: Check resource quotas and node capacity</p> </li> <li> <p>Problem: ImagePullBackOff error</p> </li> <li>Solution: Verify image exists and image pull secrets are correct</li> </ul>"},{"location":"playbooks/deployment-checklist/#script-issues","title":"Script Issues","text":"<ul> <li>Problem: Scripts not found</li> <li> <p>Solution: Ensure running from project root directory</p> </li> <li> <p>Problem: Permission denied on bash scripts</p> </li> <li>Solution: Run <code>chmod +x *.sh</code> on script files</li> </ul>"},{"location":"playbooks/deployment-checklist/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"playbooks/deployment-checklist/#immediate-rollback","title":"Immediate Rollback","text":"<p>If critical issues are detected immediately after deployment: 1. Execute rollback command 2. Notify team of rollback 3. Investigate issues in a separate branch</p>"},{"location":"playbooks/deployment-checklist/#complete-system-failure","title":"Complete System Failure","text":"<p>If the entire system is down: 1. Contact system administrators 2. Check infrastructure provider status pages 3. Follow disaster recovery procedures</p>"},{"location":"playbooks/deployment-maintenance-playbook/","title":"Deployment Maintenance Playbook","text":""},{"location":"playbooks/deployment-maintenance-playbook/#overview","title":"Overview","text":"<p>This playbook provides guidelines and procedures for maintaining the Mobius Preview Worker deployment infrastructure. It covers routine maintenance tasks, monitoring procedures, incident response, and continuous improvement processes.</p>"},{"location":"playbooks/deployment-maintenance-playbook/#routine-maintenance-tasks","title":"Routine Maintenance Tasks","text":""},{"location":"playbooks/deployment-maintenance-playbook/#daily-checks","title":"Daily Checks","text":"<ol> <li>Deployment Status Verification</li> <li>Run: <code>node cli/mobius-deploy.js status --namespace production</code></li> <li>Verify all pods are running without errors</li> <li> <p>Check resource utilization is within expected limits</p> </li> <li> <p>Log Review</p> </li> <li>Run: <code>node cli/mobius-deploy.js logs --namespace production --tail 100</code></li> <li>Look for error patterns or unusual activity</li> <li> <p>Document any anomalies for further investigation</p> </li> <li> <p>Health Check Validation</p> </li> <li>Run: <code>node cli/mobius-deploy.js verify --namespace production</code></li> <li>Ensure all health checks pass</li> <li>Validate service endpoints are responsive</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#weekly-maintenance","title":"Weekly Maintenance","text":"<ol> <li>Script Validation</li> <li> <p>Run test scripts on all platforms:      <pre><code># Windows\n.\\scripts\\test-verification-scripts.ps1\n\n# Unix/Linux/macOS\n./scripts/test-verification-scripts.sh\n</code></pre></p> </li> <li> <p>Documentation Review</p> </li> <li>Verify all documentation is current with implementation</li> <li>Update any outdated procedures or examples</li> <li> <p>Review and update contact information</p> </li> <li> <p>Security Review</p> </li> <li>Rotate GHCR PATs if needed</li> <li>Review access controls and permissions</li> <li>Check for security updates to dependencies</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#monthly-maintenance","title":"Monthly Maintenance","text":"<ol> <li>Performance Analysis</li> <li>Review resource utilization trends</li> <li>Analyze deployment duration metrics</li> <li> <p>Identify optimization opportunities</p> </li> <li> <p>Backup and Recovery Testing</p> </li> <li>Test rollback procedures</li> <li>Verify backup configurations</li> <li> <p>Document any issues found</p> </li> <li> <p>Tooling Updates</p> </li> <li>Update CLI tool dependencies</li> <li>Review and update GitHub Actions versions</li> <li>Test compatibility with updated tools</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#monitoring-procedures","title":"Monitoring Procedures","text":""},{"location":"playbooks/deployment-maintenance-playbook/#continuous-monitoring","title":"Continuous Monitoring","text":"<ol> <li>Automated Health Checks</li> <li>GitHub Actions workflows monitor build and deployment success</li> <li>Kubernetes built-in health checks monitor pod status</li> <li> <p>Prometheus metrics collection monitors application performance</p> </li> <li> <p>Alert Management</p> </li> <li>Review and acknowledge alerts promptly</li> <li>Document alert causes and resolutions</li> <li>Tune alert thresholds to reduce noise</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#periodic-monitoring-reviews","title":"Periodic Monitoring Reviews","text":"<ol> <li>Metrics Analysis</li> <li>Review deployment success rates</li> <li>Analyze rollback frequency and causes</li> <li> <p>Monitor resource utilization trends</p> </li> <li> <p>Log Analysis</p> </li> <li>Identify recurring error patterns</li> <li>Correlate logs with performance issues</li> <li>Optimize logging levels based on operational needs</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#incident-response-procedures","title":"Incident Response Procedures","text":""},{"location":"playbooks/deployment-maintenance-playbook/#level-1-incidents-minor-issues","title":"Level 1 Incidents (Minor Issues)","text":"<ol> <li>Identification</li> <li>Non-critical deployment failures</li> <li>Minor performance degradation</li> <li> <p>Low-priority alerts</p> </li> <li> <p>Response</p> </li> <li>Document the issue</li> <li>Attempt standard troubleshooting</li> <li>Escalate if unresolved within 30 minutes</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#level-2-incidents-major-issues","title":"Level 2 Incidents (Major Issues)","text":"<ol> <li>Identification</li> <li>Production deployment failures</li> <li>Significant performance degradation</li> <li> <p>High-priority alerts</p> </li> <li> <p>Response</p> </li> <li>Initiate immediate rollback if needed</li> <li>Engage operations team</li> <li>Communicate status to stakeholders</li> <li>Document root cause and resolution</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#level-3-incidents-critical-issues","title":"Level 3 Incidents (Critical Issues)","text":"<ol> <li>Identification</li> <li>Complete production outage</li> <li>Security breaches</li> <li> <p>Data loss events</p> </li> <li> <p>Response</p> </li> <li>Activate emergency response team</li> <li>Implement disaster recovery procedures</li> <li>Communicate with executive team</li> <li>Document detailed incident report</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#continuous-improvement-process","title":"Continuous Improvement Process","text":""},{"location":"playbooks/deployment-maintenance-playbook/#feedback-collection","title":"Feedback Collection","text":"<ol> <li>Team Feedback</li> <li>Regular team retrospectives</li> <li>Deployment experience surveys</li> <li> <p>One-on-one discussions</p> </li> <li> <p>System Metrics</p> </li> <li>Deployment success/failure rates</li> <li>Mean time to recovery</li> <li>User-reported issues</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#improvement-planning","title":"Improvement Planning","text":"<ol> <li>Backlog Management</li> <li>Maintain prioritized improvement backlog</li> <li>Regular backlog grooming sessions</li> <li> <p>Stakeholder review and approval</p> </li> <li> <p>Implementation Scheduling</p> </li> <li>Plan improvements in development cycles</li> <li>Coordinate with release schedules</li> <li>Allocate resources for implementation</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#improvement-tracking","title":"Improvement Tracking","text":"<ol> <li>Progress Monitoring</li> <li>Track implementation status</li> <li>Measure impact of improvements</li> <li> <p>Adjust plans based on results</p> </li> <li> <p>Success Measurement</p> </li> <li>Compare metrics before and after improvements</li> <li>Gather team feedback on changes</li> <li>Document lessons learned</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#security-maintenance","title":"Security Maintenance","text":""},{"location":"playbooks/deployment-maintenance-playbook/#regular-security-tasks","title":"Regular Security Tasks","text":"<ol> <li>Credential Management</li> <li>Monthly PAT rotation</li> <li>Quarterly access review</li> <li> <p>Annual security training</p> </li> <li> <p>Vulnerability Management</p> </li> <li>Weekly dependency scanning</li> <li>Monthly security assessments</li> <li>Immediate patching for critical vulnerabilities</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#security-incident-response","title":"Security Incident Response","text":"<ol> <li>Detection</li> <li>Monitor security alerts</li> <li>Review audit logs</li> <li> <p>Investigate suspicious activity</p> </li> <li> <p>Response</p> </li> <li>Contain affected systems</li> <li>Eradicate threats</li> <li>Recover and restore services</li> <li>Document and report incidents</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#documentation-maintenance","title":"Documentation Maintenance","text":""},{"location":"playbooks/deployment-maintenance-playbook/#regular-updates","title":"Regular Updates","text":"<ol> <li>Content Review</li> <li>Monthly documentation accuracy checks</li> <li>Update procedures when changes are made</li> <li> <p>Remove outdated information</p> </li> <li> <p>Format and Organization</p> </li> <li>Ensure consistent formatting</li> <li>Improve navigation and searchability</li> <li>Add new documentation as needed</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#version-control","title":"Version Control","text":"<ol> <li>Change Tracking</li> <li>Maintain change logs for documentation</li> <li>Review documentation changes in code reviews</li> <li>Coordinate documentation updates with feature releases</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#training-and-knowledge-transfer","title":"Training and Knowledge Transfer","text":""},{"location":"playbooks/deployment-maintenance-playbook/#ongoing-training","title":"Ongoing Training","text":"<ol> <li>New Team Member Onboarding</li> <li>Follow TEAM_ONBOARDING_GUIDE.md</li> <li>Provide hands-on training sessions</li> <li> <p>Assign mentor for first deployments</p> </li> <li> <p>Regular Refresher Training</p> </li> <li>Quarterly deployment procedure reviews</li> <li>Annual security training updates</li> <li>New feature training sessions</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#knowledge-management","title":"Knowledge Management","text":"<ol> <li>Knowledge Base Maintenance</li> <li>Document solutions to common issues</li> <li>Maintain troubleshooting guides</li> <li> <p>Share best practices and lessons learned</p> </li> <li> <p>Cross-Team Collaboration</p> </li> <li>Regular knowledge sharing sessions</li> <li>Cross-training on related systems</li> <li>Participation in industry events and communities</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#communication-plan","title":"Communication Plan","text":""},{"location":"playbooks/deployment-maintenance-playbook/#regular-updates_1","title":"Regular Updates","text":"<ol> <li>Status Reports</li> <li>Weekly deployment metrics summary</li> <li>Monthly infrastructure health report</li> <li> <p>Quarterly improvement progress update</p> </li> <li> <p>Incident Communication</p> </li> <li>Immediate notification of major incidents</li> <li>Timely status updates during ongoing issues</li> <li>Post-incident analysis and communication</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#stakeholder-engagement","title":"Stakeholder Engagement","text":"<ol> <li>Executive Reporting</li> <li>Monthly executive summary</li> <li>Quarterly strategic review</li> <li> <p>Annual planning presentation</p> </li> <li> <p>Team Collaboration</p> </li> <li>Weekly team sync meetings</li> <li>Monthly cross-team coordination</li> <li>Ad-hoc project discussions</li> </ol>"},{"location":"playbooks/deployment-maintenance-playbook/#conclusion","title":"Conclusion","text":"<p>This maintenance playbook provides a comprehensive framework for maintaining the Mobius Preview Worker deployment infrastructure. By following these procedures, the team can ensure consistent, reliable, and secure operations while continuously improving the deployment process.</p> <p>Regular review and updates to this playbook will help maintain its relevance and effectiveness as the system and team evolve.</p>"},{"location":"playbooks/deployment-metrics-dashboard/","title":"Deployment Metrics Dashboard","text":""},{"location":"playbooks/deployment-metrics-dashboard/#overview","title":"Overview","text":"<p>This document provides a template for tracking and visualizing key deployment metrics for the Mobius Preview Worker. It includes definitions of important metrics, suggested visualization approaches, and targets for healthy operations.</p>"},{"location":"playbooks/deployment-metrics-dashboard/#key-performance-indicators-kpis","title":"Key Performance Indicators (KPIs)","text":""},{"location":"playbooks/deployment-metrics-dashboard/#deployment-success-rate","title":"Deployment Success Rate","text":"<ul> <li>Definition: Percentage of successful deployments out of total deployment attempts</li> <li>Formula: (Successful Deployments / Total Deployments) \u00d7 100</li> <li>Target: \u2265 95%</li> <li>Visualization: Line chart showing trend over time</li> <li>Alert Threshold: &lt; 90% for 3 consecutive deployments</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#deployment-duration","title":"Deployment Duration","text":"<ul> <li>Definition: Time from deployment initiation to completion</li> <li>Formula: Deployment Completion Time - Deployment Start Time</li> <li>Target: \u2264 10 minutes for standard deployments</li> <li>Visualization: Histogram of deployment durations</li> <li>Alert Threshold: &gt; 15 minutes</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#rollback-frequency","title":"Rollback Frequency","text":"<ul> <li>Definition: Number of rollbacks per week</li> <li>Formula: Total Rollbacks / Number of Weeks</li> <li>Target: \u2264 2 rollbacks per week</li> <li>Visualization: Bar chart by week</li> <li>Alert Threshold: &gt; 5 rollbacks in a week</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#mean-time-to-recovery-mttr","title":"Mean Time to Recovery (MTTR)","text":"<ul> <li>Definition: Average time to restore service after a deployment failure</li> <li>Formula: Total Downtime / Number of Incidents</li> <li>Target: \u2264 30 minutes</li> <li>Visualization: Line chart showing trend over time</li> <li>Alert Threshold: &gt; 60 minutes</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#resource-utilization-metrics","title":"Resource Utilization Metrics","text":""},{"location":"playbooks/deployment-metrics-dashboard/#cpu-usage","title":"CPU Usage","text":"<ul> <li>Definition: Average CPU utilization of preview worker pods</li> <li>Target: 20-70% under normal load</li> <li>Visualization: Time series graph with upper/lower bounds</li> <li>Alert Threshold: &gt; 85% for 5 minutes</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#memory-usage","title":"Memory Usage","text":"<ul> <li>Definition: Average memory utilization of preview worker pods</li> <li>Target: 30-75% under normal load</li> <li>Visualization: Time series graph with upper/lower bounds</li> <li>Alert Threshold: &gt; 90% for 5 minutes</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#disk-usage","title":"Disk Usage","text":"<ul> <li>Definition: Average disk utilization of preview worker pods</li> <li>Target: &lt; 70%</li> <li>Visualization: Time series graph with upper bound</li> <li>Alert Threshold: &gt; 85%</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#reliability-metrics","title":"Reliability Metrics","text":""},{"location":"playbooks/deployment-metrics-dashboard/#uptime","title":"Uptime","text":"<ul> <li>Definition: Percentage of time the service is available</li> <li>Formula: (Total Time - Downtime) / Total Time \u00d7 100</li> <li>Target: \u2265 99.5%</li> <li>Visualization: Line chart showing trend over time</li> <li>Alert Threshold: &lt; 99%</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#error-rate","title":"Error Rate","text":"<ul> <li>Definition: Percentage of requests that result in errors</li> <li>Formula: (Error Responses / Total Requests) \u00d7 100</li> <li>Target: &lt; 1%</li> <li>Visualization: Time series graph with upper bound</li> <li>Alert Threshold: &gt; 5%</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#request-latency","title":"Request Latency","text":"<ul> <li>Definition: Average time to process requests</li> <li>Target: &lt; 500ms for 95th percentile</li> <li>Visualization: Histogram of response times</li> <li>Alert Threshold: &gt; 1000ms for 95th percentile</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#security-metrics","title":"Security Metrics","text":""},{"location":"playbooks/deployment-metrics-dashboard/#failed-authentication-attempts","title":"Failed Authentication Attempts","text":"<ul> <li>Definition: Number of failed login attempts to deployment systems</li> <li>Target: &lt; 10 per day</li> <li>Visualization: Bar chart by day</li> <li>Alert Threshold: &gt; 50 in 1 hour</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#vulnerability-scan-results","title":"Vulnerability Scan Results","text":"<ul> <li>Definition: Number of critical and high severity vulnerabilities</li> <li>Target: 0 critical, &lt; 3 high severity</li> <li>Visualization: Stacked bar chart by severity</li> <li>Alert Threshold: &gt; 0 critical or &gt; 5 high severity</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#team-productivity-metrics","title":"Team Productivity Metrics","text":""},{"location":"playbooks/deployment-metrics-dashboard/#deployment-frequency","title":"Deployment Frequency","text":"<ul> <li>Definition: Number of deployments per week</li> <li>Target: 3-5 deployments per week</li> <li>Visualization: Bar chart by week</li> <li>Alert Threshold: &lt; 1 or &gt; 10 deployments per week</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#lead-time-for-changes","title":"Lead Time for Changes","text":"<ul> <li>Definition: Time from code commit to production deployment</li> <li>Target: \u2264 24 hours</li> <li>Visualization: Histogram of lead times</li> <li>Alert Threshold: &gt; 72 hours</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#change-failure-rate","title":"Change Failure Rate","text":"<ul> <li>Definition: Percentage of deployments that result in degraded service</li> <li>Formula: (Failed Deployments / Total Deployments) \u00d7 100</li> <li>Target: &lt; 5%</li> <li>Visualization: Line chart showing trend over time</li> <li>Alert Threshold: &gt; 15%</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#visualization-dashboard-structure","title":"Visualization Dashboard Structure","text":""},{"location":"playbooks/deployment-metrics-dashboard/#overview-section","title":"Overview Section","text":"<ol> <li>Health Summary Panel</li> <li>Current deployment status</li> <li>Recent deployment history</li> <li> <p>Active alerts</p> </li> <li> <p>KPI Summary Panel</p> </li> <li>Deployment success rate</li> <li>Current uptime</li> <li>MTTR</li> <li>Active user sessions</li> </ol>"},{"location":"playbooks/deployment-metrics-dashboard/#performance-section","title":"Performance Section","text":"<ol> <li>Deployment Metrics Panel</li> <li>Deployment duration trend</li> <li>Deployment frequency</li> <li> <p>Rollback frequency</p> </li> <li> <p>Resource Utilization Panel</p> </li> <li>CPU usage over time</li> <li>Memory usage over time</li> <li>Disk usage over time</li> </ol>"},{"location":"playbooks/deployment-metrics-dashboard/#reliability-section","title":"Reliability Section","text":"<ol> <li>Service Health Panel</li> <li>Uptime trend</li> <li>Error rate over time</li> <li> <p>Request latency distribution</p> </li> <li> <p>Incident Management Panel</p> </li> <li>Incident frequency</li> <li>MTTR trend</li> <li>Open vs. resolved incidents</li> </ol>"},{"location":"playbooks/deployment-metrics-dashboard/#security-section","title":"Security Section","text":"<ol> <li>Security Posture Panel</li> <li>Failed authentication attempts</li> <li>Vulnerability scan results</li> <li>Security alert trends</li> </ol>"},{"location":"playbooks/deployment-metrics-dashboard/#productivity-section","title":"Productivity Section","text":"<ol> <li>Team Metrics Panel</li> <li>Lead time for changes</li> <li>Deployment frequency</li> <li>Change failure rate</li> </ol>"},{"location":"playbooks/deployment-metrics-dashboard/#alerting-configuration","title":"Alerting Configuration","text":""},{"location":"playbooks/deployment-metrics-dashboard/#critical-alerts","title":"Critical Alerts","text":"<ul> <li>Deployment failure</li> <li>Service downtime</li> <li>High error rate</li> <li>Critical security events</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#warning-alerts","title":"Warning Alerts","text":"<ul> <li>Deployment duration exceeding threshold</li> <li>Resource utilization approaching limits</li> <li>High number of failed authentications</li> <li>High severity vulnerabilities detected</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#informational-alerts","title":"Informational Alerts","text":"<ul> <li>Successful deployments</li> <li>New feature deployments</li> <li>Routine maintenance completion</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#reporting-schedule","title":"Reporting Schedule","text":""},{"location":"playbooks/deployment-metrics-dashboard/#real-time-monitoring","title":"Real-Time Monitoring","text":"<ul> <li>Continuous monitoring of all metrics</li> <li>Immediate alerts for critical issues</li> <li>Dashboard updates every minute</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#daily-reports","title":"Daily Reports","text":"<ul> <li>Summary of deployment activities</li> <li>Resource utilization report</li> <li>Security scan results</li> <li>Incident summary</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#weekly-reports","title":"Weekly Reports","text":"<ul> <li>KPI trends and analysis</li> <li>Performance optimization recommendations</li> <li>Team productivity metrics</li> <li>Upcoming maintenance schedule</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#monthly-reports","title":"Monthly Reports","text":"<ul> <li>Comprehensive metrics analysis</li> <li>Year-over-year comparisons</li> <li>Capacity planning recommendations</li> <li>Security posture assessment</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#quarterly-reports","title":"Quarterly Reports","text":"<ul> <li>Strategic review of deployment processes</li> <li>ROI analysis of improvements</li> <li>Competitive benchmarking</li> <li>Roadmap alignment</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#data-sources","title":"Data Sources","text":""},{"location":"playbooks/deployment-metrics-dashboard/#internal-sources","title":"Internal Sources","text":"<ul> <li>GitHub Actions workflow logs</li> <li>Kubernetes metrics (Prometheus)</li> <li>Application logs</li> <li>Database performance metrics</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#external-sources","title":"External Sources","text":"<ul> <li>Infrastructure provider metrics</li> <li>CDN performance data</li> <li>Third-party service status</li> <li>Industry benchmark data</li> </ul>"},{"location":"playbooks/deployment-metrics-dashboard/#conclusion","title":"Conclusion","text":"<p>This deployment metrics dashboard template provides a comprehensive framework for monitoring the health, performance, and reliability of the Mobius Preview Worker deployment infrastructure. By tracking these metrics and maintaining appropriate visualizations and alerts, the team can ensure consistent, high-quality service delivery while continuously improving the deployment process.</p> <p>Regular review and refinement of this dashboard will help maintain its relevance and effectiveness as the system evolves.</p>"},{"location":"playbooks/final-deployment-summary/","title":"\ud83c\udfaf FINAL DEPLOYMENT SUMMARY - Ready to Execute","text":""},{"location":"playbooks/final-deployment-summary/#current-status","title":"\u2705 Current Status","text":"<ul> <li>\u2705 Branch <code>chore/harden-preview-worker</code> created</li> <li>\u2705 Hardened manifests applied (patches 1 &amp; 2)</li> <li>\u2705 PowerShell deployment scripts ready</li> <li>\u2705 Image placeholder needs updating</li> </ul>"},{"location":"playbooks/final-deployment-summary/#exact-commands-to-run-now","title":"\ud83d\ude80 Exact Commands to Run Now","text":""},{"location":"playbooks/final-deployment-summary/#1-update-image-critical-replace-with-your-image","title":"1. Update Image (CRITICAL - Replace with YOUR image)","text":"<pre><code># Update this to YOUR actual image!\n$oldImage = \"YOUR_REGISTRY/mobius-preview-worker:TAG\"\n$newImage = \"ghcr.io/mobius-org/mobius-preview-worker:1.0.0\"  # CHANGE THIS!\n\n# Update all YAML files\nGet-ChildItem -Path .\\k8s\\preview-worker\\*.yaml -File | ForEach-Object {\n    (Get-Content $_.FullName -Raw) -replace [Regex]::Escape($oldImage), $newImage |\n      Set-Content -Path $_.FullName -NoNewline\n    Write-Host \"Updated $($_.Name)\"\n}\n</code></pre>"},{"location":"playbooks/final-deployment-summary/#2-commit-push","title":"2. Commit &amp; Push","text":"<pre><code>git add k8s/preview-worker/*.yaml\ngit commit -m \"chore(k8s): set preview-worker image to $newImage\"\ngit push origin chore/harden-preview-worker\n</code></pre>"},{"location":"playbooks/final-deployment-summary/#3-create-pull-request","title":"3. Create Pull Request","text":"<pre><code># Using GitHub CLI\ngh pr create --base main --head chore/harden-preview-worker `\n  --title \"chore(k8s): harden preview-worker manifests and set image\" `\n  --body \"Adds hardened deployment with securityContext, probes, resource limits, RBAC, and smoke-test.\"\n</code></pre>"},{"location":"playbooks/final-deployment-summary/#4-deploy-to-cluster","title":"4. Deploy to Cluster","text":"<pre><code># Create namespace and secrets first\nkubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\n\n# Create secrets (adjust values as needed)\nkubectl -n preview-worker create secret generic preview-worker-secrets `\n  --from-literal=REDIS_URL=\"redis://redis:6379\" `\n  --from-literal=SOME_API_KEY=\"your-api-key\"\n\n# Deploy with automation\n.\\deploy-hardened-preview-worker.ps1 -ImageRegistry \"ghcr.io\" -ImageTag \"1.0.0\"\n</code></pre>"},{"location":"playbooks/final-deployment-summary/#5-run-smoke-test","title":"5. Run Smoke Test","text":"<pre><code>.\\k8s\\preview-worker\\smoke-test-preview-worker.ps1\n</code></pre>"},{"location":"playbooks/final-deployment-summary/#what-youll-deploy","title":"\ud83d\udccb What You'll Deploy","text":""},{"location":"playbooks/final-deployment-summary/#security-hardening","title":"Security Hardening","text":"<ul> <li>\u2705 Non-root user (UID 1000)</li> <li>\u2705 Read-only root filesystem</li> <li>\u2705 Resource limits (150m/500m CPU, 256Mi/512Mi memory)</li> <li>\u2705 Dropped capabilities</li> <li>\u2705 ServiceAccount isolation</li> </ul>"},{"location":"playbooks/final-deployment-summary/#operational-excellence","title":"Operational Excellence","text":"<ul> <li>\u2705 Health probes with proper timing</li> <li>\u2705 Rolling update strategy</li> <li>\u2705 Graceful termination (30s)</li> <li>\u2705 Comprehensive smoke testing</li> <li>\u2705 Easy rollback capability</li> </ul>"},{"location":"playbooks/final-deployment-summary/#quick-verification","title":"\ud83d\udd27 Quick Verification","text":"<p>After deployment, verify with: <pre><code># Check deployment status\nkubectl -n preview-worker get deployment preview-worker\nkubectl -n preview-worker get pods -o wide\n\n# Test health endpoint\nkubectl -n preview-worker port-forward svc/preview-worker 8080:5001 &amp;\ncurl http://localhost:8080/health\n</code></pre></p>"},{"location":"playbooks/final-deployment-summary/#important-notes","title":"\ud83d\udea8 Important Notes","text":"<ol> <li>Image Registry: Replace <code>ghcr.io/mobius-org/mobius-preview-worker:1.0.0</code> with your actual image</li> <li>Secrets: Create registry secret if using private registry</li> <li>Monitoring: Check logs after deployment</li> <li>Rollback: Keep rollback commands ready</li> </ol>"},{"location":"playbooks/final-deployment-summary/#next-steps-after-success","title":"\ud83d\udcde Next Steps After Success","text":"<ol> <li>Monitor Performance - Adjust resources based on usage</li> <li>Set Up Alerts - Configure monitoring for health checks</li> <li>Document - Update runbooks with your configurations</li> <li>Scale - Consider HPA if needed for load</li> </ol> <p>\ud83c\udfaf Ready to deploy? Run the commands above in order. The entire process takes ~5-10 minutes!</p> <p>Need help? Paste any error messages or the PR URL and I'll provide exact fixes.</p>"},{"location":"playbooks/github-token-permissions-checklist/","title":"GitHub Token Permission Checklist for Phase F Automation","text":""},{"location":"playbooks/github-token-permissions-checklist/#goal","title":"Goal","text":"<p>Create a token that allows the <code>create_prs_and_issues</code> scripts to create PRs, issues, and push CI workflow changes without over-broad privileges.</p>"},{"location":"playbooks/github-token-permissions-checklist/#important-safety-notes","title":"Important Safety Notes","text":"<ul> <li>DO NOT paste the token anywhere public or into chat. Treat it like a password.</li> <li>Prefer a fine-grained personal access token (PAT) scoped to only the specific repository(ies) used.</li> <li>If your org enforces SAML SSO, you must authorize the token for the organization after creation.</li> </ul>"},{"location":"playbooks/github-token-permissions-checklist/#a-create-token-recommended-fine-grained-pat","title":"A. Create Token (Recommended: Fine-grained PAT)","text":"<ol> <li>Go to GitHub Settings \u2192 Developer settings \u2192 Personal access tokens \u2192 Fine-grained tokens</li> <li>Click \"Generate new token\"</li> <li>Repository access: Grant access only to the specific repository (e.g., <code>MOBIUS</code>)</li> <li>Minimal permission set (fine-grained):</li> <li>Code / Contents: Read &amp; write <ul> <li>Allows creating files in branches and commits</li> <li>Required for workflow file changes</li> </ul> </li> <li>Pull requests: Read &amp; write<ul> <li>Required to open/update PRs and manage PR attributes</li> </ul> </li> <li>Issues: Read &amp; write<ul> <li>Required to create/update issues</li> </ul> </li> <li>Actions / Workflows: Read &amp; write<ul> <li>Only if automation will trigger or manage workflow runs</li> <li>If only opening PRs with workflows, this may not be required</li> </ul> </li> <li>Metadata: Read (if available)<ul> <li>Useful to query repo info without wider access</li> </ul> </li> <li>Token lifetime: Set a reasonable expiry (30-90 days) and rotate regularly</li> <li>Click \"Generate token\"</li> <li>Copy the token immediately and store it securely</li> </ol>"},{"location":"playbooks/github-token-permissions-checklist/#b-if-your-org-uses-saml-sso","title":"B. If Your Org Uses SAML / SSO","text":"<ol> <li>After creating the token, go to your Organization's SSO page</li> <li>\"Authorize\" the token for the organization (if required)</li> <li>Failure to authorize will produce 401 for org repos</li> </ol>"},{"location":"playbooks/github-token-permissions-checklist/#c-classic-pat-if-you-cannot-use-fine-grained","title":"C. Classic PAT (If You Cannot Use Fine-grained)","text":"<ol> <li>Go to GitHub Settings \u2192 Developer settings \u2192 Personal access tokens \u2192 Tokens (classic)</li> <li>Click \"Generate new token\"</li> <li>Required scopes:</li> <li><code>repo</code> (Full control of private repositories)</li> <li><code>workflow</code> (Update GitHub Action workflows)</li> <li><code>public_repo</code> (Access public repositories)</li> </ol>"},{"location":"playbooks/github-token-permissions-checklist/#d-how-to-set-and-test-locally","title":"D. How to Set and Test Locally","text":""},{"location":"playbooks/github-token-permissions-checklist/#bash-temporary-in-session","title":"Bash (temporary in session):","text":"<pre><code>export GITHUB_TOKEN=\"github_pat_...\"\n</code></pre>"},{"location":"playbooks/github-token-permissions-checklist/#powershell-session","title":"PowerShell (session):","text":"<pre><code>$Env:GITHUB_TOKEN = \"github_pat_...\"\n</code></pre>"},{"location":"playbooks/github-token-permissions-checklist/#verify-the-cli-auth-status","title":"Verify the CLI auth status:","text":"<pre><code>gh auth status\n</code></pre>"},{"location":"playbooks/github-token-permissions-checklist/#basic-sanity-checks","title":"Basic sanity checks:","text":"<pre><code>gh api user --jq '.login'\ngh api repos/:owner/:repo --jq '.name'   # validate repo access\n</code></pre>"},{"location":"playbooks/github-token-permissions-checklist/#e-common-causes-of-401-bad-credentials","title":"E. Common Causes of 401 / \"Bad credentials\"","text":"<ul> <li>Token not exported into the shell where script runs</li> <li>Using the wrong env var name in the script</li> <li>Token not authorized for the organization (SAML SSO)</li> <li>Token expired or revoked</li> <li>Token lacks repository permissions for the target repo</li> <li>Token was created with only read-only scopes but script requires write</li> </ul>"},{"location":"playbooks/github-token-permissions-checklist/#f-quick-verification-flow","title":"F. Quick Verification Flow","text":"<ol> <li>Ensure your branches are pushed:</li> <li><code>phase-f/preview-image-matcher</code></li> <li><code>ci/add-phase-f-verify-workflow</code></li> <li>Export token into the same shell you will run the script from</li> <li>Run verification commands:    <pre><code>gh auth status\ngh api user --jq '.login'\ngh api repos/:OWNER/:REPO --jq '.private'   # replace :OWNER and :REPO\n</code></pre></li> </ol>"},{"location":"playbooks/github-token-permissions-checklist/#g-if-you-still-get-401","title":"G. If You Still Get 401","text":"<ol> <li>Re-check that token is authorized for the org (SAML SSO)</li> <li>Verify the token permissions include Pull requests + Contents write + Issues</li> <li>Generate a new token with minimal but sufficient permissions and authorize it</li> <li>Try using the GitHub CLI auth flow instead: <code>gh auth login</code> (interactive and SSO-aware)</li> <li>Check audit/organization settings</li> </ol>"},{"location":"playbooks/github-token-permissions-checklist/#h-best-practices-for-automation","title":"H. Best Practices for Automation","text":"<ul> <li>Use fine-grained tokens with least privileges and explicit repo selection</li> <li>Rotate tokens on a regular schedule and delete unused tokens</li> <li>Store token in secrets manager on CI runners; do not hardcode</li> <li>For CI (GitHub Actions) prefer actions/workflows using the built-in GITHUB_TOKEN where possible</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/","title":"Hardened Preview Worker Deployment - Complete Guide","text":""},{"location":"playbooks/hardened-deployment-guide/#overview","title":"Overview","text":"<p>This guide provides hardened Kubernetes manifests for the preview-worker deployment with enhanced security, resource management, and operational best practices.</p>"},{"location":"playbooks/hardened-deployment-guide/#quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"playbooks/hardened-deployment-guide/#1-prerequisites","title":"1. Prerequisites","text":"<pre><code># Ensure you have cluster access\nkubectl cluster-info\n\n# Check permissions\nkubectl auth can-i create deployment -n preview-worker\nkubectl auth can-i create serviceaccount -n preview-worker\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#2-one-command-deployment","title":"2. One-Command Deployment","text":"<pre><code># Create namespace and deploy everything\nkubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\nkubectl apply -f k8s/preview-worker/hardened-deployment.yaml -n preview-worker\nkubectl apply -f k8s/preview-worker/rbac.yaml -n preview-worker  # Optional\nchmod +x k8s/preview-worker/smoke-test-preview-worker.sh\n./k8s/preview-worker/smoke-test-preview-worker.sh\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#pre-deployment-checklist","title":"\ud83d\udccb Pre-Deployment Checklist","text":""},{"location":"playbooks/hardened-deployment-guide/#critical-updates-required","title":"Critical Updates Required","text":"<ol> <li> <p>Replace Image Placeholder in <code>hardened-deployment.yaml</code>:    <pre><code># CURRENT (placeholder):\nimage: YOUR_REGISTRY/mobius-preview-worker:TAG\n\n# UPDATE to your actual registry:\nimage: your-registry.com/mobius-preview-worker:1.0.0\n</code></pre></p> </li> <li> <p>Create Registry Secret (if using private registry):    <pre><code>kubectl create secret docker-registry regcred \\\n  --docker-server=your-registry.com \\\n  --docker-username=your-username \\\n  --docker-password=your-password \\\n  --docker-email=your-email \\\n  -n preview-worker\n</code></pre></p> </li> <li> <p>Create Application Secrets:    <pre><code>kubectl create secret generic preview-worker-secrets \\\n  --from-literal=REDIS_URL='redis://your-redis:6379' \\\n  --from-literal=API_KEY='your-api-key' \\\n  -n preview-worker\n</code></pre></p> </li> </ol>"},{"location":"playbooks/hardened-deployment-guide/#security-hardening-features","title":"\ud83d\udd12 Security Hardening Features","text":""},{"location":"playbooks/hardened-deployment-guide/#serviceaccount-rbac","title":"ServiceAccount &amp; RBAC","text":"<ul> <li>Dedicated ServiceAccount (<code>preview-worker</code>)</li> <li>Minimal RBAC permissions (namespace-scoped only)</li> <li>No cluster-wide privileges</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#security-context","title":"Security Context","text":"<ul> <li>Runs as non-root user (UID 1000)</li> <li>Read-only root filesystem</li> <li>No privilege escalation</li> <li>All capabilities dropped</li> <li>Dedicated tmp and cache volumes</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#resource-management","title":"Resource Management","text":"<ul> <li>CPU requests: 150m, limits: 500m</li> <li>Memory requests: 256Mi, limits: 512Mi</li> <li>Conservative defaults for small workloads</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#health-reliability","title":"Health &amp; Reliability","text":"<ul> <li>Liveness probe: <code>/api/preview/worker/health</code></li> <li>Readiness probe: <code>/api/preview/worker/health</code></li> <li>Rolling update strategy</li> <li>Graceful termination (30s)</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#manifest-files","title":"\ud83d\udcc1 Manifest Files","text":"File Purpose Status <code>hardened-deployment.yaml</code> Main deployment with security hardening \u2705 Ready <code>rbac.yaml</code> Optional RBAC configuration \u2705 Optional <code>smoke-test-preview-worker.sh</code> Comprehensive smoke test \u2705 Ready"},{"location":"playbooks/hardened-deployment-guide/#deployment-commands","title":"\ud83d\udee0\ufe0f Deployment Commands","text":""},{"location":"playbooks/hardened-deployment-guide/#safe-deployment-process","title":"Safe Deployment Process","text":"<pre><code># 1. Validate manifests (dry-run)\nkubectl apply --dry-run=client -f k8s/preview-worker/hardened-deployment.yaml -n preview-worker\n\n# 2. Apply manifests\nkubectl apply -f k8s/preview-worker/hardened-deployment.yaml -n preview-worker\n\n# 3. Wait for rollout\nkubectl -n preview-worker rollout status deployment/preview-worker --timeout=300s\n\n# 4. Check status\nkubectl -n preview-worker get pods -o wide\nkubectl -n preview-worker get svc\n\n# 5. Run smoke test\n./k8s/preview-worker/smoke-test-preview-worker.sh\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#rollback-commands","title":"Rollback Commands","text":"<pre><code># Quick rollback\nkubectl -n preview-worker rollout undo deployment/preview-worker\n\n# Check rollback status\nkubectl -n preview-worker rollout status deployment/preview-worker\n\n# View rollout history\nkubectl -n preview-worker rollout history deployment/preview-worker\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#monitoring-troubleshooting","title":"\ud83d\udd0d Monitoring &amp; Troubleshooting","text":""},{"location":"playbooks/hardened-deployment-guide/#health-checks","title":"Health Checks","text":"<pre><code># Check deployment status\nkubectl -n preview-worker get deployment preview-worker\n\n# Check pod logs\nkubectl -n preview-worker logs -f deployment/preview-worker\n\n# Check events\nkubectl -n preview-worker get events --sort-by='.lastTimestamp'\n\n# Port-forward for testing\nkubectl -n preview-worker port-forward svc/preview-worker 8080:80\n# Test: curl http://localhost:8080/api/preview/worker/health\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#common-issues","title":"Common Issues","text":""},{"location":"playbooks/hardened-deployment-guide/#image-pull-errors","title":"Image Pull Errors","text":"<pre><code># Check events\nkubectl -n preview-worker get events --field-selector type=Warning\n\n# Verify registry secret\nkubectl -n preview-worker get secret regcred -o yaml\n\n# Test image pull manually\nkubectl -n preview-worker run test-pull --image=your-registry.com/mobius-preview-worker:1.0.0 --rm -it -- /bin/sh\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#pod-crashloopbackoff","title":"Pod CrashLoopBackOff","text":"<pre><code># Check logs\nkubectl -n preview-worker logs deployment/preview-worker --previous\n\n# Check resource usage\nkubectl -n preview-worker top pods\n\n# Describe pod for events\nkubectl -n preview-worker describe pod -l app=preview-worker\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#resource-scaling","title":"\ud83d\udcca Resource Scaling","text":""},{"location":"playbooks/hardened-deployment-guide/#horizontal-scaling","title":"Horizontal Scaling","text":"<pre><code># Scale to 3 replicas\nkubectl -n preview-worker scale deployment/preview-worker --replicas=3\n\n# Check scaling\nkubectl -n preview-worker get pods -l app=preview-worker\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#resource-adjustment","title":"Resource Adjustment","text":"<p>Edit <code>hardened-deployment.yaml</code> and adjust: <pre><code>resources:\n  requests:\n    cpu: \"300m\"      # Increase for higher load\n    memory: \"512Mi\"\n  limits:\n    cpu: \"1000m\"\n    memory: \"1Gi\"\n</code></pre></p>"},{"location":"playbooks/hardened-deployment-guide/#customization-options","title":"\ud83d\udd27 Customization Options","text":""},{"location":"playbooks/hardened-deployment-guide/#environment-variables","title":"Environment Variables","text":"<p>Add custom environment variables in the deployment: <pre><code>env:\n  - name: CUSTOM_VAR\n    value: \"custom-value\"\n  - name: SECRET_VAR\n    valueFrom:\n      secretKeyRef:\n        name: preview-worker-secrets\n        key: SECRET_VAR\n</code></pre></p>"},{"location":"playbooks/hardened-deployment-guide/#health-probe-paths","title":"Health Probe Paths","text":"<p>If your app uses different health endpoints: <pre><code>livenessProbe:\n  httpGet:\n    path: /your/health/path\n    port: http\n</code></pre></p>"},{"location":"playbooks/hardened-deployment-guide/#network-policies","title":"Network Policies","text":"<p>Add network policies for additional security: <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: preview-worker-network-policy\n  namespace: preview-worker\nspec:\n  podSelector:\n    matchLabels:\n      app: preview-worker\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre></p>"},{"location":"playbooks/hardened-deployment-guide/#testing","title":"\ud83e\uddea Testing","text":""},{"location":"playbooks/hardened-deployment-guide/#smoke-test","title":"Smoke Test","text":"<p>The included smoke test script performs: - Manifest validation - Deployment rollout verification - Pod health checks - Service connectivity tests - Health endpoint verification - Log analysis for errors</p>"},{"location":"playbooks/hardened-deployment-guide/#manual-testing","title":"Manual Testing","text":"<pre><code># Port forward\nkubectl -n preview-worker port-forward svc/preview-worker 8080:80\n\n# Test health\ncurl -s http://localhost:8080/api/preview/worker/health\n\n# Test metrics (if available)\ncurl -s http://localhost:8080/metrics\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#emergency-procedures","title":"\ud83d\udea8 Emergency Procedures","text":""},{"location":"playbooks/hardened-deployment-guide/#quick-rollback","title":"Quick Rollback","text":"<pre><code># Immediate rollback\nkubectl -n preview-worker rollout undo deployment/preview-worker\n\n# Force rollout restart\nkubectl -n preview-worker rollout restart deployment/preview-worker\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#complete-removal","title":"Complete Removal","text":"<pre><code># Delete everything\nkubectl delete namespace preview-worker\n\n# Or delete specific resources\nkubectl -n preview-worker delete -f k8s/preview-worker/hardened-deployment.yaml\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#performance-tuning","title":"\ud83d\udcc8 Performance Tuning","text":""},{"location":"playbooks/hardened-deployment-guide/#resource-optimization","title":"Resource Optimization","text":"<ul> <li>Monitor CPU/memory usage with <code>kubectl top</code></li> <li>Adjust requests/limits based on actual usage</li> <li>Use horizontal pod autoscaling for dynamic scaling</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#startup-optimization","title":"Startup Optimization","text":"<ul> <li>Optimize container image size</li> <li>Use multi-stage builds</li> <li>Implement proper health check timing</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#integration","title":"\ud83d\udd17 Integration","text":""},{"location":"playbooks/hardened-deployment-guide/#cicd-integration","title":"CI/CD Integration","text":"<pre><code># Add to your CI pipeline\nkubectl apply --dry-run=client -f k8s/preview-worker/hardened-deployment.yaml\nkubectl apply -f k8s/preview-worker/hardened-deployment.yaml -n preview-worker\nkubectl -n preview-worker rollout status deployment/preview-worker\n./k8s/preview-worker/smoke-test-preview-worker.sh\n</code></pre>"},{"location":"playbooks/hardened-deployment-guide/#gitops-integration","title":"GitOps Integration","text":"<ul> <li>Store manifests in Git repository</li> <li>Use ArgoCD or Flux for automated deployment</li> <li>Implement progressive delivery with Flagger</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#additional-resources","title":"\ud83d\udcda Additional Resources","text":""},{"location":"playbooks/hardened-deployment-guide/#kubernetes-documentation","title":"Kubernetes Documentation","text":"<ul> <li>Security Best Practices</li> <li>Resource Management</li> <li>Health Checks</li> </ul>"},{"location":"playbooks/hardened-deployment-guide/#monitoring-tools","title":"Monitoring Tools","text":"<ul> <li>Prometheus + Grafana for metrics</li> <li>Jaeger for distributed tracing</li> <li>ELK stack for centralized logging</li> </ul> <p>Next Steps: 1. Update the image registry in <code>hardened-deployment.yaml</code> 2. Create required secrets 3. Run the smoke test script 4. Monitor deployment health 5. Adjust resources based on actual usage</p> <p>Support: If you encounter issues, check the troubleshooting section or run the smoke test script for diagnostic information.</p>"},{"location":"playbooks/infrastructure-deployment-guide/","title":"Preview Worker Kubernetes Manifests - Infrastructure Deployment Guide","text":""},{"location":"playbooks/infrastructure-deployment-guide/#overview","title":"Overview","text":"<p>This document provides the necessary Kubernetes manifests and deployment instructions for the preview-worker service. Since no cluster connection is currently available, this serves as a manifest-only deployment package that can be applied by your infrastructure team.</p>"},{"location":"playbooks/infrastructure-deployment-guide/#prerequisites","title":"Prerequisites","text":""},{"location":"playbooks/infrastructure-deployment-guide/#required-tools","title":"Required Tools","text":"<ul> <li><code>kubectl</code> (v1.18 or later recommended)</li> <li><code>yq</code> (YAML processor) - optional but recommended for validation</li> <li>Cluster access with appropriate permissions</li> </ul>"},{"location":"playbooks/infrastructure-deployment-guide/#required-permissions","title":"Required Permissions","text":"<p>The applying user/service account needs these permissions in the target namespace: - <code>create</code>/<code>get</code>/<code>update</code>/<code>patch</code> for: deployments, services, configmaps, secrets - <code>create</code>/<code>get</code>/<code>list</code>/<code>watch</code> for: pods - <code>get</code>/<code>list</code> for: namespaces</p>"},{"location":"playbooks/infrastructure-deployment-guide/#manifest-files","title":"Manifest Files","text":""},{"location":"playbooks/infrastructure-deployment-guide/#1-deployment-manifest-deploymentyaml","title":"1. Deployment Manifest (<code>deployment.yaml</code>)","text":"<p>Location: <code>k8s/preview-worker/deployment.yaml</code> Key Configuration: - Image: <code>YOUR_REGISTRY/mobius-preview-worker:ci</code> (\u26a0\ufe0f REQUIRES UPDATE) - Replicas: 1 - Resources:    - Requests: 250m CPU, 512Mi memory   - Limits: 1 CPU, 1Gi memory - Health Checks:   - Readiness: <code>/api/preview/worker/health</code> (port 3000)   - Liveness: <code>/api/preview/worker/health</code> (port 3000) - Environment Variables:   - <code>NODE_ENV: production</code>   - <code>PREVIEW_QUEUE_NAME: preview-jobs</code>   - <code>PREVIEW_WORKER_CONCURRENCY: 2</code>   - <code>HEALTH_PORT: 3000</code></p>"},{"location":"playbooks/infrastructure-deployment-guide/#2-service-manifest-serviceyaml","title":"2. Service Manifest (<code>service.yaml</code>)","text":"<p>Location: <code>k8s/preview-worker/service.yaml</code> Key Configuration: - Type: ClusterIP (default) - Port: 80 (exposed) - Target Port: 3000 (container) - Selector: <code>app: preview-worker</code></p>"},{"location":"playbooks/infrastructure-deployment-guide/#pre-deployment-checklist","title":"Pre-Deployment Checklist","text":""},{"location":"playbooks/infrastructure-deployment-guide/#1-update-image-registry","title":"1. Update Image Registry","text":"<p>CRITICAL: Replace the placeholder image in <code>deployment.yaml</code>: <pre><code># CURRENT (placeholder):\nimage: YOUR_REGISTRY/mobius-preview-worker:ci\n\n# UPDATE to your actual registry:\nimage: your-registry.com/mobius-preview-worker:1.0.0\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#2-create-required-configmap-and-secret","title":"2. Create Required ConfigMap and Secret","text":"<p>The deployment expects these resources to exist: - ConfigMap: <code>preview-worker-config</code> - Secret: <code>preview-worker-secrets</code></p> <p>Create them before deployment: <pre><code># Example ConfigMap (adjust values as needed)\nkubectl create configmap preview-worker-config \\\n  --from-literal=LOG_LEVEL=info \\\n  --from-literal=MAX_CONCURRENT_JOBS=5 \\\n  -n preview-worker\n\n# Example Secret (adjust values as needed)\nkubectl create secret generic preview-worker-secrets \\\n  --from-literal=API_KEY=your-api-key \\\n  --from-literal=DATABASE_URL=your-database-url \\\n  -n preview-worker\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#3-validate-manifests","title":"3. Validate Manifests","text":"<p>Run validation before deployment: <pre><code># Basic YAML validation\nfor file in k8s/preview-worker/*.yaml; do\n  yq eval '.' \"$file\" &gt; /dev/null &amp;&amp; echo \"\u2713 $file valid\" || echo \"\u2717 $file invalid\"\ndone\n\n# Kubernetes validation (requires cluster access)\nkubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#deployment-instructions","title":"Deployment Instructions","text":""},{"location":"playbooks/infrastructure-deployment-guide/#option-1-direct-apply-recommended","title":"Option 1: Direct Apply (Recommended)","text":"<pre><code># Create namespace\nkubectl create namespace preview-worker\n\n# Apply manifests\nkubectl apply -f k8s/preview-worker/ -n preview-worker\n\n# Wait for deployment to be ready\nkubectl rollout status deployment/preview-worker -n preview-worker --timeout=5m\n\n# Verify deployment\nkubectl get pods -n preview-worker\nkubectl get svc -n preview-worker\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#option-2-using-generated-scripts","title":"Option 2: Using Generated Scripts","text":"<p>Use the provided deployment scripts for a more controlled deployment: <pre><code># Make script executable\nchmod +x deploy-preview-worker.sh\n\n# Run deployment\n./deploy-preview-worker.sh\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#post-deployment-verification","title":"Post-Deployment Verification","text":""},{"location":"playbooks/infrastructure-deployment-guide/#1-check-pod-status","title":"1. Check Pod Status","text":"<pre><code>kubectl get pods -n preview-worker -o wide\nkubectl describe pod -l app=preview-worker -n preview-worker\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#2-check-service","title":"2. Check Service","text":"<pre><code>kubectl get svc preview-worker -n preview-worker\nkubectl describe svc preview-worker -n preview-worker\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#3-check-logs","title":"3. Check Logs","text":"<pre><code># Get pod name\nPOD_NAME=$(kubectl get pods -n preview-worker -l app=preview-worker -o jsonpath='{.items[0].metadata.name}')\n\n# Check logs\nkubectl logs \"$POD_NAME\" -n preview-worker --tail=100\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#4-test-health-endpoint","title":"4. Test Health Endpoint","text":"<pre><code># Port forward for testing\nkubectl port-forward svc/preview-worker 8080:80 -n preview-worker &amp;\n\n# Test health endpoint\ncurl -s http://localhost:8080/api/preview/worker/health\n\n# Test metrics endpoint (if available)\ncurl -s http://localhost:8080/metrics | head -20\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#rollback-instructions","title":"Rollback Instructions","text":"<p>If deployment issues occur, rollback using one of these methods:</p>"},{"location":"playbooks/infrastructure-deployment-guide/#method-1-rollout-undo","title":"Method 1: Rollout Undo","text":"<pre><code>kubectl rollout undo deployment/preview-worker -n preview-worker\nkubectl rollout status deployment/preview-worker -n preview-worker --timeout=5m\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#method-2-using-rollback-script","title":"Method 2: Using Rollback Script","text":"<pre><code>chmod +x rollback-preview-worker.sh\n./rollback-preview-worker.sh\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#method-3-delete-and-recreate","title":"Method 3: Delete and Recreate","text":"<pre><code>kubectl delete -f k8s/preview-worker/ -n preview-worker\n# Fix issues and re-apply\nkubectl apply -f k8s/preview-worker/ -n preview-worker\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"playbooks/infrastructure-deployment-guide/#common-issues","title":"Common Issues","text":""},{"location":"playbooks/infrastructure-deployment-guide/#1-image-pull-errors","title":"1. Image Pull Errors","text":"<pre><code># Check events\nkubectl get events -n preview-worker --sort-by='.lastTimestamp'\n\n# Common causes:\n# - Incorrect registry URL\n# - Missing image tag\n# - Authentication issues\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#2-pod-crashloopbackoff","title":"2. Pod CrashLoopBackOff","text":"<pre><code># Check logs\nkubectl logs -l app=preview-worker -n preview-worker --tail=200\n\n# Check previous container logs\nkubectl logs -l app=preview-worker -n preview-worker --previous\n\n# Common causes:\n# - Missing ConfigMap/Secret\n# - Environment variable issues\n# - Application startup errors\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#3-service-not-accessible","title":"3. Service Not Accessible","text":"<pre><code># Check service endpoints\nkubectl get endpoints preview-worker -n preview-worker\n\n# Check service selector matches pod labels\nkubectl get pods -n preview-worker --show-labels\n</code></pre>"},{"location":"playbooks/infrastructure-deployment-guide/#health-check-script","title":"Health Check Script","text":"<p>Use the provided health check script for comprehensive verification: <pre><code>chmod +x health-check-preview-worker.sh\n./health-check-preview-worker.sh\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#security-considerations","title":"Security Considerations","text":""},{"location":"playbooks/infrastructure-deployment-guide/#1-network-policies","title":"1. Network Policies","text":"<p>Consider implementing network policies to restrict traffic: <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: preview-worker-network-policy\n  namespace: preview-worker\nspec:\n  podSelector:\n    matchLabels:\n      app: preview-worker\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#2-resource-limits","title":"2. Resource Limits","text":"<p>The deployment includes resource limits to prevent resource exhaustion: - CPU: 250m request, 1 limit - Memory: 512Mi request, 1Gi limit</p>"},{"location":"playbooks/infrastructure-deployment-guide/#3-security-context","title":"3. Security Context","text":"<p>Consider adding security context to the deployment: <pre><code>securityContext:\n  runAsNonRoot: true\n  runAsUser: 1000\n  fsGroup: 2000\n</code></pre></p>"},{"location":"playbooks/infrastructure-deployment-guide/#monitoring-and-alerting","title":"Monitoring and Alerting","text":""},{"location":"playbooks/infrastructure-deployment-guide/#key-metrics-to-monitor","title":"Key Metrics to Monitor","text":"<ul> <li>Pod restart count</li> <li>Resource usage (CPU/memory)</li> <li>Health check success rate</li> <li>Queue processing metrics (if applicable)</li> </ul>"},{"location":"playbooks/infrastructure-deployment-guide/#recommended-alerts","title":"Recommended Alerts","text":"<ul> <li>High pod restart rate</li> <li>High resource usage</li> <li>Health check failures</li> <li>Deployment rollout failures</li> </ul>"},{"location":"playbooks/infrastructure-deployment-guide/#support","title":"Support","text":"<p>If you encounter issues during deployment:</p> <ol> <li>Check this guide for common issues and solutions</li> <li>Use the health check script for diagnostic information</li> <li>Review pod logs for application-specific errors</li> <li>Contact the development team with:</li> <li>Error messages and logs</li> <li>Cluster configuration details</li> <li>Steps to reproduce the issue</li> </ol>"},{"location":"playbooks/infrastructure-deployment-guide/#files-summary","title":"Files Summary","text":"File Purpose Status <code>deployment.yaml</code> Main application deployment \u2705 Ready (update image required) <code>service.yaml</code> Service exposure \u2705 Ready <code>validate-and-prepare-manifests.sh</code> Validation script \u2705 Available <code>deploy-preview-worker.sh</code> Deployment script \u2705 Generated <code>rollback-preview-worker.sh</code> Rollback script \u2705 Generated <code>health-check-preview-worker.sh</code> Health check script \u2705 Generated <p>Next Steps: 1. Update the image registry in <code>deployment.yaml</code> 2. Create required ConfigMap and Secret 3. Apply manifests using provided instructions 4. Run post-deployment verification 5. Use health check script for monitoring</p>"},{"location":"playbooks/merge-checklist-preview-worker/","title":"PR #165 - Preview Worker Image Update - Status Update","text":""},{"location":"playbooks/merge-checklist-preview-worker/#work-completed","title":"Work Completed","text":"<ol> <li>Identified Potential CI Issues:</li> <li>Image pull failures due to non-existent registry.example.com/mobius-preview-worker:1.0.0</li> <li> <p>Missing deployment files that could cause kubectl validation to fail</p> </li> <li> <p>Implemented Fixes:</p> </li> <li>Updated <code>k8s/preview-worker/deployment.yaml</code> with a placeholder image tag (<code>YOUR_REGISTRY/mobius-preview-worker:TAG</code>)</li> <li>Ensured all required Kubernetes manifest files exist (deployment.yaml, service.yaml, etc.)</li> <li> <p>Committed and pushed changes to fix potential CI failures</p> </li> <li> <p>Created Documentation:</p> </li> <li>CI_RUNS_TRIAGE.md - Documents anticipated CI failures and implemented fixes</li> <li>CI_FIXES_SUMMARY.md - Summary of CI fixes for the PR</li> </ol>"},{"location":"playbooks/merge-checklist-preview-worker/#files-modified","title":"Files Modified","text":"<ul> <li>k8s/preview-worker/deployment.yaml (updated image tag to placeholder)</li> <li>k8s/preview-worker/service.yaml (created if missing)</li> </ul>"},{"location":"playbooks/merge-checklist-preview-worker/#next-steps","title":"Next Steps","text":"<ol> <li>Monitor CI Runs: Check the PR page for CI status and any failure reports</li> <li>Address Additional Issues: Fix any other CI failures that may arise</li> <li>Prepare for Merge: Once CI is passing, proceed with the merge checklist</li> <li>Execute Rollout Plan: Follow the production rollout steps as outlined in the PR description</li> </ol>"},{"location":"playbooks/merge-checklist-preview-worker/#required-actions","title":"Required Actions","text":"<ul> <li>Review the CI_RUNS_TRIAGE.md and CI_FIXES_SUMMARY.md documents</li> <li>Check PR #165 on GitHub for CI status</li> <li>Address any additional CI failures that may occur</li> </ul>"},{"location":"playbooks/monitoring-and-rollback/","title":"Monitoring &amp; rollback (copy/paste into runbook)","text":""},{"location":"playbooks/monitoring-and-rollback/#metrics-to-monitor","title":"Metrics to monitor","text":"<ul> <li>preview_requests_total (counter)</li> <li>preview_failures_total (counter)</li> <li>preview_duration_ms (histogram)</li> <li>preview_queue_length (gauge)</li> <li>DATA_DIR free space (gauge)</li> </ul>"},{"location":"playbooks/monitoring-and-rollback/#alerts-thresholds","title":"Alerts &amp; thresholds","text":"<ul> <li>preview_failures_total rate &gt; 1% over 5m \u2192 P2 alert</li> <li>preview_queue_length &gt;= 80% PREVIEW_QUEUE_MAX for &gt; 10m \u2192 P1</li> <li>DATA_DIR free &lt; 15% \u2192 P1</li> </ul>"},{"location":"playbooks/monitoring-and-rollback/#immediate-triage-steps","title":"Immediate triage steps","text":"<ul> <li>Check logs for requestId.</li> <li>Inspect DATA_DIR/previews for artifacts.</li> <li>Check metrics and queue depth.</li> <li>If failing: set PREVIEW_MAX_CONCURRENCY=0 (block new render jobs) and pause traffic.</li> <li>If disk space low: free space or increase volume.</li> <li>Rollback to prior staging tag if errors persist and match rollout timeline.</li> </ul>"},{"location":"playbooks/monitoring-deployment-guide/","title":"Monitoring Deployment Guide","text":""},{"location":"playbooks/monitoring-deployment-guide/#overview","title":"Overview","text":"<p>This guide provides instructions for deploying and configuring the monitoring stack for the Mobius Preview Worker, including Prometheus integration, alerting rules, and validation procedures.</p>"},{"location":"playbooks/monitoring-deployment-guide/#prerequisites","title":"Prerequisites","text":""},{"location":"playbooks/monitoring-deployment-guide/#kubernetes-cluster","title":"Kubernetes Cluster","text":"<ul> <li>Access to a Kubernetes cluster with appropriate permissions</li> <li>kubectl CLI configured and authenticated</li> <li>Helm CLI installed (optional but recommended)</li> </ul>"},{"location":"playbooks/monitoring-deployment-guide/#monitoring-tools","title":"Monitoring Tools","text":"<ul> <li>Prometheus Operator installed in the cluster</li> <li>Alertmanager configured for alert routing</li> <li>Grafana for dashboard visualization (optional)</li> </ul>"},{"location":"playbooks/monitoring-deployment-guide/#prometheus-deployment","title":"Prometheus Deployment","text":""},{"location":"playbooks/monitoring-deployment-guide/#installing-prometheus-operator","title":"Installing Prometheus Operator","text":"<p>If not already installed, deploy Prometheus Operator using Helm:</p> <pre><code># Add the prometheus-community Helm repository\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\n\n# Update Helm repositories\nhelm repo update\n\n# Install Prometheus Operator\nhelm install prometheus prometheus-community/kube-prometheus-stack \\\n  --namespace monitoring \\\n  --create-namespace\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#verifying-prometheus-installation","title":"Verifying Prometheus Installation","text":"<pre><code># Check Prometheus pods\nkubectl -n monitoring get pods -l app.kubernetes.io/name=prometheus\n\n# Check Prometheus service\nkubectl -n monitoring get svc prometheus-kube-prometheus-prometheus\n\n# Port forward to access Prometheus UI\nkubectl -n monitoring port-forward svc/prometheus-kube-prometheus-prometheus 9090\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#servicemonitor-configuration","title":"ServiceMonitor Configuration","text":""},{"location":"playbooks/monitoring-deployment-guide/#deploying-servicemonitor","title":"Deploying ServiceMonitor","text":"<p>The Mobius Preview Worker includes a ServiceMonitor configuration that needs to be applied:</p> <pre><code># Apply the ServiceMonitor\nkubectl apply -f k8s/preview-worker/servicemonitor.yaml\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#verifying-servicemonitor","title":"Verifying ServiceMonitor","text":"<pre><code># Check if ServiceMonitor is created\nkubectl -n preview-worker get servicemonitor\n\n# Check if Prometheus is scraping the endpoint\n# In Prometheus UI, go to Status \u2192 Targets and look for preview-worker\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#alert-rules-configuration","title":"Alert Rules Configuration","text":""},{"location":"playbooks/monitoring-deployment-guide/#deploying-alert-rules","title":"Deploying Alert Rules","text":"<p>The Mobius Preview Worker includes alert rules that need to be applied:</p> <pre><code># Apply the alert rules\nkubectl apply -f k8s/preview-worker/alert-rule-preview-worker.yaml\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#verifying-alert-rules","title":"Verifying Alert Rules","text":"<pre><code># Check if alert rules are loaded\n# In Prometheus UI, go to Alerts tab\n\n# Or use kubectl to check rules\nkubectl -n monitoring get prometheusrules\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#alertmanager-configuration","title":"Alertmanager Configuration","text":""},{"location":"playbooks/monitoring-deployment-guide/#configuring-alertmanager","title":"Configuring Alertmanager","text":"<p>Create or update the Alertmanager configuration:</p> <pre><code># alertmanager-config.yaml\nglobal:\n  resolve_timeout: 5m\n\nroute:\n  group_by: ['alertname']\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval: 1h\n  receiver: 'slack-notifications'\n\nreceivers:\n- name: 'slack-notifications'\n  slack_configs:\n  - api_url: '&lt;SLACK_WEBHOOK_URL&gt;'\n    channel: '#alerts'\n    send_resolved: true\n    title: '{{ template \"slack.default.title\" . }}'\n    text: '{{ template \"slack.default.text\" . }}'\n\n- name: 'pagerduty-notifications'\n  pagerduty_configs:\n  - routing_key: '&lt;PAGERDUTY_ROUTING_KEY&gt;'\n    send_resolved: true\n</code></pre> <p>Apply the configuration: <pre><code># Create a secret with the Alertmanager configuration\nkubectl -n monitoring create secret generic alertmanager-main \\\n  --from-file=alertmanager.yaml=alertmanager-config.yaml \\\n  --dry-run=client -o yaml | kubectl apply -f -\n</code></pre></p>"},{"location":"playbooks/monitoring-deployment-guide/#grafana-dashboard-setup","title":"Grafana Dashboard Setup","text":""},{"location":"playbooks/monitoring-deployment-guide/#installing-grafana","title":"Installing Grafana","text":"<p>If not already installed, deploy Grafana using Helm:</p> <pre><code># Install Grafana\nhelm install grafana grafana/grafana \\\n  --namespace monitoring \\\n  --set adminPassword=admin \\\n  --set service.type=LoadBalancer\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#creating-dashboards","title":"Creating Dashboards","text":"<p>Create a dashboard for the Preview Worker:</p> <pre><code>{\n  \"dashboard\": {\n    \"id\": null,\n    \"title\": \"Preview Worker Dashboard\",\n    \"tags\": [\"preview-worker\"],\n    \"timezone\": \"browser\",\n    \"schemaVersion\": 16,\n    \"version\": 0,\n    \"refresh\": \"25s\",\n    \"panels\": [\n      {\n        \"id\": 1,\n        \"title\": \"Job Processing Rate\",\n        \"type\": \"graph\",\n        \"datasource\": \"Prometheus\",\n        \"targets\": [\n          {\n            \"expr\": \"rate(preview_worker_job_outcomes_total[5m])\",\n            \"legendFormat\": \"{{outcome}}\",\n            \"refId\": \"A\"\n          }\n        ]\n      },\n      {\n        \"id\": 2,\n        \"title\": \"Job Duration\",\n        \"type\": \"graph\",\n        \"datasource\": \"Prometheus\",\n        \"targets\": [\n          {\n            \"expr\": \"histogram_quantile(0.95, rate(preview_worker_job_duration_seconds_bucket[5m]))\",\n            \"legendFormat\": \"95th percentile\",\n            \"refId\": \"A\"\n          }\n        ]\n      },\n      {\n        \"id\": 3,\n        \"title\": \"Active Jobs\",\n        \"type\": \"singlestat\",\n        \"datasource\": \"Prometheus\",\n        \"targets\": [\n          {\n            \"expr\": \"sum(preview_worker_active_jobs)\",\n            \"refId\": \"A\"\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#alerting-integrations","title":"Alerting Integrations","text":""},{"location":"playbooks/monitoring-deployment-guide/#slack-integration","title":"Slack Integration","text":"<ol> <li>Create a Slack app and webhook URL</li> <li>Update the Alertmanager configuration with the webhook URL</li> <li>Test the integration by creating a test alert</li> </ol>"},{"location":"playbooks/monitoring-deployment-guide/#pagerduty-integration","title":"PagerDuty Integration","text":"<ol> <li>Create a PagerDuty service and obtain the routing key</li> <li>Update the Alertmanager configuration with the routing key</li> <li>Test the integration by creating a test alert</li> </ol>"},{"location":"playbooks/monitoring-deployment-guide/#email-integration","title":"Email Integration","text":"<p>Configure email alerts in Alertmanager:</p> <pre><code>receivers:\n- name: 'email-notifications'\n  email_configs:\n  - to: 'team@example.com'\n    from: 'alerts@example.com'\n    smarthost: 'smtp.example.com:587'\n    auth_username: 'alerts@example.com'\n    auth_password: '&lt;SMTP_PASSWORD&gt;'\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#validation-procedures","title":"Validation Procedures","text":""},{"location":"playbooks/monitoring-deployment-guide/#1-metrics-validation","title":"1. Metrics Validation","text":"<pre><code># Check if metrics are being exposed by the application\nkubectl -n preview-worker port-forward svc/preview-worker 8080:80\ncurl http://localhost:8080/metrics\n\n# Check if Prometheus is scraping the metrics\n# In Prometheus UI, go to Status \u2192 Targets\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#2-alert-rule-validation","title":"2. Alert Rule Validation","text":"<pre><code># Simulate a high failure rate to trigger alerts\n# This would require a script to generate failed jobs\n\n# Check if alerts are firing\n# In Prometheus UI, go to Alerts tab\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#3-alertmanager-validation","title":"3. Alertmanager Validation","text":"<pre><code># Check Alertmanager status\nkubectl -n monitoring port-forward svc/alertmanager-main 9093\n# Visit http://localhost:9093\n\n# Send a test alert\ncurl -H \"Content-Type: application/json\" -d '[{\"status\": \"firing\", \"labels\": {\"alertname\": \"TestAlert\"}, \"annotations\": {\"summary\": \"Test alert\"}}]' http://localhost:9093/api/v1/alerts\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#4-integration-testing","title":"4. Integration Testing","text":"<pre><code># Simulate deployment failure\nkubectl -n preview-worker scale deployment preview-worker --replicas=0\n\n# Wait for alerts to fire\nsleep 60\n\n# Check notifications in Slack/PagerDuty/email\n</code></pre>"},{"location":"playbooks/monitoring-deployment-guide/#monitoring-dashboard","title":"Monitoring Dashboard","text":""},{"location":"playbooks/monitoring-deployment-guide/#key-metrics-to-monitor","title":"Key Metrics to Monitor","text":"<ol> <li>Job Processing Rate: Rate of jobs by outcome (success, failure, etc.)</li> <li>Job Duration: Time taken to process jobs (95th percentile)</li> <li>Active Jobs: Number of currently processing jobs</li> <li>Queue Size: Number of jobs waiting in queue</li> <li>Resource Usage: CPU and memory utilization</li> <li>Error Rate: Percentage of failed jobs</li> </ol>"},{"location":"playbooks/monitoring-deployment-guide/#dashboard-layout","title":"Dashboard Layout","text":"<ol> <li>Top Row: Key metrics overview (single stats)</li> <li>Middle Row: Job processing trends (graphs)</li> <li>Bottom Row: Resource utilization and error rates</li> </ol>"},{"location":"playbooks/monitoring-deployment-guide/#troubleshooting-common-issues","title":"Troubleshooting Common Issues","text":""},{"location":"playbooks/monitoring-deployment-guide/#metrics-not-appearing","title":"Metrics Not Appearing","text":"<p>Problem: Metrics not showing in Prometheus Solution:  1. Verify ServiceMonitor is correctly configured 2. Check that the application is exposing metrics on the correct port 3. Verify network policies allow Prometheus to scrape the endpoint</p>"},{"location":"playbooks/monitoring-deployment-guide/#alerts-not-firing","title":"Alerts Not Firing","text":"<p>Problem: Alert rules not triggering Solution: 1. Verify alert rules are correctly formatted 2. Check that the metrics exist and have the expected labels 3. Verify Alertmanager is correctly configured</p>"},{"location":"playbooks/monitoring-deployment-guide/#notifications-not-working","title":"Notifications Not Working","text":"<p>Problem: Alerts firing but notifications not received Solution: 1. Check Alertmanager configuration 2. Verify integration credentials (webhook URLs, API keys) 3. Test integrations manually</p>"},{"location":"playbooks/monitoring-deployment-guide/#performance-issues","title":"Performance Issues","text":"<p>Problem: High resource usage or slow metrics collection Solution: 1. Optimize metric collection intervals 2. Reduce cardinality of metrics 3. Scale Prometheus horizontally if needed</p>"},{"location":"playbooks/monitoring-deployment-guide/#conclusion","title":"Conclusion","text":"<p>This guide provides a comprehensive approach to deploying and configuring monitoring for the Mobius Preview Worker. By following these steps, you can ensure comprehensive observability with proper alerting and dashboard visualization.</p> <p>Regular review and updates to the monitoring configuration will help maintain visibility into the system's health and performance as it evolves.</p>"},{"location":"playbooks/ongoing-maintenance-guide/","title":"Ongoing Maintenance Guide","text":""},{"location":"playbooks/ongoing-maintenance-guide/#overview","title":"Overview","text":"<p>This guide establishes processes and procedures for the ongoing maintenance and continuous improvement of the Mobius Preview Worker deployment infrastructure. It includes review cadences, improvement planning, and backlog management.</p>"},{"location":"playbooks/ongoing-maintenance-guide/#bi-weekly-review-cadence","title":"Bi-Weekly Review Cadence","text":""},{"location":"playbooks/ongoing-maintenance-guide/#review-schedule","title":"Review Schedule","text":"<ul> <li>Frequency: Every two weeks on Monday mornings</li> <li>Duration: 1-2 hours per session</li> <li>Participants: Development leads, operations leads, and key stakeholders</li> <li>Facilitator: Rotating team lead</li> </ul>"},{"location":"playbooks/ongoing-maintenance-guide/#review-agenda","title":"Review Agenda","text":"<ol> <li>Metrics Analysis (30 minutes)</li> <li>Deployment success rates and trends</li> <li>Incident reports and root cause analysis</li> <li>Performance metrics and resource utilization</li> <li> <p>Security scan results and vulnerabilities</p> </li> <li> <p>Feedback Review (30 minutes)</p> </li> <li>Team feedback from deployment activities</li> <li>User feedback from documentation and tools</li> <li>Stakeholder input on operational effectiveness</li> <li> <p>Suggestions for improvement</p> </li> <li> <p>Improvement Planning (30-60 minutes)</p> </li> <li>Prioritization of backlog items</li> <li>Assignment of tasks and responsibilities</li> <li>Timeline and milestone setting</li> <li>Resource allocation and coordination</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#review-deliverables","title":"Review Deliverables","text":"<ul> <li>Metrics Report: Summary of key performance indicators</li> <li>Action Items: List of assigned tasks with deadlines</li> <li>Meeting Notes: Documentation of discussions and decisions</li> <li>Follow-up Schedule: Dates for next review and check-ins</li> </ul>"},{"location":"playbooks/ongoing-maintenance-guide/#improvement-planning-process","title":"Improvement Planning Process","text":""},{"location":"playbooks/ongoing-maintenance-guide/#idea-generation","title":"Idea Generation","text":"<ol> <li>Team Suggestions: Regular input from all team members</li> <li>Incident Analysis: Lessons learned from operational issues</li> <li>Technology Updates: New tools and practices in the industry</li> <li>User Feedback: Input from documentation users and tool operators</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#prioritization-framework","title":"Prioritization Framework","text":"<ol> <li>Impact Assessment</li> <li>High: Significant improvement in reliability, security, or efficiency</li> <li>Medium: Moderate improvement with clear benefits</li> <li> <p>Low: Minor enhancement with limited impact</p> </li> <li> <p>Effort Estimation</p> </li> <li>High: Complex implementation requiring significant resources</li> <li>Medium: Moderate implementation with reasonable effort</li> <li> <p>Low: Simple implementation with minimal effort</p> </li> <li> <p>Priority Matrix</p> </li> <li>High Impact / Low Effort: Immediate action</li> <li>High Impact / High Effort: Plan for upcoming sprints</li> <li>Low Impact / Low Effort: Consider for future inclusion</li> <li>Low Impact / High Effort: Defer or reconsider</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#implementation-planning","title":"Implementation Planning","text":"<ol> <li>Task Breakdown: Decompose improvements into manageable tasks</li> <li>Resource Allocation: Assign team members and estimate time requirements</li> <li>Timeline Setting: Establish realistic deadlines and milestones</li> <li>Risk Assessment: Identify potential challenges and mitigation strategies</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#backlog-management","title":"Backlog Management","text":""},{"location":"playbooks/ongoing-maintenance-guide/#backlog-categories","title":"Backlog Categories","text":"<ol> <li>Feature Requests</li> <li>New functionality for CLI tool</li> <li>Enhanced monitoring capabilities</li> <li>Additional deployment options</li> <li> <p>User experience improvements</p> </li> <li> <p>Technical Debt</p> </li> <li>Code refactoring opportunities</li> <li>Performance optimization tasks</li> <li>Security enhancement items</li> <li> <p>Documentation updates</p> </li> <li> <p>Bug Fixes</p> </li> <li>Reported issues from users</li> <li>Discovered problems during operations</li> <li>Edge case handling improvements</li> <li> <p>Compatibility fixes</p> </li> <li> <p>Process Improvements</p> </li> <li>Workflow optimization</li> <li>Automation opportunities</li> <li>Communication enhancements</li> <li>Governance updates</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#backlog-grooming","title":"Backlog Grooming","text":"<ol> <li>Regular Reviews: Monthly assessment of backlog items</li> <li>Priority Updates: Adjust priorities based on changing needs</li> <li>Decomposition: Break down large items into smaller tasks</li> <li>Removal: Eliminate outdated or irrelevant items</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#backlog-tracking","title":"Backlog Tracking","text":"<ol> <li>Issue Tracking: Use GitHub Issues or similar tool</li> <li>Status Updates: Regular updates on item progress</li> <li>Milestone Planning: Group items by release cycles</li> <li>Reporting: Regular reports on backlog health</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#metrics-and-reporting","title":"Metrics and Reporting","text":""},{"location":"playbooks/ongoing-maintenance-guide/#key-performance-indicators","title":"Key Performance Indicators","text":"<ol> <li>Reliability Metrics</li> <li>Deployment success rate</li> <li>Mean time to recovery (MTTR)</li> <li>Incident frequency and severity</li> <li> <p>System uptime</p> </li> <li> <p>Performance Metrics</p> </li> <li>Deployment duration</li> <li>Resource utilization</li> <li>Request latency</li> <li> <p>Error rates</p> </li> <li> <p>Security Metrics</p> </li> <li>Vulnerability scan results</li> <li>Failed authentication attempts</li> <li>Security incident frequency</li> <li> <p>Compliance status</p> </li> <li> <p>Team Productivity Metrics</p> </li> <li>Deployment frequency</li> <li>Lead time for changes</li> <li>Change failure rate</li> <li>Time to restore service</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#reporting-schedule","title":"Reporting Schedule","text":"<ol> <li>Daily: Automated dashboards with real-time metrics</li> <li>Weekly: Summary reports for team leads</li> <li>Monthly: Comprehensive analysis for stakeholders</li> <li>Quarterly: Strategic review for executive team</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#reporting-tools","title":"Reporting Tools","text":"<ol> <li>Dashboards: Grafana or similar visualization tools</li> <li>Reports: Automated generation of regular reports</li> <li>Alerts: Real-time notifications for critical issues</li> <li>Archives: Historical data for trend analysis</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#continuous-improvement-activities","title":"Continuous Improvement Activities","text":""},{"location":"playbooks/ongoing-maintenance-guide/#regular-assessments","title":"Regular Assessments","text":"<ol> <li>Technology Reviews: Evaluation of new tools and practices</li> <li>Process Audits: Assessment of workflow effectiveness</li> <li>Security Audits: Regular security posture evaluation</li> <li>User Experience Reviews: Feedback on tool usability</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#innovation-initiatives","title":"Innovation Initiatives","text":"<ol> <li>Hackathons: Dedicated time for experimental improvements</li> <li>Research Projects: Investigation of emerging technologies</li> <li>Proof of Concepts: Testing new approaches in isolated environments</li> <li>Pilot Programs: Limited deployment of new features</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#knowledge-sharing","title":"Knowledge Sharing","text":"<ol> <li>Lessons Learned: Documentation of successful improvements</li> <li>Best Practices: Sharing of effective approaches</li> <li>Community Engagement: Participation in industry forums</li> <li>Training Updates: Incorporation of new knowledge into training</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#communication-plan","title":"Communication Plan","text":""},{"location":"playbooks/ongoing-maintenance-guide/#internal-communication","title":"Internal Communication","text":"<ol> <li>Team Meetings: Regular sync-ups for status updates</li> <li>Stakeholder Updates: Periodic reports to management</li> <li>Documentation: Keeping all materials current</li> <li>Feedback Loops: Channels for continuous input</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#external-communication","title":"External Communication","text":"<ol> <li>Community Engagement: Sharing learnings with the broader community</li> <li>Industry Participation: Contributing to relevant forums and events</li> <li>Vendor Coordination: Working with tool providers on improvements</li> <li>User Support: Providing assistance to tool users</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#risk-management","title":"Risk Management","text":""},{"location":"playbooks/ongoing-maintenance-guide/#risk-identification","title":"Risk Identification","text":"<ol> <li>Technical Risks: Potential failures in implementation</li> <li>Resource Risks: Availability of team members and budget</li> <li>Schedule Risks: Delays in delivery timelines</li> <li>Quality Risks: Impact of changes on system stability</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#risk-mitigation","title":"Risk Mitigation","text":"<ol> <li>Testing: Comprehensive validation before deployment</li> <li>Rollback Plans: Ability to revert changes if needed</li> <li>Phased Rollouts: Gradual deployment to minimize impact</li> <li>Monitoring: Close observation of changes after deployment</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#risk-monitoring","title":"Risk Monitoring","text":"<ol> <li>Regular Reviews: Assessment of risk status during reviews</li> <li>Early Warning Systems: Alerts for emerging risks</li> <li>Contingency Planning: Preparation for risk realization</li> <li>Post-incident Analysis: Learning from risk events</li> </ol>"},{"location":"playbooks/ongoing-maintenance-guide/#conclusion","title":"Conclusion","text":"<p>This ongoing maintenance guide provides a structured approach to continuously improve the Mobius Preview Worker deployment infrastructure. By following the bi-weekly review cadence, improvement planning process, and backlog management practices, the team can ensure the system evolves to meet changing needs while maintaining reliability and security.</p> <p>Regular assessment and adaptation of these processes will help maintain their effectiveness as the system and team grow.</p>"},{"location":"playbooks/operational-runbook/","title":"Mobius Games Tutorial Generator - Operational Runbook","text":""},{"location":"playbooks/operational-runbook/#overview","title":"Overview","text":"<p>This document provides operational guidance for the Mobius Games Tutorial Generator, covering alerts, dashboards, saturation handling, retention policies, and service level objectives.</p>"},{"location":"playbooks/operational-runbook/#system-components","title":"System Components","text":""},{"location":"playbooks/operational-runbook/#api-endpoints","title":"API Endpoints","text":"<ul> <li><code>GET /health</code> - Health check endpoint</li> <li><code>GET /metrics</code> - Prometheus metrics endpoint</li> <li><code>POST /api/ingest</code> - PDF ingestion endpoint</li> <li><code>POST /api/preview</code> - Chapter preview generation endpoint</li> <li><code>POST /api/export</code> - Tutorial package export endpoint</li> </ul>"},{"location":"playbooks/operational-runbook/#core-services","title":"Core Services","text":"<ul> <li>PDF Text Extraction</li> <li>BoardGameGeek Metadata Fetching</li> <li>Storyboard Generation</li> <li>File Storage and Management</li> <li>Preview Generation</li> <li>Image Matching</li> </ul>"},{"location":"playbooks/operational-runbook/#configuration-parameters","title":"Configuration Parameters","text":""},{"location":"playbooks/operational-runbook/#environment-variables","title":"Environment Variables","text":"Variable Default Description API_VERSION v1 API version header DATA_DIR ./data Canonical data directory PORT 5001 Server port INGEST_MAX_CONCURRENCY 3 Maximum concurrent ingestion tasks INGEST_QUEUE_MAX 20 Maximum queue size for ingestion UPLOAD_MAX_MB 25 Maximum upload file size in MB NODE_ENV production Environment (production/development) BGG_CACHE_TTL_MS 86400000 (24h) BGG cache time-to-live in milliseconds BGG_RATE_LIMIT_QPS 2 BGG API rate limit in queries per second KEEP_UPLOADS_DAYS 30 Days to retain uploaded files KEEP_OUTPUT_DAYS 90 Days to retain output files"},{"location":"playbooks/operational-runbook/#monitoring-and-alerting","title":"Monitoring and Alerting","text":""},{"location":"playbooks/operational-runbook/#key-metrics","title":"Key Metrics","text":"<ul> <li><code>requests_total</code> - Total HTTP requests</li> <li><code>ingest_total</code> - Successful ingestions</li> <li><code>ingest_errors_total</code> - Failed ingestions</li> <li><code>ingest_rejected_saturated_total</code> - Rejected ingestions due to queue saturation</li> <li><code>errors_total</code> - Total application errors</li> <li><code>preview_requests_total</code> - Total preview requests</li> <li><code>preview_failures_total</code> - Total preview failures</li> <li><code>exports_generated_total</code> - Total exports generated</li> <li><code>export_errors_total</code> - Total export errors</li> </ul>"},{"location":"playbooks/operational-runbook/#alerting-rules","title":"Alerting Rules","text":"<ol> <li>High Error Rate: If <code>ingest_errors_total</code> increases by &gt;10% in 5 minutes</li> <li>Queue Saturation: If <code>ingest_rejected_saturated_total</code> &gt; 5 in 10 minutes</li> <li>Service Unavailability: If <code>health</code> endpoint returns non-200 for &gt; 30 seconds</li> <li>High Latency: If 95th percentile request latency &gt; 5 seconds for 5 minutes</li> <li>Preview Failures: If <code>preview_failures_total</code> &gt; 3 in 10 minutes</li> </ol>"},{"location":"playbooks/operational-runbook/#dashboards","title":"Dashboards","text":"<ol> <li>Ingestion Throughput: Requests per second, success/failure rates</li> <li>Resource Utilization: CPU, memory, disk usage</li> <li>Queue Metrics: Current queue size, saturation events</li> <li>BGG API Metrics: Cache hit rate, API response times</li> <li>Preview Metrics: Preview requests, failures, duration</li> </ol>"},{"location":"playbooks/operational-runbook/#saturation-handling","title":"Saturation Handling","text":""},{"location":"playbooks/operational-runbook/#queue-management","title":"Queue Management","text":"<ul> <li>Maximum concurrent ingestion tasks: 3</li> <li>Maximum queue size: 20</li> <li>When queue is saturated, API returns 503 with <code>Retry-After</code> header</li> <li>Clients should implement exponential backoff when receiving 503</li> </ul>"},{"location":"playbooks/operational-runbook/#rate-limiting","title":"Rate Limiting","text":"<ul> <li>BGG API rate limited to 2 QPS</li> <li>Requests are queued and processed with proper delays</li> <li>Cache is used to minimize external API calls</li> </ul>"},{"location":"playbooks/operational-runbook/#retention-policies","title":"Retention Policies","text":""},{"location":"playbooks/operational-runbook/#file-retention","title":"File Retention","text":"<ul> <li>Uploaded files: 30 days</li> <li>Output files: 90 days</li> <li>Preview files: 7 days</li> <li>Export files: 30 days</li> <li>Janitor job runs daily to clean up expired files</li> </ul>"},{"location":"playbooks/operational-runbook/#cache-retention","title":"Cache Retention","text":"<ul> <li>BGG metadata: 24 hours</li> <li>Cache is automatically refreshed after TTL expires</li> </ul>"},{"location":"playbooks/operational-runbook/#security","title":"Security","text":""},{"location":"playbooks/operational-runbook/#file-validation","title":"File Validation","text":"<ul> <li>Production environment only accepts PDF files</li> <li>Development environment allows PDF and text files</li> <li>Maximum file size enforced via Multer</li> <li>PDF header validation</li> <li>Suspicious content scanning (JavaScript, OpenAction, etc.)</li> <li>Encrypted PDF rejection</li> </ul>"},{"location":"playbooks/operational-runbook/#access-control","title":"Access Control","text":"<ul> <li>CORS restricted to localhost:3000 by default</li> <li>File uploads stored in private data directory</li> <li>No direct access to uploaded files via API</li> </ul>"},{"location":"playbooks/operational-runbook/#service-level-objectives-slos","title":"Service Level Objectives (SLOs)","text":""},{"location":"playbooks/operational-runbook/#availability","title":"Availability","text":"<ul> <li>99.9% uptime for API endpoints</li> <li>99.5% success rate for ingestion requests</li> <li>99.0% success rate for preview requests</li> </ul>"},{"location":"playbooks/operational-runbook/#latency","title":"Latency","text":"<ul> <li>95% of requests &lt; 2 seconds</li> <li>99% of requests &lt; 5 seconds</li> <li>Preview requests &lt; 10 seconds</li> </ul>"},{"location":"playbooks/operational-runbook/#durability","title":"Durability","text":"<ul> <li>99.99% data persistence for generated storyboards</li> <li>99.9% successful BGG metadata retrieval</li> <li>99.5% successful preview generation</li> </ul>"},{"location":"playbooks/operational-runbook/#response-schema-v1","title":"Response Schema (v1)","text":""},{"location":"playbooks/operational-runbook/#health-endpoint","title":"Health Endpoint","text":"<pre><code>{\n  \"status\": \"ok\",\n  \"time\": \"2025-10-08T17:02:05.323Z\",\n  \"requestId\": \"req_1caqt21zmgi8ks8t\",\n  \"hostname\": \"Cactuar\",\n  \"pid\": 63544\n}\n</code></pre>"},{"location":"playbooks/operational-runbook/#metrics-endpoint","title":"Metrics Endpoint","text":"<pre><code>{\n  \"counters\": {\n    \"requests_total\": 42,\n    \"ingest_total\": 5,\n    \"ingest_errors_total\": 1,\n    \"ingest_rejected_saturated_total\": 0,\n    \"errors_total\": 1,\n    \"preview_requests_total\": 3,\n    \"preview_failures_total\": 0,\n    \"exports_generated_total\": 2,\n    \"export_errors_total\": 0\n  }\n}\n</code></pre>"},{"location":"playbooks/operational-runbook/#ingest-endpoint-success","title":"Ingest Endpoint (Success)","text":"<pre><code>{\n  \"ok\": true,\n  \"id\": \"1a2b3c\",\n  \"file\": \"123456_rulebook.pdf\",\n  \"summary\": {\n    \"pages\": 24,\n    \"chunks\": 24,\n    \"tocDetected\": true,\n    \"flags\": {\n      \"pagesWithLowTextRatio\": [],\n      \"componentsDetected\": true\n    }\n  },\n  \"bgg\": {\n    \"title\": \"Wingspan\",\n    \"year\": 2019,\n    \"designers\": [\"Elizabeth Hargrave\"],\n    \"players\": \"1-5\",\n    \"time\": \"40-70\",\n    \"age\": \"10+\"\n  },\n  \"storyboardPath\": \"output/1a2b3c_storyboard.json\"\n}\n</code></pre>"},{"location":"playbooks/operational-runbook/#preview-endpoint-success","title":"Preview Endpoint (Success)","text":"<pre><code>{\n  \"status\": \"queued\",\n  \"requestId\": \"req_123456\",\n  \"jobToken\": \"abc123\",\n  \"previewPath\": \"previews/project1/chapter1.json\"\n}\n</code></pre>"},{"location":"playbooks/operational-runbook/#export-endpoint-success","title":"Export Endpoint (Success)","text":"<pre><code>{\n  \"ok\": true,\n  \"exportId\": \"def456\",\n  \"files\": {\n    \"chapters\": \"exports/def456_chapters.json\",\n    \"srt\": \"exports/def456_script.srt\",\n    \"meta\": \"exports/def456_meta.json\"\n  },\n  \"generatedAt\": \"2025-10-08T17:02:05.323Z\"\n}\n</code></pre>"},{"location":"playbooks/operational-runbook/#error-response","title":"Error Response","text":"<pre><code>{\n  \"error\": \"Server busy, try again later\"\n}\n</code></pre>"},{"location":"playbooks/operational-runbook/#troubleshooting","title":"Troubleshooting","text":""},{"location":"playbooks/operational-runbook/#common-issues","title":"Common Issues","text":"<ol> <li>503 Errors</li> <li>Cause: Ingestion queue is saturated</li> <li> <p>Solution: Wait for <code>Retry-After</code> seconds and retry request</p> </li> <li> <p>PDF Parsing Failures</p> </li> <li>Cause: Corrupted or encrypted PDF</li> <li> <p>Solution: Verify PDF integrity, ensure it's not encrypted</p> </li> <li> <p>BGG Metadata Not Found</p> </li> <li>Cause: Invalid BGG ID or network issues</li> <li> <p>Solution: Verify BGG ID, check network connectivity</p> </li> <li> <p>File Upload Rejected</p> </li> <li>Cause: Invalid file type or size in production</li> <li> <p>Solution: Ensure file is PDF and under size limit</p> </li> <li> <p>Preview Generation Failures</p> </li> <li>Cause: Invalid chapter data or system resource issues</li> <li>Solution: Verify chapter structure, check system resources</li> </ol>"},{"location":"playbooks/operational-runbook/#log-analysis","title":"Log Analysis","text":"<ul> <li>Structured JSON logs with request correlation</li> <li>Log levels: info, warn, error</li> <li>Request IDs for tracing operations</li> <li>Metrics counters for system state monitoring</li> </ul>"},{"location":"playbooks/operational-runbook/#maintenance","title":"Maintenance","text":""},{"location":"playbooks/operational-runbook/#daily-tasks","title":"Daily Tasks","text":"<ul> <li>Janitor job runs to clean up expired files</li> <li>Monitor queue saturation metrics</li> <li>Check BGG API rate limit usage</li> <li>Verify preview and export file retention</li> </ul>"},{"location":"playbooks/operational-runbook/#weekly-tasks","title":"Weekly Tasks","text":"<ul> <li>Review error logs for patterns</li> <li>Verify backup integrity</li> <li>Update dependencies</li> </ul>"},{"location":"playbooks/operational-runbook/#monthly-tasks","title":"Monthly Tasks","text":"<ul> <li>Review and adjust retention policies</li> <li>Performance tuning</li> <li>Security audit</li> </ul>"},{"location":"playbooks/operational-runbook/#phase-f-features","title":"Phase F Features","text":""},{"location":"playbooks/operational-runbook/#script-workbench","title":"Script Workbench","text":"<p>The Script Workbench provides a unified interface for: - Managing script content (chapters and steps) - Matching images to steps - Generating previews of chapters - Exporting tutorial packages</p>"},{"location":"playbooks/operational-runbook/#image-matcher","title":"Image Matcher","text":"<p>The Image Matcher allows: - Drag-and-drop association of images with steps - Visual preview of asset placement - Management of asset libraries - Persistence of image-step mappings</p>"},{"location":"playbooks/operational-runbook/#preview-generation","title":"Preview Generation","text":"<p>Preview generation features: - Dry-run mode for testing - Asynchronous processing with job queuing - Status tracking via job tokens - Artifact storage in canonical data directory</p>"},{"location":"playbooks/operational-runbook/#export-packaging","title":"Export Packaging","text":"<p>Export packaging capabilities: - Generation of chapters.json, SRT, and metadata files - Bundling of all tutorial assets - Versioned export identifiers - Automated file organization</p>"},{"location":"playbooks/pr-reviewer-checklist/","title":"PR Reviewer Checklist Comment for Phase F","text":""},{"location":"playbooks/pr-reviewer-checklist/#compact-copypaste-pr-reviewer-checklist","title":"Compact Copy/Paste PR Reviewer Checklist","text":"<p>Use this as the top-level PR comment for reviewers:</p> <pre><code>## Reviewer checklist \u2014 Phase F (Image Matcher + Preview)\n\n- [ ] PR body explains user-visible behavior and includes test instructions.\n- [ ] Files changed: confirm only intended files under client/src and src/api/handlers and .github/workflows.\n- [ ] CI: unit tests pass locally (jest + supertest) and CI workflow file is present if this PR includes CI changes.\n- [ ] Preview endpoint: POST /api/preview supports dryRun=true and writes to DATA_DIR in staging.\n- [ ] Metrics: preview_requests_total, preview_failures_total, preview_duration_ms registered.\n- [ ] Scripts: verify-phase-f.sh and verify-phase-f.ps1 present and executable; smoke tests referenced in SMOKE_TESTS.md.\n- [ ] Logging: structured JSON with requestId; no secrets logged.\n- [ ] Security: no hardcoded tokens or secrets in PR.\n- [ ] Documentation: MONITORING_AND_ROLLBACK.md and runbook updated.\n- [ ] Manual verify (Ops): ensure DATA_DIR writable, set PREVIEW_MAX_CONCURRENCY=1 and PREVIEW_QUEUE_MAX=20 for initial tests.\n\n/cc @developer @ops @team-lead\n</code></pre>"},{"location":"playbooks/pr-reviewer-checklist/#how-to-use","title":"How to Use","text":"<ol> <li>Copy the entire checklist above</li> <li>Paste it as a comment on the PR</li> <li>Tag the appropriate reviewers</li> <li>Reviewers can check off items as they complete their review</li> </ol>"},{"location":"playbooks/pr-reviewer-checklist/#tips-for-reviewers","title":"Tips for Reviewers","text":"<ul> <li>Focus on the acceptance criteria listed in the PR description</li> <li>Verify that all new functionality is covered by tests</li> <li>Check that documentation is updated to reflect new features</li> <li>Ensure security best practices are followed</li> <li>Validate that the implementation matches the design described in the PR</li> </ul>"},{"location":"playbooks/preview-runbook-snippet/","title":"Preview Feature Monitoring &amp; Rollback Procedures","text":""},{"location":"playbooks/preview-runbook-snippet/#monitoring","title":"Monitoring","text":""},{"location":"playbooks/preview-runbook-snippet/#key-metrics-to-watch","title":"Key Metrics to Watch","text":"<ol> <li>preview_failures_total - Counter for failed preview requests</li> <li>preview_requests_total - Counter for total preview requests</li> <li>preview_duration_ms - Histogram for preview request processing time</li> <li>preview_queue_length - Gauge for current queue depth</li> <li>DATA_DIR disk usage - Percentage of disk space used</li> </ol>"},{"location":"playbooks/preview-runbook-snippet/#alert-thresholds","title":"Alert Thresholds","text":"<ul> <li>preview_failures_total rate &gt; 1% for 5m \u2192 Investigate (P2 alert)</li> <li>preview_queue_length &gt;= PREVIEW_QUEUE_MAX * 0.8 for &gt; 10m \u2192 P1 alert</li> <li>DATA_DIR free space &lt; 15% \u2192 P1 alert</li> </ul>"},{"location":"playbooks/preview-runbook-snippet/#rollback-procedures","title":"Rollback Procedures","text":""},{"location":"playbooks/preview-runbook-snippet/#when-to-rollback","title":"When to Rollback","text":"<ol> <li>Sustained preview failure rate &gt; 5% for 10 minutes correlated to recent deploy</li> <li>Queue backlog causes resource exhaustion or increased error rates with CPU/mem &gt; 80% for 10 minutes</li> <li>Disk full risk due to uncontrolled artifact generation</li> </ol>"},{"location":"playbooks/preview-runbook-snippet/#rollback-steps","title":"Rollback Steps","text":"<ol> <li>Check Logs: Use requestId from error responses to trace specific failures in logs</li> <li>Inspect Artifacts: Examine preview artifacts under DATA_DIR/previews for corruption or unexpected content</li> <li>Throttle Traffic: Set PREVIEW_MAX_CONCURRENCY to 0 or pause incoming traffic to preview endpoint</li> <li>Rollback Deployment: Revert to previous staging tag using your standard rollback procedure</li> <li>Verify Recovery: Confirm metrics return to normal and new preview requests succeed</li> </ol>"},{"location":"playbooks/preview-runbook-snippet/#runbook-actions","title":"Runbook Actions","text":"<ol> <li>For High Failure Rate:</li> <li>Check logs for error patterns</li> <li>Validate input data formats</li> <li> <p>Verify dependencies (ffmpeg, etc.) are available</p> </li> <li> <p>For Queue Backlog:</p> </li> <li>Reduce PREVIEW_MAX_CONCURRENCY temporarily</li> <li>Check worker health and resource allocation</li> <li> <p>Consider increasing PREVIEW_QUEUE_MAX if legitimate traffic spike</p> </li> <li> <p>For Disk Space Issues:</p> </li> <li>Implement aggressive cleanup of old preview artifacts</li> <li>Check for orphaned files not associated with active projects</li> <li>Consider reducing retention period for preview artifacts</li> </ol>"},{"location":"playbooks/preview-worker-complete-deployment-package/","title":"Preview Worker Complete Deployment Package","text":"<p>This document provides a comprehensive overview of all artifacts created for the Preview Worker implementation.</p>"},{"location":"playbooks/preview-worker-complete-deployment-package/#kubernetes-manifests","title":"Kubernetes Manifests","text":"<p>All manifests are located in the <code>k8s/preview-worker/</code> directory:</p> <ol> <li><code>deployment.yaml</code> - Main deployment configuration</li> <li><code>configmap.yaml</code> - Configuration values</li> <li><code>service.yaml</code> - Service definition</li> <li><code>hpa.yaml</code> - Horizontal Pod Autoscaler</li> <li><code>servicemonitor.yaml</code> - Prometheus ServiceMonitor</li> <li><code>secret-example.yaml</code> - Secret template</li> <li><code>alert-rule-preview-worker.yaml</code> - Prometheus alert rules</li> </ol>"},{"location":"playbooks/preview-worker-complete-deployment-package/#generated-artifacts","title":"Generated Artifacts","text":"<ol> <li><code>PREVIEW_WORKER_FINAL_MANIFESTS_SUMMARY.md</code> - Summary of finalized manifests</li> <li><code>PR_BODY_PREVIEW_WORKER_FINAL.md</code> - PR body for the final manifests</li> <li><code>PREVIEW_WORKER_DEPLOYMENT_CHECKLIST.md</code> - Deployment verification checklist</li> <li><code>preview-worker-final-manifests.patch</code> - Git patch with all changes</li> </ol>"},{"location":"playbooks/preview-worker-complete-deployment-package/#configuration-used","title":"Configuration Used","text":"<ul> <li>Container Image: <code>ghcr.io/your-org/mobius-preview-worker:latest</code></li> <li>Namespace: <code>preview-worker</code></li> <li>Image Pull Policy: <code>IfNotPresent</code></li> <li>Replicas: <code>1</code></li> <li>Worker Concurrency: <code>2</code></li> <li>Redis Connection: <code>redis://redis.default.svc.cluster.local:6379</code></li> <li>HPA: Enabled (1\u21926 replicas, CPU target 60%)</li> <li>Prometheus ServiceMonitor Label: <code>release=prometheus</code></li> </ul>"},{"location":"playbooks/preview-worker-complete-deployment-package/#deployment-commands","title":"Deployment Commands","text":"<pre><code># Create the namespace\nkubectl create namespace preview-worker\n\n# Apply the manifests\nkubectl apply -f k8s/preview-worker/\n\n# Check deployment status\nkubectl -n preview-worker get deployments\nkubectl -n preview-worker get pods\n</code></pre>"},{"location":"playbooks/preview-worker-complete-deployment-package/#verification-steps","title":"Verification Steps","text":"<ol> <li>Health endpoint check</li> <li>Dry-run job submission</li> <li>Metrics endpoint verification</li> <li>HPA status check</li> <li>ServiceMonitor verification</li> </ol>"},{"location":"playbooks/preview-worker-complete-deployment-package/#rollback-procedure","title":"Rollback Procedure","text":"<pre><code>kubectl delete -f k8s/preview-worker/\nkubectl delete namespace preview-worker\n</code></pre>"},{"location":"playbooks/preview-worker-complete-deployment-package/#next-steps","title":"Next Steps","text":"<ol> <li>Replace placeholder container image with actual image</li> <li>Update Redis connection details as needed</li> <li>Add actual Redis password to secrets</li> <li>Adjust resource limits based on environment</li> <li>Configure proper monitoring and alerting</li> </ol>"},{"location":"playbooks/preview-worker-deployment-checklist/","title":"Preview Worker Deployment Checklist","text":""},{"location":"playbooks/preview-worker-deployment-checklist/#pre-deployment","title":"Pre-deployment","text":"<ul> <li>[ ] Verify container image is available in registry</li> <li>[ ] Update Redis connection details if needed</li> <li>[ ] Add actual Redis password to secrets</li> <li>[ ] Review resource limits for your environment</li> </ul>"},{"location":"playbooks/preview-worker-deployment-checklist/#deployment","title":"Deployment","text":"<ul> <li>[ ] Create namespace: <code>kubectl create namespace preview-worker</code></li> <li>[ ] Apply manifests: <code>kubectl apply -f k8s/preview-worker/</code></li> <li>[ ] Verify deployment: <code>kubectl -n preview-worker get deployments</code></li> <li>[ ] Check pod status: <code>kubectl -n preview-worker get pods</code></li> </ul>"},{"location":"playbooks/preview-worker-deployment-checklist/#health-checks","title":"Health Checks","text":"<ul> <li>[ ] Port forward: <code>kubectl -n preview-worker port-forward service/preview-worker 3000:3000</code></li> <li>[ ] Health endpoint: <code>curl http://localhost:3000/api/preview/worker/health</code></li> <li>[ ] Metrics endpoint: <code>curl http://localhost:3000/metrics</code></li> </ul>"},{"location":"playbooks/preview-worker-deployment-checklist/#functionality-tests","title":"Functionality Tests","text":"<ul> <li>[ ] Submit dry-run job: <code>curl -X POST http://localhost:3000/api/preview/job -H \"Content-Type: application/json\" -d @preview_payload_minimal.json</code></li> <li>[ ] Check HPA status: <code>kubectl -n preview-worker get hpa</code></li> <li>[ ] Verify ServiceMonitor: <code>kubectl -n preview-worker get servicemonitor</code></li> </ul>"},{"location":"playbooks/preview-worker-deployment-checklist/#monitoring","title":"Monitoring","text":"<ul> <li>[ ] Check Prometheus is scraping metrics</li> <li>[ ] Verify alert rules are loaded</li> <li>[ ] Confirm logs are being collected</li> </ul>"},{"location":"playbooks/preview-worker-deployment-checklist/#rollback-if-needed","title":"Rollback (if needed)","text":"<ul> <li>[ ] Delete resources: <code>kubectl delete -f k8s/preview-worker/</code></li> <li>[ ] Delete namespace: <code>kubectl delete namespace preview-worker</code></li> </ul>"},{"location":"playbooks/preview-worker-deployment-guide/","title":"Preview Worker Deployment Guide","text":"<p>This guide explains how to deploy the Preview Worker to a Kubernetes cluster with proper configuration and testing.</p>"},{"location":"playbooks/preview-worker-deployment-guide/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster access (kubectl configured)</li> <li>Docker (for building images locally)</li> <li>Registry access for pushing images</li> <li>GitHub CLI (gh) for PR creation (optional)</li> <li>sed, grep, or perl for image tag replacement</li> </ul>"},{"location":"playbooks/preview-worker-deployment-guide/#step-1-build-and-push-the-container-image","title":"Step 1: Build and Push the Container Image","text":""},{"location":"playbooks/preview-worker-deployment-guide/#option-a-build-locally","title":"Option A: Build locally","text":"<pre><code># Build the image\ndocker build -t YOUR_REGISTRY/mobius-preview-worker:1.0.0 -f Dockerfile .\n\n# Push the image\ndocker push YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#option-b-use-github-actions","title":"Option B: Use GitHub Actions","text":"<p>The CI workflow will automatically build and push images on merge to main branch.</p>"},{"location":"playbooks/preview-worker-deployment-guide/#step-2-update-image-tag-in-manifests","title":"Step 2: Update Image Tag in Manifests","text":""},{"location":"playbooks/preview-worker-deployment-guide/#using-the-provided-scripts","title":"Using the provided scripts:","text":""},{"location":"playbooks/preview-worker-deployment-guide/#bash-unixlinuxmacos","title":"Bash (Unix/Linux/macOS):","text":"<pre><code># Update the image tag\n./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#powershell-windows","title":"PowerShell (Windows):","text":"<pre><code># Update the image tag\n.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#manual-update-cross-platform-safe-methods","title":"Manual update (cross-platform safe methods):","text":""},{"location":"playbooks/preview-worker-deployment-guide/#using-grep-and-sed-linux","title":"Using grep and sed (Linux):","text":"<pre><code>IMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} sed -i \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#using-grep-and-sed-macos","title":"Using grep and sed (macOS):","text":"<pre><code>IMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} sed -i '' \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#using-perl-cross-platform","title":"Using Perl (cross-platform):","text":"<pre><code>IMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} perl -pi -e \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#step-3-pre-commit-safety-checks","title":"Step 3: Pre-Commit Safety Checks","text":"<p>Before committing changes, run these validation steps:</p> <pre><code># Check what files changed\ngit status\ngit diff -- k8s/preview-worker/\n\n# Run tests\nnpm ci\nnpm run test:preview-payloads\nnpm test\n\n# Run linter if present\nnpm run lint --if-present\n\n# Check for accidentally committed secrets\ngit diff --staged\n\n# Validate manifests syntax\nkubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#step-4-commit-and-create-pr","title":"Step 4: Commit and Create PR","text":"<pre><code># Commit the changes\ngit add k8s/preview-worker/deployment.yaml\ngit commit -m \"chore(k8s): update preview worker image to YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n\n# Push the branch\ngit push origin your-branch-name\n\n# Create PR using GitHub CLI\ngh pr create --title \"k8s: preview-worker manifests\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_FINAL.md --base main --head your-branch-name\n</code></pre> <p>If gh is not installed or authenticated, create the PR via the GitHub web UI.</p>"},{"location":"playbooks/preview-worker-deployment-guide/#step-5-configure-environment-specific-settings","title":"Step 5: Configure Environment-Specific Settings","text":""},{"location":"playbooks/preview-worker-deployment-guide/#update-redis-connection","title":"Update Redis Connection","text":"<p>Edit <code>k8s/preview-worker/configmap.yaml</code> and update the Redis URL: <pre><code>REDIS_URL: \"redis://your-redis-host:6379\"\n</code></pre></p>"},{"location":"playbooks/preview-worker-deployment-guide/#create-secrets","title":"Create Secrets","text":"<p>Create a secret with your Redis password: <pre><code>kubectl create secret generic preview-worker-secrets \\\n  --from-literal=REDIS_PASSWORD=your-redis-password \\\n  -n preview-worker\n</code></pre></p>"},{"location":"playbooks/preview-worker-deployment-guide/#step-6-deploy-to-staging","title":"Step 6: Deploy to Staging","text":"<pre><code># Create namespace\nkubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\n\n# Apply manifests\nkubectl apply -n preview-worker -f k8s/preview-worker/\n\n# Verify deployment\nkubectl -n preview-worker get all\nkubectl -n preview-worker get hpa\nkubectl -n preview-worker get servicemonitor\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#step-7-run-smoke-tests","title":"Step 7: Run Smoke Tests","text":""},{"location":"playbooks/preview-worker-deployment-guide/#port-forward-the-service","title":"Port-forward the service:","text":"<pre><code>kubectl -n preview-worker port-forward svc/preview-worker 3000:3000 &amp;\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#check-health-endpoint","title":"Check health endpoint:","text":"<pre><code>curl -sS http://localhost:3000/api/preview/worker/health | jq\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#check-metrics","title":"Check metrics:","text":"<pre><code>curl -sS http://localhost:3000/metrics | head -n 40\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#submit-test-jobs","title":"Submit test jobs:","text":""},{"location":"playbooks/preview-worker-deployment-guide/#dry-run-job","title":"Dry-run job:","text":"<pre><code>curl -X POST http://localhost:3000/api/preview/jobs \\\n  -H \"Content-Type: application/json\" \\\n  -d @preview_payload_minimal.json | jq\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#full-job","title":"Full job:","text":"<pre><code>curl -X POST http://localhost:3000/api/preview/jobs \\\n  -H \"Content-Type: application/json\" \\\n  -d @preview_payload_full.json | jq\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#step-8-monitor-deployment","title":"Step 8: Monitor Deployment","text":""},{"location":"playbooks/preview-worker-deployment-guide/#check-logs","title":"Check logs:","text":"<pre><code>kubectl -n preview-worker logs -l app=preview-worker --tail=200 -f\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#check-job-status","title":"Check job status:","text":"<pre><code>curl http://localhost:3000/api/preview/jobs/&lt;jobId&gt;/status\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#verify-metrics-in-prometheus","title":"Verify metrics in Prometheus:","text":"<ul> <li>preview_job_started</li> <li>preview_job_completed</li> <li>preview_job_failed</li> <li>preview_job_invalid</li> <li>preview_job_dryrun</li> <li>preview_job_duration_ms</li> </ul>"},{"location":"playbooks/preview-worker-deployment-guide/#step-9-staged-rollout","title":"Step 9: Staged Rollout","text":"<ol> <li>Staging (replicas=1, concurrency=1) - 24-48 hours smoke tests</li> <li>Canary production - Route small % of jobs</li> <li>Gradual scale up - Increase concurrency and replicas</li> <li>Full rollout - Complete deployment</li> </ol>"},{"location":"playbooks/preview-worker-deployment-guide/#rollback-procedure","title":"Rollback Procedure","text":"<p>If issues are encountered:</p> <pre><code># Scale to 0\nkubectl -n preview-worker scale deployment/preview-worker --replicas=0\n\n# Or rollback deployment\nkubectl -n preview-worker rollout undo deployment/preview-worker\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-guide/#alerting","title":"Alerting","text":"<p>Ensure these alerts are configured: - High failure rate: failure rate &gt; 10% over 5m - Queue backlog threshold: waiting jobs &gt; X - Worker crash loop or liveness failure</p>"},{"location":"playbooks/preview-worker-deployment-guide/#cicd","title":"CI/CD","text":"<p>The GitHub Actions workflow <code>.github/workflows/preview-worker-build-push.yml</code> will: 1. Run tests on PRs 2. Build and push images on merge to main</p>"},{"location":"playbooks/preview-worker-deployment-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"playbooks/preview-worker-deployment-guide/#common-issues","title":"Common Issues:","text":"<ol> <li>sed/grep not found: Install via package manager or use the Perl command above</li> <li>Tests failing: Run individual test commands to identify the specific failure</li> <li>gh not installed: Create the PR in GitHub web UI or install gh with <code>brew install gh</code> (macOS) or <code>apt install gh</code> (Ubuntu)</li> <li>Permission denied: Ensure you have proper Kubernetes RBAC permissions</li> <li>Image pull errors: Verify the image tag and registry authentication</li> </ol>"},{"location":"playbooks/preview-worker-deployment-guide/#debugging-tips","title":"Debugging Tips:","text":"<ol> <li>Check pod logs: <code>kubectl -n preview-worker logs -l app=preview-worker</code></li> <li>Describe pods: <code>kubectl -n preview-worker describe pods</code></li> <li>Check events: <code>kubectl -n preview-worker get events</code></li> <li>Validate config: <code>kubectl -n preview-worker get configmap preview-worker-config -o yaml</code></li> <li>Validate secrets: <code>kubectl -n preview-worker get secret preview-worker-secrets -o yaml</code></li> </ol>"},{"location":"playbooks/preview-worker-deployment-prep-complete/","title":"Preview Worker Deployment Preparation Complete","text":"<p>This document summarizes all the work completed for Preview Worker deployment preparation and provides clear next steps for deployment.</p>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#work-completed","title":"Work Completed","text":""},{"location":"playbooks/preview-worker-deployment-prep-complete/#1-core-implementation-previously-completed","title":"1. Core Implementation (Previously Completed)","text":"<ul> <li>Preview Worker service with BullMQ integration</li> <li>Job validation and processing logic</li> <li>Health check endpoints</li> <li>Metrics collection and exposure</li> <li>Client library for job management</li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#2-kubernetes-manifests-previously-completed","title":"2. Kubernetes Manifests (Previously Completed)","text":"<ul> <li>Deployment with resource limits and health checks</li> <li>ConfigMap with default configuration</li> <li>Service for internal communication</li> <li>Horizontal Pod Autoscaler (HPA) for scaling</li> <li>ServiceMonitor for Prometheus integration</li> <li>Secret template for sensitive data</li> <li>Alert rules for monitoring</li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#3-deployment-preparation-newly-completed","title":"3. Deployment Preparation (Newly Completed)","text":"<ul> <li>Cross-platform image update scripts</li> <li>Comprehensive deployment guide with platform-specific instructions</li> <li>Pre-commit checklist for safety validation</li> <li>Troubleshooting guide for common issues</li> <li>Enhanced PR body highlighting cross-platform compatibility</li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#files-available","title":"Files Available","text":""},{"location":"playbooks/preview-worker-deployment-prep-complete/#in-main-branch","title":"In Main Branch","text":"<ul> <li>All Kubernetes manifests in <code>k8s/preview-worker/</code></li> <li>Core implementation files in <code>src/worker/</code></li> <li>Test files in <code>tests/worker/</code></li> <li>Payload validation files in <code>scripts/</code></li> <li>Existing documentation files</li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#in-featpreview-worker-ci-branch","title":"In feat/preview-worker-ci Branch","text":"<p>All main branch files plus:</p>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#deployment-scripts","title":"Deployment Scripts","text":"<ul> <li><code>scripts/update-preview-worker-image.sh</code> (Unix/Linux/macOS)</li> <li><code>scripts/update-preview-worker-image.ps1</code> (Windows PowerShell)</li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#documentation","title":"Documentation","text":"<ul> <li><code>PREVIEW_WORKER_DEPLOYMENT_GUIDE.md</code></li> <li><code>PREVIEW_WORKER_PRE_COMMIT_CHECKLIST.md</code></li> <li><code>PREVIEW_WORKER_TROUBLESHOOTING_GUIDE.md</code></li> <li><code>PR_BODY_PREVIEW_WORKER_FINAL_ENHANCED.md</code></li> <li><code>PHASE_F_PREVIEW_WORKER_COMPLETE_DEPLOYMENT_READY.md</code></li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#next-steps-for-deployment","title":"Next Steps for Deployment","text":""},{"location":"playbooks/preview-worker-deployment-prep-complete/#option-1-use-existing-pr-body-basic","title":"Option 1: Use Existing PR Body (Basic)","text":"<pre><code># Create branch and commit\ngit checkout -b feat/preview-worker-k8s-final\ngit add .\ngit commit -m \"chore(k8s): finalize preview-worker manifests\"\n\n# Push branch\ngit push -u origin feat/preview-worker-k8s-final\n\n# Create PR using existing body\ngh pr create --title \"k8s: preview-worker manifests (final)\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_FINAL.md \\\n  --base main --head feat/preview-worker-k8s-final\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#option-2-use-enhanced-pr-body-cross-platform","title":"Option 2: Use Enhanced PR Body (Cross-Platform)","text":"<pre><code># Create branch and commit\ngit checkout -b feat/preview-worker-k8s-enhanced\ngit add .\ngit commit -m \"chore(k8s): finalize preview-worker manifests with cross-platform deployment tooling\"\n\n# Push branch\ngit push -u origin feat/preview-worker-k8s-enhanced\n\n# Create PR using enhanced body\ngh pr create --title \"k8s: preview-worker manifests with cross-platform deployment tooling\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_FINAL_ENHANCED.md \\\n  --base main --head feat/preview-worker-k8s-enhanced\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#cross-platform-image-update-instructions","title":"Cross-Platform Image Update Instructions","text":""},{"location":"playbooks/preview-worker-deployment-prep-complete/#unixlinuxmacos","title":"Unix/Linux/macOS","text":"<pre><code>./scripts/update-preview-worker-image.sh YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#windows-powershell","title":"Windows PowerShell","text":"<pre><code>.\\scripts\\update-preview-worker-image.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#manual-cross-platform-safe-replacement","title":"Manual Cross-Platform Safe Replacement","text":"<pre><code># Linux (GNU sed)\nIMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} sed -i \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n\n# macOS (BSD sed)\nIMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} sed -i '' \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n\n# Perl (cross-platform)\nIMAGE=\"YOUR_REGISTRY/mobius-preview-worker:1.0.0\"\ngrep -rl \"ghcr.io/your-org/mobius-preview-worker:latest\" k8s/preview-worker/ \\\n  | xargs -I{} perl -pi -e \"s|ghcr.io/your-org/mobius-preview-worker:latest|${IMAGE}|g\" {}\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#pre-commit-safety-checklist","title":"Pre-Commit Safety Checklist","text":"<ol> <li> <p>Run tests:    <pre><code>npm ci\nnpm run test:preview-payloads\nnpm test\nnpm run lint --if-present\n</code></pre></p> </li> <li> <p>Verify changes:    <pre><code>git status\ngit diff -- k8s/preview-worker/\n</code></pre></p> </li> <li> <p>Check for secrets:    <pre><code>git diff --staged | grep -E \"PASSWORD|TOKEN|SECRET|AWS_|REDIS|REDIS_PASSWORD\" || true\n</code></pre></p> </li> <li> <p>Validate manifests:    <pre><code>kubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre></p> </li> </ol>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#post-merge-deployment","title":"Post-Merge Deployment","text":""},{"location":"playbooks/preview-worker-deployment-prep-complete/#1-build-and-push-container-image","title":"1. Build and Push Container Image","text":"<pre><code>docker build -t YOUR_REGISTRY/mobius-preview-worker:1.0.0 -f Dockerfile .\ndocker push YOUR_REGISTRY/mobius-preview-worker:1.0.0\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#2-update-manifests-with-actual-image-tag","title":"2. Update Manifests with Actual Image Tag","text":"<p>Use one of the cross-platform methods above.</p>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#3-deploy-to-kubernetes","title":"3. Deploy to Kubernetes","text":"<pre><code>kubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\nkubectl apply -n preview-worker -f k8s/preview-worker/\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#4-run-smoke-tests","title":"4. Run Smoke Tests","text":"<pre><code>kubectl -n preview-worker port-forward svc/preview-worker 3000:3000 &amp;\ncurl -sS http://localhost:3000/api/preview/worker/health | jq\ncurl -sS http://localhost:3000/metrics | head -n 40\ncurl -X POST http://localhost:3000/api/preview/jobs -H \"Content-Type: application/json\" -d @preview_payload_minimal.json | jq\n</code></pre>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#5-staged-rollout-plan","title":"5. Staged Rollout Plan","text":"<ol> <li>Staging deploy (replicas=1, concurrency=1) - 24-48 hours smoke tests</li> <li>Canary production - Route small % of jobs</li> <li>Gradual scale up - Increase concurrency and replicas</li> <li>Full rollout - Complete deployment</li> </ol>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#monitoring-and-alerting","title":"Monitoring and Alerting","text":""},{"location":"playbooks/preview-worker-deployment-prep-complete/#enable-immediately","title":"Enable Immediately","text":"<ul> <li>Alert: High failure rate (failed/started &gt; 10% over 5m)</li> <li>Alert: Queue backlog above threshold</li> <li>Alert: Liveness/readiness failures</li> <li>Dashboard: throughput, success rate, duration histogram, queue length</li> </ul>"},{"location":"playbooks/preview-worker-deployment-prep-complete/#key-metrics-to-monitor","title":"Key Metrics to Monitor","text":"<ul> <li>preview_job_started</li> <li>preview_job_completed</li> <li>preview_job_failed</li> <li>preview_job_invalid</li> <li>preview_job_dryrun</li> <li>preview_job_duration_ms histogram</li> </ul> <p>The Preview Worker is now fully prepared for deployment with comprehensive tooling, documentation, and safety measures.</p>"},{"location":"playbooks/preview-worker-development-guide/","title":"Preview Worker Development Guide","text":""},{"location":"playbooks/preview-worker-development-guide/#overview","title":"Overview","text":"<p>This guide provides everything needed to begin development on the Preview Worker while PR creation/auth issues are being resolved. It includes issue breakdowns, setup scripts, and implementation guidance.</p>"},{"location":"playbooks/preview-worker-development-guide/#files-created","title":"Files Created","text":""},{"location":"playbooks/preview-worker-development-guide/#issue-definitions-json","title":"Issue Definitions (JSON)","text":"<ol> <li><code>preview_worker_issue_1.json</code> - Worker Skeleton &amp; Job Model</li> <li><code>preview_worker_issue_2.json</code> - Queue &amp; Concurrency Controls</li> <li><code>preview_worker_issue_3.json</code> - Renderer Integration</li> <li><code>preview_worker_issue_4.json</code> - Job Status &amp; API Endpoints</li> </ol>"},{"location":"playbooks/preview-worker-development-guide/#documentation","title":"Documentation","text":"<ol> <li><code>PREVIEW_WORKER_SUBTASKS.md</code> - Complete breakdown of all 12 subtasks</li> <li><code>PREVIEW_WORKER_DEVELOPMENT_GUIDE.md</code> - This document</li> </ol>"},{"location":"playbooks/preview-worker-development-guide/#setup-scripts","title":"Setup Scripts","text":"<ol> <li><code>setup_preview_worker.ps1</code> - PowerShell setup script for Windows</li> <li><code>setup_preview_worker.sh</code> - Bash setup script for Unix/Linux/macOS</li> </ol>"},{"location":"playbooks/preview-worker-development-guide/#getting-started","title":"Getting Started","text":""},{"location":"playbooks/preview-worker-development-guide/#1-environment-setup","title":"1. Environment Setup","text":"<p>Run the appropriate setup script for your platform:</p> <p>Windows (PowerShell): <pre><code>.\\setup_preview_worker.ps1\n</code></pre></p> <p>Unix/Linux/macOS (Bash): <pre><code>chmod +x setup_preview_worker.sh\n./setup_preview_worker.sh\n</code></pre></p> <p>Both scripts will: - Verify Node.js and npm installation - Create required directories - Set up environment variables - Install necessary dependencies (BullMQ, SQLite3) - Create a worker script template - Update package.json with run scripts</p>"},{"location":"playbooks/preview-worker-development-guide/#2-run-the-worker","title":"2. Run the Worker","text":"<p>After setup, you can start the worker with: <pre><code>npm run worker:preview\n</code></pre></p>"},{"location":"playbooks/preview-worker-development-guide/#3-create-github-issues","title":"3. Create GitHub Issues","text":"<p>Use the JSON files with your existing <code>create_prs_and_issues</code> scripts or manually create issues through the GitHub web interface.</p>"},{"location":"playbooks/preview-worker-development-guide/#development-approach","title":"Development Approach","text":""},{"location":"playbooks/preview-worker-development-guide/#priority-order","title":"Priority Order","text":"<ol> <li>Worker Skeleton &amp; Job Model - Establish the basic worker infrastructure</li> <li>Queue &amp; Concurrency Controls - Implement job queuing and resource management</li> <li>Renderer Integration - Connect the worker to the actual rendering process</li> <li>Job Status &amp; API Endpoints - Enable monitoring and control of jobs</li> </ol>"},{"location":"playbooks/preview-worker-development-guide/#key-implementation-details","title":"Key Implementation Details","text":""},{"location":"playbooks/preview-worker-development-guide/#directory-structure","title":"Directory Structure","text":"<pre><code>src/\n  worker/\n    previewWorker.js        # Main worker implementation\n    jobHandlers/            # Job processing logic\n      renderPreview.js      # Preview rendering handler\ndata/\n  previews/                 # Preview artifacts storage\n    {projectId}/\n      {jobId}/\n        preview.json        # Job result metadata\n        preview.mp4         # Rendered preview (or other formats)\nlogs/                       # Worker logs\n</code></pre>"},{"location":"playbooks/preview-worker-development-guide/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>DATA_DIR</code> - Root directory for data storage</li> <li><code>REDIS_URL</code> - Redis connection URL (optional)</li> <li><code>DEV_JOB_STORE</code> - Fallback to SQLite when Redis unavailable</li> <li><code>PREVIEW_MAX_CONCURRENCY</code> - Maximum concurrent jobs</li> <li><code>PREVIEW_QUEUE_MAX</code> - Maximum queue length</li> </ul>"},{"location":"playbooks/preview-worker-development-guide/#metrics-to-implement","title":"Metrics to Implement","text":"<ul> <li><code>preview_worker_jobs_total</code> (labels: outcome=success|failure|retry)</li> <li><code>preview_worker_job_duration_seconds</code> (histogram)</li> <li><code>preview_worker_queue_size</code> (gauge)</li> <li><code>preview_worker_active_jobs</code> (gauge)</li> </ul>"},{"location":"playbooks/preview-worker-development-guide/#testing-strategy","title":"Testing Strategy","text":""},{"location":"playbooks/preview-worker-development-guide/#unit-tests","title":"Unit Tests","text":"<ul> <li>Mock job handlers to test success/failure paths</li> <li>Validate job payload processing</li> <li>Test concurrency and queue limits</li> </ul>"},{"location":"playbooks/preview-worker-development-guide/#integration-tests","title":"Integration Tests","text":"<ul> <li>Run worker with small test jobs</li> <li>Verify artifact creation in DATA_DIR</li> <li>Test dry-run vs. real rendering</li> </ul>"},{"location":"playbooks/preview-worker-development-guide/#cicd-considerations","title":"CI/CD Considerations","text":"<ul> <li>Use small, fast renderers for CI</li> <li>Set low concurrency for CI environments</li> <li>Test both Redis and SQLite paths</li> </ul>"},{"location":"playbooks/preview-worker-development-guide/#security-considerations","title":"Security Considerations","text":"<ul> <li>Prevent secret leakage in logs</li> <li>Implement auth for artifact downloads</li> <li>Validate job payloads</li> <li>Sanitize file paths to prevent directory traversal</li> </ul>"},{"location":"playbooks/preview-worker-development-guide/#next-steps","title":"Next Steps","text":"<ol> <li>Immediate: Run setup script and verify worker starts</li> <li>Short-term: Implement the top 4 priority issues</li> <li>Medium-term: Add metrics, logging, and security features</li> <li>Long-term: Implement full test suite and CI integration</li> </ol>"},{"location":"playbooks/preview-worker-development-guide/#files-summary","title":"Files Summary","text":"File Purpose Type <code>preview_worker_issue_*.json</code> GitHub issue definitions JSON <code>PREVIEW_WORKER_SUBTASKS.md</code> Complete task breakdown Documentation <code>setup_preview_worker.ps1</code> Windows setup script PowerShell <code>setup_preview_worker.sh</code> Unix/Linux setup script Bash <p>These files provide a complete foundation for beginning Preview Worker development immediately, even while resolving GitHub token and PR creation issues.</p>"},{"location":"playbooks/preview-worker-finalization-guide/","title":"Preview Worker PR Finalization Guide","text":"<p>This document explains how to finalize the Preview Worker PR with your specific image tag.</p>"},{"location":"playbooks/preview-worker-finalization-guide/#files-created","title":"Files Created","text":"<ol> <li><code>preview-worker-image-update.patch</code> - A patch file template for updating the image tag</li> <li><code>update-preview-worker-image-tag.sh</code> - Bash script to update the image tag</li> <li><code>update-preview-worker-image-tag.ps1</code> - PowerShell script to update the image tag</li> <li><code>finalize-preview-worker-pr.sh</code> - Complete bash script to finalize the PR</li> <li><code>finalize-preview-worker-pr.ps1</code> - Complete PowerShell script to finalize the PR</li> </ol>"},{"location":"playbooks/preview-worker-finalization-guide/#how-to-finalize-the-pr","title":"How to Finalize the PR","text":""},{"location":"playbooks/preview-worker-finalization-guide/#option-1-using-the-complete-scripts-recommended","title":"Option 1: Using the Complete Scripts (Recommended)","text":""},{"location":"playbooks/preview-worker-finalization-guide/#on-unixlinuxmacos","title":"On Unix/Linux/macOS:","text":"<pre><code># Run the finalization script with your image tag\n./finalize-preview-worker-pr.sh YOUR_REGISTRY/mobius-preview-worker:TAG\n\n# Push the branch and create the PR\ngit push -u origin feat/preview-worker-k8s-final\ngh pr create --title \"k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_COMPLETE.md --base main --head feat/preview-worker-k8s-final\n</code></pre>"},{"location":"playbooks/preview-worker-finalization-guide/#on-windows","title":"On Windows:","text":"<pre><code># Run the finalization script with your image tag\n.\\finalize-preview-worker-pr.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:TAG\"\n\n# Push the branch and create the PR\ngit push -u origin feat/preview-worker-k8s-final\ngh pr create --title \"k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_COMPLETE.md --base main --head feat/preview-worker-k8s-final\n</code></pre>"},{"location":"playbooks/preview-worker-finalization-guide/#option-2-manual-process","title":"Option 2: Manual Process","text":"<ol> <li> <p>Create a new branch:    <pre><code>git checkout -b feat/preview-worker-k8s-final\n</code></pre></p> </li> <li> <p>Update the image tag using the appropriate script:</p> </li> </ol> <p>On Unix/Linux/macOS: <pre><code>./update-preview-worker-image-tag.sh YOUR_REGISTRY/mobius-preview-worker:TAG\n</code></pre></p> <p>On Windows: <pre><code>.\\update-preview-worker-image-tag.ps1 -ImageTag \"YOUR_REGISTRY/mobius-preview-worker:TAG\"\n</code></pre></p> <ol> <li> <p>Commit the changes:    <pre><code>git add k8s/preview-worker/deployment.yaml\ngit commit -m \"chore(k8s): finalize preview-worker manifests with image tag YOUR_REGISTRY/mobius-preview-worker:TAG\"\n</code></pre></p> </li> <li> <p>Push the branch and create the PR:    <pre><code>git push -u origin feat/preview-worker-k8s-final\ngh pr create --title \"k8s: add preview-worker manifests + cross-platform deployment tooling (BullMQ preview worker)\" \\\n  --body-file PR_BODY_PREVIEW_WORKER_COMPLETE.md --base main --head feat/preview-worker-k8s-final\n</code></pre></p> </li> </ol>"},{"location":"playbooks/preview-worker-finalization-guide/#verification-steps","title":"Verification Steps","text":"<p>After updating the image tag, verify the change:</p> <pre><code># Check the deployment file\ngrep -A 2 \"image:\" k8s/preview-worker/deployment.yaml\n\n# Dry-run Kubernetes apply\nkubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre>"},{"location":"playbooks/preview-worker-finalization-guide/#next-steps-after-pr-creation","title":"Next Steps After PR Creation","text":"<ol> <li>Ensure all CI checks pass</li> <li>Deploy to staging environment</li> <li>Run smoke tests</li> <li>Verify Prometheus metrics scraping</li> <li>Test rollback procedures</li> </ol> <p>The Preview Worker is now ready for final review and deployment with your specific image tag.</p>"},{"location":"playbooks/preview-worker-pre-commit-checklist/","title":"Preview Worker Pre-Commit Checklist","text":"<p>This checklist ensures all safety measures are followed before committing changes to the Preview Worker manifests.</p>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#pre-commit-validation-steps","title":"\ud83d\udccb Pre-Commit Validation Steps","text":""},{"location":"playbooks/preview-worker-pre-commit-checklist/#1-image-tag-replacement-verification","title":"1. Image Tag Replacement Verification","text":"<ul> <li>[ ] Image tag has been replaced from placeholder <code>ghcr.io/your-org/mobius-preview-worker:latest</code></li> <li>[ ] Correct image tag format: <code>registry/organization/image:tag</code></li> <li>[ ] Only the deployment.yaml file was modified</li> <li>[ ] No other files were accidentally changed</li> </ul> <pre><code># Verify changes\ngit status\ngit diff -- k8s/preview-worker/\n</code></pre>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#2-test-suite-execution","title":"2. Test Suite Execution","text":"<ul> <li>[ ] Dependencies installed: <code>npm ci</code></li> <li>[ ] Payload validation tests pass: <code>npm run test:preview-payloads</code></li> <li>[ ] Unit tests pass: <code>npm test</code></li> <li>[ ] Linter passes (if present): <code>npm run lint --if-present</code></li> </ul> <pre><code># Run all tests\nnpm ci\nnpm run test:preview-payloads\nnpm test\nnpm run lint --if-present\n</code></pre>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#3-secret-safety-check","title":"3. Secret Safety Check","text":"<ul> <li>[ ] No secrets in git diff: <code>git diff --staged</code></li> <li>[ ] Secret template does not contain real values</li> <li>[ ] No passwords, tokens, or keys in manifests</li> </ul> <pre><code># Check for secrets\ngit diff --staged\n</code></pre>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#4-manifest-validation","title":"4. Manifest Validation","text":"<ul> <li>[ ] Manifests are syntactically correct</li> <li>[ ] All required fields are present</li> <li>[ ] No placeholder values remain (except in secret-example.yaml)</li> </ul> <pre><code># Validate manifests\nkubectl apply --dry-run=client -f k8s/preview-worker/\n</code></pre>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#5-cross-platform-compatibility","title":"5. Cross-Platform Compatibility","text":"<ul> <li>[ ] Scripts work on target platforms</li> <li>[ ] Line endings are consistent</li> <li>[ ] File permissions are appropriate</li> </ul>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#6-documentation-updates","title":"6. Documentation Updates","text":"<ul> <li>[ ] README files updated if needed</li> <li>[ ] Comments in code are clear and accurate</li> <li>[ ] No placeholder text remains in documentation</li> </ul>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#commit-and-pr-preparation","title":"\ud83d\ude80 Commit and PR Preparation","text":""},{"location":"playbooks/preview-worker-pre-commit-checklist/#before-committing","title":"Before Committing:","text":"<ul> <li>[ ] All checklist items completed</li> <li>[ ] Changes are focused and minimal</li> <li>[ ] Commit message follows convention: <code>chore(k8s): update preview worker image to registry/org/image:tag</code></li> </ul>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#before-creating-pr","title":"Before Creating PR:","text":"<ul> <li>[ ] Branch is up to date with main</li> <li>[ ] PR body is prepared (use PR_BODY_PREVIEW_WORKER_FINAL.md)</li> <li>[ ] GitHub CLI is installed and authenticated (or ready to use web UI)</li> </ul>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#common-pitfalls-to-avoid","title":"\u26a0\ufe0f Common Pitfalls to Avoid","text":"<ol> <li>Accidental Secret Commits: Always check <code>git diff --staged</code> for sensitive data</li> <li>Incomplete Image Replacement: Verify only the intended image tag was changed</li> <li>Untested Changes: Always run the full test suite before committing</li> <li>Missing Manifest Validation: Use <code>kubectl apply --dry-run=client</code> to validate syntax</li> <li>Cross-Platform Issues: Test scripts on target platforms before committing</li> </ol>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#emergency-rollback-plan","title":"\ud83d\udee1\ufe0f Emergency Rollback Plan","text":"<p>If issues are discovered after commit but before merge: <pre><code># Revert the last commit\ngit reset --soft HEAD~1\n# Or if already pushed\ngit revert HEAD\n</code></pre></p> <p>If issues are discovered after merge: <pre><code># Create a revert commit\ngit revert &lt;commit-hash&gt;\n# Push the fix\ngit push origin main\n</code></pre></p>"},{"location":"playbooks/preview-worker-pre-commit-checklist/#final-verification","title":"\u2705 Final Verification","text":"<p>Before finalizing the PR: - [ ] All tests pass locally - [ ] Manifests validate successfully - [ ] No secrets are staged - [ ] Image tag is correct - [ ] Documentation is complete - [ ] PR body is ready</p> <p>Once this checklist is complete, you're ready to create the PR.</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/","title":"Preview Worker Troubleshooting Guide","text":"<p>This guide helps diagnose and resolve common issues encountered during Preview Worker deployment and operation.</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#pre-deployment-issues","title":"\ud83d\udea8 Pre-Deployment Issues","text":""},{"location":"playbooks/preview-worker-troubleshooting-guide/#1-image-tag-replacement-problems","title":"1. Image Tag Replacement Problems","text":"<p>Problem: sed/grep commands not found Solution:  - Install GNU sed: <code>brew install gnu-sed</code> (macOS) or <code>apt-get install sed</code> (Ubuntu) - Use Perl alternative: <code>perl -pi -e \"s|old|new|g\" file</code> - Use the provided cross-platform scripts</p> <p>Problem: Incorrect image tag format Solution: - Ensure format is <code>registry/organization/image:tag</code> - Verify registry is accessible - Check image exists in registry</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#2-test-suite-failures","title":"2. Test Suite Failures","text":"<p>Problem: npm ci fails Solution: - Check Node.js version (should be 18.x or 20.x) - Verify package-lock.json consistency - Clear npm cache: <code>npm cache clean --force</code></p> <p>Problem: Payload validation tests fail Solution: - Check preview_payload_*.json files for correct structure - Verify validatePreviewPayload.js logic - Ensure all required fields are present</p> <p>Problem: Unit tests fail Solution: - Run individual failing tests to identify specific issues - Check for missing dependencies - Verify test environment variables</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#3-manifest-validation-errors","title":"3. Manifest Validation Errors","text":"<p>Problem: kubectl apply --dry-run fails Solution: - Check YAML syntax (indentation, colons, quotes) - Verify all required fields are present - Ensure Kubernetes API versions are correct</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#deployment-issues","title":"\ud83d\udea8 Deployment Issues","text":""},{"location":"playbooks/preview-worker-troubleshooting-guide/#1-pod-creation-failures","title":"1. Pod Creation Failures","text":"<p>Problem: Pods stuck in Pending state Diagnostic Commands: <pre><code>kubectl -n preview-worker describe pods\nkubectl -n preview-worker get events\n</code></pre> Solutions: - Check resource quotas - Verify node affinity/anti-affinity rules - Ensure sufficient cluster resources</p> <p>Problem: Pods stuck in CrashLoopBackOff Diagnostic Commands: <pre><code>kubectl -n preview-worker logs -l app=preview-worker --previous\nkubectl -n preview-worker describe pods\n</code></pre> Solutions: - Check application logs for errors - Verify environment variables - Ensure ConfigMap and Secret references are correct</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#2-image-pull-errors","title":"2. Image Pull Errors","text":"<p>Problem: ErrImagePull or ImagePullBackOff Diagnostic Commands: <pre><code>kubectl -n preview-worker describe pods\nkubectl -n preview-worker get events\n</code></pre> Solutions: - Verify image tag is correct - Check registry authentication - Ensure image exists in registry - Verify node has network access to registry</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#3-health-check-failures","title":"3. Health Check Failures","text":"<p>Problem: Readiness probe failing Diagnostic Commands: <pre><code>kubectl -n preview-worker logs -l app=preview-worker\nkubectl -n preview-worker describe pods\ncurl http://localhost:3000/api/preview/worker/health\n</code></pre> Solutions: - Check application logs for startup errors - Verify Redis connectivity - Ensure correct port is exposed - Check health endpoint implementation</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#runtime-issues","title":"\ud83d\udea8 Runtime Issues","text":""},{"location":"playbooks/preview-worker-troubleshooting-guide/#1-job-processing-problems","title":"1. Job Processing Problems","text":"<p>Problem: Jobs not being processed Diagnostic Commands: <pre><code>kubectl -n preview-worker logs -l app=preview-worker\nkubectl -n preview-worker exec -it &lt;pod-name&gt; -- redis-cli -h &lt;redis-host&gt; llen preview-jobs\n</code></pre> Solutions: - Check Redis connectivity - Verify queue name matches between worker and client - Ensure worker has correct concurrency settings</p> <p>Problem: High job failure rate Diagnostic Commands: <pre><code>kubectl -n preview-worker logs -l app=preview-worker\ncurl http://localhost:3000/metrics | grep preview_job_failed\n</code></pre> Solutions: - Check application logs for error details - Verify input payload validity - Ensure sufficient resources (CPU, memory)</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#2-performance-issues","title":"2. Performance Issues","text":"<p>Problem: Slow job processing Diagnostic Commands: <pre><code>kubectl -n preview-worker top pods\ncurl http://localhost:3000/metrics | grep preview_job_duration\n</code></pre> Solutions: - Increase worker concurrency - Scale up replica count - Optimize resource requests/limits - Check Redis performance</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#3-resource-constraints","title":"3. Resource Constraints","text":"<p>Problem: OOMKilled pods Diagnostic Commands: <pre><code>kubectl -n preview-worker describe pods\nkubectl -n preview-worker top pods\n</code></pre> Solutions: - Increase memory limits - Optimize application memory usage - Scale out rather than up</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#monitoring-and-observability-issues","title":"\ud83d\udea8 Monitoring and Observability Issues","text":""},{"location":"playbooks/preview-worker-troubleshooting-guide/#1-metrics-not-appearing","title":"1. Metrics Not Appearing","text":"<p>Problem: Prometheus not scraping metrics Diagnostic Commands: <pre><code>kubectl -n preview-worker get servicemonitor\nkubectl -n preview-worker port-forward svc/preview-worker 3000:3000\ncurl http://localhost:3000/metrics\n</code></pre> Solutions: - Verify ServiceMonitor configuration - Check Prometheus Operator installation - Ensure correct port and path in ServiceMonitor</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#2-alerting-problems","title":"2. Alerting Problems","text":"<p>Problem: Alerts not firing Diagnostic Commands: <pre><code>kubectl -n preview-worker get prometheusrule\ncurl http://localhost:3000/metrics | grep alert_metric\n</code></pre> Solutions: - Verify alert rule syntax - Check Prometheus rule evaluation - Ensure alert thresholds are appropriate</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#cicd-issues","title":"\ud83d\udea8 CI/CD Issues","text":""},{"location":"playbooks/preview-worker-troubleshooting-guide/#1-github-actions-failures","title":"1. GitHub Actions Failures","text":"<p>Problem: Build step failing Solutions: - Check Dockerfile syntax - Verify build context - Ensure all dependencies are specified</p> <p>Problem: Push step failing Solutions: - Verify registry credentials - Check image name format - Ensure sufficient permissions</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#2-pr-creation-issues","title":"2. PR Creation Issues","text":"<p>Problem: gh pr create fails Solutions: - Verify gh CLI installation: <code>gh --version</code> - Check authentication: <code>gh auth status</code> - Use web UI as alternative</p>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#useful-diagnostic-commands","title":"\ud83d\udee0\ufe0f Useful Diagnostic Commands","text":""},{"location":"playbooks/preview-worker-troubleshooting-guide/#general-kubernetes-diagnostics","title":"General Kubernetes Diagnostics","text":"<pre><code># Check all resources\nkubectl -n preview-worker get all\n\n# Check pod logs\nkubectl -n preview-worker logs -l app=preview-worker --follow\n\n# Check pod details\nkubectl -n preview-worker describe pods\n\n# Check events\nkubectl -n preview-worker get events --sort-by=.metadata.creationTimestamp\n\n# Port forward for direct access\nkubectl -n preview-worker port-forward svc/preview-worker 3000:3000\n</code></pre>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#application-diagnostics","title":"Application Diagnostics","text":"<pre><code># Check health endpoint\ncurl http://localhost:3000/api/preview/worker/health\n\n# Check metrics\ncurl http://localhost:3000/metrics\n\n# Check specific metrics\ncurl http://localhost:3000/metrics | grep preview_job\n</code></pre>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#resource-monitoring","title":"Resource Monitoring","text":"<pre><code># Check pod resource usage\nkubectl -n preview-worker top pods\n\n# Check node resource usage\nkubectl top nodes\n\n# Check resource quotas\nkubectl -n preview-worker describe resourcequota\n</code></pre>"},{"location":"playbooks/preview-worker-troubleshooting-guide/#getting-additional-help","title":"\ud83d\udcde Getting Additional Help","text":"<p>If you encounter issues not covered in this guide:</p> <ol> <li>Check logs thoroughly: Most issues are evident in the application logs</li> <li>Verify configuration: Ensure all environment variables and config files are correct</li> <li>Test connectivity: Verify network access between components</li> <li>Check versions: Ensure compatible versions of all dependencies</li> <li>Consult documentation: Review Kubernetes and application documentation</li> </ol> <p>For persistent issues, provide: - Error messages from logs - Output of diagnostic commands - Steps to reproduce the issue - Environment details (Kubernetes version, OS, etc.)</p>"},{"location":"playbooks/quick-reference-guide/","title":"Mobius Preview Worker Deployment - Quick Reference Guide","text":""},{"location":"playbooks/quick-reference-guide/#essential-commands","title":"Essential Commands","text":""},{"location":"playbooks/quick-reference-guide/#cli-deployment","title":"CLI Deployment","text":"<pre><code># Deploy to default namespace\nnode cli/mobius-deploy.js deploy\n\n# Deploy with custom image tag\nnode cli/mobius-deploy.js deploy --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3\n\n# Deploy to specific namespace\nnode cli/mobius-deploy.js deploy --namespace production\n\n# Dry run (test without making changes)\nnode cli/mobius-deploy.js deploy --dry-run\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#status-and-verification","title":"Status and Verification","text":"<pre><code># Check deployment status\nnode cli/mobius-deploy.js status\n\n# Verify deployment health\nnode cli/mobius-deploy.js verify\n\n# View deployment logs\nnode cli/mobius-deploy.js logs\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#rollback-operations","title":"Rollback Operations","text":"<pre><code># Rollback deployment\nnode cli/mobius-deploy.js rollback\n\n# Rollback specific namespace\nnode cli/mobius-deploy.js rollback --namespace production\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#platform-specific-scripts","title":"Platform-Specific Scripts","text":""},{"location":"playbooks/quick-reference-guide/#windows-powershell","title":"Windows (PowerShell)","text":"<pre><code># Build and push image\n.\\build-and-push.ps1\n\n# Update manifests\n.\\update-manifests.ps1\n\n# Apply manifests\n.\\apply-manifests.ps1\n\n# Full deployment\n.\\deploy-preview-worker.ps1\n\n# Verify deployment\n.\\verify-deployment.ps1\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#unixlinuxmacos-bash","title":"Unix/Linux/macOS (Bash)","text":"<pre><code># Make scripts executable (first time only)\nchmod +x *.sh\n\n# Build and push image\n./build-and-push.sh\n\n# Update manifests\n./update-manifests.sh\n\n# Apply manifests\n./apply-manifests.sh\n\n# Full deployment\n./deploy-preview-worker.sh\n\n# Verify deployment\n./verify-deployment.sh\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#kubernetes-commands","title":"Kubernetes Commands","text":""},{"location":"playbooks/quick-reference-guide/#basic-operations","title":"Basic Operations","text":"<pre><code># Check pod status\nkubectl -n preview-worker get pods\n\n# View pod logs\nkubectl -n preview-worker logs &lt;pod-name&gt;\n\n# Check deployment status\nkubectl -n preview-worker rollout status deployment/preview-worker\n\n# Describe pod for detailed info\nkubectl -n preview-worker describe pod &lt;pod-name&gt;\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#resource-monitoring","title":"Resource Monitoring","text":"<pre><code># Check resource usage\nkubectl -n preview-worker top pods\n\n# View recent events\nkubectl -n preview-worker get events --sort-by=.metadata.creationTimestamp\n\n# Check service endpoints\nkubectl -n preview-worker get endpoints\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#github-actions-workflows","title":"GitHub Actions Workflows","text":""},{"location":"playbooks/quick-reference-guide/#manual-triggers","title":"Manual Triggers","text":"<ul> <li>Build Workflow: Can be triggered manually with custom version tags</li> <li>Deploy Workflow: Can be triggered manually with environment selection and rollback option</li> <li>Test Workflow: Runs automatically on script changes</li> </ul>"},{"location":"playbooks/quick-reference-guide/#workflow-urls","title":"Workflow URLs","text":"<ul> <li>Build: <code>.github/workflows/preview-worker-build.yaml</code></li> <li>Deploy: <code>.github/workflows/preview-worker-deploy.yaml</code></li> <li>Test: <code>.github/workflows/test-deployment-scripts.yaml</code></li> </ul>"},{"location":"playbooks/quick-reference-guide/#environment-variables","title":"Environment Variables","text":""},{"location":"playbooks/quick-reference-guide/#required-variables","title":"Required Variables","text":"<pre><code># GHCR Personal Access Token (for image push)\nGHCR_PAT=your_personal_access_token\n\n# Kubernetes namespace (optional, defaults to preview-worker)\nNAMESPACE=preview-worker\n</code></pre>"},{"location":"playbooks/quick-reference-guide/#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"playbooks/quick-reference-guide/#docker-issues","title":"Docker Issues","text":"<p>Problem: Docker not running Solution: Start Docker Desktop or Docker daemon</p> <p>Problem: Permission denied when pushing to GHCR Solution: Verify GHCR PAT has correct permissions</p>"},{"location":"playbooks/quick-reference-guide/#kubernetes-issues","title":"Kubernetes Issues","text":"<p>Problem: Cannot connect to cluster Solution: Verify kubeconfig is correct and cluster is accessible</p> <p>Problem: Pods stuck in Pending state Solution: Check resource quotas and node capacity</p> <p>Problem: ImagePullBackOff error Solution: Verify image exists and image pull secrets are correct</p>"},{"location":"playbooks/quick-reference-guide/#script-issues","title":"Script Issues","text":"<p>Problem: Scripts not found Solution: Ensure running from project root directory</p> <p>Problem: Permission denied on bash scripts Solution: Run <code>chmod +x *.sh</code> on script files</p>"},{"location":"playbooks/quick-reference-guide/#security-best-practices","title":"Security Best Practices","text":"<ol> <li>Never commit PATs to the repository</li> <li>Use environment variables for sensitive data</li> <li>Rotate PATs regularly for security</li> <li>Follow principle of least privilege for all credentials</li> <li>Use dry-run mode to test deployments safely</li> </ol>"},{"location":"playbooks/quick-reference-guide/#documentation-resources","title":"Documentation Resources","text":""},{"location":"playbooks/quick-reference-guide/#core-documentation","title":"Core Documentation","text":"<ul> <li>CLI_DEPLOYMENT_TOOL.md - Complete CLI documentation</li> <li>CLI_USAGE_EXAMPLES.md - Practical usage examples</li> <li>DEPLOYMENT_CHECKLIST.md - Deployment checklist</li> </ul>"},{"location":"playbooks/quick-reference-guide/#team-resources","title":"Team Resources","text":"<ul> <li>TEAM_ONBOARDING_GUIDE.md - Onboarding guide</li> <li>MONITORING_AND_ALERTING.md - Monitoring setup</li> <li>DEPLOYMENT_DOCUMENTATION_SUMMARY.md - Documentation overview</li> </ul>"},{"location":"playbooks/quick-reference-guide/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"playbooks/quick-reference-guide/#immediate-rollback","title":"Immediate Rollback","text":"<ol> <li>Execute: <code>node cli/mobius-deploy.js rollback</code></li> <li>Verify: <code>node cli/mobius-deploy.js verify</code></li> <li>Check status: <code>node cli/mobius-deploy.js status</code></li> </ol>"},{"location":"playbooks/quick-reference-guide/#complete-system-failure","title":"Complete System Failure","text":"<ol> <li>Contact system administrators</li> <li>Check infrastructure provider status pages</li> <li>Follow disaster recovery procedures</li> </ol>"},{"location":"playbooks/quick-reference-guide/#contact-information","title":"Contact Information","text":""},{"location":"playbooks/quick-reference-guide/#for-deployment-issues","title":"For Deployment Issues","text":"<ul> <li>Team Lead: [team-lead-email]</li> <li>Operations: [ops-email]</li> </ul>"},{"location":"playbooks/quick-reference-guide/#for-security-concerns","title":"For Security Concerns","text":"<ul> <li>Security Team: [security-email]</li> </ul>"},{"location":"playbooks/quick-reference-guide/#for-documentation-updates","title":"For Documentation Updates","text":"<ul> <li>Documentation Lead: [docs-email]</li> </ul>"},{"location":"playbooks/quick-start-deployment/","title":"Hardened Preview Worker Deployment - Quick Start Guide","text":""},{"location":"playbooks/quick-start-deployment/#immediate-action-plan","title":"\ud83d\ude80 Immediate Action Plan","text":""},{"location":"playbooks/quick-start-deployment/#step-1-apply-the-patches-copy-paste-commands","title":"Step 1: Apply the Patches (Copy &amp; Paste Commands)","text":"<pre><code># Create a new branch for the hardened manifests\ngit checkout -b chore/harden-preview-worker\n\n# Apply the patches in order\ngit apply -p0 0001-harden-preview-worker-manifests.patch\ngit apply -p0 0002-add-rbac-configuration.patch  \ngit apply -p0 0003-add-smoke-test-script.patch\n\n# Make the deployment script executable\nchmod +x deploy-hardened-preview-worker.sh\nchmod +x k8s/preview-worker/smoke-test-preview-worker.sh\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#step-2-update-image-placeholder-critical","title":"Step 2: Update Image Placeholder (Critical!)","text":"<pre><code># Replace with your actual registry and image tag\n# macOS:\nsed -i '' 's|YOUR_REGISTRY/mobius-preview-worker:TAG|registry.example.com/mobius-preview-worker:1.0.0|g' k8s/preview-worker/sa-and-scc.yaml\n\n# Linux:\nsed -i 's|YOUR_REGISTRY/mobius-preview-worker:TAG|registry.example.com/mobius-preview-worker:1.0.0|g' k8s/preview-worker/sa-and-scc.yaml\n\n# Verify the change\ngrep \"image:\" k8s/preview-worker/sa-and-scc.yaml\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#step-3-commit-the-changes","title":"Step 3: Commit the Changes","text":"<pre><code>git add k8s/preview-worker/\ngit commit -m \"chore(k8s): harden preview-worker manifests (securityContext, probes, resources, SA, RBAC) and add smoke-test\"\n\n# If you updated the image, commit that too\ngit commit -am \"chore(k8s): set image to registry.example.com/mobius-preview-worker:1.0.0\"\n\ngit push --set-upstream origin chore/harden-preview-worker\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#step-4-deploy-to-cluster-one-command","title":"Step 4: Deploy to Cluster (One Command)","text":"<pre><code># Interactive deployment (recommended)\n./deploy-hardened-preview-worker.sh\n\n# Or manual steps if you prefer control:\nkubectl create namespace preview-worker --dry-run=client -o yaml | kubectl apply -f -\nkubectl apply -f k8s/preview-worker/sa-and-scc.yaml -n preview-worker\nkubectl apply -f k8s/preview-worker/rbac.yaml -n preview-worker  # Optional\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#step-5-create-required-secrets","title":"Step 5: Create Required Secrets","text":"<pre><code># Create registry secret (if using private registry)\nkubectl create secret docker-registry regcred \\\n  --docker-server=your-registry.com \\\n  --docker-username=your-username \\\n  --docker-password=your-password \\\n  --docker-email=your-email \\\n  -n preview-worker\n\n# Create application secrets\nkubectl -n preview-worker create secret generic preview-worker-secrets \\\n  --from-literal=REDIS_URL='redis://your-redis:6379' \\\n  --from-literal=SOME_API_KEY='your-api-key'\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#step-6-run-smoke-test","title":"Step 6: Run Smoke Test","text":"<pre><code># Run comprehensive smoke test\n./k8s/preview-worker/smoke-test-preview-worker.sh\n\n# Or manual verification:\nkubectl -n preview-worker rollout status deployment/preview-worker --timeout=180s\nkubectl -n preview-worker get pods -o wide\nkubectl -n preview-worker get svc\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#verification-commands","title":"\ud83d\udd27 Verification Commands","text":""},{"location":"playbooks/quick-start-deployment/#health-check","title":"Health Check","text":"<pre><code># Port forward and test\nkubectl -n preview-worker port-forward svc/preview-worker 8080:5001 &amp;\nsleep 2\ncurl http://localhost:8080/health\nkill %1\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#monitor-deployment","title":"Monitor Deployment","text":"<pre><code># Watch logs\nkubectl -n preview-worker logs -f deployment/preview-worker\n\n# Check events\nkubectl -n preview-worker get events --sort-by='.lastTimestamp'\n\n# Describe resources\nkubectl -n preview-worker describe deployment preview-worker\nkubectl -n preview-worker describe pod -l app=preview-worker\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#rollback-commands","title":"\ud83d\udd04 Rollback Commands","text":""},{"location":"playbooks/quick-start-deployment/#quick-rollback","title":"Quick Rollback","text":"<pre><code># Rollback to previous version\nkubectl -n preview-worker rollout undo deployment/preview-worker\n\n# Check rollback status\nkubectl -n preview-worker rollout status deployment/preview-worker\n\n# View rollout history\nkubectl -n preview-worker rollout history deployment/preview-worker\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#emergency-removal","title":"Emergency Removal","text":"<pre><code># Delete everything (nuclear option)\nkubectl delete namespace preview-worker\n</code></pre>"},{"location":"playbooks/quick-start-deployment/#what-you-get","title":"\ud83d\udcca What You Get","text":""},{"location":"playbooks/quick-start-deployment/#security-hardening","title":"Security Hardening \u2705","text":"<ul> <li>ServiceAccount isolation (no cluster privileges)</li> <li>Security context (non-root, read-only filesystem)</li> <li>Resource limits (prevents resource exhaustion)</li> <li>Network isolation ready</li> <li>Minimal RBAC permissions</li> </ul>"},{"location":"playbooks/quick-start-deployment/#operational-excellence","title":"Operational Excellence \u2705","text":"<ul> <li>Health probes with proper timing</li> <li>Rolling update strategy</li> <li>Graceful termination</li> <li>Comprehensive smoke testing</li> <li>Easy rollback capability</li> </ul>"},{"location":"playbooks/quick-start-deployment/#production-ready","title":"Production Ready \u2705","text":"<ul> <li>Conservative resource requests/limits</li> <li>Proper error handling</li> <li>Monitoring integration points</li> <li>Documentation and runbooks</li> </ul>"},{"location":"playbooks/quick-start-deployment/#files-created","title":"\ud83d\udccb Files Created","text":"File Purpose <code>k8s/preview-worker/sa-and-scc.yaml</code> Hardened deployment + service + serviceaccount <code>k8s/preview-worker/rbac.yaml</code> Optional RBAC configuration <code>k8s/preview-worker/smoke-test-preview-worker.sh</code> Comprehensive smoke test <code>deploy-hardened-preview-worker.sh</code> Complete deployment automation <code>0001-harden-preview-worker-manifests.patch</code> Unified patch for hardened manifests <code>0002-add-rbac-configuration.patch</code> RBAC configuration patch <code>0003-add-smoke-test-script.patch</code> Smoke test script patch"},{"location":"playbooks/quick-start-deployment/#critical-reminders","title":"\ud83d\udea8 Critical Reminders","text":"<ol> <li>Update Image Placeholder - Replace <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code> with your actual image</li> <li>Create Secrets - Registry and application secrets are required</li> <li>Test in Staging First - Always test in non-production environment</li> <li>Monitor After Deployment - Watch logs and metrics post-deployment</li> </ol>"},{"location":"playbooks/quick-start-deployment/#next-steps-after-deployment","title":"\ud83c\udfaf Next Steps After Deployment","text":"<ol> <li>Monitor Performance - Adjust resource requests/limits based on actual usage</li> <li>Set Up Monitoring - Integrate with Prometheus/Grafana for metrics</li> <li>Configure Alerts - Set up alerts for health check failures</li> <li>Document Changes - Update runbooks with your specific configurations</li> </ol>"},{"location":"playbooks/quick-start-deployment/#support","title":"\ud83d\udcde Support","text":"<p>If you encounter issues: 1. Check the troubleshooting section in <code>HARDENED_DEPLOYMENT_GUIDE.md</code> 2. Run the smoke test script for diagnostic information 3. Check pod logs and events 4. Verify all secrets are created correctly</p> <p>Ready to deploy? Start with Step 1 and follow the commands in order. The entire process should take 5-10 minutes once you have your image registry information ready.</p>"},{"location":"playbooks/reviewer-checklist/","title":"Reviewer checklist to paste in PR comment","text":"<ul> <li>[ ] Run unit tests in CI / locally: <code>npm ci &amp;&amp; npm test</code></li> <li>[ ] Run scripts/verify-phase-f.sh locally against the dev server (or let CI run it).</li> <li>[ ] POST a dry-run preview to /api/preview and confirm 202 + artifact saved.</li> <li>[ ] Check logs for preview_request and response with requestId.</li> <li>[ ] Confirm preview_requests_total increment (metrics).</li> <li>[ ] Confirm docs updated (docs/api/preview.md, runbook snippet).</li> </ul>"},{"location":"playbooks/runbook-preview/","title":"Preview monitoring &amp; rollback (short)","text":""},{"location":"playbooks/runbook-preview/#metrics-to-monitor","title":"Metrics to monitor","text":"<ul> <li>preview_requests_total (counter)</li> <li>preview_failures_total (counter)</li> <li>preview_duration_ms (histogram)</li> <li>preview_queue_length (gauge)</li> <li>DATA_DIR free percentage</li> </ul>"},{"location":"playbooks/runbook-preview/#alerts","title":"Alerts","text":"<ul> <li>preview_failures_total rate &gt;= 1% over 5m \u2192 Pager P2</li> <li>preview_queue_length &gt;= 80% PREVIEW_QUEUE_MAX for &gt; 10m \u2192 Pager P1</li> <li>DATA_DIR free &lt; 15% \u2192 Pager P1</li> </ul>"},{"location":"playbooks/runbook-preview/#first-response-steps","title":"First response steps","text":"<ul> <li>Check recent logs for preview_request / preview_response with requestId.</li> <li>Inspect preview artifacts under DATA_DIR/previews//. <li>Check metrics &amp; job queue depth.</li> <li>If failing: set PREVIEW_MAX_CONCURRENCY=0 (stop accepting new render work) and pause traffic.</li> <li>If disk space low: free space, move older exports, or increase volume.</li> <li>If widespread errors, rollback the service to previous tag.</li>"},{"location":"playbooks/runbook-preview/#rollback-conditions","title":"Rollback conditions","text":"<ul> <li>sustained preview_failures_total &gt; 5% for 10m AND correlated errors to recent deploy</li> <li>queue backlog causing resource exhaustion and high CPU/memory for &gt; 10m</li> <li>disk full threat</li> </ul>"},{"location":"playbooks/runbook-preview/#post-incident","title":"Post-incident","text":"<ul> <li>Run forensic script to collect artifacts and send to SRE with timeline and requestIds.</li> <li>Re-run verification scripts after rollback to confirm stability.</li> </ul>"},{"location":"playbooks/runbook/","title":"Mobius Rendering Pipeline Runbook","text":"<p>This document provides guidance for incident response and operational procedures for the Mobius Tutorial Generator's video rendering pipeline.</p>"},{"location":"playbooks/runbook/#service-level-indicators-slis","title":"Service Level Indicators (SLIs)","text":"<ul> <li>Render success rate = completed / (started)</li> <li>P50/P95 render duration (preview/full separately)</li> <li>Timeout rate = timeouts / (started)</li> <li>FFmpeg speed ratio distribution (median, 5th percentile)</li> </ul>"},{"location":"playbooks/runbook/#service-level-objectives-slos","title":"Service Level Objectives (SLOs)","text":"<ul> <li>Success rate: \u2265 99.5% rolling 7 days</li> <li>P95 duration: preview \u2264 45s wall time; full \u2264 configured budget</li> <li>Timeouts: \u2264 0.5% of renders per 7 days</li> </ul>"},{"location":"playbooks/runbook/#alerting","title":"Alerting","text":""},{"location":"playbooks/runbook/#prometheus-alert-rules","title":"Prometheus Alert Rules","text":"<p>Alert rules are defined in alerts/rendering.rules.yml:</p> <ol> <li>RenderErrorSpike - Triggers when render failures exceed 5% over 5 minutes</li> <li>RenderTimeoutSpike - Triggers when timeouts exceed 1% over 10 minutes</li> <li>RenderDurationP95Exceeded - Triggers when P95 render duration exceeds budget</li> </ol>"},{"location":"playbooks/runbook/#incident-response","title":"Incident Response","text":""},{"location":"playbooks/runbook/#symptoms-and-first-response","title":"Symptoms and First Response","text":""},{"location":"playbooks/runbook/#alert-rendererrorspike-many-failures","title":"Alert: RenderErrorSpike \u2192 Many failures","text":"<p>First response: - Pull latest NDJSON logs and render_meta.json from failing runs - Check metrics endpoint: <code>curl http://host:9464/metrics</code> - Verify system resources: CPU, IO, memory, tmp space - Validate ffmpeg version and fonts availability</p>"},{"location":"playbooks/runbook/#alert-rendertimeoutspike-stuckstalled-ffmpeg-or-resource-starvation","title":"Alert: RenderTimeoutSpike \u2192 Stuck/stalled ffmpeg or resource starvation","text":"<p>First response: - Check system resource usage (CPU, memory, disk IO) - Verify temporary directory space - Check for zombie FFmpeg processes - Review timeout configuration</p>"},{"location":"playbooks/runbook/#alert-durationp95exceeded-performance-regression-or-input-skew","title":"Alert: DurationP95Exceeded \u2192 Performance regression or input skew","text":"<p>First response: - Analyze FFmpeg speed ratio metrics - Check for changes in input data size or complexity - Review system performance metrics</p>"},{"location":"playbooks/runbook/#remediation-playbooks","title":"Remediation Playbooks","text":""},{"location":"playbooks/runbook/#timeouts","title":"Timeouts","text":"<ul> <li>Raise timeoutMs and add backoff</li> <li>Confirm checkpoint resume skips done stages</li> <li>Check for resource constraints (CPU, memory, disk IO)</li> </ul>"},{"location":"playbooks/runbook/#performance-regression","title":"Performance Regression","text":"<ul> <li>Inspect speed ratio metrics</li> <li>Down-tune caps (maxFps/bitrate)</li> <li>Enable envelope ducking over sidechain if CPU-bound</li> </ul>"},{"location":"playbooks/runbook/#failures-clustering-by-reason","title":"Failures Clustering by Reason","text":"<ul> <li>Fix root cause (path validation, escaping, missing inputs)</li> <li>Add validation for common failure modes</li> <li>Update test fixtures to cover the regression</li> </ul>"},{"location":"playbooks/runbook/#post-incident-actions","title":"Post-Incident Actions","text":"<ol> <li>Update test fixtures to cover the regression</li> <li>Add alert annotation with root cause and remediation code links</li> <li>Document lessons learned in this runbook</li> <li>Review and update SLOs if needed</li> </ol>"},{"location":"playbooks/runbook/#log-policy-and-compliance","title":"Log Policy and Compliance","text":""},{"location":"playbooks/runbook/#ndjson-fields","title":"NDJSON Fields","text":"<p>All logs include these fields: - <code>ts</code>: Timestamp - <code>level</code>: Log level - <code>sessionId</code>: Render session identifier - <code>jobId</code>: Render job identifier - <code>stage</code>: Current rendering stage - <code>message</code>: Log message - <code>progress</code>: Completion percentage - <code>etaSec</code>: Estimated time of arrival in seconds - <code>speed</code>: Processing speed ratio - <code>fps</code>: Frames per second - <code>reason</code>: Failure reason (on failure)</p>"},{"location":"playbooks/runbook/#redaction","title":"Redaction","text":"<ul> <li>Strip PII and external absolute paths</li> <li>Truncate long subtitle lines</li> <li>Escape safely for vf=subtitles</li> </ul>"},{"location":"playbooks/runbook/#retention","title":"Retention","text":"<ul> <li>CI: 30 days for failure artifacts</li> <li>Production: 7-14 days hot, 90 days cold (S3 IA/Glacier)</li> </ul>"},{"location":"playbooks/runbook/#rotation","title":"Rotation","text":"<ul> <li>Daily rollover by size/time</li> <li>Gzip old logs</li> </ul>"},{"location":"playbooks/runbook/#operational-toggles-and-safe-defaults","title":"Operational Toggles and Safe Defaults","text":""},{"location":"playbooks/runbook/#environment-flags","title":"Environment Flags","text":"<ul> <li><code>METRICS_PORT=9464</code></li> <li><code>LOG_LEVEL=info</code></li> <li><code>RENDER_TIMEOUT_MS=900000</code></li> <li><code>MEDIA_CAPS</code>: maxWidth=1920, maxHeight=1080, maxFps=30, maxBitrateKbps=6000</li> <li><code>LOUDNESS</code>: enabled=true, targetI=-16, lra=11, tp=-1.5</li> </ul>"},{"location":"playbooks/runbook/#cli-examples","title":"CLI Examples","text":"<p>Start metrics server: <pre><code>node scripts/demo-observability.js --metrics-port 9464\n</code></pre></p> <p>Force caps and loudness: <pre><code>node scripts/render.js --mode full --caps.maxFps 30 --loudness.enabled true\n</code></pre></p>"},{"location":"playbooks/runbook/#deployment-notes","title":"Deployment Notes","text":""},{"location":"playbooks/runbook/#container-deployment","title":"Container Deployment","text":"<p>Recommended docker run: <pre><code>docker run --cpus=2 --memory=3g --pids-limit=256 -p 9464:9464 -v /input:/input -v /output:/output mobius-renderer:latest node scripts/render.js --mode preview\n</code></pre></p>"},{"location":"playbooks/runbook/#kubernetes-resources","title":"Kubernetes Resources","text":"<p>Resource requests/limits: - requests: cpu 1000m, mem 1.5Gi - limits: cpu 2000m, mem 3Gi</p>"},{"location":"playbooks/runbook/#health-checks","title":"Health Checks","text":"<ul> <li>Liveness: metrics endpoint 200 OK</li> <li>Readiness: quick dry-run arg build endpoint (optional)</li> </ul>"},{"location":"playbooks/smoke-tests/","title":"Exact smoke tests to run after staging deploy","text":""},{"location":"playbooks/smoke-tests/#dry-run-preview-replace-staging-host","title":"Dry-run preview (replace staging host)","text":"<pre><code>curl -X POST \"https://staging.example.com/api/preview?dryRun=true\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-api-version: v1\" \\\n  -d '{\"projectId\":\"smoke\",\"chapterId\":\"c1\",\"chapter\":{\"title\":\"smoke\",\"steps\":[{\"id\":\"s1\",\"title\":\"t\",\"body\":\"b\"}]}}'\n</code></pre> <p>Expect 202 and JSON with <code>{ status: \"dry_run\" | \"queued\", jobToken, previewPath }</code>.</p>"},{"location":"playbooks/smoke-tests/#confirm-artifact-exists-on-staging-host-or-mounted-data_dir","title":"Confirm artifact exists (on staging host or mounted DATA_DIR)","text":"<pre><code># run on staging host or where DATA_DIR is accessible\nls -l ./data/previews/smoke/c1.json\njq . ./data/previews/smoke/c1.json\n</code></pre>"},{"location":"playbooks/smoke-tests/#confirm-metric-increment-example-scraping-metrics","title":"Confirm metric increment (example scraping /metrics)","text":"<pre><code>curl https://staging.example.com/metrics | grep preview_requests_total\n</code></pre> <p>Expect incremented counter.</p>"},{"location":"playbooks/smoke-tests/#queueback-pressure-test","title":"Queue/back-pressure test","text":"<p>Set: <pre><code>PREVIEW_MAX_CONCURRENCY=1\nPREVIEW_QUEUE_MAX=2 (for this test)\n</code></pre></p> <p>Then concurrently fire 3 non-dry-run preview requests. Expected:</p> <p>First accepted/queued, second either queued/accepted depending on queue behavior, third should trigger 503 + Retry-After if queue is saturated.</p>"},{"location":"playbooks/team-onboarding-guide/","title":"Team Onboarding Guide: Deployment Infrastructure","text":"<p>This guide helps new team members understand and use the Mobius Preview Worker deployment infrastructure effectively.</p>"},{"location":"playbooks/team-onboarding-guide/#overview","title":"Overview","text":"<p>The deployment infrastructure consists of: 1. Cross-platform deployment scripts (PowerShell and Bash) 2. A unified CLI tool for simplified operations 3. GitHub Actions workflows for CI/CD 4. Automated testing for deployment scripts 5. Comprehensive documentation and checklists</p>"},{"location":"playbooks/team-onboarding-guide/#prerequisites","title":"Prerequisites","text":""},{"location":"playbooks/team-onboarding-guide/#required-tools","title":"Required Tools","text":"<ul> <li>Docker: For building and running containers</li> <li>Kubernetes CLI (kubectl): For interacting with Kubernetes clusters</li> <li>Node.js: For running the CLI tool (version 14 or higher)</li> <li>Git: For version control</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#required-access","title":"Required Access","text":"<ul> <li>GitHub Account: With access to the repository</li> <li>GHCR PAT: Personal Access Token for GitHub Container Registry</li> <li>Kubernetes Access: kubeconfig file for target clusters</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#setting-up-your-environment","title":"Setting Up Your Environment","text":""},{"location":"playbooks/team-onboarding-guide/#1-install-required-tools","title":"1. Install Required Tools","text":""},{"location":"playbooks/team-onboarding-guide/#windows","title":"Windows","text":"<pre><code># Install Docker Desktop\n# Download from: https://www.docker.com/products/docker-desktop\n\n# Install Node.js\n# Download from: https://nodejs.org/\n\n# Git is usually included with GitHub Desktop\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#macos","title":"macOS","text":"<pre><code># Install Homebrew if not already installed\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n\n# Install required tools\nbrew install docker kubectl node git\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#linux-ubuntudebian","title":"Linux (Ubuntu/Debian)","text":"<pre><code># Update package index\nsudo apt update\n\n# Install Docker\nsudo apt install docker.io\n\n# Install kubectl\nsudo apt install kubectl\n\n# Install Node.js\nsudo apt install nodejs npm\n\n# Install Git\nsudo apt install git\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#2-configure-github-access","title":"2. Configure GitHub Access","text":""},{"location":"playbooks/team-onboarding-guide/#generate-ghcr-pat","title":"Generate GHCR PAT","text":"<ol> <li>Go to GitHub Settings \u2192 Developer settings \u2192 Personal access tokens</li> <li>Generate new token with <code>read:packages</code> and <code>write:packages</code> scopes</li> <li>Save the token securely</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#configure-docker-authentication","title":"Configure Docker Authentication","text":"<pre><code># Login to GHCR\necho YOUR_PAT | docker login ghcr.io -u YOUR_USERNAME --password-stdin\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#3-configure-kubernetes-access","title":"3. Configure Kubernetes Access","text":""},{"location":"playbooks/team-onboarding-guide/#set-up-kubeconfig","title":"Set up kubeconfig","text":"<ol> <li>Obtain the kubeconfig file from your system administrator</li> <li>Place it in <code>~/.kube/config</code> or set the <code>KUBECONFIG</code> environment variable</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#verify-access","title":"Verify Access","text":"<pre><code># Check current context\nkubectl config current-context\n\n# List available contexts\nkubectl config get-contexts\n\n# Test connection\nkubectl get nodes\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#first-deployment","title":"First Deployment","text":""},{"location":"playbooks/team-onboarding-guide/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone &lt;repository-url&gt;\ncd mobius-games-tutorial-generator\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#2-run-a-dry-run","title":"2. Run a Dry Run","text":"<pre><code># Test the deployment process without making changes\nnode cli/mobius-deploy.js deploy --dry-run\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#3-deploy-to-staging","title":"3. Deploy to Staging","text":"<pre><code># Deploy to staging environment\nnode cli/mobius-deploy.js deploy --namespace staging\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#4-verify-deployment","title":"4. Verify Deployment","text":"<pre><code># Verify the deployment was successful\nnode cli/mobius-deploy.js verify --namespace staging\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#5-check-status","title":"5. Check Status","text":"<pre><code># Check the deployment status\nnode cli/mobius-deploy.js status --namespace staging\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#daily-workflow","title":"Daily Workflow","text":""},{"location":"playbooks/team-onboarding-guide/#morning-check","title":"Morning Check","text":"<pre><code># Check status of production deployment\nnode cli/mobius-deploy.js status --namespace production\n\n# View recent logs if needed\nnode cli/mobius-deploy.js logs --namespace production --tail 50\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#deploying-changes","title":"Deploying Changes","text":"<pre><code># 1. Make code changes\n# 2. Commit and push to feature branch\n# 3. Create pull request\n# 4. After merge, CI/CD will automatically deploy to staging\n# 5. Manually deploy to production after verification:\nnode cli/mobius-deploy.js deploy --namespace production\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#troubleshooting","title":"Troubleshooting","text":"<pre><code># 1. Check status\nnode cli/mobius-deploy.js status --namespace production\n\n# 2. View logs\nnode cli/mobius-deploy.js logs --namespace production\n\n# 3. If issues found, rollback\nnode cli/mobius-deploy.js rollback --namespace production\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#best-practices","title":"Best Practices","text":""},{"location":"playbooks/team-onboarding-guide/#code-changes","title":"Code Changes","text":"<ol> <li>Always create feature branches for changes</li> <li>Write clear commit messages</li> <li>Follow the pull request process</li> <li>Ensure all tests pass before merging</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#deployments","title":"Deployments","text":"<ol> <li>Always use <code>--dry-run</code> first</li> <li>Deploy to staging before production</li> <li>Verify deployments after they complete</li> <li>Monitor logs after deployments</li> <li>Have a rollback plan ready</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#security","title":"Security","text":"<ol> <li>Never commit PATs or other secrets to the repository</li> <li>Use environment variables for sensitive data</li> <li>Rotate PATs regularly</li> <li>Follow the principle of least privilege</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#collaboration","title":"Collaboration","text":"<ol> <li>Communicate deployment activities to the team</li> <li>Document any issues and their solutions</li> <li>Update documentation when making changes</li> <li>Participate in code reviews</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#common-tasks","title":"Common Tasks","text":""},{"location":"playbooks/team-onboarding-guide/#building-and-pushing-images","title":"Building and Pushing Images","text":"<pre><code># Build and push a new image\nnode cli/mobius-deploy.js build-push\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#updating-manifests","title":"Updating Manifests","text":"<pre><code># Update Kubernetes manifests with a specific image tag\nnode cli/mobius-deploy.js update-manifests --image-tag ghcr.io/w9bikze8u4cbupc/mobius-preview-worker:v1.2.3\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#applying-manifests","title":"Applying Manifests","text":"<pre><code># Apply manifests to a specific namespace\nnode cli/mobius-deploy.js apply-manifests --namespace production\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#viewing-logs","title":"Viewing Logs","text":"<pre><code># View recent logs\nnode cli/mobius-deploy.js logs --namespace production\n\n# View logs with more context\nnode cli/mobius-deploy.js logs --namespace production --tail 100\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#rolling-back","title":"Rolling Back","text":"<pre><code># Rollback a deployment\nnode cli/mobius-deploy.js rollback --namespace production\n</code></pre>"},{"location":"playbooks/team-onboarding-guide/#troubleshooting-guide","title":"Troubleshooting Guide","text":""},{"location":"playbooks/team-onboarding-guide/#deployment-fails","title":"Deployment Fails","text":"<ol> <li>Check the error message</li> <li>Verify all prerequisites are met</li> <li>Run <code>status</code> command to check current state</li> <li>View logs for more details</li> <li>If needed, rollback the deployment</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#cannot-connect-to-kubernetes","title":"Cannot Connect to Kubernetes","text":"<ol> <li>Verify kubeconfig is correct</li> <li>Check that the cluster is running</li> <li>Verify network connectivity</li> <li>Contact system administrator if issues persist</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#image-pull-errors","title":"Image Pull Errors","text":"<ol> <li>Verify the image exists in GHCR</li> <li>Check that the image tag is correct</li> <li>Verify GHCR credentials</li> <li>Check image pull secrets in Kubernetes</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#scripts-not-found","title":"Scripts Not Found","text":"<ol> <li>Ensure you're in the project root directory</li> <li>Verify all files are present</li> <li>Check file permissions (especially on Unix systems)</li> </ol>"},{"location":"playbooks/team-onboarding-guide/#resources","title":"Resources","text":""},{"location":"playbooks/team-onboarding-guide/#documentation","title":"Documentation","text":"<ul> <li>CLI_DEPLOYMENT_TOOL.md: Complete CLI documentation</li> <li>CLI_USAGE_EXAMPLES.md: Practical usage examples</li> <li>DEPLOYMENT_CHECKLIST.md: Deployment checklist</li> <li>DEPLOYMENT_ENHANCEMENTS_SUMMARY.md: Summary of deployment enhancements</li> <li>CROSS_PLATFORM_DEPLOYMENT_SCRIPTS.md: Cross-platform script documentation</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#workflows","title":"Workflows","text":"<ul> <li>.github/workflows/preview-worker-build.yaml: Build workflow</li> <li>.github/workflows/preview-worker-deploy.yaml: Deploy workflow</li> <li>.github/workflows/test-deployment-scripts.yaml: Test workflow</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#scripts","title":"Scripts","text":"<ul> <li>PowerShell scripts: <code>*.ps1</code> files in the project root</li> <li>Bash scripts: <code>*.sh</code> files in the project root</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#getting-help","title":"Getting Help","text":""},{"location":"playbooks/team-onboarding-guide/#internal-resources","title":"Internal Resources","text":"<ul> <li>Contact your team lead for access issues</li> <li>Check the team wiki for additional documentation</li> <li>Ask in the team chat for quick questions</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#external-resources","title":"External Resources","text":"<ul> <li>Kubernetes Documentation</li> <li>Docker Documentation</li> <li>GitHub Documentation</li> </ul>"},{"location":"playbooks/team-onboarding-guide/#feedback-and-improvements","title":"Feedback and Improvements","text":"<p>We're always looking to improve our deployment infrastructure. If you: - Encounter issues or bugs - Have suggestions for improvements - Find documentation gaps - Want to add new features</p> <p>Please: 1. Create an issue in the GitHub repository 2. Discuss in team meetings 3. Submit a pull request with fixes/improvements</p>"},{"location":"playbooks/team-training-guide/","title":"Team Training Guide","text":""},{"location":"playbooks/team-training-guide/#overview","title":"Overview","text":"<p>This guide provides a comprehensive training program for development and operations teams on the Mobius Preview Worker deployment infrastructure. It includes training materials, schedules, and evaluation methods.</p>"},{"location":"playbooks/team-training-guide/#training-objectives","title":"Training Objectives","text":""},{"location":"playbooks/team-training-guide/#for-development-teams","title":"For Development Teams","text":"<ol> <li>Understand the Preview Worker architecture and functionality</li> <li>Master CLI usage for deployment and management</li> <li>Learn troubleshooting and rollback procedures</li> <li>Gain familiarity with monitoring dashboards and alert response</li> </ol>"},{"location":"playbooks/team-training-guide/#for-operations-teams","title":"For Operations Teams","text":"<ol> <li>Master Kubernetes deployment and management</li> <li>Understand monitoring and alerting systems</li> <li>Learn incident response procedures</li> <li>Gain expertise in security and compliance</li> </ol>"},{"location":"playbooks/team-training-guide/#training-modules","title":"Training Modules","text":""},{"location":"playbooks/team-training-guide/#module-1-preview-worker-architecture-1-hour","title":"Module 1: Preview Worker Architecture (1 hour)","text":"<ul> <li>Overview: Introduction to the Preview Worker role in the Mobius ecosystem</li> <li>Components: Core worker functionality, metrics, and monitoring</li> <li>Architecture: Container design, scaling strategy, and service discovery</li> <li>Hands-on: Explore the worker codebase and configuration files</li> </ul>"},{"location":"playbooks/team-training-guide/#module-2-cli-tool-usage-2-hours","title":"Module 2: CLI Tool Usage (2 hours)","text":"<ul> <li>Overview: Introduction to the CLI tool and its capabilities</li> <li>Basic Commands: Deploy, verify, status, logs, rollback</li> <li>Advanced Features: Custom image tags, namespaces, dry-run mode</li> <li>Hands-on: Practice CLI commands in a sandbox environment</li> <li>Best Practices: Security, efficiency, and troubleshooting tips</li> </ul>"},{"location":"playbooks/team-training-guide/#module-3-deployment-workflows-2-hours","title":"Module 3: Deployment Workflows (2 hours)","text":"<ul> <li>CI/CD Overview: GitHub Actions workflows for build and deploy</li> <li>Scripting: PowerShell and Bash deployment scripts</li> <li>Configuration: Environment variables and Kubernetes manifests</li> <li>Hands-on: Execute deployments in staging environment</li> <li>Troubleshooting: Common deployment issues and solutions</li> </ul>"},{"location":"playbooks/team-training-guide/#module-4-monitoring-and-alerting-2-hours","title":"Module 4: Monitoring and Alerting (2 hours)","text":"<ul> <li>Metrics: Understanding key performance indicators</li> <li>Dashboards: Grafana dashboard navigation and interpretation</li> <li>Alerts: Alert rules, routing, and response procedures</li> <li>Hands-on: Monitor a deployment and respond to simulated alerts</li> <li>Best Practices: Proactive monitoring and alert tuning</li> </ul>"},{"location":"playbooks/team-training-guide/#module-5-security-and-compliance-15-hours","title":"Module 5: Security and Compliance (1.5 hours)","text":"<ul> <li>Credentials: Secure handling of PATs and other secrets</li> <li>Access Control: RBAC and permission management</li> <li>Compliance: Following security best practices and audit requirements</li> <li>Hands-on: Review security configurations and conduct a security audit</li> <li>Incident Response: Security incident identification and response</li> </ul>"},{"location":"playbooks/team-training-guide/#module-6-troubleshooting-and-optimization-15-hours","title":"Module 6: Troubleshooting and Optimization (1.5 hours)","text":"<ul> <li>Debugging: Log analysis and error identification</li> <li>Performance: Resource optimization and scaling</li> <li>Rollback: Recovery procedures and best practices</li> <li>Hands-on: Troubleshoot a simulated production issue</li> <li>Continuous Improvement: Feedback loops and process optimization</li> </ul>"},{"location":"playbooks/team-training-guide/#training-schedule","title":"Training Schedule","text":""},{"location":"playbooks/team-training-guide/#week-1-foundation-training","title":"Week 1: Foundation Training","text":"<ul> <li>Day 1: Module 1 - Preview Worker Architecture</li> <li>Day 2: Module 2 - CLI Tool Usage (Part 1)</li> <li>Day 3: Module 2 - CLI Tool Usage (Part 2)</li> <li>Day 4: Module 3 - Deployment Workflows (Part 1)</li> <li>Day 5: Module 3 - Deployment Workflows (Part 2)</li> </ul>"},{"location":"playbooks/team-training-guide/#week-2-advanced-training","title":"Week 2: Advanced Training","text":"<ul> <li>Day 1: Module 4 - Monitoring and Alerting (Part 1)</li> <li>Day 2: Module 4 - Monitoring and Alerting (Part 2)</li> <li>Day 3: Module 5 - Security and Compliance</li> <li>Day 4: Module 6 - Troubleshooting and Optimization</li> <li>Day 5: Comprehensive Review and Q&amp;A</li> </ul>"},{"location":"playbooks/team-training-guide/#training-materials","title":"Training Materials","text":""},{"location":"playbooks/team-training-guide/#documentation","title":"Documentation","text":"<ul> <li>CLI_DEPLOYMENT_TOOL.md: Complete CLI documentation</li> <li>CLI_USAGE_EXAMPLES.md: Practical usage examples</li> <li>DEPLOYMENT_CHECKLIST.md: Deployment checklist</li> <li>TEAM_ONBOARDING_GUIDE.md: Onboarding guide</li> <li>MONITORING_AND_ALERTING.md: Monitoring setup</li> <li>QUICK_REFERENCE_GUIDE.md: Quick reference guide</li> </ul>"},{"location":"playbooks/team-training-guide/#cheat-sheets","title":"Cheat Sheets","text":"<ul> <li>CLI Commands Cheat Sheet: Essential CLI commands and options</li> <li>Kubernetes Commands Cheat Sheet: Common kubectl commands</li> <li>Troubleshooting Cheat Sheet: Quick solutions for common issues</li> <li>Security Checklist: Security best practices and verification steps</li> </ul>"},{"location":"playbooks/team-training-guide/#hands-on-labs","title":"Hands-on Labs","text":"<ul> <li>Lab 1: Basic CLI operations and deployment</li> <li>Lab 2: Advanced CLI features and customization</li> <li>Lab 3: Monitoring dashboard navigation and alert response</li> <li>Lab 4: Troubleshooting and rollback procedures</li> <li>Lab 5: Security audit and compliance verification</li> </ul>"},{"location":"playbooks/team-training-guide/#training-delivery-methods","title":"Training Delivery Methods","text":""},{"location":"playbooks/team-training-guide/#instructor-led-training","title":"Instructor-Led Training","text":"<ul> <li>Live presentations with slides and demonstrations</li> <li>Interactive Q&amp;A sessions</li> <li>Hands-on labs with instructor guidance</li> <li>Real-time feedback and support</li> </ul>"},{"location":"playbooks/team-training-guide/#self-paced-learning","title":"Self-Paced Learning","text":"<ul> <li>Recorded video tutorials</li> <li>Interactive documentation</li> <li>Online quizzes and assessments</li> <li>Peer collaboration and discussion forums</li> </ul>"},{"location":"playbooks/team-training-guide/#blended-approach","title":"Blended Approach","text":"<ul> <li>Combination of instructor-led and self-paced learning</li> <li>Flexible scheduling to accommodate different learning styles</li> <li>Regular check-ins and progress reviews</li> <li>Personalized support and mentoring</li> </ul>"},{"location":"playbooks/team-training-guide/#evaluation-and-certification","title":"Evaluation and Certification","text":""},{"location":"playbooks/team-training-guide/#knowledge-checks","title":"Knowledge Checks","text":"<ul> <li>Pre-training Assessment: Baseline knowledge evaluation</li> <li>Module Quizzes: End-of-module knowledge checks</li> <li>Final Exam: Comprehensive assessment of all training materials</li> <li>Practical Exercises: Hands-on lab evaluations</li> </ul>"},{"location":"playbooks/team-training-guide/#performance-metrics","title":"Performance Metrics","text":"<ul> <li>Attendance: Participation in training sessions</li> <li>Engagement: Active participation in discussions and activities</li> <li>Knowledge Gain: Improvement from pre to post-training assessments</li> <li>Skill Application: Successful completion of hands-on labs</li> </ul>"},{"location":"playbooks/team-training-guide/#certification","title":"Certification","text":"<ul> <li>Completion Certificate: Awarded for attending all sessions</li> <li>Proficiency Certificate: Awarded for passing all assessments</li> <li>Expert Certificate: Awarded for exceptional performance and peer feedback</li> </ul>"},{"location":"playbooks/team-training-guide/#ongoing-learning-and-development","title":"Ongoing Learning and Development","text":""},{"location":"playbooks/team-training-guide/#regular-refresher-training","title":"Regular Refresher Training","text":"<ul> <li>Quarterly Workshops: Updates on new features and best practices</li> <li>Monthly Webinars: Deep dives into specific topics</li> <li>Weekly Office Hours: Q&amp;A sessions with subject matter experts</li> </ul>"},{"location":"playbooks/team-training-guide/#advanced-training-opportunities","title":"Advanced Training Opportunities","text":"<ul> <li>Specialized Courses: Advanced topics and emerging technologies</li> <li>External Conferences: Industry events and networking opportunities</li> <li>Certification Programs: Professional certifications and credentials</li> </ul>"},{"location":"playbooks/team-training-guide/#knowledge-sharing","title":"Knowledge Sharing","text":"<ul> <li>Brown Bag Sessions: Informal lunch-and-learn presentations</li> <li>Tech Talks: In-depth technical presentations</li> <li>Mentorship Programs: Peer-to-peer learning and guidance</li> </ul>"},{"location":"playbooks/team-training-guide/#feedback-and-continuous-improvement","title":"Feedback and Continuous Improvement","text":""},{"location":"playbooks/team-training-guide/#training-feedback","title":"Training Feedback","text":"<ul> <li>Session Surveys: Immediate feedback on each training session</li> <li>Overall Evaluation: Comprehensive training program assessment</li> <li>Suggestion Box: Anonymous feedback and improvement ideas</li> <li>Focus Groups: In-depth discussions with select participants</li> </ul>"},{"location":"playbooks/team-training-guide/#continuous-improvement","title":"Continuous Improvement","text":"<ul> <li>Content Updates: Regular review and update of training materials</li> <li>Delivery Method Optimization: Improvement of training delivery approaches</li> <li>Technology Integration: Adoption of new training technologies and tools</li> <li>Best Practice Sharing: Incorporation of lessons learned from participants</li> </ul>"},{"location":"playbooks/team-training-guide/#resources-and-support","title":"Resources and Support","text":""},{"location":"playbooks/team-training-guide/#training-environment","title":"Training Environment","text":"<ul> <li>Sandbox Cluster: Dedicated Kubernetes environment for hands-on practice</li> <li>Documentation Portal: Centralized access to all training materials</li> <li>Support Channels: Dedicated channels for training-related questions</li> <li>Resource Library: Additional learning resources and references</li> </ul>"},{"location":"playbooks/team-training-guide/#post-training-support","title":"Post-Training Support","text":"<ul> <li>Mentorship Program: Ongoing guidance from experienced team members</li> <li>Help Desk: Dedicated support for deployment and operational questions</li> <li>Community Forums: Peer-to-peer support and knowledge sharing</li> <li>Regular Check-ins: Scheduled meetings to address ongoing needs</li> </ul>"},{"location":"playbooks/team-training-guide/#conclusion","title":"Conclusion","text":"<p>This training guide provides a comprehensive program for enabling development and operations teams to effectively use the Mobius Preview Worker deployment infrastructure. By following this structured approach, teams will gain the knowledge and skills needed to deploy, monitor, and maintain the system with confidence.</p> <p>Regular evaluation and continuous improvement of the training program will ensure it remains relevant and effective as the system and team evolve.</p>"},{"location":"playbooks/token-and-review-checklists/","title":"Token and Review Checklists for Phase F Rollout","text":""},{"location":"playbooks/token-and-review-checklists/#files-created","title":"Files Created","text":"<ol> <li><code>GITHUB_TOKEN_PERMISSIONS_CHECKLIST.md</code> - Comprehensive guide for creating and configuring GitHub tokens with minimal required permissions</li> <li><code>PR_REVIEWER_CHECKLIST.md</code> - Compact copy/paste checklist for PR reviewers</li> <li><code>VERIFY_GITHUB_TOKEN.ps1</code> - PowerShell script to set token and verify access</li> <li><code>verify_github_token.sh</code> - Bash script to set token and verify access</li> </ol>"},{"location":"playbooks/token-and-review-checklists/#1-github-token-permissions-checklist","title":"1. GitHub Token Permissions Checklist","text":"<p>The <code>GITHUB_TOKEN_PERMISSIONS_CHECKLIST.md</code> file contains detailed instructions for:</p> <ul> <li>Creating fine-grained personal access tokens with minimal permissions</li> <li>Setting up SAML/SSO authorization for organizational repositories</li> <li>Configuring classic PATs as an alternative</li> <li>Setting and testing tokens locally in both Bash and PowerShell</li> <li>Troubleshooting common 401 errors</li> <li>Best practices for token security and management</li> </ul>"},{"location":"playbooks/token-and-review-checklists/#2-pr-reviewer-checklist","title":"2. PR Reviewer Checklist","text":"<p>The <code>PR_REVIEWER_CHECKLIST.md</code> file contains a compact, copy/paste checklist that reviewers can use to validate Phase F PRs. It covers:</p> <ul> <li>User-visible behavior and test instructions</li> <li>File change verification</li> <li>CI and unit test validation</li> <li>Preview endpoint functionality</li> <li>Metrics registration</li> <li>Script verification</li> <li>Security checks</li> <li>Documentation updates</li> <li>Manual verification steps for Ops</li> </ul>"},{"location":"playbooks/token-and-review-checklists/#3-verification-scripts","title":"3. Verification Scripts","text":"<p>Two verification scripts are provided to help set up and test GitHub token access:</p>"},{"location":"playbooks/token-and-review-checklists/#powershell-version-verify_github_tokenps1","title":"PowerShell Version (<code>VERIFY_GITHUB_TOKEN.ps1</code>)","text":"<ul> <li>Interactive token input if not already set</li> <li>User and repository access verification</li> <li>Branch existence checking</li> <li>Environment variable setup</li> </ul>"},{"location":"playbooks/token-and-review-checklists/#bash-version-verify_github_tokensh","title":"Bash Version (<code>verify_github_token.sh</code>)","text":"<ul> <li>Same functionality as PowerShell version</li> <li>Compatible with Unix-like systems</li> <li>Uses curl and jq for API interactions</li> </ul>"},{"location":"playbooks/token-and-review-checklists/#usage-instructions","title":"Usage Instructions","text":"<ol> <li>For Token Setup:</li> <li>Review <code>GITHUB_TOKEN_PERMISSIONS_CHECKLIST.md</code> for detailed instructions</li> <li> <p>Run either <code>VERIFY_GITHUB_TOKEN.ps1</code> or <code>verify_github_token.sh</code> to set and verify your token</p> </li> <li> <p>For PR Reviews:</p> </li> <li>Copy the checklist from <code>PR_REVIEWER_CHECKLIST.md</code></li> <li>Paste it as a comment on the PR</li> <li>Tag appropriate reviewers</li> </ol>"},{"location":"playbooks/token-and-review-checklists/#security-notes","title":"Security Notes","text":"<ul> <li>Never share your GitHub token with anyone</li> <li>Store tokens securely in environment variables or credential managers</li> <li>Use fine-grained tokens with minimal permissions when possible</li> <li>Regularly rotate tokens and remove unused ones</li> <li>Authorize tokens for SAML/SSO if required by your organization</li> </ul>"},{"location":"playbooks/windows-deployment-guide/","title":"Windows PowerShell Deployment Guide for Hardened Preview Worker","text":""},{"location":"playbooks/windows-deployment-guide/#windows-powershell-quick-start","title":"\ud83d\ude80 Windows PowerShell Quick Start","text":""},{"location":"playbooks/windows-deployment-guide/#step-1-check-current-status","title":"Step 1: Check Current Status","text":"<pre><code># Check what files we have\nGet-ChildItem k8s/preview-worker/\n\n# Check git status\ngit status\n\n# Check if hardened deployment exists\nTest-Path k8s/preview-worker/hardened-deployment.yaml\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#step-2-update-image-placeholder-critical","title":"Step 2: Update Image Placeholder (Critical!)","text":"<pre><code># Replace with your actual registry and image tag\n# Example: registry.example.com/mobius-preview-worker:1.0.0\n\n$oldImage = \"YOUR_REGISTRY/mobius-preview-worker:TAG\"\n$newImage = \"registry.example.com/mobius-preview-worker:1.0.0\"  # Change this!\n\n# Update the hardened deployment file\n$content = Get-Content k8s/preview-worker/hardened-deployment.yaml -Raw\n$updatedContent = $content -replace $oldImage, $newImage\nSet-Content -Path k8s/preview-worker/hardened-deployment.yaml -Value $updatedContent -NoNewline\n\n# Verify the change\nSelect-String -Path k8s/preview-worker/hardened-deployment.yaml -Pattern \"image:\"\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#step-3-use-the-hardened-deployment","title":"Step 3: Use the Hardened Deployment","text":"<pre><code># Copy hardened deployment to replace the basic one\nCopy-Item k8s/preview-worker/hardened-deployment.yaml k8s/preview-worker/sa-and-scc.yaml -Force\n\n# Or use the hardened deployment directly\n# The PowerShell script will use the hardened deployment file\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#step-4-deploy-with-powershell-script","title":"Step 4: Deploy with PowerShell Script","text":"<pre><code># Make sure you have the deployment script\nTest-Path deploy-hardened-preview-worker.ps1\n\n# Basic deployment (interactive)\n.\\deploy-hardened-preview-worker.ps1\n\n# Or with parameters\n.\\deploy-hardened-preview-worker.ps1 -ImageRegistry \"registry.example.com\" -ImageTag \"1.0.0\"\n\n# Or dry-run to validate first\n.\\deploy-hardened-preview-worker.ps1 -DryRun\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#step-5-create-required-secrets","title":"Step 5: Create Required Secrets","text":"<pre><code># Create registry secret (if using private registry)\nkubectl create secret docker-registry regcred `\n  --docker-server=\"your-registry.com\" `\n  --docker-username=\"your-username\" `\n  --docker-password=\"your-password\" `\n  --docker-email=\"your-email\" `\n  -n preview-worker\n\n# Create application secrets\nkubectl -n preview-worker create secret generic preview-worker-secrets `\n  --from-literal=REDIS_URL=\"redis://your-redis:6379\" `\n  --from-literal=SOME_API_KEY=\"your-api-key\"\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#step-6-run-smoke-test","title":"Step 6: Run Smoke Test","text":"<pre><code># Run the PowerShell smoke test\n.\\k8s\\preview-worker\\smoke-test-preview-worker.ps1\n\n# Or manual verification\nkubectl -n preview-worker rollout status deployment/preview-worker --timeout=180s\nkubectl -n preview-worker get pods -o wide\nkubectl -n preview-worker get svc\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#verification-commands-powershell","title":"\ud83d\udd27 Verification Commands (PowerShell)","text":""},{"location":"playbooks/windows-deployment-guide/#health-check","title":"Health Check","text":"<pre><code># Port forward and test\nStart-Job -ScriptBlock { kubectl -n preview-worker port-forward svc/preview-worker 8080:5001 }\nStart-Sleep -Seconds 3\nInvoke-WebRequest -Uri \"http://localhost:8080/health\" -UseBasicParsing\nGet-Job | Stop-Job\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#monitor-deployment","title":"Monitor Deployment","text":"<pre><code># Watch logs\nkubectl -n preview-worker logs -f deployment/preview-worker\n\n# Check events\nkubectl -n preview-worker get events --sort-by='.lastTimestamp'\n\n# Describe resources\nkubectl -n preview-worker describe deployment preview-worker\nkubectl -n preview-worker describe pod -l app=preview-worker\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#rollback-commands-powershell","title":"\ud83d\udd04 Rollback Commands (PowerShell)","text":""},{"location":"playbooks/windows-deployment-guide/#quick-rollback","title":"Quick Rollback","text":"<pre><code># Rollback to previous version\nkubectl -n preview-worker rollout undo deployment/preview-worker\n\n# Check rollback status\nkubectl -n preview-worker rollout status deployment/preview-worker\n\n# View rollout history\nkubectl -n preview-worker rollout history deployment/preview-worker\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#what-you-get","title":"\ud83d\udcca What You Get","text":""},{"location":"playbooks/windows-deployment-guide/#security-hardening","title":"Security Hardening \u2705","text":"<ul> <li>ServiceAccount isolation (no cluster privileges)</li> <li>Security context (non-root, read-only filesystem)</li> <li>Resource limits (prevents resource exhaustion)</li> <li>Network isolation ready</li> <li>Minimal RBAC permissions</li> </ul>"},{"location":"playbooks/windows-deployment-guide/#operational-excellence","title":"Operational Excellence \u2705","text":"<ul> <li>Health probes with proper timing</li> <li>Rolling update strategy</li> <li>Graceful termination (30s)</li> <li>Comprehensive smoke testing</li> <li>Easy rollback capability</li> </ul>"},{"location":"playbooks/windows-deployment-guide/#critical-reminders","title":"\ud83d\udea8 Critical Reminders","text":"<ol> <li>Update Image Placeholder - Replace <code>YOUR_REGISTRY/mobius-preview-worker:TAG</code> with your actual image</li> <li>Create Secrets - Registry and application secrets are required</li> <li>Test in Staging First - Always test in non-production environment</li> <li>Monitor After Deployment - Watch logs and metrics post-deployment</li> </ol>"},{"location":"playbooks/windows-deployment-guide/#complete-deployment-example","title":"\ud83c\udfaf Complete Deployment Example","text":"<pre><code># 1. Update image (change this to your actual registry)\n$oldImage = \"YOUR_REGISTRY/mobius-preview-worker:TAG\"\n$newImage = \"registry.example.com/mobius-preview-worker:1.0.0\"\n$content = Get-Content k8s/preview-worker/hardened-deployment.yaml -Raw\n$updatedContent = $content -replace $oldImage, $newImage\nSet-Content -Path k8s/preview-worker/hardened-deployment.yaml -Value $updatedContent -NoNewline\n\n# 2. Deploy with automation\n.\\deploy-hardened-preview-worker.ps1 -ImageRegistry \"registry.example.com\" -ImageTag \"1.0.0\"\n\n# 3. Create secrets\nkubectl -n preview-worker create secret generic preview-worker-secrets `\n  --from-literal=REDIS_URL=\"redis://your-redis:6379\" `\n  --from-literal=SOME_API_KEY=\"your-api-key\"\n\n# 4. Run smoke test\n.\\k8s\\preview-worker\\smoke-test-preview-worker.ps1\n</code></pre>"},{"location":"playbooks/windows-deployment-guide/#support","title":"\ud83d\udcde Support","text":"<p>If you encounter issues: 1. Check the troubleshooting section in <code>HARDENED_DEPLOYMENT_GUIDE.md</code> 2. Run the smoke test script for diagnostic information 3. Check pod logs and events 4. Verify all secrets are created correctly</p> <p>Ready to deploy on Windows? The PowerShell scripts handle all the complexity for you. Just update the image placeholder and run the deployment script!</p>"},{"location":"roadmap/","title":"Roadmap","text":"<p>Purpose: Future plans, feature timelines, and strategic direction.</p>"},{"location":"roadmap/#contents","title":"Contents","text":"<p>Forward-looking planning documents and milestone tracking.</p>"},{"location":"roadmap/execution-instructions/","title":"Execution Instructions for Phase F Rollout","text":""},{"location":"roadmap/execution-instructions/#pr-creation-urls","title":"PR Creation URLs","text":"<ol> <li>Feature PR: https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...phase-f/preview-image-matcher</li> <li>CI Workflow PR: https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...ci/add-phase-f-verify-workflow</li> </ol>"},{"location":"roadmap/execution-instructions/#steps-to-execute","title":"Steps to Execute","text":""},{"location":"roadmap/execution-instructions/#1-create-feature-pr","title":"1. Create Feature PR","text":"<ul> <li>Go to: https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...phase-f/preview-image-matcher</li> <li>Click \"Create pull request\"</li> <li>Copy the content from <code>FEATURE_PR_BODY.md</code> and paste it as the PR description</li> <li>Add labels: feature, phase-f, needs-review, ready-for-staging</li> <li>Add reviewers: developer, ops, team-lead</li> <li>Add assignee: developer</li> </ul>"},{"location":"roadmap/execution-instructions/#2-create-ci-workflow-pr","title":"2. Create CI Workflow PR","text":"<ul> <li>Go to: https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...ci/add-phase-f-verify-workflow</li> <li>Click \"Create pull request\"</li> <li>Copy the content from <code>CI_WORKFLOW_PR_BODY.md</code> and paste it as the PR description</li> <li>Add labels: ci, phase-f</li> <li>Add reviewer: ops</li> <li>Add assignee: developer</li> </ul>"},{"location":"roadmap/execution-instructions/#3-create-issues","title":"3. Create Issues","text":"<p>Create three new issues in the repository using the following files as content: 1. <code>ISSUE_PREVIEW_WORKER.md</code> 2. <code>ISSUE_ASSET_UPLOADS.md</code> 3. <code>ISSUE_EXPORT_PACKAGING.md</code></p>"},{"location":"roadmap/execution-instructions/#verification-and-monitoring","title":"Verification and Monitoring","text":"<ul> <li>Use <code>SMOKE_TESTS.md</code> for post-deployment verification</li> <li>Use <code>MONITORING_AND_ROLLBACK.md</code> for runbook information</li> <li>Use <code>REVIEWER_CHECKLIST.md</code> for PR review checklist</li> </ul>"},{"location":"roadmap/execution-instructions/#files-created","title":"Files Created","text":"<ul> <li>FEATURE_PR_BODY.md - Content for the feature PR</li> <li>CI_WORKFLOW_PR_BODY.md - Content for the CI workflow PR</li> <li>ISSUE_PREVIEW_WORKER.md - Content for Preview Worker issue</li> <li>ISSUE_ASSET_UPLOADS.md - Content for Asset Uploads issue</li> <li>ISSUE_EXPORT_PACKAGING.md - Content for Export Packaging issue</li> <li>SMOKE_TESTS.md - Smoke tests to run after deployment</li> <li>MONITORING_AND_ROLLBACK.md - Monitoring and rollback procedures</li> <li>REVIEWER_CHECKLIST.md - Checklist for PR reviewers</li> <li>EXECUTION_INSTRUCTIONS.md - This file</li> </ul>"},{"location":"roadmap/execution-options/","title":"Execution Options for Phase F Rollout","text":""},{"location":"roadmap/execution-options/#prerequisites","title":"Prerequisites","text":"<p>Before executing either option, you need: 1. A GitHub Personal Access Token (PAT) with <code>repo</code> scope 2. Repository owner and name (in this case: owner=<code>w9bikze8u4cbupc</code>, repo=<code>MOBIUS</code>)</p>"},{"location":"roadmap/execution-options/#option-1-manual-web-ui-approach","title":"Option 1: Manual Web UI Approach","text":""},{"location":"roadmap/execution-options/#steps","title":"Steps:","text":"<ol> <li>Open the Feature PR page:    https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...phase-f/preview-image-matcher    Click \"Create pull request\" and use the following content:</li> </ol> <p>Title: <code>Phase F: Image Matcher UI + Preview backend stub</code></p> <p>Body: <pre><code>Summary\n- Adds Image Matcher React component (drag/drop, asset library, match grid).\n- Adds Script Workbench container (ScriptEditor + ImageMatcher + PreviewPane).\n- Adds preview backend stub: POST /api/preview (validation, dry-run, artifact persisted at DATA_DIR/previews).\n- Adds metrics: preview_requests_total, preview_failures_total, preview_duration_ms.\n- Adds unit tests and verification scripts.\n\nAcceptance criteria\n- Unit tests pass (backend + client).\n- Dry-run preview writes artifact and increments metric.\n- Queue/back-pressure behavior enforced.\n- Docs updated (docs/api/preview.md and runbook).\n</code></pre></p> <p>Labels: <code>feature</code>, <code>phase-f</code>, <code>needs-review</code>, <code>ready-for-staging</code> Reviewers: <code>developer</code>, <code>ops</code>, <code>team-lead</code> Assignee: <code>developer</code></p> <ol> <li>Open the CI Workflow PR page:    https://github.com/w9bikze8u4cbupc/MOBIUS/compare/staging...ci/add-phase-f-verify-workflow    Click \"Create pull request\" and use the following content:</li> </ol> <p>Title: <code>CI: Add staging verify workflow for Phase F</code></p> <p>Body: <pre><code>Adds post-deploy verification jobs (Linux + Windows) to verify Phase F preview &amp; matcher functionality. Runs scripts/verify-phase-f.sh and scripts/verify-phase-f.ps1 after the deploy_to_staging job completes. Uploads verification artifacts on failure for debugging.\n\nThis workflow file: .github/workflows/staging-verify-phase-f.yml\n</code></pre></p> <p>Labels: <code>ci</code>, <code>phase-f</code> Reviewer: <code>ops</code> Assignee: <code>developer</code></p> <ol> <li>Create three new issues using the content from the following files:</li> <li><code>ISSUE_PREVIEW_WORKER.md</code></li> <li><code>ISSUE_ASSET_UPLOADS.md</code></li> <li><code>ISSUE_EXPORT_PACKAGING.md</code></li> </ol>"},{"location":"roadmap/execution-options/#option-2-automated-approach-curl-commands","title":"Option 2: Automated Approach (curl commands)","text":""},{"location":"roadmap/execution-options/#files-created","title":"Files Created:","text":"<ol> <li><code>pr_feature.json</code> - Payload for Feature PR</li> <li><code>pr_ci.json</code> - Payload for CI Workflow PR</li> <li><code>preview_issue.json</code> - Payload for Preview Worker issue</li> <li><code>asset_issue.json</code> - Payload for Asset Uploads issue</li> <li><code>packaging_issue.json</code> - Payload for Export Packaging issue</li> <li><code>create_prs_and_issues.sh</code> - Bash script for automated creation</li> <li><code>create_prs_and_issues.ps1</code> - PowerShell script for automated creation</li> </ol>"},{"location":"roadmap/execution-options/#steps_1","title":"Steps:","text":"<ol> <li> <p>Set environment variables:    <pre><code>export GITHUB_TOKEN=\"ghp_...\"  # Your GitHub Personal Access Token\nexport OWNER=\"w9bikze8u4cbupc\"  # Repository owner\nexport REPO=\"MOBIUS\"  # Repository name\n</code></pre></p> </li> <li> <p>Run the script:    <pre><code>chmod +x create_prs_and_issues.sh\n./create_prs_and_issues.sh\n</code></pre></p> </li> </ol> <p>Or on Windows:    <pre><code>.\\create_prs_and_issues.ps1\n</code></pre></p>"},{"location":"roadmap/execution-options/#after-execution","title":"After Execution","text":"<p>Once the PRs are created, paste the PR URLs here for validation and next steps coordination.</p>"},{"location":"roadmap/execution-plan-summary/","title":"Execution Plan Summary","text":""},{"location":"roadmap/execution-plan-summary/#overview","title":"Overview","text":"<p>This document summarizes the comprehensive execution plan for finalizing and operationalizing the Mobius Preview Worker deployment infrastructure. It consolidates all the steps, documentation, and processes needed to ensure a robust, secure, scalable, and future-proof deployment environment.</p>"},{"location":"roadmap/execution-plan-summary/#completed-implementation","title":"Completed Implementation","text":""},{"location":"roadmap/execution-plan-summary/#1-deployment-infrastructure","title":"1. Deployment Infrastructure","text":"<ul> <li>Enhanced CLI Tool: Cross-platform Node.js CLI with full lifecycle management</li> <li>CI/CD Pipeline: Automated GitHub Actions workflows for build, deploy, and testing</li> <li>Cross-Platform Scripts: Paired PowerShell and Bash scripts for all operations</li> <li>Monitoring Integration: Prometheus metrics collection and alerting framework</li> <li>Security Measures: Secure credential handling and compliance with best practices</li> </ul>"},{"location":"roadmap/execution-plan-summary/#2-documentation-suite","title":"2. Documentation Suite","text":"<ul> <li>PHASE_F_DEPLOYMENT_INFRASTRUCTURE_SUMMARY.md: Complete phase implementation summary</li> <li>PREVIEW_WORKER_IMPLEMENTATION_SUMMARY.md: Detailed worker component documentation</li> <li>CI_CD_FINALIZATION_GUIDE.md: Secrets management and pipeline integrity</li> <li>MONITORING_DEPLOYMENT_GUIDE.md: Prometheus and alerting setup</li> <li>TEAM_TRAINING_GUIDE.md: Comprehensive training program</li> <li>ONGOING_MAINTENANCE_GUIDE.md: Continuous improvement processes</li> </ul>"},{"location":"roadmap/execution-plan-summary/#3-quick-reference-materials","title":"3. Quick Reference Materials","text":"<ul> <li>QUICK_REFERENCE_GUIDE.md: Essential commands and procedures</li> <li>DEPLOYMENT_MAINTENANCE_PLAYBOOK.md: Routine maintenance procedures</li> <li>DEPLOYMENT_METRICS_DASHBOARD.md: Metrics tracking template</li> </ul>"},{"location":"roadmap/execution-plan-summary/#immediate-next-steps","title":"Immediate Next Steps","text":""},{"location":"roadmap/execution-plan-summary/#1-documentation-publishing-automation","title":"1. Documentation Publishing Automation","text":"<p>Status: \u2705 Ready for implementation Actions: - Set up GitHub Pages or internal wiki for documentation portal - Configure automated publishing in CI/CD pipeline - Implement version control for documentation - Create navigation and search functionality</p>"},{"location":"roadmap/execution-plan-summary/#2-cicd-pipeline-finalization","title":"2. CI/CD Pipeline Finalization","text":"<p>Status: \u2705 Ready for implementation Actions: - Configure GitHub Secrets for GHCR_PAT and KUBECONFIG_DATA - Set up branch protection rules for main and staging branches - Implement environment protection rules for deployments - Configure workflow permissions and dispatch settings</p>"},{"location":"roadmap/execution-plan-summary/#3-monitoring-stack-deployment","title":"3. Monitoring Stack Deployment","text":"<p>Status: \u2705 Ready for implementation Actions: - Deploy Prometheus Operator in staging environment - Apply ServiceMonitor and alert rule configurations - Configure Alertmanager with Slack and PagerDuty integrations - Set up Grafana dashboards for key metrics</p>"},{"location":"roadmap/execution-plan-summary/#4-team-enablement-and-training","title":"4. Team Enablement and Training","text":"<p>Status: \u2705 Ready for implementation Actions: - Schedule training sessions based on TEAM_TRAINING_GUIDE.md - Distribute quick reference materials and cheat sheets - Conduct hands-on labs in sandbox environment - Provide certification and ongoing support</p>"},{"location":"roadmap/execution-plan-summary/#parallel-execution-tracks","title":"Parallel Execution Tracks","text":""},{"location":"roadmap/execution-plan-summary/#track-1-documentation-and-knowledge-management","title":"Track 1: Documentation and Knowledge Management","text":"<p>Lead: Documentation Team Timeline: Weeks 1-2 Deliverables: - Centralized documentation portal - Automated publishing pipeline - Version-controlled documentation - Search and navigation features</p>"},{"location":"roadmap/execution-plan-summary/#track-2-cicd-and-security","title":"Track 2: CI/CD and Security","text":"<p>Lead: DevOps Team Timeline: Weeks 1-3 Deliverables: - Finalized GitHub Secrets configuration - Branch protection rules implementation - Environment protection setup - Security audit and compliance verification</p>"},{"location":"roadmap/execution-plan-summary/#track-3-monitoring-and-observability","title":"Track 3: Monitoring and Observability","text":"<p>Lead: Operations Team Timeline: Weeks 2-4 Deliverables: - Prometheus deployment in staging - Alerting integrations configuration - Grafana dashboard implementation - Validation of monitoring workflows</p>"},{"location":"roadmap/execution-plan-summary/#track-4-team-training-and-enablement","title":"Track 4: Team Training and Enablement","text":"<p>Lead: Training Coordinator Timeline: Weeks 3-5 Deliverables: - Completed training program delivery - Hands-on lab execution - Certification awarding - Ongoing support channel establishment</p>"},{"location":"roadmap/execution-plan-summary/#ongoing-maintenance-and-improvement","title":"Ongoing Maintenance and Improvement","text":""},{"location":"roadmap/execution-plan-summary/#bi-weekly-review-process","title":"Bi-Weekly Review Process","text":"<ul> <li>Cadence: Every two weeks starting after initial deployment</li> <li>Participants: Development leads, operations leads, stakeholders</li> <li>Agenda: Metrics analysis, feedback review, improvement planning</li> <li>Deliverables: Action items, meeting notes, follow-up schedule</li> </ul>"},{"location":"roadmap/execution-plan-summary/#continuous-improvement-framework","title":"Continuous Improvement Framework","text":"<ul> <li>Backlog Management: Feature requests, technical debt, bug fixes</li> <li>Prioritization: Impact/effort matrix for item ranking</li> <li>Implementation: Task breakdown, resource allocation, timeline setting</li> <li>Tracking: Issue tracking, status updates, milestone planning</li> </ul>"},{"location":"roadmap/execution-plan-summary/#metrics-and-reporting","title":"Metrics and Reporting","text":"<ul> <li>KPIs: Reliability, performance, security, team productivity metrics</li> <li>Schedule: Daily dashboards, weekly summaries, monthly analysis</li> <li>Tools: Grafana dashboards, automated reports, real-time alerts</li> <li>Communication: Team meetings, stakeholder updates, community engagement</li> </ul>"},{"location":"roadmap/execution-plan-summary/#risk-management","title":"Risk Management","text":""},{"location":"roadmap/execution-plan-summary/#identified-risks","title":"Identified Risks","text":"<ol> <li>Documentation Adoption: Team may not fully utilize new documentation</li> <li>CI/CD Configuration: Secrets management or permissions issues</li> <li>Monitoring Integration: Alert fatigue or false positives</li> <li>Training Effectiveness: Knowledge retention and skill application</li> <li>Resource Constraints: Availability of team members for implementation</li> </ol>"},{"location":"roadmap/execution-plan-summary/#mitigation-strategies","title":"Mitigation Strategies","text":"<ol> <li>Documentation: Regular feedback collection and improvement</li> <li>CI/CD: Comprehensive testing and rollback procedures</li> <li>Monitoring: Alert tuning and validation procedures</li> <li>Training: Hands-on labs and ongoing mentorship</li> <li>Resources: Cross-training and knowledge sharing</li> </ol>"},{"location":"roadmap/execution-plan-summary/#success-criteria","title":"Success Criteria","text":""},{"location":"roadmap/execution-plan-summary/#short-term-1-3-months","title":"Short-Term (1-3 Months)","text":"<ul> <li>\u2705 Documentation portal live with automated publishing</li> <li>\u2705 CI/CD pipeline fully operational with security compliance</li> <li>\u2705 Monitoring stack deployed with alerting integrations</li> <li>\u2705 Team training completed with certification awarded</li> <li>\u2705 First bi-weekly review conducted</li> </ul>"},{"location":"roadmap/execution-plan-summary/#medium-term-3-6-months","title":"Medium-Term (3-6 Months)","text":"<ul> <li>\u2705 Metrics dashboard showing improved deployment reliability</li> <li>\u2705 Reduced incident response times through better monitoring</li> <li>\u2705 Positive feedback from team on documentation and tools</li> <li>\u2705 Continuous improvement backlog actively managed</li> <li>\u2705 Security audits showing compliance with best practices</li> </ul>"},{"location":"roadmap/execution-plan-summary/#long-term-6-months","title":"Long-Term (6+ Months)","text":"<ul> <li>\u2705 Industry recognition for deployment excellence</li> <li>\u2705 Team members contributing to community knowledge</li> <li>\u2705 Innovation initiatives resulting in competitive advantages</li> <li>\u2705 Scalable processes supporting organizational growth</li> <li>\u2705 Sustainable maintenance with minimal overhead</li> </ul>"},{"location":"roadmap/execution-plan-summary/#conclusion","title":"Conclusion","text":"<p>The execution plan for finalizing and operationalizing the Mobius Preview Worker deployment infrastructure is comprehensive and ready for implementation. All necessary documentation, processes, and resources have been prepared to ensure successful deployment and ongoing operations.</p> <p>The parallel execution tracks allow for efficient implementation while the ongoing maintenance framework ensures continuous improvement. Risk mitigation strategies are in place to address potential challenges, and success criteria provide clear measures of achievement.</p> <p>Regular reporting and adaptation of this plan will ensure continued success as the system and team evolve.# Execution Plan Summary</p>"},{"location":"roadmap/execution-plan-summary/#overview_1","title":"Overview","text":"<p>This document summarizes the comprehensive execution plan for finalizing and operationalizing the Mobius Preview Worker deployment infrastructure. It consolidates all the steps, documentation, and processes needed to ensure a robust, secure, scalable, and future-proof deployment environment.</p>"},{"location":"roadmap/execution-plan-summary/#completed-implementation_1","title":"Completed Implementation","text":""},{"location":"roadmap/execution-plan-summary/#1-deployment-infrastructure_1","title":"1. Deployment Infrastructure","text":"<ul> <li>Enhanced CLI Tool: Cross-platform Node.js CLI with full lifecycle management</li> <li>CI/CD Pipeline: Automated GitHub Actions workflows for build, deploy, and testing</li> <li>Cross-Platform Scripts: Paired PowerShell and Bash scripts for all operations</li> <li>Monitoring Integration: Prometheus metrics collection and alerting framework</li> <li>Security Measures: Secure credential handling and compliance with best practices</li> </ul>"},{"location":"roadmap/execution-plan-summary/#2-documentation-suite_1","title":"2. Documentation Suite","text":"<ul> <li>PHASE_F_DEPLOYMENT_INFRASTRUCTURE_SUMMARY.md: Complete phase implementation summary</li> <li>PREVIEW_WORKER_IMPLEMENTATION_SUMMARY.md: Detailed worker component documentation</li> <li>CI_CD_FINALIZATION_GUIDE.md: Secrets management and pipeline integrity</li> <li>MONITORING_DEPLOYMENT_GUIDE.md: Prometheus and alerting setup</li> <li>TEAM_TRAINING_GUIDE.md: Comprehensive training program</li> <li>ONGOING_MAINTENANCE_GUIDE.md: Continuous improvement processes</li> </ul>"},{"location":"roadmap/execution-plan-summary/#3-quick-reference-materials_1","title":"3. Quick Reference Materials","text":"<ul> <li>QUICK_REFERENCE_GUIDE.md: Essential commands and procedures</li> <li>DEPLOYMENT_MAINTENANCE_PLAYBOOK.md: Routine maintenance procedures</li> <li>DEPLOYMENT_METRICS_DASHBOARD.md: Metrics tracking template</li> </ul>"},{"location":"roadmap/execution-plan-summary/#immediate-next-steps_1","title":"Immediate Next Steps","text":""},{"location":"roadmap/execution-plan-summary/#1-documentation-publishing-automation_1","title":"1. Documentation Publishing Automation","text":"<p>Status: \u2705 Ready for implementation Actions: - Set up GitHub Pages or internal wiki for documentation portal - Configure automated publishing in CI/CD pipeline - Implement version control for documentation - Create navigation and search functionality</p>"},{"location":"roadmap/execution-plan-summary/#2-cicd-pipeline-finalization_1","title":"2. CI/CD Pipeline Finalization","text":"<p>Status: \u2705 Ready for implementation Actions: - Configure GitHub Secrets for GHCR_PAT and KUBECONFIG_DATA - Set up branch protection rules for main and staging branches - Implement environment protection rules for deployments - Configure workflow permissions and dispatch settings</p>"},{"location":"roadmap/execution-plan-summary/#3-monitoring-stack-deployment_1","title":"3. Monitoring Stack Deployment","text":"<p>Status: \u2705 Ready for implementation Actions: - Deploy Prometheus Operator in staging environment - Apply ServiceMonitor and alert rule configurations - Configure Alertmanager with Slack and PagerDuty integrations - Set up Grafana dashboards for key metrics</p>"},{"location":"roadmap/execution-plan-summary/#4-team-enablement-and-training_1","title":"4. Team Enablement and Training","text":"<p>Status: \u2705 Ready for implementation Actions: - Schedule training sessions based on TEAM_TRAINING_GUIDE.md - Distribute quick reference materials and cheat sheets - Conduct hands-on labs in sandbox environment - Provide certification and ongoing support</p>"},{"location":"roadmap/execution-plan-summary/#parallel-execution-tracks_1","title":"Parallel Execution Tracks","text":""},{"location":"roadmap/execution-plan-summary/#track-1-documentation-and-knowledge-management_1","title":"Track 1: Documentation and Knowledge Management","text":"<p>Lead: Documentation Team Timeline: Weeks 1-2 Deliverables: - Centralized documentation portal - Automated publishing pipeline - Version-controlled documentation - Search and navigation features</p>"},{"location":"roadmap/execution-plan-summary/#track-2-cicd-and-security_1","title":"Track 2: CI/CD and Security","text":"<p>Lead: DevOps Team Timeline: Weeks 1-3 Deliverables: - Finalized GitHub Secrets configuration - Branch protection rules implementation - Environment protection setup - Security audit and compliance verification</p>"},{"location":"roadmap/execution-plan-summary/#track-3-monitoring-and-observability_1","title":"Track 3: Monitoring and Observability","text":"<p>Lead: Operations Team Timeline: Weeks 2-4 Deliverables: - Prometheus deployment in staging - Alerting integrations configuration - Grafana dashboard implementation - Validation of monitoring workflows</p>"},{"location":"roadmap/execution-plan-summary/#track-4-team-training-and-enablement_1","title":"Track 4: Team Training and Enablement","text":"<p>Lead: Training Coordinator Timeline: Weeks 3-5 Deliverables: - Completed training program delivery - Hands-on lab execution - Certification awarding - Ongoing support channel establishment</p>"},{"location":"roadmap/execution-plan-summary/#ongoing-maintenance-and-improvement_1","title":"Ongoing Maintenance and Improvement","text":""},{"location":"roadmap/execution-plan-summary/#bi-weekly-review-process_1","title":"Bi-Weekly Review Process","text":"<ul> <li>Cadence: Every two weeks starting after initial deployment</li> <li>Participants: Development leads, operations leads, stakeholders</li> <li>Agenda: Metrics analysis, feedback review, improvement planning</li> <li>Deliverables: Action items, meeting notes, follow-up schedule</li> </ul>"},{"location":"roadmap/execution-plan-summary/#continuous-improvement-framework_1","title":"Continuous Improvement Framework","text":"<ul> <li>Backlog Management: Feature requests, technical debt, bug fixes</li> <li>Prioritization: Impact/effort matrix for item ranking</li> <li>Implementation: Task breakdown, resource allocation, timeline setting</li> <li>Tracking: Issue tracking, status updates, milestone planning</li> </ul>"},{"location":"roadmap/execution-plan-summary/#metrics-and-reporting_1","title":"Metrics and Reporting","text":"<ul> <li>KPIs: Reliability, performance, security, team productivity metrics</li> <li>Schedule: Daily dashboards, weekly summaries, monthly analysis</li> <li>Tools: Grafana dashboards, automated reports, real-time alerts</li> <li>Communication: Team meetings, stakeholder updates, community engagement</li> </ul>"},{"location":"roadmap/execution-plan-summary/#risk-management_1","title":"Risk Management","text":""},{"location":"roadmap/execution-plan-summary/#identified-risks_1","title":"Identified Risks","text":"<ol> <li>Documentation Adoption: Team may not fully utilize new documentation</li> <li>CI/CD Configuration: Secrets management or permissions issues</li> <li>Monitoring Integration: Alert fatigue or false positives</li> <li>Training Effectiveness: Knowledge retention and skill application</li> <li>Resource Constraints: Availability of team members for implementation</li> </ol>"},{"location":"roadmap/execution-plan-summary/#mitigation-strategies_1","title":"Mitigation Strategies","text":"<ol> <li>Documentation: Regular feedback collection and improvement</li> <li>CI/CD: Comprehensive testing and rollback procedures</li> <li>Monitoring: Alert tuning and validation procedures</li> <li>Training: Hands-on labs and ongoing mentorship</li> <li>Resources: Cross-training and knowledge sharing</li> </ol>"},{"location":"roadmap/execution-plan-summary/#success-criteria_1","title":"Success Criteria","text":""},{"location":"roadmap/execution-plan-summary/#short-term-1-3-months_1","title":"Short-Term (1-3 Months)","text":"<ul> <li>\u2705 Documentation portal live with automated publishing</li> <li>\u2705 CI/CD pipeline fully operational with security compliance</li> <li>\u2705 Monitoring stack deployed with alerting integrations</li> <li>\u2705 Team training completed with certification awarded</li> <li>\u2705 First bi-weekly review conducted</li> </ul>"},{"location":"roadmap/execution-plan-summary/#medium-term-3-6-months_1","title":"Medium-Term (3-6 Months)","text":"<ul> <li>\u2705 Metrics dashboard showing improved deployment reliability</li> <li>\u2705 Reduced incident response times through better monitoring</li> <li>\u2705 Positive feedback from team on documentation and tools</li> <li>\u2705 Continuous improvement backlog actively managed</li> <li>\u2705 Security audits showing compliance with best practices</li> </ul>"},{"location":"roadmap/execution-plan-summary/#long-term-6-months_1","title":"Long-Term (6+ Months)","text":"<ul> <li>\u2705 Industry recognition for deployment excellence</li> <li>\u2705 Team members contributing to community knowledge</li> <li>\u2705 Innovation initiatives resulting in competitive advantages</li> <li>\u2705 Scalable processes supporting organizational growth</li> <li>\u2705 Sustainable maintenance with minimal overhead</li> </ul>"},{"location":"roadmap/execution-plan-summary/#conclusion_1","title":"Conclusion","text":"<p>The execution plan for finalizing and operationalizing the Mobius Preview Worker deployment infrastructure is comprehensive and ready for implementation. All necessary documentation, processes, and resources have been prepared to ensure successful deployment and ongoing operations.</p> <p>The parallel execution tracks allow for efficient implementation while the ongoing maintenance framework ensures continuous improvement. Risk mitigation strategies are in place to address potential challenges, and success criteria provide clear measures of achievement.</p> <p>Regular reporting and adaptation of this plan will ensure continued success as the system and team evolve.</p>"},{"location":"roadmap/execution-readiness-summary/","title":"Execution Readiness Summary","text":""},{"location":"roadmap/execution-readiness-summary/#overview","title":"Overview","text":"<p>This document summarizes all the automation scripts, configuration files, and setup procedures needed to execute the immediate deployment infrastructure plan. All required components are ready for implementation.</p>"},{"location":"roadmap/execution-readiness-summary/#ready-for-execution","title":"Ready for Execution","text":""},{"location":"roadmap/execution-readiness-summary/#1-documentation-publishing-automation","title":"1. Documentation Publishing Automation","text":"<ul> <li>Workflow: .github/workflows/publish-docs.yaml</li> <li>Status: \u2705 Ready for deployment</li> <li>Function: Automatically publishes documentation to GitHub Pages</li> <li>Trigger: On push to main branch or manual dispatch</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#2-cicd-pipeline-finalization-scripts","title":"2. CI/CD Pipeline Finalization Scripts","text":"<ul> <li>PowerShell: scripts/setup-ci-cd.ps1</li> <li>Bash: scripts/setup-ci-cd.sh</li> <li>Status: \u2705 Ready for execution</li> <li>Function: Configures GitHub secrets, branch protection, and environment rules</li> <li>Requirements: GitHub CLI, repository access</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#3-monitoring-stack-deployment-scripts","title":"3. Monitoring Stack Deployment Scripts","text":"<ul> <li>PowerShell: scripts/deploy-monitoring.ps1</li> <li>Bash: scripts/deploy-monitoring.sh</li> <li>Status: \u2705 Ready for execution</li> <li>Function: Deploys Prometheus, Grafana, Alertmanager with integrations</li> <li>Requirements: kubectl, Helm, Kubernetes cluster access</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#4-team-training-schedule-and-materials","title":"4. Team Training Schedule and Materials","text":"<ul> <li>Schedule: TRAINING_SCHEDULE.md</li> <li>Template: BIWEEKLY_REVIEW_TEMPLATE.md</li> <li>Status: \u2705 Ready for implementation</li> <li>Function: Provides structured training program and review process</li> <li>Requirements: Meeting coordination, training environment setup</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#implementation-timeline","title":"Implementation Timeline","text":""},{"location":"roadmap/execution-readiness-summary/#days-1-3-documentation-publishing-and-cicd-finalization","title":"Days 1-3: Documentation Publishing and CI/CD Finalization","text":"<ol> <li>Day 1:</li> <li>Deploy documentation publishing workflow</li> <li>Execute CI/CD setup scripts</li> <li>Verify GitHub secrets configuration</li> <li> <p>Test branch protection rules</p> </li> <li> <p>Day 2:</p> </li> <li>Validate documentation publishing</li> <li>Confirm environment protection rules</li> <li>Test required status checks</li> <li> <p>Document any issues and resolutions</p> </li> <li> <p>Day 3:</p> </li> <li>Finalize CI/CD configuration</li> <li>Conduct security audit of secrets</li> <li>Prepare for monitoring deployment</li> <li>Schedule team training sessions</li> </ol>"},{"location":"roadmap/execution-readiness-summary/#days-4-6-monitoring-stack-deployment","title":"Days 4-6: Monitoring Stack Deployment","text":"<ol> <li>Day 4:</li> <li>Execute monitoring deployment scripts</li> <li>Configure Prometheus and Grafana</li> <li>Deploy ServiceMonitor and alert rules</li> <li> <p>Set up Alertmanager integrations</p> </li> <li> <p>Day 5:</p> </li> <li>Verify monitoring stack functionality</li> <li>Test alert workflows with simulations</li> <li>Configure Grafana dashboards</li> <li> <p>Validate metrics collection</p> </li> <li> <p>Day 6:</p> </li> <li>Finalize alerting configurations</li> <li>Conduct end-to-end monitoring test</li> <li>Document monitoring procedures</li> <li>Prepare for team training</li> </ol>"},{"location":"roadmap/execution-readiness-summary/#days-7-8-team-training","title":"Days 7-8: Team Training","text":"<ol> <li>Day 7:</li> <li>Session 1: Architecture and CLI usage (10:00 AM - 12:00 PM)</li> <li>Session 2: Deployment workflows and troubleshooting (2:00 PM - 4:00 PM)</li> <li>Provide hands-on lab access</li> <li> <p>Collect session feedback</p> </li> <li> <p>Day 8:</p> </li> <li>Session 3: Monitoring, alerting, and security (10:00 AM - 12:00 PM)</li> <li>Session 4: Maintenance and continuous improvement (2:00 PM - 3:00 PM)</li> <li>Conduct certification process</li> <li>Establish ongoing support channels</li> </ol>"},{"location":"roadmap/execution-readiness-summary/#ongoing-bi-weekly-reviews","title":"Ongoing: Bi-weekly Reviews","text":"<ul> <li>First Review: Scheduled for completion of initial deployment</li> <li>Cadence: Every two weeks thereafter</li> <li>Process: Use BIWEEKLY_REVIEW_TEMPLATE.md</li> <li>Participants: Development leads, operations leads, stakeholders</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#prerequisites-verification","title":"Prerequisites Verification","text":""},{"location":"roadmap/execution-readiness-summary/#tooling-requirements","title":"Tooling Requirements","text":"<ul> <li>\u2705 GitHub CLI (gh)</li> <li>\u2705 kubectl CLI</li> <li>\u2705 Helm CLI</li> <li>\u2705 Docker Desktop with Kubernetes</li> <li>\u2705 Node.js for documentation publishing</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#access-requirements","title":"Access Requirements","text":"<ul> <li>\u2705 GitHub repository write access</li> <li>\u2705 Kubernetes cluster admin access</li> <li>\u2705 GHCR write permissions</li> <li>\u2705 Slack/PagerDuty integration credentials (optional)</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#environment-requirements","title":"Environment Requirements","text":"<ul> <li>\u2705 Sandbox Kubernetes namespace for training</li> <li>\u2705 Staging environment for monitoring validation</li> <li>\u2705 Conference facilities or virtual meeting setup</li> <li>\u2705 Shared documentation platform access</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#risk-mitigation","title":"Risk Mitigation","text":""},{"location":"roadmap/execution-readiness-summary/#identified-risks","title":"Identified Risks","text":"<ol> <li>Tool Installation Issues</li> <li>Mitigation: Pre-verification of all required tools</li> <li> <p>Contingency: Manual setup procedures documented</p> </li> <li> <p>Access Permission Problems</p> </li> <li>Mitigation: Early validation of all access credentials</li> <li> <p>Contingency: Alternative authentication methods</p> </li> <li> <p>Training Participation</p> </li> <li>Mitigation: Mandatory attendance with management support</li> <li> <p>Contingency: Recorded sessions for later viewing</p> </li> <li> <p>Monitoring Integration Failures</p> </li> <li>Mitigation: Staged deployment with rollback procedures</li> <li>Contingency: Manual monitoring setup procedures</li> </ol>"},{"location":"roadmap/execution-readiness-summary/#success-criteria","title":"Success Criteria","text":""},{"location":"roadmap/execution-readiness-summary/#short-term-completion-of-execution-plan","title":"Short-term (Completion of Execution Plan)","text":"<ul> <li>\u2705 Documentation automatically published to GitHub Pages</li> <li>\u2705 CI/CD pipeline fully configured with security compliance</li> <li>\u2705 Monitoring stack deployed with alerting integrations</li> <li>\u2705 Team training completed with certification awarded</li> <li>\u2705 First bi-weekly review conducted</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#medium-term-3-months","title":"Medium-term (3 Months)","text":"<ul> <li>\u2705 95%+ deployment success rate</li> <li>\u2705 &lt; 30 minute mean time to recovery</li> <li>\u2705 Positive team feedback on tools and processes</li> <li>\u2705 Active backlog of improvement items</li> <li>\u2705 Regular bi-weekly reviews conducted</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#long-term-6-months","title":"Long-term (6+ Months)","text":"<ul> <li>\u2705 Industry recognition for deployment excellence</li> <li>\u2705 Team members contributing to community knowledge</li> <li>\u2705 Innovation initiatives resulting in competitive advantages</li> <li>\u2705 Scalable processes supporting organizational growth</li> <li>\u2705 Sustainable maintenance with minimal overhead</li> </ul>"},{"location":"roadmap/execution-readiness-summary/#next-steps","title":"Next Steps","text":""},{"location":"roadmap/execution-readiness-summary/#immediate-actions","title":"Immediate Actions","text":"<ol> <li>Today: </li> <li>Deploy documentation publishing workflow</li> <li>Begin CI/CD setup script execution</li> <li> <p>Confirm all prerequisites are met</p> </li> <li> <p>Tomorrow:</p> </li> <li>Verify documentation publishing</li> <li>Complete GitHub secrets configuration</li> <li> <p>Schedule training sessions</p> </li> <li> <p>Day 3:</p> </li> <li>Finalize CI/CD configuration</li> <li>Begin monitoring deployment preparation</li> <li>Confirm training environment readiness</li> </ol>"},{"location":"roadmap/execution-readiness-summary/#conclusion","title":"Conclusion","text":"<p>All automation scripts, configuration files, and procedural documentation are ready for immediate execution of the deployment infrastructure plan. The implementation has been carefully structured to ensure robustness, security, stability, and scalability while maintaining cross-platform compatibility and following all security best practices.</p> <p>Regular monitoring and adaptation of this plan will ensure continued success as the system and team evolve.</p>"},{"location":"roadmap/immediate-actions-completed/","title":"Preview Worker PR #165 - Immediate Actions Completed","text":""},{"location":"roadmap/immediate-actions-completed/#summary","title":"Summary","text":"<p>I've successfully implemented fixes for anticipated CI failures in PR #165 and pushed the changes to the remote branch.</p>"},{"location":"roadmap/immediate-actions-completed/#actions-taken","title":"Actions Taken","text":"<ol> <li>Fixed Image Tag Issue: </li> <li> <p>Updated <code>k8s/preview-worker/deployment.yaml</code> to use a placeholder image tag (<code>YOUR_REGISTRY/mobius-preview-worker:TAG</code>) instead of the non-existent <code>registry.example.com/mobius-preview-worker:1.0.0</code></p> </li> <li> <p>Ensured Manifest Completeness:</p> </li> <li>Verified all required Kubernetes manifest files exist</li> <li> <p>Created <code>k8s/preview-worker/service.yaml</code> if it was missing</p> </li> <li> <p>Pushed Changes:</p> </li> <li>Committed fixes with message: \"fix(k8s): update preview-worker image tag to placeholder to prevent CI failures\"</li> <li>Pushed changes to the <code>feat/preview-worker-k8s-final-image</code> branch</li> </ol>"},{"location":"roadmap/immediate-actions-completed/#documentation-created","title":"Documentation Created","text":"<ol> <li><code>CI_RUNS_TRIAGE.md</code> - Analysis of anticipated CI failures</li> <li><code>CI_FIXES_SUMMARY.md</code> - Summary of implemented fixes</li> <li><code>MERGE_CHECKLIST_PREVIEW_WORKER.md</code> - Next steps for merging</li> </ol>"},{"location":"roadmap/immediate-actions-completed/#next-steps-for-you","title":"Next Steps for You","text":"<ol> <li>Monitor CI Status: Check the PR page on GitHub for CI run results</li> <li>Address Additional Failures: Fix any other CI issues that may arise</li> <li>Proceed with Merge: Once CI is passing, continue with your planned merge checklist</li> <li>Execute Rollout: Follow the production rollout plan as outlined in the PR</li> </ol> <p>The immediate CI blocking issues have been addressed. Please check the CI status on the PR page and let me know if any additional failures need to be addressed.</p>"},{"location":"roadmap/phase-f-rollout-execution-plan/","title":"Phase F Rollout Execution Plan","text":""},{"location":"roadmap/phase-f-rollout-execution-plan/#overview","title":"Overview","text":"<p>This document contains all the commands and files needed to execute the Phase F rollout, including creating the main PR, adding the staging verification workflow, and creating the follow-up issues.</p>"},{"location":"roadmap/phase-f-rollout-execution-plan/#files-created","title":"Files Created","text":"<ol> <li><code>create_phase_f_pr.sh</code> - Script to create the main PR for Phase F</li> <li><code>.github/workflows/staging-verify-phase-f.yml</code> - Staging verification workflow</li> <li><code>add_workflow_pr.sh</code> - Script to add and create PR for the staging workflow</li> <li><code>preview_worker_issue.md</code> - Issue body for Preview Worker implementation</li> <li><code>asset_uploads_issue.md</code> - Issue body for Asset Uploads implementation</li> <li><code>packaging_issue.md</code> - Issue body for Packaging implementation</li> <li><code>create_issues.sh</code> - Script to create all three follow-up issues</li> </ol>"},{"location":"roadmap/phase-f-rollout-execution-plan/#execution-steps","title":"Execution Steps","text":""},{"location":"roadmap/phase-f-rollout-execution-plan/#1-create-the-pr-for-phase-fpreview-image-matcher","title":"1. Create the PR for phase-f/preview-image-matcher","text":"<p>Run the following command from your repository root:</p> <pre><code>gh pr create \\\n  --base staging \\\n  --head phase-f/preview-image-matcher \\\n  --title \"Phase F: Image Matcher UI + Preview backend stub\" \\\n  --body-file ./pr_body.md \\\n  --label \"feature\" \\\n  --label \"phase-f\" \\\n  --label \"needs-review\" \\\n  --label \"ready-for-staging\" \\\n  --reviewer \"developer\" \\\n  --reviewer \"ops\" \\\n  --reviewer \"team-lead\" \\\n  --assignee \"developer\" \\\n  --web\n</code></pre>"},{"location":"roadmap/phase-f-rollout-execution-plan/#2-add-and-create-pr-for-the-staging-workflow","title":"2. Add and create PR for the staging workflow","text":"<p>First, ensure the workflow file exists at <code>.github/workflows/staging-verify-phase-f.yml</code>, then run:</p> <pre><code># Create branch for the CI/workflow changes\ngit checkout -b ci/add-phase-f-verify-workflow\n\n# Stage the workflow file\ngit add .github/workflows/staging-verify-phase-f.yml\n\n# Commit\ngit commit -m \"chore(ci): add staging verify workflow for Phase F (Linux + Windows)\"\n\n# Push branch\ngit push --set-upstream origin ci/add-phase-f-verify-workflow\n\n# Open PR to staging\ngh pr create --base staging --head ci/add-phase-f-verify-workflow \\\n  --title \"CI: Add staging verify workflow for Phase F\" \\\n  --body \"Adds post-deploy verification jobs (Linux + Windows) to verify Phase F preview &amp; matcher functionality. Runs scripts/verify-phase-f.sh and .ps1. See docs/runbook-preview.md for run instructions.\" \\\n  --label \"ci\" --label \"phase-f\" --reviewer \"ops\" --assignee \"developer\" --web\n</code></pre>"},{"location":"roadmap/phase-f-rollout-execution-plan/#3-create-the-three-follow-up-issues","title":"3. Create the three follow-up issues","text":"<p>Run these commands to create the issues in the repo:</p>"},{"location":"roadmap/phase-f-rollout-execution-plan/#a-preview-worker-issue","title":"A) Preview Worker Issue","text":"<pre><code>gh issue create --title \"Preview Worker \u2014 render queued chapter previews (Phase F)\" \\\n  --body-file ./preview_worker_issue.md \\\n  --assignee developer --label \"feature\" --label \"phase-f\"\n</code></pre>"},{"location":"roadmap/phase-f-rollout-execution-plan/#b-asset-uploads-hashed-storage-issue","title":"B) Asset Uploads &amp; Hashed Storage Issue","text":"<pre><code>gh issue create --title \"Asset uploads &amp; hashed storage \u2014 upload endpoint + thumbnails\" \\\n  --body-file ./asset_uploads_issue.md \\\n  --assignee developer --label \"feature\" --label \"phase-f\"\n</code></pre>"},{"location":"roadmap/phase-f-rollout-execution-plan/#c-packaging-export-endpoint-issue","title":"C) Packaging &amp; Export Endpoint Issue","text":"<pre><code>gh issue create --title \"Export Packaging \u2014 create downloadable tutorial bundle (zip)\" \\\n  --body-file ./packaging_issue.md \\\n  --assignee developer --label \"feature\" --label \"phase-f\" --label \"packaging\"\n</code></pre>"},{"location":"roadmap/phase-f-rollout-execution-plan/#post-execution-checklist","title":"Post-Execution Checklist","text":"<p>After running the commands:</p> <ol> <li>Confirm PR(s) opened &amp; reviewers assigned.</li> <li>Confirm the staging-verify workflow PR exists and CI passes on that PR.</li> <li>Confirm the three issues exist and are assigned to developer.</li> <li>Run a manual dry-run of /api/preview after staging deploy and verify artifact + metric.</li> <li>Share failing logs or artifacts if something breaks \u2014 cite requestId(s).</li> </ol>"},{"location":"roadmap/phase-f-rollout-execution-plan/#post-merge-to-staging","title":"Post-Merge to Staging","text":"<ol> <li>Set PREVIEW_MAX_CONCURRENCY=1, PREVIEW_QUEUE_MAX=20.</li> <li>Ensure secrets.STAGING_API_URL is set in the repo.</li> <li>Merge PRs and watch the staging verification workflow run.</li> </ol>"},{"location":"roadmap/phase-f-rollout-status/","title":"Phase F Rollout Status","text":""},{"location":"roadmap/phase-f-rollout-status/#branches-created-and-pushed","title":"Branches Created and Pushed","text":"<ol> <li>Feature Branch: phase-f/preview-image-matcher</li> <li>Contains all Phase F implementation</li> <li> <p>Already pushed to remote repository</p> </li> <li> <p>CI Workflow Branch: ci/add-phase-f-verify-workflow</p> </li> <li>Contains staging verification workflow</li> <li>Already pushed to remote repository</li> </ol>"},{"location":"roadmap/phase-f-rollout-status/#next-steps","title":"Next Steps","text":""},{"location":"roadmap/phase-f-rollout-status/#1-create-pull-requests","title":"1. Create Pull Requests","text":""},{"location":"roadmap/phase-f-rollout-status/#feature-pr","title":"Feature PR","text":"<ul> <li>Base: staging</li> <li>Head: phase-f/preview-image-matcher</li> <li>Title: \"Phase F: Image Matcher UI + Preview backend stub\"</li> <li>Description: Use content from pr_body.md</li> <li>Labels: feature, phase-f, needs-review, ready-for-staging</li> <li>Reviewers: developer, ops, team-lead</li> <li>Assignee: developer</li> </ul>"},{"location":"roadmap/phase-f-rollout-status/#ci-workflow-pr","title":"CI Workflow PR","text":"<ul> <li>Base: staging</li> <li>Head: ci/add-phase-f-verify-workflow</li> <li>Title: \"CI: Add staging verify workflow for Phase F\"</li> <li>Description: Adds post-deploy verification jobs (Linux + Windows) to verify Phase F preview and matcher functionality. Runs scripts/verify-phase-f.sh and .ps1. See docs/runbook-preview.md for run instructions.</li> <li>Labels: ci, phase-f</li> <li>Reviewers: ops</li> <li>Assignee: developer</li> </ul>"},{"location":"roadmap/phase-f-rollout-status/#2-create-follow-up-issues","title":"2. Create Follow-up Issues","text":"<p>Three issues need to be created manually:</p> <ol> <li>Preview Worker Implementation</li> <li>Asset Uploads &amp; Hashed Storage</li> <li>Packaging &amp; Export Endpoint</li> </ol> <p>Use the detailed descriptions from the CREATE_PR_AND_ISSUES.ps1 script output.</p>"},{"location":"roadmap/phase-f-rollout-status/#3-post-merge-staging-steps","title":"3. Post-Merge Staging Steps","text":"<p>After PRs are merged:</p> <ol> <li>Set environment variables:</li> <li>PREVIEW_MAX_CONCURRENCY=1</li> <li>PREVIEW_QUEUE_MAX=20</li> <li>Ensure DATA_DIR is writable by the service user</li> <li> <p>Ensure secrets.STAGING_API_URL exists and points to the staging API base</p> </li> <li> <p>Deploy staging (your normal process)</p> </li> <li> <p>Watch the staging verify workflow run:</p> </li> <li>Runs scripts/verify-phase-f.sh on Linux runner</li> <li>Runs scripts/verify-phase-f.ps1 on Windows runner</li> <li>Uploads logs to artifacts on failure</li> </ol>"},{"location":"roadmap/phase-f-rollout-status/#4-manual-smoke-tests","title":"4. Manual Smoke Tests","text":"<p>After staging deploy:</p> <ol> <li> <p>Dry-run preview via curl:    <pre><code>curl -X POST \"https://staging.example.com/api/preview?dryRun=true\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-api-version: v1\" \\\n  -d '{\"projectId\":\"smoke\",\"chapterId\":\"c1\",\"chapter\":{\"title\":\"smoke\",\"steps\":[{\"id\":\"s1\",\"title\":\"t\",\"body\":\"b\"}]}}'\n</code></pre></p> </li> <li> <p>Expected: HTTP 202 JSON with { status: \"dry_run\" | \"queued\", jobToken, previewPath }</p> </li> <li> <p>Check artifact exists:    <pre><code>ls -l ./data/previews/smoke/c1.json\njq . ./data/previews/smoke/c1.json\n</code></pre></p> </li> <li> <p>Confirm metric increment:    <pre><code>curl https://staging.example.com/metrics | grep preview_requests_total\n</code></pre></p> </li> </ol>"},{"location":"roadmap/phase-f-rollout-status/#5-merge-strategy-rollout","title":"5. Merge Strategy &amp; Rollout","text":"<ol> <li>Merge feature PR into staging (squash merge)</li> <li>Let staging verify workflow run and pass</li> <li>Soak on staging for 24 hours (watch metrics and errors)</li> <li>Progressive rollout to production only after soak passes &amp; runbook confirmed</li> </ol>"},{"location":"roadmap/phase-f-rollout-status/#files-summary","title":"Files Summary","text":"<p>All required files are in the repository:</p> <ul> <li>Implementation files in src/ and client/src/</li> <li>Tests in tests/</li> <li>Scripts in scripts/</li> <li>Documentation in docs/</li> <li>CI workflow in .github/workflows/</li> <li>Execution plan in PHASE_F_ROLLOUT_EXECUTION_PLAN.md</li> <li>Runbook in docs/runbook-preview.md</li> </ul>"},{"location":"roadmap/rollout-plan-preview-worker/","title":"Preview Worker Rollout Plan","text":""},{"location":"roadmap/rollout-plan-preview-worker/#pre-deployment-checklist","title":"Pre-Deployment Checklist","text":"<ul> <li>[ ] Redis server is installed and running</li> <li>[ ] Redis connection settings are configured in environment variables</li> <li>[ ] Data directory permissions are set correctly</li> <li>[ ] Monitoring and alerting systems are configured</li> <li>[ ] CI/CD pipeline is updated with worker tests</li> <li>[ ] Documentation is updated with worker usage instructions</li> </ul>"},{"location":"roadmap/rollout-plan-preview-worker/#deployment-steps","title":"Deployment Steps","text":""},{"location":"roadmap/rollout-plan-preview-worker/#1-staging-environment","title":"1. Staging Environment","text":"<ol> <li>Deploy worker service to staging environment</li> <li>Configure environment variables:</li> <li><code>REDIS_URL</code> - Redis connection string</li> <li><code>PREVIEW_QUEUE_NAME</code> - Name of the preview job queue</li> <li><code>PREVIEW_WORKER_CONCURRENCY</code> - Number of concurrent jobs (default: 2)</li> <li><code>DATA_DIR</code> - Directory for storing preview artifacts</li> <li>Start the worker service</li> <li>Verify service is running and connected to Redis</li> <li>Test job submission and processing through API</li> <li>Monitor metrics and logs for errors</li> </ol>"},{"location":"roadmap/rollout-plan-preview-worker/#2-production-environment","title":"2. Production Environment","text":"<ol> <li>Deploy worker service to production environment</li> <li>Configure environment variables (same as staging)</li> <li>Start the worker service</li> <li>Monitor for successful job processing</li> <li>Verify metrics collection is working</li> <li>Set up alerts for failure conditions</li> </ol>"},{"location":"roadmap/rollout-plan-preview-worker/#monitoring-alerting","title":"Monitoring &amp; Alerting","text":""},{"location":"roadmap/rollout-plan-preview-worker/#key-metrics-to-monitor","title":"Key Metrics to Monitor","text":"<ol> <li>Job Processing Rate: Track how many jobs are processed per minute</li> <li>Job Success Rate: Percentage of jobs that complete successfully</li> <li>Job Failure Rate: Percentage of jobs that fail</li> <li>Average Job Processing Time: Time taken to process jobs</li> <li>Queue Depth: Number of jobs waiting in the queue</li> <li>Worker Health: Status of the worker service</li> </ol>"},{"location":"roadmap/rollout-plan-preview-worker/#alerting-rules","title":"Alerting Rules","text":"<ol> <li>High Failure Rate: Alert when job failure rate exceeds 5% for 5 minutes</li> <li>Queue Backlog: Alert when queue depth exceeds 100 jobs for 10 minutes</li> <li>Worker Down: Alert when worker service is not reporting health checks</li> <li>High Processing Time: Alert when average job processing time exceeds 60 seconds</li> <li>Redis Connectivity: Alert when worker cannot connect to Redis</li> </ol>"},{"location":"roadmap/rollout-plan-preview-worker/#monitoring-endpoints","title":"Monitoring Endpoints","text":"<ul> <li><code>/api/preview/worker/health</code> - Health check endpoint</li> <li><code>/api/preview/queue/metrics</code> - Queue metrics endpoint</li> <li><code>/metrics</code> - Prometheus metrics endpoint (if configured)</li> </ul>"},{"location":"roadmap/rollout-plan-preview-worker/#rollback-procedure","title":"Rollback Procedure","text":"<ol> <li>If issues are detected, stop the worker service immediately</li> <li>Review logs and metrics to identify the cause</li> <li>If necessary, rollback to the previous version</li> <li>Notify team of the issue and resolution plan</li> <li>Investigate and fix the root cause</li> <li>Re-deploy the fixed version after verification</li> </ol>"},{"location":"roadmap/rollout-plan-preview-worker/#post-deployment-verification","title":"Post-Deployment Verification","text":"<ul> <li>[ ] Worker service is running and processing jobs</li> <li>[ ] Jobs are completing successfully</li> <li>[ ] Metrics are being collected and reported</li> <li>[ ] Monitoring and alerting systems are working</li> <li>[ ] Logs are being written and rotated properly</li> <li>[ ] Performance is within expected parameters</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/","title":"Branch Protection Rollback Plan","text":""},{"location":"roadmap/stricter-protection-rollback-plan/#overview","title":"Overview","text":"<p>This document provides step-by-step instructions for rolling back branch protection changes if issues occur after updating required status check contexts.</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#when-to-rollback","title":"When to Rollback","text":"<p>Consider rolling back if you experience: - \u2705 False positives: PRs blocked by non-existent or incorrectly named check-runs - \u2705 CI failures: Matrix jobs not running or reporting under different names - \u2705 Workflow disruption: Team unable to merge legitimate PRs - \u2705 Emergency hotfixes: Critical fixes blocked by protection rules</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#quick-rollback-emergency","title":"Quick Rollback (Emergency)","text":""},{"location":"roadmap/stricter-protection-rollback-plan/#option-1-use-backup-files-recommended","title":"Option 1: Use Backup Files (Recommended)","text":"<p>If you used the <code>update-branch-protection-contexts.*</code> scripts, backup files were automatically created:</p> <p>Bash: <pre><code># Find your backup file (most recent)\nls -la /tmp/branch-protection-backup/\n\n# Set variables\nexport OWNER=\"your-org\"\nexport REPO=\"your-repo\"  \nexport BRANCH=\"main\"\nBACKUP_FILE=\"/tmp/branch-protection-backup/protection-backup-YYYYMMDD-HHMMSS.json\"\n\n# Restore from backup\ncurl -X PUT \\\n  -H \"Authorization: token $GITHUB_TOKEN\" \\\n  -H \"Accept: application/vnd.github+json\" \\\n  -H \"Content-Type: application/json\" \\\n  \"https://api.github.com/repos/$OWNER/$REPO/branches/$BRANCH/protection\" \\\n  --data-binary @\"$BACKUP_FILE\"\n</code></pre></p> <p>PowerShell: <pre><code># Find your backup file (most recent)\nGet-ChildItem \"$env:TEMP\\branch-protection-backup\\\" | Sort-Object LastWriteTime -Descending\n\n# Set variables\n$Owner = \"your-org\"\n$Repo = \"your-repo\"\n$Branch = \"main\"\n$BackupFile = \"$env:TEMP\\branch-protection-backup\\protection-backup-YYYYMMDD-HHMMSS.json\"\n\n$headers = @{\n    Authorization = \"token $env:GITHUB_TOKEN\"\n    Accept = \"application/vnd.github+json\"\n}\n\n# Restore from backup\nInvoke-RestMethod -Method Put -Uri \"https://api.github.com/repos/$Owner/$Repo/branches/$Branch/protection\" -Headers $headers -Body (Get-Content $BackupFile -Raw) -ContentType \"application/json\"\n</code></pre></p>"},{"location":"roadmap/stricter-protection-rollback-plan/#option-2-disable-required-status-checks-emergency-only","title":"Option 2: Disable Required Status Checks (Emergency Only)","text":"<p>If no backup is available and you need immediate access:</p> <p>Bash: <pre><code># Create minimal protection (removes required status checks)\ncat &gt; /tmp/emergency-protection.json &lt;&lt; 'EOF'\n{\n  \"required_status_checks\": null,\n  \"enforce_admins\": {\n    \"enabled\": true\n  },\n  \"required_pull_request_reviews\": {\n    \"required_approving_review_count\": 1,\n    \"dismiss_stale_reviews\": true,\n    \"require_code_owner_reviews\": false\n  },\n  \"restrictions\": null\n}\nEOF\n\ncurl -X PUT \\\n  -H \"Authorization: token $GITHUB_TOKEN\" \\\n  -H \"Accept: application/vnd.github+json\" \\\n  -H \"Content-Type: application/json\" \\\n  \"https://api.github.com/repos/$OWNER/$REPO/branches/$BRANCH/protection\" \\\n  --data-binary @/tmp/emergency-protection.json\n</code></pre></p> <p>PowerShell: <pre><code># Create minimal protection (removes required status checks)\n$emergencyProtection = @{\n    required_status_checks = $null\n    enforce_admins = @{\n        enabled = $true\n    }\n    required_pull_request_reviews = @{\n        required_approving_review_count = 1\n        dismiss_stale_reviews = $true\n        require_code_owner_reviews = $false\n    }\n    restrictions = $null\n}\n\nInvoke-RestMethod -Method Put -Uri \"https://api.github.com/repos/$Owner/$Repo/branches/$Branch/protection\" -Headers $headers -Body ($emergencyProtection | ConvertTo-Json -Depth 20) -ContentType \"application/json\"\n</code></pre></p>"},{"location":"roadmap/stricter-protection-rollback-plan/#verification-after-rollback","title":"Verification After Rollback","text":""},{"location":"roadmap/stricter-protection-rollback-plan/#1-confirm-protection-status","title":"1. Confirm Protection Status","text":"<pre><code># Check current protection\ncurl -sS -H \"Authorization: token $GITHUB_TOKEN\" \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/$OWNER/$REPO/branches/$BRANCH/protection\" \\\n  | jq '.required_status_checks.contexts // []'\n</code></pre> <pre><code># Check current protection\n$protection = Invoke-RestMethod -Uri \"https://api.github.com/repos/$Owner/$Repo/branches/$Branch/protection\" -Headers $headers\n$protection.required_status_checks.contexts\n</code></pre>"},{"location":"roadmap/stricter-protection-rollback-plan/#2-test-pr-merge","title":"2. Test PR Merge","text":"<ul> <li>Create a test PR or use an existing one</li> <li>Verify that legitimate PRs can now merge</li> <li>Confirm CI still runs (even if not required)</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/#3-monitor-team-access","title":"3. Monitor Team Access","text":"<ul> <li>Notify team that rollback is complete</li> <li>Confirm no one is blocked from merging</li> <li>Document any ongoing issues</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/#root-cause-analysis","title":"Root Cause Analysis","text":"<p>After rollback, investigate the original issue:</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#1-check-actual-ci-check-run-names","title":"1. Check Actual CI Check-Run Names","text":"<p>Create a test PR and examine the actual check-run names: <pre><code># Get check-runs for a specific commit\ncurl -sS -H \"Authorization: token $GITHUB_TOKEN\" \\\n  -H \"Accept: application/vnd.github+json\" \\\n  \"https://api.github.com/repos/$OWNER/$REPO/commits/COMMIT_SHA/check-runs\" \\\n  | jq '.check_runs[] | select(.app.slug == \"github-actions\") | .name'\n</code></pre></p>"},{"location":"roadmap/stricter-protection-rollback-plan/#2-compare-expected-vs-actual","title":"2. Compare Expected vs Actual","text":"<ul> <li>Expected: What you configured in <code>required_status_checks.contexts</code></li> <li>Actual: What GitHub Actions actually reports</li> <li>Common mismatches:</li> <li>Job names vs workflow names</li> <li>Matrix parameter formatting</li> <li>Workflow file name changes</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/#3-common-issues-and-solutions","title":"3. Common Issues and Solutions","text":"Issue Cause Solution <code>CI / build-and-qa (ubuntu-latest)</code> not found Matrix job name format changed Update contexts to match actual format Workflow renamed CI workflow file renamed Update contexts with new workflow name Job name changed Job ID in workflow changed Update contexts with new job name Multiple workflows Multiple CI workflows running Include all required workflow check-runs"},{"location":"roadmap/stricter-protection-rollback-plan/#re-applying-protection-after-fix","title":"Re-applying Protection (After Fix)","text":"<p>Once you've identified and fixed the root cause:</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#1-update-context-names","title":"1. Update Context Names","text":"<p>Edit the <code>NEW_CONTEXTS</code> in your update script with the correct names:</p> <pre><code># In update-branch-protection-contexts.sh\nNEW_CONTEXTS='[\n  \"Correct Check Run Name 1\",\n  \"Correct Check Run Name 2\",\n  \"Correct Check Run Name 3\"\n]'\n</code></pre>"},{"location":"roadmap/stricter-protection-rollback-plan/#2-test-in-preview-mode","title":"2. Test in Preview Mode","text":"<p>Run the update script to generate preview JSON, but don't apply yet: <pre><code># Review the preview carefully\n./scripts/update-branch-protection-contexts.sh\n# When prompted, choose \"no\" to review the preview\n</code></pre></p>"},{"location":"roadmap/stricter-protection-rollback-plan/#3-apply-gradually","title":"3. Apply Gradually","text":"<p>Consider applying protection during low-activity periods: - Off-hours or weekends - After team notification - With team standing by to verify</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#4-monitor-closely","title":"4. Monitor Closely","text":"<p>After re-applying: - Watch for 24-48 hours - Monitor team Slack/communication channels - Check PR merge success rates - Be ready to rollback again if needed</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#prevention-for-next-time","title":"Prevention for Next Time","text":""},{"location":"roadmap/stricter-protection-rollback-plan/#1-use-the-capture-workflow","title":"1. Use the Capture Workflow","text":"<p>Ensure <code>.github/workflows/capture-check-runs.yml</code> is in place to automatically detect check-run names.</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#2-test-on-feature-branch-first","title":"2. Test on Feature Branch First","text":"<ul> <li>Create protection rules on a test branch first</li> <li>Verify check-run names match</li> <li>Only then apply to main/production branches</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/#3-gradual-rollout","title":"3. Gradual Rollout","text":"<ul> <li>Start with non-critical repositories</li> <li>Apply to one repository at a time</li> <li>Wait for stability before proceeding</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/#4-team-communication","title":"4. Team Communication","text":"<ul> <li>Announce changes in advance</li> <li>Provide rollback contact information</li> <li>Document the change in team channels</li> </ul>"},{"location":"roadmap/stricter-protection-rollback-plan/#emergency-contacts","title":"Emergency Contacts","text":"<p>When rollback is needed: 1. Immediate: Use this document for self-service rollback 2. If stuck: Contact repository administrators 3. If urgent: Escalate to platform/DevOps team</p>"},{"location":"roadmap/stricter-protection-rollback-plan/#files-and-artifacts","title":"Files and Artifacts","text":"<p>Keep these files for troubleshooting: - <code>/tmp/branch-protection-backup/protection-backup-*.json</code> (backup files) - <code>/tmp/branch-protection-preview.json</code> (preview of changes) - <code>/tmp/branch-protection-applied-*.json</code> (applied configuration) - GitHub Actions logs from failed CI runs - Screenshots of error messages</p> <p>Remember: It's better to rollback quickly and investigate than to leave the team blocked. Branch protection can always be re-applied once the issue is understood and resolved.</p>"}]}