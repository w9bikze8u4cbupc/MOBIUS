# Example configuration snippet that restricts access to the /metrics endpoint.
#
# Place this inside the relevant server block of the gateway ingress.  The
# configuration protects Prometheus metrics by requiring basic authentication
# and limiting requests to a known CIDR range.

location /metrics {
    satisfy any;
    allow 10.0.0.0/8;        # internal network
    allow 192.168.0.0/16;    # VPN
    deny  all;

    auth_basic           "Gateway Metrics";
    auth_basic_user_file /etc/nginx/secrets/gateway-metrics.htpasswd;

    proxy_pass http://gateway-internal/metrics;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
}
